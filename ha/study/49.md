# 49. –í —á–µ–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Deployment –∏ StatefulSet?

## üéØ **–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ Kubernetes**

**–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç, –∫–∞–∫ Kubernetes –∑–∞–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ä—ã–µ Pod'—ã –Ω–æ–≤—ã–º–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. Deployment –∏ StatefulSet –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–∞–∑–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∏–∑-–∑–∞ —Ä–∞–∑–ª–∏—á–∏–π –≤ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏: Deployment –¥–ª—è stateless –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, StatefulSet –¥–ª—è stateful –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∫ –ø–æ—Ä—è–¥–∫—É –∏ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏.

## üèóÔ∏è **–û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è:**

### **1. Deployment —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:**
- **RollingUpdate**: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –∑–∞–º–µ–Ω–∞ Pod'–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- **Recreate**: –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö Pod'–æ–≤ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤—ã—Ö
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ú–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ Pod'–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- **–ë–µ–∑ –≥–∞—Ä–∞–Ω—Ç–∏–π –ø–æ—Ä—è–¥–∫–∞**: Pod'—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∏ —É–¥–∞–ª—è—é—Ç—Å—è –≤ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ

### **2. StatefulSet —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:**
- **RollingUpdate**: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∑–∞–º–µ–Ω–∞ Pod'–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- **OnDelete**: –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
- **–£–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –°—Ç—Ä–æ–≥–∏–π –ø–æ—Ä—è–¥–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–æ—Ç –±–æ–ª—å—à–µ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ –∫ –º–µ–Ω—å—à–µ–º—É)
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏**: Pod'—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –∏–º–µ–Ω–∞ –∏ PVC –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

## üìä **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –≤–∞—à–µ–≥–æ HA –∫–ª–∞—Å—Ç–µ—Ä–∞:**

### **1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å—Ä–µ–¥—ã –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:**
```bash
# –°–æ–∑–¥–∞—Ç—å namespace –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
kubectl create namespace update-strategies-demo

# –°–æ–∑–¥–∞—Ç—å StorageClass –¥–ª—è StatefulSet
cat << EOF | kubectl apply -f -
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: demo-storage
provisioner: kubernetes.io/no-provisioner
volumeBindingMode: WaitForFirstConsumer
---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: demo-pv-0
spec:
  capacity:
    storage: 1Gi
  accessModes:
  - ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain
  storageClassName: demo-storage
  hostPath:
    path: /tmp/demo-data-0
---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: demo-pv-1
spec:
  capacity:
    storage: 1Gi
  accessModes:
  - ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain
  storageClassName: demo-storage
  hostPath:
    path: /tmp/demo-data-1
---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: demo-pv-2
spec:
  capacity:
    storage: 1Gi
  accessModes:
  - ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain
  storageClassName: demo-storage
  hostPath:
    path: /tmp/demo-data-2
EOF

# –°–æ–∑–¥–∞—Ç—å ConfigMap –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cat << EOF | kubectl apply -f -
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: update-strategies-demo
data:
  app.conf: |
    version=1.0
    environment=demo
    features=basic
  index.html: |
    <!DOCTYPE html>
    <html>
    <head><title>Update Strategies Demo v1.0</title></head>
    <body style="background-color: #f0f8ff; text-align: center; padding: 50px;">
      <h1>üöÄ Update Strategies Demo</h1>
      <p>Version: 1.0</p>
      <p>Pod: <span id="pod"></span></p>
      <script>
        document.getElementById('pod').textContent = window.location.hostname;
      </script>
    </body>
    </html>
EOF
```

### **2. Deployment —Å RollingUpdate —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π:**
```bash
# –°–æ–∑–¥–∞—Ç—å Deployment —Å RollingUpdate
cat << EOF | kubectl apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: deployment-demo
  namespace: update-strategies-demo
  labels:
    app: deployment-demo
spec:
  replicas: 4
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1
      maxSurge: 2
  selector:
    matchLabels:
      app: deployment-demo
  template:
    metadata:
      labels:
        app: deployment-demo
        version: "1.0"
    spec:
      containers:
      - name: web
        image: nginx:1.20
        ports:
        - containerPort: 80
        env:
        - name: VERSION
          value: "1.0"
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        resources:
          requests:
            memory: "64Mi"
            cpu: "100m"
          limits:
            memory: "128Mi"
            cpu: "200m"
        readinessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 5
          periodSeconds: 3
        livenessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 10
          periodSeconds: 10
        volumeMounts:
        - name: config
          mountPath: /usr/share/nginx/html
        - name: app-config
          mountPath: /etc/nginx/conf.d
      volumes:
      - name: config
        configMap:
          name: app-config
      - name: app-config
        configMap:
          name: app-config
---
apiVersion: v1
kind: Service
metadata:
  name: deployment-service
  namespace: update-strategies-demo
spec:
  selector:
    app: deployment-demo
  ports:
  - port: 80
    targetPort: 80
  type: ClusterIP
EOF

# –î–æ–∂–¥–∞—Ç—å—Å—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
kubectl rollout status deployment/deployment-demo -n update-strategies-demo

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
echo "=== Deployment Initial State ==="
kubectl get deployment deployment-demo -n update-strategies-demo
kubectl get pods -n update-strategies-demo -l app=deployment-demo -o wide
```

### **3. StatefulSet —Å RollingUpdate —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π:**
```bash
# –°–æ–∑–¥–∞—Ç—å StatefulSet —Å RollingUpdate
cat << EOF | kubectl apply -f -
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: statefulset-demo
  namespace: update-strategies-demo
  labels:
    app: statefulset-demo
spec:
  serviceName: statefulset-service
  replicas: 3
  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      partition: 0
  selector:
    matchLabels:
      app: statefulset-demo
  template:
    metadata:
      labels:
        app: statefulset-demo
        version: "1.0"
    spec:
      containers:
      - name: web
        image: nginx:1.20
        ports:
        - containerPort: 80
        env:
        - name: VERSION
          value: "1.0"
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_ORDINAL
          valueFrom:
            fieldRef:
              fieldPath: metadata.annotations['statefulset.kubernetes.io/pod-name']
        resources:
          requests:
            memory: "64Mi"
            cpu: "100m"
          limits:
            memory: "128Mi"
            cpu: "200m"
        readinessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 5
          periodSeconds: 3
        livenessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 10
          periodSeconds: 10
        volumeMounts:
        - name: config
          mountPath: /usr/share/nginx/html
        - name: data
          mountPath: /var/lib/nginx
      volumes:
      - name: config
        configMap:
          name: app-config
  volumeClaimTemplates:
  - metadata:
      name: data
    spec:
      accessModes: ["ReadWriteOnce"]
      storageClassName: demo-storage
      resources:
        requests:
          storage: 1Gi
---
apiVersion: v1
kind: Service
metadata:
  name: statefulset-service
  namespace: update-strategies-demo
spec:
  clusterIP: None
  selector:
    app: statefulset-demo
  ports:
  - port: 80
    targetPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: statefulset-lb
  namespace: update-strategies-demo
spec:
  selector:
    app: statefulset-demo
  ports:
  - port: 80
    targetPort: 80
  type: ClusterIP
EOF

# –î–æ–∂–¥–∞—Ç—å—Å—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
kubectl rollout status statefulset/statefulset-demo -n update-strategies-demo

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
echo "=== StatefulSet Initial State ==="
kubectl get statefulset statefulset-demo -n update-strategies-demo
kubectl get pods -n update-strategies-demo -l app=statefulset-demo -o wide
kubectl get pvc -n update-strategies-demo
```

### **4. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ RollingUpdate –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
cat << 'EOF' > compare-update-strategies.sh
#!/bin/bash

NAMESPACE="update-strategies-demo"

echo "=== Update Strategies Comparison ==="
echo "Namespace: $NAMESPACE"
echo

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ Deployment
show_deployment_status() {
    echo "=== Deployment Status ==="
    kubectl get deployment deployment-demo -n $NAMESPACE
    echo
    echo "Deployment Pods:"
    kubectl get pods -n $NAMESPACE -l app=deployment-demo -o custom-columns=NAME:.metadata.name,STATUS:.status.phase,READY:.status.containerStatuses[0].ready,IMAGE:.spec.containers[0].image,AGE:.metadata.creationTimestamp --sort-by=.metadata.creationTimestamp
    echo
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ StatefulSet
show_statefulset_status() {
    echo "=== StatefulSet Status ==="
    kubectl get statefulset statefulset-demo -n $NAMESPACE
    echo
    echo "StatefulSet Pods:"
    kubectl get pods -n $NAMESPACE -l app=statefulset-demo -o custom-columns=NAME:.metadata.name,STATUS:.status.phase,READY:.status.containerStatuses[0].ready,IMAGE:.spec.containers[0].image,AGE:.metadata.creationTimestamp --sort-by=.metadata.name
    echo
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
show_full_status() {
    echo "=== Full Status at $(date) ==="
    show_deployment_status
    show_statefulset_status
    echo "----------------------------------------"
    echo
}

# –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
show_full_status

# –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä watch, –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
if [ "$1" = "watch" ]; then
    while true; do
        sleep 10
        show_full_status
    done
fi
EOF

chmod +x compare-update-strategies.sh

# –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
./compare-update-strategies.sh

# –ù–∞—á–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
echo "=== Starting Parallel Updates ==="
echo "Updating Deployment..."
kubectl set image deployment/deployment-demo web=nginx:1.21 -n update-strategies-demo &
DEPLOYMENT_PID=$!

echo "Updating StatefulSet..."
kubectl set image statefulset/statefulset-demo web=nginx:1.21 -n update-strategies-demo &
STATEFULSET_PID=$!

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
echo "Monitoring updates..."
for i in {1..30}; do
    echo "=== Update Check $i ==="
    ./compare-update-strategies.sh
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å –ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    deployment_done=false
    statefulset_done=false
    
    if kubectl rollout status deployment/deployment-demo -n update-strategies-demo --timeout=5s >/dev/null 2>&1; then
        deployment_done=true
    fi
    
    if kubectl rollout status statefulset/statefulset-demo -n update-strategies-demo --timeout=5s >/dev/null 2>&1; then
        statefulset_done=true
    fi
    
    if $deployment_done && $statefulset_done; then
        echo "‚úÖ Both updates completed!"
        break
    fi
    
    sleep 10
done

# –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
echo "=== Final State ==="
./compare-update-strategies.sh
```

### **5. Deployment Recreate —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:**
```bash
# –°–æ–∑–¥–∞—Ç—å Deployment —Å Recreate —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π
cat << EOF | kubectl apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: recreate-demo
  namespace: update-strategies-demo
  labels:
    app: recreate-demo
spec:
  replicas: 3
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app: recreate-demo
  template:
    metadata:
      labels:
        app: recreate-demo
        version: "1.0"
    spec:
      containers:
      - name: web
        image: nginx:1.20
        ports:
        - containerPort: 80
        env:
        - name: VERSION
          value: "1.0"
        - name: STRATEGY
          value: "Recreate"
        resources:
          requests:
            memory: "64Mi"
            cpu: "100m"
          limits:
            memory: "128Mi"
            cpu: "200m"
        readinessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 5
          periodSeconds: 3
        volumeMounts:
        - name: config
          mountPath: /usr/share/nginx/html
      volumes:
      - name: config
        configMap:
          name: app-config
EOF

# –î–æ–∂–¥–∞—Ç—å—Å—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
kubectl rollout status deployment/recreate-demo -n update-strategies-demo

echo "=== Recreate Demo Initial State ==="
kubectl get deployment recreate-demo -n update-strategies-demo
kubectl get pods -n update-strategies-demo -l app=recreate-demo -o wide

# –í—ã–ø–æ–ª–Ω–∏—Ç—å Recreate –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
echo "=== Starting Recreate Update ==="
kubectl set image deployment/recreate-demo web=nginx:1.21 -n update-strategies-demo

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Recreate –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
echo "Monitoring Recreate update..."
for i in {1..20}; do
    echo "=== Recreate Check $i ==="
    kubectl get deployment recreate-demo -n update-strategies-demo
    kubectl get pods -n update-strategies-demo -l app=recreate-demo -o custom-columns=NAME:.metadata.name,STATUS:.status.phase,READY:.status.containerStatuses[0].ready,IMAGE:.spec.containers[0].image,AGE:.metadata.creationTimestamp
    echo
    
    if kubectl rollout status deployment/recreate-demo -n update-strategies-demo --timeout=5s >/dev/null 2>&1; then
        echo "‚úÖ Recreate update completed!"
        break
    fi
    
    sleep 5
done
```

### **6. StatefulSet OnDelete —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:**
```bash
# –°–æ–∑–¥–∞—Ç—å StatefulSet —Å OnDelete —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π
cat << EOF | kubectl apply -f -
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: ondelete-demo
  namespace: update-strategies-demo
  labels:
    app: ondelete-demo
spec:
  serviceName: ondelete-service
  replicas: 3
  updateStrategy:
    type: OnDelete
  selector:
    matchLabels:
      app: ondelete-demo
  template:
    metadata:
      labels:
        app: ondelete-demo
        version: "1.0"
    spec:
      containers:
      - name: web
        image: busybox:1.35
        command: ["sh", "-c"]
        args:
        - |
          echo "OnDelete StatefulSet v1.0 starting: \$(hostname)"
          while true; do
            echo "\$(date): OnDelete v1.0 running on \$(hostname)"
            sleep 30
          done
        env:
        - name: VERSION
          value: "1.0"
        - name: STRATEGY
          value: "OnDelete"
        resources:
          requests:
            memory: "32Mi"
            cpu: "50m"
          limits:
            memory: "64Mi"
            cpu: "100m"
---
apiVersion: v1
kind: Service
metadata:
  name: ondelete-service
  namespace: update-strategies-demo
spec:
  clusterIP: None
  selector:
    app: ondelete-demo
  ports:
  - port: 80
    targetPort: 80
EOF

# –î–æ–∂–¥–∞—Ç—å—Å—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
kubectl rollout status statefulset/ondelete-demo -n update-strategies-demo

echo "=== OnDelete Demo Initial State ==="
kubectl get statefulset ondelete-demo -n update-strategies-demo
kubectl get pods -n update-strategies-demo -l app=ondelete-demo -o wide

# –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –æ–±–Ω–æ–≤–∏—Ç—å (–Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
echo "=== Attempting OnDelete Update ==="
kubectl set image statefulset/ondelete-demo web=busybox:1.36 -n update-strategies-demo

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ Pod'—ã –Ω–µ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å
echo "Checking if pods updated automatically..."
sleep 10
kubectl get pods -n update-strategies-demo -l app=ondelete-demo -o custom-columns=NAME:.metadata.name,IMAGE:.spec.containers[0].image,STATUS:.status.phase

# –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Pod'–æ–≤ –≤ –ø–æ—Ä—è–¥–∫–µ StatefulSet (–æ—Ç –±–æ–ª—å—à–µ–≥–æ –∫ –º–µ–Ω—å—à–µ–º—É)
echo "=== Manual OnDelete Updates (Reverse Order) ==="
for pod in ondelete-demo-2 ondelete-demo-1 ondelete-demo-0; do
    echo "Manually deleting pod: $pod"
    kubectl delete pod $pod -n update-strategies-demo
    
    # –î–æ–∂–¥–∞—Ç—å—Å—è –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è
    echo "Waiting for pod recreation..."
    kubectl wait --for=condition=Ready pod/$pod -n update-strategies-demo --timeout=60s
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–≤—ã–π –æ–±—Ä–∞–∑
    image=$(kubectl get pod $pod -n update-strategies-demo -o jsonpath='{.spec.containers[0].image}')
    echo "  $pod recreated with image: $image"
    echo
done

# –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ OnDelete –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
echo "=== OnDelete Final State ==="
kubectl get statefulset ondelete-demo -n update-strategies-demo
kubectl get pods -n update-strategies-demo -l app=ondelete-demo -o custom-columns=NAME:.metadata.name,IMAGE:.spec.containers[0].image,STATUS:.status.phase
```

## üîß **Advanced —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π:**

### **1. Partition –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è StatefulSet:**
```bash
# –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è partition –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
echo "=== StatefulSet Partition Update Demo ==="

# –°–æ–∑–¥–∞—Ç—å StatefulSet —Å partition
cat << EOF | kubectl apply -f -
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: partition-demo
  namespace: update-strategies-demo
  labels:
    app: partition-demo
spec:
  serviceName: partition-service
  replicas: 5
  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      partition: 3  # –û–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ Pod'—ã —Å –∏–Ω–¥–µ–∫—Å–æ–º >= 3
  selector:
    matchLabels:
      app: partition-demo
  template:
    metadata:
      labels:
        app: partition-demo
        version: "1.0"
    spec:
      containers:
      - name: web
        image: nginx:1.20
        ports:
        - containerPort: 80
        env:
        - name: VERSION
          value: "1.0"
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        resources:
          requests:
            memory: "64Mi"
            cpu: "100m"
          limits:
            memory: "128Mi"
            cpu: "200m"
        readinessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 5
          periodSeconds: 3
        volumeMounts:
        - name: config
          mountPath: /usr/share/nginx/html
      volumes:
      - name: config
        configMap:
          name: app-config
---
apiVersion: v1
kind: Service
metadata:
  name: partition-service
  namespace: update-strategies-demo
spec:
  clusterIP: None
  selector:
    app: partition-demo
  ports:
  - port: 80
    targetPort: 80
EOF

# –î–æ–∂–¥–∞—Ç—å—Å—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
kubectl rollout status statefulset/partition-demo -n update-strategies-demo

echo "Initial state with partition=3:"
kubectl get statefulset partition-demo -n update-strategies-demo
kubectl get pods -n update-strategies-demo -l app=partition-demo -o custom-columns=NAME:.metadata.name,IMAGE:.spec.containers[0].image,STATUS:.status.phase

# –û–±–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–∑ (–æ–±–Ω–æ–≤—è—Ç—Å—è —Ç–æ–ª—å–∫–æ Pod'—ã 3 –∏ 4)
echo "=== Updating with partition=3 (only pods 3,4 will update) ==="
kubectl set image statefulset/partition-demo web=nginx:1.21 -n update-strategies-demo

# –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
sleep 30
echo "After partial update:"
kubectl get pods -n update-strategies-demo -l app=partition-demo -o custom-columns=NAME:.metadata.name,IMAGE:.spec.containers[0].image,STATUS:.status.phase

# –£–º–µ–Ω—å—à–∏—Ç—å partition –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Pod'–∞ 2
echo "=== Reducing partition to 2 ==="
kubectl patch statefulset partition-demo -n update-strategies-demo -p '{"spec":{"updateStrategy":{"rollingUpdate":{"partition":2}}}}'

sleep 20
echo "After partition=2:"
kubectl get pods -n update-strategies-demo -l app=partition-demo -o custom-columns=NAME:.metadata.name,IMAGE:.spec.containers[0].image,STATUS:.status.phase

# –£–±—Ä–∞—Ç—å partition –ø–æ–ª–Ω–æ—Å—Ç—å—é
echo "=== Removing partition (partition=0) ==="
kubectl patch statefulset partition-demo -n update-strategies-demo -p '{"spec":{"updateStrategy":{"rollingUpdate":{"partition":0}}}}'

sleep 30
echo "After complete update:"
kubectl get pods -n update-strategies-demo -l app=partition-demo -o custom-columns=NAME:.metadata.name,IMAGE:.spec.containers[0].image,STATUS:.status.phase
```

### **2. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
cat << 'EOF' > measure-update-performance.sh
#!/bin/bash

NAMESPACE="update-strategies-demo"

echo "=== Update Performance Comparison ==="
echo

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Deployment
measure_deployment_update() {
    local deployment=$1
    local new_image=$2
    
    echo "Measuring Deployment update: $deployment -> $new_image"
    
    # –ó–∞–ø–∏—Å–∞—Ç—å –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞
    start_time=$(date +%s)
    
    # –ù–∞—á–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    kubectl set image deployment/$deployment web=$new_image -n $NAMESPACE
    
    # –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    kubectl rollout status deployment/$deployment -n $NAMESPACE
    
    # –ó–∞–ø–∏—Å–∞—Ç—å –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è
    end_time=$(date +%s)
    duration=$((end_time - start_time))
    
    echo "  Deployment update completed in: ${duration}s"
    return $duration
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è StatefulSet
measure_statefulset_update() {
    local statefulset=$1
    local new_image=$2
    
    echo "Measuring StatefulSet update: $statefulset -> $new_image"
    
    # –ó–∞–ø–∏—Å–∞—Ç—å –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞
    start_time=$(date +%s)
    
    # –ù–∞—á–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    kubectl set image statefulset/$statefulset web=$new_image -n $NAMESPACE
    
    # –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    kubectl rollout status statefulset/$statefulset -n $NAMESPACE
    
    # –ó–∞–ø–∏—Å–∞—Ç—å –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è
    end_time=$(date +%s)
    duration=$((end_time - start_time))
    
    echo "  StatefulSet update completed in: ${duration}s"
    return $duration
}

# –ò–∑–º–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
echo "=== Performance Test 1: nginx:1.20 -> nginx:1.22 ==="
measure_deployment_update "deployment-demo" "nginx:1.22"
deployment_time1=$?

measure_statefulset_update "statefulset-demo" "nginx:1.22"
statefulset_time1=$?

echo
echo "=== Performance Test 2: nginx:1.22 -> nginx:1.23 ==="
measure_deployment_update "deployment-demo" "nginx:1.23"
deployment_time2=$?

measure_statefulset_update "statefulset-demo" "nginx:1.23"
statefulset_time2=$?

# –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
echo
echo "=== Performance Results ==="
echo "Test 1 (nginx:1.20 -> nginx:1.22):"
echo "  Deployment: ${deployment_time1}s"
echo "  StatefulSet: ${statefulset_time1}s"
echo "  Difference: $((statefulset_time1 - deployment_time1))s"
echo
echo "Test 2 (nginx:1.22 -> nginx:1.23):"
echo "  Deployment: ${deployment_time2}s"
echo "  StatefulSet: ${statefulset_time2}s"
echo "  Difference: $((statefulset_time2 - deployment_time2))s"
echo
echo "Average times:"
avg_deployment=$(( (deployment_time1 + deployment_time2) / 2 ))
avg_statefulset=$(( (statefulset_time1 + statefulset_time2) / 2 ))
echo "  Deployment average: ${avg_deployment}s"
echo "  StatefulSet average: ${avg_statefulset}s"
echo "  Average difference: $((avg_statefulset - avg_deployment))s"
EOF

chmod +x measure-update-performance.sh
./measure-update-performance.sh
```

### **3. –ê–Ω–∞–ª–∏–∑ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø—Ä–∏ —Å–±–æ—è—Ö:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø—Ä–∏ —Å–±–æ—è—Ö
cat << 'EOF' > test-failure-behavior.sh
#!/bin/bash

NAMESPACE="update-strategies-demo"

echo "=== Failure Behavior Testing ==="
echo

# –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–π –æ–±—Ä–∞–∑ (–Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
BAD_IMAGE="nginx:nonexistent-tag"

echo "Testing failure behavior with bad image: $BAD_IMAGE"
echo

# –¢–µ—Å—Ç 1: Deployment —Å –ø–ª–æ—Ö–∏–º –æ–±—Ä–∞–∑–æ–º
echo "=== Test 1: Deployment with bad image ==="
kubectl set image deployment/deployment-demo web=$BAD_IMAGE -n $NAMESPACE

echo "Waiting 60s to observe behavior..."
sleep 60

echo "Deployment status after bad update:"
kubectl get deployment deployment-demo -n $NAMESPACE
kubectl get pods -n $NAMESPACE -l app=deployment-demo -o custom-columns=NAME:.metadata.name,STATUS:.status.phase,READY:.status.containerStatuses[0].ready,IMAGE:.spec.containers[0].image,REASON:.status.containerStatuses[0].state.waiting.reason

# –û—Ç–∫–∞—Ç–∏—Ç—å Deployment
echo "Rolling back Deployment..."
kubectl rollout undo deployment/deployment-demo -n $NAMESPACE
kubectl rollout status deployment/deployment-demo -n $NAMESPACE

echo
echo "=== Test 2: StatefulSet with bad image ==="
kubectl set image statefulset/statefulset-demo web=$BAD_IMAGE -n $NAMESPACE

echo "Waiting 60s to observe behavior..."
sleep 60

echo "StatefulSet status after bad update:"
kubectl get statefulset statefulset-demo -n $NAMESPACE
kubectl get pods -n $NAMESPACE -l app=statefulset-demo -o custom-columns=NAME:.metadata.name,STATUS:.status.phase,READY:.status.containerStatuses[0].ready,IMAGE:.spec.containers[0].image,REASON:.status.containerStatuses[0].state.waiting.reason

# –û—Ç–∫–∞—Ç–∏—Ç—å StatefulSet
echo "Rolling back StatefulSet..."
kubectl rollout undo statefulset/statefulset-demo -n $NAMESPACE
kubectl rollout status statefulset/statefulset-demo -n $NAMESPACE

echo
echo "=== Failure Behavior Analysis ==="
echo "Deployment behavior:"
echo "  - Continues updating pods in parallel"
echo "  - Maintains maxUnavailable constraint"
echo "  - Old pods remain running if new pods fail"
echo "  - Can be quickly rolled back"
echo
echo "StatefulSet behavior:"
echo "  - Updates pods sequentially (highest index first)"
echo "  - Stops update if any pod fails"
echo "  - Maintains ordered deployment"
echo "  - Rollback also follows sequential order"
EOF

chmod +x test-failure-behavior.sh
./test-failure-behavior.sh
```

## üìä **–î–µ—Ç–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π:**

### **1. –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞:**
```bash
# –°–æ–∑–¥–∞—Ç—å comprehensive —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
cat << 'EOF' > strategy-comparison.sh
#!/bin/bash

echo "=== Comprehensive Strategy Comparison ==="
echo
printf "%-20s | %-15s | %-15s | %-15s | %-15s\n" "–•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö–ê" "DEPLOY ROLLING" "DEPLOY RECREATE" "STATEFUL ROLLING" "STATEFUL ONDELETE"
echo "---------------------|-----------------|-----------------|-----------------|------------------"
printf "%-20s | %-15s | %-15s | %-15s | %-15s\n" "–ü–æ—Ä—è–¥–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è" "–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π" "–í—Å–µ —Å—Ä–∞–∑—É" "–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π" "–†—É—á–Ω–æ–π"
printf "%-20s | %-15s | %-15s | %-15s | %-15s\n" "–í—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è" "–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ" "–ü–æ–ª–Ω–æ–µ" "–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ" "–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ"
printf "%-20s | %-15s | %-15s | %-15s | %-15s\n" "–ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–æ—Ü–µ—Å—Å–∞" "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π" "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π" "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π" "–†—É—á–Ω–æ–π"
printf "%-20s | %-15s | %-15s | %-15s | %-15s\n" "–°–∫–æ—Ä–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è" "–ë—ã—Å—Ç—Ä–∞—è" "–û—á–µ–Ω—å –±—ã—Å—Ç—Ä–∞—è" "–ú–µ–¥–ª–µ–Ω–Ω–∞—è" "–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–∞—è"
printf "%-20s | %-15s | %-15s | %-15s | %-15s\n" "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö" "–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è" "–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è" "–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è" "–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è"
printf "%-20s | %-15s | %-15s | %-15s | %-15s\n" "–ò–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å Pod'–æ–≤" "–°–ª—É—á–∞–π–Ω–∞—è" "–°–ª—É—á–∞–π–Ω–∞—è" "–°—Ç–∞–±–∏–ª—å–Ω–∞—è" "–°—Ç–∞–±–∏–ª—å–Ω–∞—è"
printf "%-20s | %-15s | %-15s | %-15s | %-15s\n" "–û—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ" "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π" "–†—É—á–Ω–æ–π" "–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è" "–†—É—á–Ω–æ–π"
printf "%-20s | %-15s | %-15s | %-15s | %-15s\n" "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ" "Stateless apps" "Legacy apps" "Databases" "Critical systems"

echo
echo "=== Detailed Comparison ==="
echo
echo "üîÑ DEPLOYMENT ROLLINGUPDATE:"
echo "  ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:"
echo "    - –ù—É–ª–µ–≤–æ–µ –≤—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è"
echo "    - –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ"
echo "    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç"
echo "    - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞"
echo "  ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:"
echo "    - –ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–π –ø–æ—Ä—è–¥–∫–∞"
echo "    - –í–æ–∑–º–æ–∂–Ω—ã –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è"
echo "    - –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è stateful –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π"
echo
echo "üîÑ DEPLOYMENT RECREATE:"
echo "  ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:"
echo "    - –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏"
echo "    - –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ –≤—Å–µ—Ö Pod'–æ–≤"
echo "    - –ù–µ—Ç –≤–µ—Ä—Å–∏–æ–Ω–Ω—ã—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤"
echo "  ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:"
echo "    - –ü–æ–ª–Ω–æ–µ –≤—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è"
echo "    - –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è production"
echo "    - –ü–æ—Ç–µ—Ä—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞"
echo
echo "üîÑ STATEFULSET ROLLINGUPDATE:"
echo "  ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:"
echo "    - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –∏ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏"
echo "    - –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–ª—è stateful –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π"
echo "    - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ partition –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π"
echo "    - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö"
echo "  ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:"
echo "    - –ú–µ–¥–ª–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ"
echo "    - –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞"
echo "    - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö"
echo
echo "üîÑ STATEFULSET ONDELETE:"
echo "  ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:"
echo "    - –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–æ—Ü–µ—Å—Å–∞"
echo "    - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å"
echo "    - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"
echo "    - –ì–∏–±–∫–æ—Å—Ç—å –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏"
echo "  ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:"
echo "    - –¢—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞"
echo "    - –ú–µ–¥–ª–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å"
echo "    - –°–ª–æ–∂–Ω–æ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏"
EOF

chmod +x strategy-comparison.sh
./strategy-comparison.sh
```

### **2. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–ª–∏—á–∏–π:**
```bash
# –°–æ–∑–¥–∞—Ç—å comprehensive —Ç–µ—Å—Ç —Ä–∞–∑–ª–∏—á–∏–π
cat << 'EOF' > comprehensive-strategy-test.sh
#!/bin/bash

NAMESPACE="update-strategies-demo"

echo "=== Comprehensive Strategy Testing ==="
echo

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Deployment RollingUpdate
test_deployment_rolling() {
    echo "üîÑ Testing Deployment RollingUpdate..."
    
    # –°–±—Ä–æ—Å–∏—Ç—å –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
    kubectl set image deployment/deployment-demo web=nginx:1.20 -n $NAMESPACE
    kubectl rollout status deployment/deployment-demo -n $NAMESPACE
    
    echo "  Initial state:"
    kubectl get pods -n $NAMESPACE -l app=deployment-demo --no-headers | wc -l
    
    # –ù–∞—á–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å
    start_time=$(date +%s)
    kubectl set image deployment/deployment-demo web=nginx:1.21 -n $NAMESPACE
    
    # –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å
    max_pods=0
    min_pods=999
    while ! kubectl rollout status deployment/deployment-demo -n $NAMESPACE --timeout=5s >/dev/null 2>&1; do
        current_pods=$(kubectl get pods -n $NAMESPACE -l app=deployment-demo --field-selector=status.phase=Running --no-headers | wc -l)
        if [ $current_pods -gt $max_pods ]; then max_pods=$current_pods; fi
        if [ $current_pods -lt $min_pods ]; then min_pods=$current_pods; fi
        sleep 2
    done
    
    end_time=$(date +%s)
    duration=$((end_time - start_time))
    
    echo "  Results:"
    echo "    Duration: ${duration}s"
    echo "    Max pods during update: $max_pods"
    echo "    Min pods during update: $min_pods"
    echo "    Strategy: Parallel update with surge"
    echo
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Deployment Recreate
test_deployment_recreate() {
    echo "üîÑ Testing Deployment Recreate..."
    
    # –°–±—Ä–æ—Å–∏—Ç—å –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
    kubectl set image deployment/recreate-demo web=nginx:1.20 -n $NAMESPACE
    kubectl rollout status deployment/recreate-demo -n $NAMESPACE
    
    echo "  Initial state:"
    kubectl get pods -n $NAMESPACE -l app=recreate-demo --no-headers | wc -l
    
    # –ù–∞—á–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å
    start_time=$(date +%s)
    kubectl set image deployment/recreate-demo web=nginx:1.21 -n $NAMESPACE
    
    # –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å
    min_pods=999
    zero_pods_time=0
    while ! kubectl rollout status deployment/recreate-demo -n $NAMESPACE --timeout=5s >/dev/null 2>&1; do
        current_pods=$(kubectl get pods -n $NAMESPACE -l app=recreate-demo --field-selector=status.phase=Running --no-headers | wc -l)
        if [ $current_pods -lt $min_pods ]; then min_pods=$current_pods; fi
        if [ $current_pods -eq 0 ] && [ $zero_pods_time -eq 0 ]; then
            zero_pods_time=$(($(date +%s) - start_time))
        fi
        sleep 2
    done
    
    end_time=$(date +%s)
    duration=$((end_time - start_time))
    
    echo "  Results:"
    echo "    Duration: ${duration}s"
    echo "    Min pods during update: $min_pods"
    echo "    Zero pods time: ${zero_pods_time}s"
    echo "    Strategy: Complete termination then recreation"
    echo
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è StatefulSet RollingUpdate
test_statefulset_rolling() {
    echo "üîÑ Testing StatefulSet RollingUpdate..."
    
    # –°–±—Ä–æ—Å–∏—Ç—å –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
    kubectl set image statefulset/statefulset-demo web=nginx:1.20 -n $NAMESPACE
    kubectl rollout status statefulset/statefulset-demo -n $NAMESPACE
    
    echo "  Initial state:"
    kubectl get pods -n $NAMESPACE -l app=statefulset-demo --no-headers | wc -l
    
    # –ù–∞—á–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫
    start_time=$(date +%s)
    kubectl set image statefulset/statefulset-demo web=nginx:1.21 -n $NAMESPACE
    
    # –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    update_order=()
    while ! kubectl rollout status statefulset/statefulset-demo -n $NAMESPACE --timeout=5s >/dev/null 2>&1; do
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫–∏–µ Pod'—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è
        for pod in statefulset-demo-2 statefulset-demo-1 statefulset-demo-0; do
            image=$(kubectl get pod $pod -n $NAMESPACE -o jsonpath='{.spec.containers[0].image}' 2>/dev/null || echo "")
            if [[ "$image" == "nginx:1.21" ]] && [[ ! " ${update_order[@]} " =~ " ${pod} " ]]; then
                update_order+=("$pod")
                echo "    Pod $pod updated at $(($(date +%s) - start_time))s"
            fi
        done
        sleep 3
    done
    
    end_time=$(date +%s)
    duration=$((end_time - start_time))
    
    echo "  Results:"
    echo "    Duration: ${duration}s"
    echo "    Update order: ${update_order[*]}"
    echo "    Strategy: Sequential update (highest index first)"
    echo
}

# –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
test_deployment_rolling
test_deployment_recreate
test_statefulset_rolling

echo "=== Test Summary ==="
echo "Deployment RollingUpdate: Fast, parallel, zero downtime"
echo "Deployment Recreate: Fast, complete downtime, simple"
echo "StatefulSet RollingUpdate: Slow, sequential, ordered, safe"
EOF

chmod +x comprehensive-strategy-test.sh
./comprehensive-strategy-test.sh
```

### **3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤–æ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
cat << 'EOF' > monitor-update-resources.sh
#!/bin/bash

NAMESPACE="update-strategies-demo"

echo "=== Resource Monitoring During Updates ==="
echo

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
monitor_resources() {
    local label=$1
    local duration=$2
    
    echo "Monitoring resources for $label (${duration}s)..."
    
    for i in $(seq 1 $duration); do
        # –ü–æ–ª—É—á–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU –∏ –ø–∞–º—è—Ç–∏
        pods_count=$(kubectl get pods -n $NAMESPACE -l $label --field-selector=status.phase=Running --no-headers | wc -l)
        
        # –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –ø–æ–ª—É—á–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã)
        if kubectl top pods -n $NAMESPACE -l $label >/dev/null 2>&1; then
            cpu_usage=$(kubectl top pods -n $NAMESPACE -l $label --no-headers | awk '{sum+=$2} END {print sum}' | sed 's/m//')
            memory_usage=$(kubectl top pods -n $NAMESPACE -l $label --no-headers | awk '{sum+=$3} END {print sum}' | sed 's/Mi//')
            echo "  ${i}s: Pods=$pods_count, CPU=${cpu_usage:-0}m, Memory=${memory_usage:-0}Mi"
        else
            echo "  ${i}s: Pods=$pods_count (metrics not available)"
        fi
        
        sleep 1
    done
    echo
}

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã –≤–æ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
echo "Starting resource monitoring test..."

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Deployment –≤ —Ñ–æ–Ω–µ
kubectl set image deployment/deployment-demo web=nginx:1.22 -n $NAMESPACE &
DEPLOY_PID=$!

# –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã Deployment
monitor_resources "app=deployment-demo" 30

# –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Deployment
wait $DEPLOY_PID

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ StatefulSet –≤ —Ñ–æ–Ω–µ
kubectl set image statefulset/statefulset-demo web=nginx:1.22 -n $NAMESPACE &
STATEFUL_PID=$!

# –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã StatefulSet
monitor_resources "app=statefulset-demo" 60

# –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è StatefulSet
wait $STATEFUL_PID

echo "Resource monitoring completed"
EOF

chmod +x monitor-update-resources.sh
./monitor-update-resources.sh
```

## üö® **Troubleshooting —Ä–∞–∑–ª–∏—á–∏–π –≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è—Ö:**

### **1. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
```bash
# –°–æ–∑–¥–∞—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç
cat << 'EOF' > diagnose-update-strategies.sh
#!/bin/bash

NAMESPACE="update-strategies-demo"

echo "=== Update Strategies Diagnostics ==="
echo

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ Deployment
diagnose_deployment() {
    local deployment=$1
    
    echo "üîç Diagnosing Deployment: $deployment"
    
    # –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    kubectl get deployment $deployment -n $NAMESPACE -o wide
    
    # –°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    echo "  Update Strategy:"
    kubectl get deployment $deployment -n $NAMESPACE -o jsonpath='{.spec.strategy}' | jq '.'
    
    # –°—Ç–∞—Ç—É—Å rollout
    echo "  Rollout Status:"
    kubectl rollout status deployment/$deployment -n $NAMESPACE --timeout=5s 2>&1 || echo "    Rollout not progressing"
    
    # ReplicaSets
    echo "  ReplicaSets:"
    kubectl get rs -n $NAMESPACE -l app=$deployment -o custom-columns="    NAME:.metadata.name,DESIRED:.spec.replicas,CURRENT:.status.replicas,READY:.status.readyReplicas,AGE:.metadata.creationTimestamp"
    
    # –°–æ–±—ã—Ç–∏—è
    echo "  Recent Events:"
    kubectl get events -n $NAMESPACE --field-selector involvedObject.name=$deployment --sort-by='.lastTimestamp' | tail -5 | sed 's/^/    /'
    
    echo
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ StatefulSet
diagnose_statefulset() {
    local statefulset=$1
    
    echo "üîç Diagnosing StatefulSet: $statefulset"
    
    # –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    kubectl get statefulset $statefulset -n $NAMESPACE -o wide
    
    # –°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    echo "  Update Strategy:"
    kubectl get statefulset $statefulset -n $NAMESPACE -o jsonpath='{.spec.updateStrategy}' | jq '.'
    
    # –°—Ç–∞—Ç—É—Å rollout
    echo "  Rollout Status:"
    kubectl rollout status statefulset/$statefulset -n $NAMESPACE --timeout=5s 2>&1 || echo "    Rollout not progressing"
    
    # Pod'—ã –≤ –ø–æ—Ä—è–¥–∫–µ
    echo "  Pods (ordered):"
    kubectl get pods -n $NAMESPACE -l app=$statefulset -o custom-columns="    NAME:.metadata.name,STATUS:.status.phase,READY:.status.containerStatuses[0].ready,IMAGE:.spec.containers[0].image,AGE:.metadata.creationTimestamp" --sort-by=.metadata.name
    
    # PVC —Å—Ç–∞—Ç—É—Å
    echo "  PersistentVolumeClaims:"
    kubectl get pvc -n $NAMESPACE | grep $statefulset | sed 's/^/    /'
    
    # –°–æ–±—ã—Ç–∏—è
    echo "  Recent Events:"
    kubectl get events -n $NAMESPACE --field-selector involvedObject.name=$statefulset --sort-by='.lastTimestamp' | tail -5 | sed 's/^/    /'
    
    echo
}

# –î–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã
diagnose_deployment "deployment-demo"
diagnose_deployment "recreate-demo"
diagnose_statefulset "statefulset-demo"
diagnose_statefulset "ondelete-demo"

# –û–±—â–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ namespace
echo "üîç Namespace Overview:"
kubectl get all -n $NAMESPACE
echo

echo "üîç Resource Usage:"
kubectl top pods -n $NAMESPACE 2>/dev/null || echo "Metrics not available"
EOF

chmod +x diagnose-update-strategies.sh
./diagnose-update-strategies.sh
```

### **2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
cat << 'EOF' > auto-fix-update-issues.sh
#!/bin/bash

NAMESPACE="update-strategies-demo"

echo "=== Auto-Fix Update Issues ==="
echo

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞—Å—Ç—Ä—è–≤—à–∏—Ö Deployment'–æ–≤
fix_deployment_issues() {
    local deployment=$1
    
    echo "üîß Fixing Deployment: $deployment"
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞—Å—Ç—Ä—è–ª –ª–∏ rollout
    if ! kubectl rollout status deployment/$deployment -n $NAMESPACE --timeout=10s >/dev/null 2>&1; then
        echo "  Deployment rollout appears stuck"
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ Pod'—ã
        failed_pods=$(kubectl get pods -n $NAMESPACE -l app=$deployment --field-selector=status.phase=Failed -o jsonpath='{.items[*].metadata.name}')
        pending_pods=$(kubectl get pods -n $NAMESPACE -l app=$deployment --field-selector=status.phase=Pending -o jsonpath='{.items[*].metadata.name}')
        
        if [ -n "$failed_pods" ]; then
            echo "  Deleting failed pods: $failed_pods"
            for pod in $failed_pods; do
                kubectl delete pod $pod -n $NAMESPACE --force --grace-period=0
            done
        fi
        
        if [ -n "$pending_pods" ]; then
            echo "  Deleting pending pods: $pending_pods"
            for pod in $pending_pods; do
                kubectl delete pod $pod -n $NAMESPACE --force --grace-period=0
            done
        fi
        
        # –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞—é—Ç—Å—è, –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å restart
        sleep 10
        if ! kubectl rollout status deployment/$deployment -n $NAMESPACE --timeout=10s >/dev/null 2>&1; then
            echo "  Restarting deployment"
            kubectl rollout restart deployment/$deployment -n $NAMESPACE
        fi
    else
        echo "  Deployment is healthy"
    fi
    echo
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞—Å—Ç—Ä—è–≤—à–∏—Ö StatefulSet'–æ–≤
fix_statefulset_issues() {
    local statefulset=$1
    
    echo "üîß Fixing StatefulSet: $statefulset"
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞—Å—Ç—Ä—è–ª –ª–∏ rollout
    if ! kubectl rollout status statefulset/$statefulset -n $NAMESPACE --timeout=10s >/dev/null 2>&1; then
        echo "  StatefulSet rollout appears stuck"
        
        # –î–ª—è StatefulSet –Ω—É–∂–Ω–æ –±—ã—Ç—å –±–æ–ª–µ–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã–º
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–ª—å–∫–æ failed Pod'—ã
        failed_pods=$(kubectl get pods -n $NAMESPACE -l app=$statefulset --field-selector=status.phase=Failed -o jsonpath='{.items[*].metadata.name}')
        
        if [ -n "$failed_pods" ]; then
            echo "  Deleting failed pods: $failed_pods"
            for pod in $failed_pods; do
                kubectl delete pod $pod -n $NAMESPACE --force --grace-period=0
                # –î–æ–∂–¥–∞—Ç—å—Å—è –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º
                kubectl wait --for=condition=Ready pod/$pod -n $NAMESPACE --timeout=120s || echo "    Warning: Pod $pod not ready"
            done
        fi
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å OnDelete strategy
        strategy=$(kubectl get statefulset $statefulset -n $NAMESPACE -o jsonpath='{.spec.updateStrategy.type}')
        if [ "$strategy" = "OnDelete" ]; then
            echo "  OnDelete strategy detected - manual intervention required"
            echo "  Use: kubectl delete pod <pod-name> -n $NAMESPACE"
        fi
    else
        echo "  StatefulSet is healthy"
    fi
    echo
}

# –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã
fix_deployment_issues "deployment-demo"
fix_deployment_issues "recreate-demo"
fix_statefulset_issues "statefulset-demo"
fix_statefulset_issues "ondelete-demo"

echo "Auto-fix completed. Check status:"
kubectl get deployments,statefulsets -n $NAMESPACE
EOF

chmod +x auto-fix-update-issues.sh
./auto-fix-update-issues.sh
```

## üßπ **–û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤:**
```bash
# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã
kubectl delete namespace update-strategies-demo

# –£–¥–∞–ª–∏—Ç—å PersistentVolumes
kubectl delete pv demo-pv-0 demo-pv-1 demo-pv-2

# –£–¥–∞–ª–∏—Ç—å —Å–∫—Ä–∏–ø—Ç—ã
rm -f compare-update-strategies.sh strategy-comparison.sh comprehensive-strategy-test.sh measure-update-performance.sh test-failure-behavior.sh monitor-update-resources.sh diagnose-update-strategies.sh auto-fix-update-issues.sh
```

## üìã **–°–≤–æ–¥–∫–∞ –∫–æ–º–∞–Ω–¥ –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**

### **Deployment –∫–æ–º–∞–Ω–¥—ã:**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å RollingUpdate —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
kubectl patch deployment myapp -p '{"spec":{"strategy":{"type":"RollingUpdate","rollingUpdate":{"maxUnavailable":1,"maxSurge":2}}}}'

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Recreate —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
kubectl patch deployment myapp -p '{"spec":{"strategy":{"type":"Recreate"}}}'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
kubectl get deployment myapp -o jsonpath='{.spec.strategy}'

# –û–±–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–∑
kubectl set image deployment/myapp container=new-image

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å rollout
kubectl rollout status deployment/myapp

# –û—Ç–∫–∞—Ç–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
kubectl rollout undo deployment/myapp
```

### **StatefulSet –∫–æ–º–∞–Ω–¥—ã:**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å RollingUpdate —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
kubectl patch statefulset myapp -p '{"spec":{"updateStrategy":{"type":"RollingUpdate","rollingUpdate":{"partition":0}}}}'

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å OnDelete —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
kubectl patch statefulset myapp -p '{"spec":{"updateStrategy":{"type":"OnDelete"}}}'

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å partition –¥–ª—è —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
kubectl patch statefulset myapp -p '{"spec":{"updateStrategy":{"rollingUpdate":{"partition":2}}}}'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
kubectl get statefulset myapp -o jsonpath='{.spec.updateStrategy}'

# –û–±–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–∑
kubectl set image statefulset/myapp container=new-image

# –î–ª—è OnDelete: —Ä—É—á–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ Pod'–æ–≤
kubectl delete pod myapp-2 myapp-1 myapp-0
```

## üéØ **–ö–ª—é—á–µ–≤—ã–µ —Ä–∞–∑–ª–∏—á–∏—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

### **1. –í—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è Deployment:**
- **RollingUpdate**: –î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ stateless –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- **Recreate**: –î–ª—è legacy –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏–ª–∏ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –ø–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞

### **2. –í—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è StatefulSet:**
- **RollingUpdate**: –î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ stateful –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- **OnDelete**: –î–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º, —Ç—Ä–µ–±—É—é—â–∏—Ö —Ä—É—á–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è

### **3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
- **maxUnavailable**: –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö Pod'–æ–≤
- **maxSurge**: –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö Pod'–æ–≤ (—Ç–æ–ª—å–∫–æ Deployment)
- **partition**: –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —á–∞—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ StatefulSet)

### **4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- **–í—Å–µ–≥–¥–∞ –º–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ** –ø—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- **–ò–º–µ–π—Ç–µ –ø–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞** –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** –≤ staging —Å—Ä–µ–¥–µ
- **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ health checks** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ–Ω –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≤ production —Å—Ä–µ–¥–µ!**
