# 159. –ö–∞–∫–∏–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏?

## üéØ –í–æ–ø—Ä–æ—Å
–ö–∞–∫–∏–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏?

## üí° –û—Ç–≤–µ—Ç

–ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ Kubernetes - —ç—Ç–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ —Å–Ω–∏–∂–µ–Ω–∏—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Ä–µ—Å—É—Ä—Å–æ–≤.

### üèóÔ∏è –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

#### 1. **–°—Ö–µ–º–∞ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                Performance Anti-patterns                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
‚îÇ  ‚îÇ  Resource   ‚îÇ  ‚îÇ  Scaling    ‚îÇ  ‚îÇ  Network    ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ Management  ‚îÇ  ‚îÇ Problems    ‚îÇ  ‚îÇ Issues      ‚îÇ         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
‚îÇ  ‚îÇ Storage     ‚îÇ  ‚îÇ Monitoring  ‚îÇ  ‚îÇ Security    ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ Misconfig   ‚îÇ  ‚îÇ Blindness   ‚îÇ  ‚îÇ Overhead    ‚îÇ         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### 2. **–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏**
```yaml
# –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø–æ —É—Ä–æ–≤–Ω—é –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏
antipatterns_by_severity:
  critical:
    - "–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ resource limits"
    - "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è HPA"
    - "–ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ init containers"
    - "–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ health checks"
  
  high:
    - "–ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã"
    - "–ò–∑–±—ã—Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ"
    - "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è storage"
    - "–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞"
  
  medium:
    - "–ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–∑—ã"
    - "–ò–∑–±—ã—Ç–æ—á–Ω—ã–µ sidecar –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã"
    - "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è DNS"
    - "–ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ network policies"
```

### üìä –ü—Ä–∏–º–µ—Ä—ã –∏–∑ –Ω–∞—à–µ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞

#### –ü–æ–∏—Å–∫ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ:
```bash
# –ü–æ–¥—ã –±–µ–∑ resource limits
kubectl get pods --all-namespaces -o jsonpath='{range .items[*]}{.metadata.namespace}{"\t"}{.metadata.name}{"\t"}{.spec.containers[*].resources}{"\n"}{end}' | grep -v limits

# HPA –±–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
kubectl get hpa --all-namespaces -o wide

# –ü—Ä–æ–±–ª–µ–º—ã —Å readiness/liveness probes
kubectl get pods --all-namespaces -o jsonpath='{range .items[*]}{.metadata.name}{"\t"}{.spec.containers[*].readinessProbe}{"\n"}{end}'
```

### üö´ –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏

#### 1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ resource limits –∏ requests**
```yaml
# ‚ùå –ê–ù–¢–ò–ü–ê–¢–¢–ï–†–ù: –ü–æ–¥ –±–µ–∑ resource limits
apiVersion: v1
kind: Pod
metadata:
  name: bad-resource-management
spec:
  containers:
  - name: app
    image: nginx
    # –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç resources - –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–ª—è—Ç—å –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã —É–∑–ª–∞!

---
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ü–æ–¥ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ resource limits
apiVersion: v1
kind: Pod
metadata:
  name: good-resource-management
spec:
  containers:
  - name: app
    image: nginx
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "256Mi"
        cpu: "200m"
```

#### 2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ QoS –∫–ª–∞—Å—Å—ã**
```yaml
# ‚ùå –ê–ù–¢–ò–ü–ê–¢–¢–ï–†–ù: –°–º–µ—à–∞–Ω–Ω—ã–µ QoS –∫–ª–∞—Å—Å—ã
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mixed-qos-antipattern
spec:
  replicas: 3
  selector:
    matchLabels:
      app: mixed-qos
  template:
    metadata:
      labels:
        app: mixed-qos
    spec:
      containers:
      - name: critical-app
        image: critical-app:latest
        resources:
          requests:
            memory: "1Gi"
            cpu: "500m"
          # –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç limits - BestEffort QoS!
      - name: sidecar
        image: sidecar:latest
        resources:
          requests:
            memory: "100Mi"
          limits:
            memory: "200Mi"
            # –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç CPU limit - Burstable QoS!

---
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ QoS –∫–ª–∞—Å—Å—ã
apiVersion: apps/v1
kind: Deployment
metadata:
  name: consistent-qos
spec:
  replicas: 3
  selector:
    matchLabels:
      app: consistent-qos
  template:
    metadata:
      labels:
        app: consistent-qos
    spec:
      containers:
      - name: critical-app
        image: critical-app:latest
        resources:
          requests:
            memory: "1Gi"
            cpu: "500m"
          limits:
            memory: "1Gi"
            cpu: "500m"
            # Guaranteed QoS –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```

#### 3. **–°–∫—Ä–∏–ø—Ç –ø–æ–∏—Å–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å —Ä–µ—Å—É—Ä—Å–∞–º–∏**
```bash
#!/bin/bash
# resource-antipatterns-check.sh

echo "üîç –ü–æ–∏—Å–∫ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏"

# –ü–æ–¥—ã –±–µ–∑ resource requests
echo "‚ùå –ü–æ–¥—ã –±–µ–∑ resource requests:"
kubectl get pods --all-namespaces -o json | \
jq -r '.items[] | select(.spec.containers[].resources.requests == null) | "\(.metadata.namespace)/\(.metadata.name)"'

# –ü–æ–¥—ã –±–µ–∑ resource limits
echo -e "\n‚ùå –ü–æ–¥—ã –±–µ–∑ resource limits:"
kubectl get pods --all-namespaces -o json | \
jq -r '.items[] | select(.spec.containers[].resources.limits == null) | "\(.metadata.namespace)/\(.metadata.name)"'

# –ü–æ–¥—ã —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ–º requests/limits
echo -e "\n‚ö†Ô∏è –ü–æ–¥—ã —Å –±–æ–ª—å—à–∏–º —Ä–∞–∑—Ä—ã–≤–æ–º –º–µ–∂–¥—É requests –∏ limits:"
kubectl get pods --all-namespaces -o json | \
jq -r '.items[] | select(.spec.containers[].resources.limits.memory and .spec.containers[].resources.requests.memory) | select((.spec.containers[].resources.limits.memory | rtrimstr("Mi") | tonumber) / (.spec.containers[].resources.requests.memory | rtrimstr("Mi") | tonumber) > 4) | "\(.metadata.namespace)/\(.metadata.name)"'

echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
```

### üìà –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

#### 1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è HPA**
```yaml
# ‚ùå –ê–ù–¢–ò–ü–ê–¢–¢–ï–†–ù: HPA —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: bad-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: web-app
  minReplicas: 1                          # –°–ª–∏—à–∫–æ–º –º–∞–ª–æ –¥–ª—è production
  maxReplicas: 100                        # –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 90            # –°–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–π –ø–æ—Ä–æ–≥
  # –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç behavior –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ - —Ä–µ–∑–∫–∏–µ —Å–∫–∞—á–∫–∏!

---
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: HPA —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: good-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: web-app
  minReplicas: 3                          # –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è HA
  maxReplicas: 20                         # –†–∞–∑—É–º–Ω—ã–π –º–∞–∫—Å–∏–º—É–º
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70            # –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300     # –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —É–º–µ–Ω—å—à–µ–Ω–∏–∏
      policies:
      - type: Percent
        value: 50
        periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 60      # –ë—ã—Å—Ç—Ä–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∞–≥—Ä—É–∑–∫–µ
      policies:
      - type: Percent
        value: 100
        periodSeconds: 30
```

#### 2. **–ü—Ä–æ–±–ª–µ–º—ã —Å Cluster Autoscaler**
```yaml
# ‚ùå –ê–ù–¢–ò–ü–ê–¢–¢–ï–†–ù: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ node affinity
apiVersion: apps/v1
kind: Deployment
metadata:
  name: bad-node-affinity
spec:
  replicas: 10
  selector:
    matchLabels:
      app: bad-affinity
  template:
    metadata:
      labels:
        app: bad-affinity
    spec:
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: node-type
                operator: In
                values:
                - specific-node                # –°–ª–∏—à–∫–æ–º –∂–µ—Å—Ç–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è!
      containers:
      - name: app
        image: nginx

---
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ì–∏–±–∫–∏–µ node preferences
apiVersion: apps/v1
kind: Deployment
metadata:
  name: good-node-affinity
spec:
  replicas: 10
  selector:
    matchLabels:
      app: good-affinity
  template:
    metadata:
      labels:
        app: good-affinity
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 100
            preference:
              matchExpressions:
              - key: node-type
                operator: In
                values:
                - preferred-node
          - weight: 50
            preference:
              matchExpressions:
              - key: zone
                operator: In
                values:
                - zone-a
      containers:
      - name: app
        image: nginx
```

### üåê –°–µ—Ç–µ–≤—ã–µ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã

#### 1. **–ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ Service –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
```yaml
# ‚ùå –ê–ù–¢–ò–ü–ê–¢–¢–ï–†–ù: Service –±–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤
apiVersion: v1
kind: Service
metadata:
  name: bad-service
spec:
  ports:
  - port: 80
    targetPort: 8080
  # –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç selector - —Ä—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ endpoints!

---
# ‚ùå –ê–ù–¢–ò–ü–ê–¢–¢–ï–†–ù: –°–ª–∏—à–∫–æ–º —à–∏—Ä–æ–∫–∏–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
apiVersion: v1
kind: Service
metadata:
  name: overly-broad-service
spec:
  selector:
    app: web                              # –°–ª–∏—à–∫–æ–º –æ–±—â–∏–π —Å–µ–ª–µ–∫—Ç–æ—Ä
  ports:
  - port: 80
    targetPort: 8080

---
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –¢–æ—á–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
apiVersion: v1
kind: Service
metadata:
  name: good-service
spec:
  selector:
    app: web
    version: v1
    component: frontend                   # –¢–æ—á–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä
  ports:
  - port: 80
    targetPort: 8080
```

#### 2. **–ü—Ä–æ–±–ª–µ–º—ã —Å DNS**
```yaml
# ‚ùå –ê–ù–¢–ò–ü–ê–¢–¢–ï–†–ù: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è DNS
apiVersion: v1
kind: Pod
metadata:
  name: bad-dns-config
spec:
  dnsPolicy: "None"                       # –û—Ç–∫–ª—é—á–∞–µ—Ç DNS!
  containers:
  - name: app
    image: nginx

---
# ‚ùå –ê–ù–¢–ò–ü–ê–¢–¢–ï–†–ù: –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ DNS –∑–∞–ø—Ä–æ—Å—ã
apiVersion: v1
kind: Pod
metadata:
  name: dns-heavy-pod
spec:
  containers:
  - name: app
    image: nginx
    env:
    - name: SERVICE_URL
      value: "http://my-service.default.svc.cluster.local"  # –ü–æ–ª–Ω–æ–µ –∏–º—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

---
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è DNS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
apiVersion: v1
kind: Pod
metadata:
  name: good-dns-config
spec:
  dnsPolicy: ClusterFirst
  dnsConfig:
    options:
    - name: ndots
      value: "2"                          # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è DNS –ø–æ–∏—Å–∫–∞
    - name: edns0
  containers:
  - name: app
    image: nginx
    env:
    - name: SERVICE_URL
      value: "http://my-service"          # –ö–æ—Ä–æ—Ç–∫–æ–µ –∏–º—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
```

### üíæ –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

#### 1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ volumes**
```yaml
# ‚ùå –ê–ù–¢–ò–ü–ê–¢–¢–ï–†–ù: emptyDir –¥–ª—è persistent –¥–∞–Ω–Ω—ã—Ö
apiVersion: v1
kind: Pod
metadata:
  name: bad-storage
spec:
  containers:
  - name: database
    image: postgres
    volumeMounts:
    - name: data
      mountPath: /var/lib/postgresql/data
  volumes:
  - name: data
    emptyDir: {}                          # –î–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ!

---
# ‚ùå –ê–ù–¢–ò–ü–ê–¢–¢–ï–†–ù: hostPath –≤ production
apiVersion: v1
kind: Pod
metadata:
  name: bad-hostpath
spec:
  containers:
  - name: app
    image: nginx
    volumeMounts:
    - name: data
      mountPath: /data
  volumes:
  - name: data
    hostPath:
      path: /tmp/data                     # –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —É–∑–ª—É!

---
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: PersistentVolume –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: database-pvc
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi
  storageClassName: fast-ssd
---
apiVersion: v1
kind: Pod
metadata:
  name: good-storage
spec:
  containers:
  - name: database
    image: postgres
    volumeMounts:
    - name: data
      mountPath: /var/lib/postgresql/data
  volumes:
  - name: data
    persistentVolumeClaim:
      claimName: database-pvc
```

#### 2. **–ü—Ä–æ–±–ª–µ–º—ã —Å storage classes**
```yaml
# ‚ùå –ê–ù–¢–ò–ü–ê–¢–¢–ï–†–ù: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π storage class
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: bad-storage-class
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 1Ti                        # –ë–æ–ª—å—à–æ–π –æ–±—ä–µ–º
  storageClassName: slow-hdd              # –ú–µ–¥–ª–µ–Ω–Ω—ã–π –¥–∏—Å–∫ –¥–ª—è –±–æ–ª—å—à–æ–≥–æ –æ–±—ä–µ–º–∞!

---
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ü–æ–¥—Ö–æ–¥—è—â–∏–π storage class
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: good-storage-class
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 100Gi                      # –†–∞–∑—É–º–Ω—ã–π —Ä–∞–∑–º–µ—Ä
  storageClassName: fast-ssd              # –ë—ã—Å—Ç—Ä—ã–π –¥–∏—Å–∫ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```

### üîç –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

#### 1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ health checks**
```yaml
# ‚ùå –ê–ù–¢–ò–ü–ê–¢–¢–ï–†–ù: –ü–æ–¥ –±–µ–∑ health checks
apiVersion: v1
kind: Pod
metadata:
  name: no-health-checks
spec:
  containers:
  - name: app
    image: nginx
    ports:
    - containerPort: 80
    # –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç readiness –∏ liveness probes!

---
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ health checks
apiVersion: v1
kind: Pod
metadata:
  name: good-health-checks
spec:
  containers:
  - name: app
    image: nginx
    ports:
    - containerPort: 80
    readinessProbe:
      httpGet:
        path: /ready
        port: 80
      initialDelaySeconds: 5
      periodSeconds: 10
    livenessProbe:
      httpGet:
        path: /health
        port: 80
      initialDelaySeconds: 30
      periodSeconds: 30
    startupProbe:
      httpGet:
        path: /startup
        port: 80
      initialDelaySeconds: 10
      periodSeconds: 5
      failureThreshold: 30
```

#### 2. **–ò–∑–±—ã—Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
```yaml
# ‚ùå –ê–ù–¢–ò–ü–ê–¢–¢–ï–†–ù: –ò–∑–±—ã—Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
apiVersion: v1
kind: Pod
metadata:
  name: verbose-logging
spec:
  containers:
  - name: app
    image: nginx
    env:
    - name: LOG_LEVEL
      value: "DEBUG"                      # –°–ª–∏—à–∫–æ–º –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ production
    - name: ACCESS_LOG
      value: "ON"
    - name: ERROR_LOG
      value: "ON"
    - name: TRACE_LOG
      value: "ON"                         # –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –ª–æ–≥–∏

---
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
apiVersion: v1
kind: Pod
metadata:
  name: optimized-logging
spec:
  containers:
  - name: app
    image: nginx
    env:
    - name: LOG_LEVEL
      value: "INFO"                       # –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–ª—è production
    - name: LOG_FORMAT
      value: "json"                       # –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏
    - name: LOG_SAMPLING
      value: "true"                       # –°–µ–º–ø–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```

### üõ°Ô∏è –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

#### 1. **–ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏**
```yaml
# ‚ùå –ê–ù–¢–ò–ü–ê–¢–¢–ï–†–ù: –ó–∞–ø—É—Å–∫ —Å root –ø—Ä–∞–≤–∞–º–∏
apiVersion: v1
kind: Pod
metadata:
  name: root-container
spec:
  containers:
  - name: app
    image: nginx
    securityContext:
      runAsUser: 0                        # Root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å!
      privileged: true                    # –ü—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º!

---
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏
apiVersion: v1
kind: Pod
metadata:
  name: secure-container
spec:
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 2000
  containers:
  - name: app
    image: nginx
    securityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      capabilities:
        drop:
        - ALL
        add:
        - NET_BIND_SERVICE
```

### üéØ –°–∫—Ä–∏–ø—Ç –ø–æ–∏—Å–∫–∞ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

#### 1. **–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤**
```bash
#!/bin/bash
# antipatterns-scanner.sh

echo "üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ resource limits
echo "üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ resource management:"
kubectl get pods --all-namespaces -o json | \
jq -r '.items[] | select(.spec.containers[].resources.limits == null) | "‚ùå \(.metadata.namespace)/\(.metadata.name): –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç resource limits"'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ health checks
echo -e "\nüè• –ü—Ä–æ–≤–µ—Ä–∫–∞ health checks:"
kubectl get pods --all-namespaces -o json | \
jq -r '.items[] | select(.spec.containers[].readinessProbe == null) | "‚ùå \(.metadata.namespace)/\(.metadata.name): –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç readiness probe"'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ HPA –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
echo -e "\nüìà –ü—Ä–æ–≤–µ—Ä–∫–∞ HPA:"
kubectl get hpa --all-namespaces -o json | \
jq -r '.items[] | select(.spec.minReplicas < 2) | "‚ö†Ô∏è \(.metadata.namespace)/\(.metadata.name): minReplicas < 2"'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ storage
echo -e "\nüíæ –ü—Ä–æ–≤–µ—Ä–∫–∞ storage:"
kubectl get pods --all-namespaces -o json | \
jq -r '.items[] | select(.spec.volumes[]?.emptyDir != null and (.spec.containers[].volumeMounts[]?.mountPath | contains("/data") or contains("/var/lib"))) | "‚ùå \(.metadata.namespace)/\(.metadata.name): –∏—Å–ø–æ–ª—å–∑—É–µ—Ç emptyDir –¥–ª—è persistent –¥–∞–Ω–Ω—ã—Ö"'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ security context
echo -e "\nüõ°Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ security:"
kubectl get pods --all-namespaces -o json | \
jq -r '.items[] | select(.spec.securityContext.runAsUser == 0 or .spec.containers[].securityContext.runAsUser == 0) | "‚ùå \(.metadata.namespace)/\(.metadata.name): –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å root –ø—Ä–∞–≤–∞–º–∏"'

echo -e "\n‚úÖ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ"
```

### üìã –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏–∑–±–µ–∂–∞–Ω–∏—è –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

#### 1. **–ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤**
```yaml
antipattern_prevention_checklist:
  resource_management:
    - "‚úÖ –í—Å–µ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ resource requests –∏ limits"
    - "‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ QoS –∫–ª–∞—Å—Å—ã"
    - "‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤"
    - "‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ eviction thresholds"
  
  scaling:
    - "‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ HPA —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏"
    - "‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ behavior –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è HPA"
    - "‚úÖ –ò–∑–±–µ–≥–∞–π—Ç–µ —Å–ª–∏—à–∫–æ–º –∂–µ—Å—Ç–∫–∏—Ö node affinity"
    - "‚úÖ –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∞–≤—Ç–æ–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π"
  
  networking:
    - "‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ—á–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è Services"
    - "‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ DNS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é"
    - "‚úÖ –ò–∑–±–µ–≥–∞–π—Ç–µ –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö network policies"
    - "‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ —Å–µ—Ç–µ–≤—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å"
  
  storage:
    - "‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã volumes"
    - "‚úÖ –í—ã–±–∏—Ä–∞–π—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ storage classes"
    - "‚úÖ –ò–∑–±–µ–≥–∞–π—Ç–µ hostPath –≤ production"
    - "‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ backup –¥–ª—è persistent –¥–∞–Ω–Ω—ã—Ö"
  
  monitoring:
    - "‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ health checks –¥–ª—è –≤—Å–µ—Ö –ø–æ–¥–æ–≤"
    - "‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è"
    - "‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ structured logging"
    - "‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏"
  
  security:
    - "‚úÖ –ó–∞–ø—É—Å–∫–∞–π—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏"
    - "‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ read-only root filesystem"
    - "‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Pod Security Standards"
    - "‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ —Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ –æ–±—Ä–∞–∑—ã –Ω–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–∏"
```

–ò–∑–±–µ–∂–∞–Ω–∏–µ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö –∏ –Ω–∞–¥–µ–∂–Ω—ã—Ö Kubernetes –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.
