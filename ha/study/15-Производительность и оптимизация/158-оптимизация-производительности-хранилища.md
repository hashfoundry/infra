# 158. –ö–∞–∫ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞?

## üéØ **–ß—Ç–æ —Ç–∞–∫–æ–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞?**

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –≤ Kubernetes** ‚Äî —ç—Ç–æ –∫–æ–º–ø–ª–µ–∫—Å –º–µ—Ä –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Storage Classes, CSI –¥—Ä–∞–π–≤–µ—Ä–æ–≤, —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º –∏ I/O –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º, –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ –∏ –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –¥–∏—Å–∫–æ–≤—ã—Ö –ø–æ–¥—Å–∏—Å—Ç–µ–º.

## üèóÔ∏è **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:**

### **1. Storage Classes**
- –¢–∏–ø—ã –¥–∏—Å–∫–æ–≤ (SSD, NVMe, HDD)
- –§–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã (XFS, ext4, Btrfs)
- Mount –æ–ø—Ü–∏–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- Provisioning –∏ reclaim –ø–æ–ª–∏—Ç–∏–∫–∏

### **2. CSI –î—Ä–∞–π–≤–µ—Ä—ã**
- DigitalOcean Block Storage
- Local storage provisioners
- NFS –∏ distributed storage
- Snapshot –∏ backup —Ñ—É–Ω–∫—Ü–∏–∏

### **3. I/O –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**
- I/O scheduler –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- Read-ahead –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- Disk queue depth
- Filesystem tuning

### **4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏**
- IOPS (Input/Output Operations Per Second)
- Throughput (–ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å)
- Latency (–∑–∞–¥–µ—Ä–∂–∫–∞)
- Queue depth –∏ utilization

## üìä **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –≤–∞—à–µ–≥–æ HA –∫–ª–∞—Å—Ç–µ—Ä–∞:**

### **1. –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:**
```bash
# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ storage classes
kubectl get storageclass -o wide

# Persistent volumes –∏ –∏—Ö —Å—Ç–∞—Ç—É—Å
kubectl get pv -o custom-columns=NAME:.metadata.name,CAPACITY:.spec.capacity.storage,STATUS:.status.phase,STORAGECLASS:.spec.storageClassName,CLAIM:.spec.claimRef.name

# Persistent volume claims
kubectl get pvc --all-namespaces -o custom-columns=NAME:.metadata.name,NAMESPACE:.metadata.namespace,STATUS:.status.phase,CAPACITY:.status.capacity.storage,STORAGECLASS:.spec.storageClassName

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –≤ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
kubectl get pvc -n monitoring
kubectl get pvc -n argocd
```

### **2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:**
```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –Ω–∞ —É–∑–ª–∞—Ö
kubectl get nodes -o jsonpath='{.items[*].metadata.name}' | \
xargs -I {} sh -c 'echo "=== Node: {} ==="; kubectl describe node {} | grep -A 10 "Allocated resources"'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Å–∫–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫ —á–µ—Ä–µ–∑ node-exporter
kubectl port-forward -n monitoring svc/prometheus-server 9090:80 &

# –ê–Ω–∞–ª–∏–∑ I/O —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
for node in $(kubectl get nodes -o jsonpath='{.items[*].metadata.name}'); do
    echo "=== Node: $node ==="
    kubectl get --raw /api/v1/nodes/$node/proxy/stats/summary | jq '.node.fs'
done
```

### **3. –ü—Ä–æ–≤–µ—Ä–∫–∞ CSI –¥—Ä–∞–π–≤–µ—Ä–æ–≤:**
```bash
# CSI –¥—Ä–∞–π–≤–µ—Ä—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ
kubectl get csidriver

# CSI nodes
kubectl get csinode

# Storage classes —Å CSI
kubectl get storageclass -o yaml | grep -A 5 provisioner
```

## üîÑ **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:**

### **1. –°–æ–∑–¥–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö Storage Classes:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç storage-class-optimizer.sh
cat << 'EOF' > storage-class-optimizer.sh
#!/bin/bash

echo "üíæ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Storage Classes –¥–ª—è HA –∫–ª–∞—Å—Ç–µ—Ä–∞"
echo "============================================="

# –°–æ–∑–¥–∞–Ω–∏–µ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ Storage Class
echo "üöÄ –°–æ–∑–¥–∞–Ω–∏–µ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ Storage Class:"
cat << 'FAST_SSD_EOF' | kubectl apply -f -
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: fast-ssd
  annotations:
    storageclass.kubernetes.io/is-default-class: "false"
  labels:
    performance: high
    type: ssd
provisioner: dobs.csi.digitalocean.com
parameters:
  type: do-block-storage
  fs-type: xfs                           # XFS –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
reclaimPolicy: Delete
allowVolumeExpansion: true
volumeBindingMode: WaitForFirstConsumer
mountOptions:
- noatime                                # –û—Ç–∫–ª—é—á–µ–Ω–∏–µ access time
- nodiratime                             # –û—Ç–∫–ª—é—á–µ–Ω–∏–µ directory access time
- largeio                                # –ë–æ–ª—å—à–∏–µ I/O –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è XFS
- inode64                                # 64-bit inodes
FAST_SSD_EOF

# –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–º–∏—É–º Storage Class –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
echo -e "\nüíé –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–º–∏—É–º Storage Class:"
cat << 'PREMIUM_EOF' | kubectl apply -f -
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: premium-ssd
  annotations:
    storageclass.kubernetes.io/is-default-class: "false"
  labels:
    performance: premium
    type: ssd
    backup: enabled
provisioner: dobs.csi.digitalocean.com
parameters:
  type: do-block-storage
  fs-type: xfs
reclaimPolicy: Retain                    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
allowVolumeExpansion: true
volumeBindingMode: Immediate
mountOptions:
- noatime
- nodiratime
- largeio
- inode64
- nobarrier                              # –û—Ç–∫–ª—é—á–µ–Ω–∏–µ write barriers –¥–ª—è SSD
PREMIUM_EOF

# –°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–æ–Ω–æ–º–∏—á–Ω–æ–≥–æ Storage Class
echo -e "\nüí∞ –°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–æ–Ω–æ–º–∏—á–Ω–æ–≥–æ Storage Class:"
cat << 'STANDARD_EOF' | kubectl apply -f -
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: standard-optimized
  annotations:
    storageclass.kubernetes.io/is-default-class: "true"
  labels:
    performance: standard
    type: balanced
provisioner: dobs.csi.digitalocean.com
parameters:
  type: do-block-storage
  fs-type: ext4                          # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
reclaimPolicy: Delete
allowVolumeExpansion: true
volumeBindingMode: WaitForFirstConsumer
mountOptions:
- noatime
- nodiratime
STANDARD_EOF

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö Storage Classes
echo -e "\nüìä –°–æ–∑–¥–∞–Ω–Ω—ã–µ Storage Classes:"
kubectl get storageclass -o custom-columns=NAME:.metadata.name,PROVISIONER:.provisioner,RECLAIM:.reclaimPolicy,EXPANSION:.allowVolumeExpansion,DEFAULT:.metadata.annotations.'storageclass\.kubernetes\.io/is-default-class'

echo "‚úÖ Storage Classes –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã"
EOF

chmod +x storage-class-optimizer.sh
```

### **2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è I/O –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç io-performance-optimizer.sh
cat << 'EOF' > io-performance-optimizer.sh
#!/bin/bash

echo "‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è I/O –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"
echo "==================================="

# –°–æ–∑–¥–∞–Ω–∏–µ DaemonSet –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ I/O –Ω–∞ —É–∑–ª–∞—Ö
echo "üîß –°–æ–∑–¥–∞–Ω–∏–µ DaemonSet –¥–ª—è I/O –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:"
cat << 'DAEMONSET_EOF' | kubectl apply -f -
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: io-optimizer
  namespace: kube-system
  labels:
    app: io-optimizer
spec:
  selector:
    matchLabels:
      app: io-optimizer
  template:
    metadata:
      labels:
        app: io-optimizer
    spec:
      hostNetwork: true
      hostPID: true
      tolerations:
      - operator: Exists
      containers:
      - name: optimizer
        image: busybox
        command: ["/bin/sh"]
        args:
        - -c
        - |
          echo "üöÄ –ù–∞—á–∞–ª–æ I/O –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –Ω–∞ —É–∑–ª–µ $(hostname)"
          
          # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è I/O scheduler –¥–ª—è SSD –¥–∏—Å–∫–æ–≤
          echo "üìÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ I/O scheduler:"
          for disk in /sys/block/*/queue/scheduler; do
            if [ -f "$disk" ]; then
              # –î–ª—è SSD –¥–∏—Å–∫–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º noop –∏–ª–∏ none
              if echo "noop" > "$disk" 2>/dev/null; then
                echo "‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω noop scheduler –¥–ª—è $(basename $(dirname $(dirname $disk)))"
              elif echo "none" > "$disk" 2>/dev/null; then
                echo "‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω none scheduler –¥–ª—è $(basename $(dirname $(dirname $disk)))"
              else
                echo "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π scheduler –¥–ª—è $(basename $(dirname $(dirname $disk)))"
              fi
            fi
          done
          
          # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ read-ahead –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
          echo "üìñ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ read-ahead:"
          for disk in /sys/block/*/queue/read_ahead_kb; do
            if [ -f "$disk" ]; then
              echo "128" > "$disk"
              echo "‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω read-ahead 128KB –¥–ª—è $(basename $(dirname $(dirname $disk)))"
            fi
          done
          
          # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è VM –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
          echo "üß† –ù–∞—Å—Ç—Ä–æ–π–∫–∞ VM –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:"
          echo 1 > /proc/sys/vm/swappiness
          echo 80 > /proc/sys/vm/dirty_ratio
          echo 5 > /proc/sys/vm/dirty_background_ratio
          echo 60 > /proc/sys/vm/dirty_expire_centisecs
          echo 1500 > /proc/sys/vm/dirty_writeback_centisecs
          echo "‚úÖ VM –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã"
          
          # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
          echo "üìÅ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã:"
          echo 262144 > /proc/sys/fs/file-max
          echo "‚úÖ –£–≤–µ–ª–∏—á–µ–Ω –ª–∏–º–∏—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤"
          
          echo "‚úÖ I/O –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –Ω–∞ —É–∑–ª–µ $(hostname)"
          
          # –ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ —Ä–∞–±–æ—á–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
          while true; do
            sleep 3600
            echo "üîÑ I/O optimizer –∞–∫—Ç–∏–≤–µ–Ω –Ω–∞ $(hostname)"
          done
        securityContext:
          privileged: true
        volumeMounts:
        - name: proc
          mountPath: /proc
        - name: sys
          mountPath: /sys
        resources:
          requests:
            cpu: 10m
            memory: 32Mi
          limits:
            cpu: 100m
            memory: 128Mi
      volumes:
      - name: proc
        hostPath:
          path: /proc
      - name: sys
        hostPath:
          path: /sys
DAEMONSET_EOF

# –û–∂–∏–¥–∞–Ω–∏–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è DaemonSet
echo "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è I/O –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞..."
kubectl rollout status daemonset io-optimizer -n kube-system

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
echo -e "\nüìä –°—Ç–∞—Ç—É—Å I/O –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:"
kubectl get pods -n kube-system -l app=io-optimizer -o wide

echo "‚úÖ I/O –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞"
EOF

chmod +x io-performance-optimizer.sh
```

### **3. –°–æ–∑–¥–∞–Ω–∏–µ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã—Ö PVC:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç high-performance-storage.sh
cat << 'EOF' > high-performance-storage.sh
#!/bin/bash

echo "üèÜ –°–æ–∑–¥–∞–Ω–∏–µ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞"
echo "============================================="

# –°–æ–∑–¥–∞–Ω–∏–µ PVC –¥–ª—è –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
echo "üóÑÔ∏è –°–æ–∑–¥–∞–Ω–∏–µ PVC –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:"
cat << 'DATABASE_PVC_EOF' | kubectl apply -f -
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: high-performance-db-pvc
  namespace: default
  labels:
    app: database
    performance: high
  annotations:
    volume.beta.kubernetes.io/storage-class: "fast-ssd"
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 100Gi
  storageClassName: fast-ssd
DATABASE_PVC_EOF

# –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ PVC –¥–ª—è WAL (Write-Ahead Log)
echo -e "\nüìù –°–æ–∑–¥–∞–Ω–∏–µ PVC –¥–ª—è WAL:"
cat << 'WAL_PVC_EOF' | kubectl apply -f -
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: high-performance-wal-pvc
  namespace: default
  labels:
    app: database
    type: wal
    performance: premium
  annotations:
    volume.beta.kubernetes.io/storage-class: "premium-ssd"
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 20Gi
  storageClassName: premium-ssd
WAL_PVC_EOF

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
echo -e "\nüß™ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–¥–∞:"
cat << 'TEST_POD_EOF' | kubectl apply -f -
apiVersion: v1
kind: Pod
metadata:
  name: storage-performance-test
  namespace: default
  labels:
    app: storage-test
spec:
  containers:
  - name: test
    image: busybox
    command: ["/bin/sh"]
    args:
    - -c
    - |
      echo "üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞"
      
      # –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏ –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –¥–∏—Å–∫
      echo "üìù –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏ –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –¥–∏—Å–∫:"
      dd if=/dev/zero of=/data/write_test bs=1M count=1000 oflag=direct 2>&1 | tail -1
      
      # –¢–µ—Å—Ç —á—Ç–µ–Ω–∏—è —Å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –¥–∏—Å–∫–∞
      echo "üìñ –¢–µ—Å—Ç —á—Ç–µ–Ω–∏—è —Å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –¥–∏—Å–∫–∞:"
      dd if=/data/write_test of=/dev/null bs=1M iflag=direct 2>&1 | tail -1
      
      # –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏ –Ω–∞ WAL –¥–∏—Å–∫
      echo "üìù –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏ –Ω–∞ WAL –¥–∏—Å–∫:"
      dd if=/dev/zero of=/wal/wal_test bs=4k count=10000 oflag=direct 2>&1 | tail -1
      
      # –¢–µ—Å—Ç —á—Ç–µ–Ω–∏—è —Å WAL –¥–∏—Å–∫–∞
      echo "üìñ –¢–µ—Å—Ç —á—Ç–µ–Ω–∏—è —Å WAL –¥–∏—Å–∫–∞:"
      dd if=/wal/wal_test of=/dev/null bs=4k iflag=direct 2>&1 | tail -1
      
      # –¢–µ—Å—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ I/O
      echo "üé≤ –¢–µ—Å—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ I/O:"
      dd if=/dev/urandom of=/data/random_test bs=4k count=5000 oflag=direct 2>&1 | tail -1
      
      # –û—á–∏—Å—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
      rm -f /data/write_test /data/random_test /wal/wal_test
      
      echo "‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ"
      
      # –ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–æ–¥–∞ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–∏—Ö —Ç–µ—Å—Ç–æ–≤
      while true; do sleep 3600; done
    volumeMounts:
    - name: data-volume
      mountPath: /data
    - name: wal-volume
      mountPath: /wal
    resources:
      requests:
        cpu: 500m
        memory: 512Mi
      limits:
        cpu: 1000m
        memory: 1Gi
  volumes:
  - name: data-volume
    persistentVolumeClaim:
      claimName: high-performance-db-pvc
  - name: wal-volume
    persistentVolumeClaim:
      claimName: high-performance-wal-pvc
  restartPolicy: Always
TEST_POD_EOF

# –û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
echo "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤..."
kubectl wait --for=condition=Ready pod/storage-performance-test --timeout=120s

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
echo -e "\nüìä –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:"
kubectl get pvc -o custom-columns=NAME:.metadata.name,STATUS:.status.phase,CAPACITY:.status.capacity.storage,STORAGECLASS:.spec.storageClassName
kubectl get pod storage-performance-test -o wide

echo "‚úÖ –í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ–∑–¥–∞–Ω–æ"
EOF

chmod +x high-performance-storage.sh
```

## üîß **–°–∫—Ä–∏–ø—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:**

### **1. –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç storage-performance-monitor.sh
cat << 'EOF' > storage-performance-monitor.sh
#!/bin/bash

echo "üìä –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞"
echo "===================================================="

# 1. –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
echo "üíæ 1. –û–ë–©–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –•–†–ê–ù–ò–õ–ò–©–ï:"
echo "Storage Classes:"
kubectl get storageclass -o custom-columns=NAME:.metadata.name,PROVISIONER:.provisioner,RECLAIM:.reclaimPolicy,EXPANSION:.allowVolumeExpansion,DEFAULT:.metadata.annotations.'storageclass\.kubernetes\.io/is-default-class'

echo -e "\nPersistent Volumes:"
kubectl get pv -o custom-columns=NAME:.metadata.name,CAPACITY:.spec.capacity.storage,STATUS:.status.phase,STORAGECLASS:.spec.storageClassName,CLAIM:.spec.claimRef.name

echo -e "\nPersistent Volume Claims:"
kubectl get pvc --all-namespaces -o custom-columns=NAME:.metadata.name,NAMESPACE:.metadata.namespace,STATUS:.status.phase,CAPACITY:.status.capacity.storage,STORAGECLASS:.spec.storageClassName

# 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –ø–æ namespace
echo -e "\nüìà 2. –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï –•–†–ê–ù–ò–õ–ò–©–ê –ü–û NAMESPACE:"
for ns in $(kubectl get namespaces -o jsonpath='{.items[*].metadata.name}'); do
    pvc_count=$(kubectl get pvc -n $ns --no-headers 2>/dev/null | wc -l)
    if [ $pvc_count -gt 0 ]; then
        echo "Namespace: $ns ($pvc_count PVC)"
        kubectl get pvc -n $ns -o custom-columns=NAME:.metadata.name,CAPACITY:.status.capacity.storage,STORAGECLASS:.spec.storageClassName
        echo
    fi
done

# 3. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–∏—Å–∫–æ–≤ –Ω–∞ —É–∑–ª–∞—Ö
echo "üñ•Ô∏è 3. –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ –î–ò–°–ö–û–í –ù–ê –£–ó–õ–ê–•:"
for node in $(kubectl get nodes -o jsonpath='{.items[*].metadata.name}'); do
    echo "=== Node: $node ==="
    kubectl get --raw /api/v1/nodes/$node/proxy/stats/summary 2>/dev/null | \
    jq -r '.node.fs // empty | "Filesystem usage: \(.usedBytes // 0 | . / 1024 / 1024 | floor)MB used / \(.capacityBytes // 0 | . / 1024 / 1024 | floor)MB total"' 2>/dev/null || echo "–ú–µ—Ç—Ä–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã"
done

# 4. CSI –¥—Ä–∞–π–≤–µ—Ä—ã –∏ –∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–µ
echo -e "\nüîå 4. CSI –î–†–ê–ô–í–ï–†–´:"
kubectl get csidriver -o custom-columns=NAME:.metadata.name,ATTACH:.spec.attachRequired,POD_INFO:.spec.podInfoOnMount,VOLUME_LIFECYCLE:.spec.volumeLifecycleModes

echo -e "\nCSI Nodes:"
kubectl get csinode -o custom-columns=NAME:.metadata.name,DRIVERS:.spec.drivers[*].name

# 5. –°–æ–±—ã—Ç–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
echo -e "\nüìÖ 5. –°–û–ë–´–¢–ò–Ø –•–†–ê–ù–ò–õ–ò–©–ê (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10):"
kubectl get events --all-namespaces --field-selector involvedObject.kind=PersistentVolume,involvedObject.kind=PersistentVolumeClaim --sort-by=.metadata.creationTimestamp | tail -10

# 6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
echo -e "\nüß™ 6. –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò:"
if kubectl get pod storage-performance-test &>/dev/null; then
    echo "–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏..."
    kubectl exec storage-performance-test -- sh -c "
    echo '–¢–µ—Å—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –∑–∞–ø–∏—Å–∏ (1GB):'
    dd if=/dev/zero of=/data/perf_test bs=1M count=1000 oflag=direct 2>&1 | grep -E '(copied|MB/s|GB/s)'
    
    echo '–¢–µ—Å—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è (1GB):'
    dd if=/data/perf_test of=/dev/null bs=1M iflag=direct 2>&1 | grep -E '(copied|MB/s|GB/s)'
    
    echo '–¢–µ—Å—Ç —Å–ª—É—á–∞–π–Ω–æ–π –∑–∞–ø–∏—Å–∏ (4K –±–ª–æ–∫–∏):'
    dd if=/dev/urandom of=/data/random_perf bs=4k count=10000 oflag=direct 2>&1 | grep -E '(copied|MB/s|kB/s)'
    
    rm -f /data/perf_test /data/random_perf
    echo '–¢–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã'
    "
else
    echo "–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –°–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ —Å –ø–æ–º–æ—â—å—é high-performance-storage.sh"
fi

# 7. –ú–µ—Ç—Ä–∏–∫–∏ Prometheus (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
echo -e "\nüìà 7. –ú–ï–¢–†–ò–ö–ò PROMETHEUS:"
if kubectl get svc prometheus-server -n monitoring &>/dev/null; then
    echo "Prometheus –¥–æ—Å—Ç—É–ø–µ–Ω. –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:"
    echo "- node_disk_reads_completed_total: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —á—Ç–µ–Ω–∏—è"
    echo "- node_disk_writes_completed_total: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞–ø–∏—Å–∏"
    echo "- node_disk_read_bytes_total: –ë–∞–π—Ç—ã –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —Å –¥–∏—Å–∫–∞"
    echo "- node_disk_written_bytes_total: –ë–∞–π—Ç—ã –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –Ω–∞ –¥–∏—Å–∫"
    echo "- kubelet_volume_stats_capacity_bytes: –ï–º–∫–æ—Å—Ç—å volume"
    echo "- kubelet_volume_stats_used_bytes: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ volume"
    
    kubectl port-forward svc/prometheus-server -n monitoring 9090:80 &
    PF_PID=$!
    sleep 3
    
    echo -e "\n–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–µ—Ç—Ä–∏–∫ –¥–∏—Å–∫–æ–≤:"
    curl -s "http://localhost:9090/api/v1/query?query=up{job=\"node-exporter\"}" | \
    jq -r '.data.result[] | "Node exporter: \(.metric.instance) - \(.value[1])"' 2>/dev/null || echo "–ú–µ—Ç—Ä–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã"
    
    kill $PF_PID 2>/dev/null
else
    echo "Prometheus –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
fi

# 8. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
echo -e "\nüí° 8. –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò:"
echo "–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è:"

# –ü–æ–¥—Å—á–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Storage Classes
fast_ssd_count=$(kubectl get pvc --all-namespaces -o jsonpath='{.items[*].spec.storageClassName}' | grep -o "fast-ssd" | wc -l)
premium_count=$(kubectl get pvc --all-namespaces -o jsonpath='{.items[*].spec.storageClassName}' | grep -o "premium-ssd" | wc -l)
standard_count=$(kubectl get pvc --all-namespaces -o jsonpath='{.items[*].spec.storageClassName}' | grep -o "standard" | wc -l)

echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Storage Classes:"
echo "  Fast SSD: $fast_ssd_count PVC"
echo "  Premium SSD: $premium_count PVC"
echo "  Standard: $standard_count PVC"

echo -e "\n–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:"
echo "1. üöÄ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ fast-ssd –¥–ª—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –∏ –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π"
echo "2. üíé –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ premium-ssd –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å retention –ø–æ–ª–∏—Ç–∏–∫–æ–π"
echo "3. üí∞ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ standard –¥–ª—è –ª–æ–≥–æ–≤, –∫—ç—à–µ–π –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö"
echo "4. üìä –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ IOPS –∏ latency —á–µ—Ä–µ–∑ Prometheus/Grafana"
echo "5. üîß –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ I/O –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞ —É–∑–ª–∞—Ö"
echo "6. üìà –ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ capacity –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ—Å—Ç–∞ –¥–∞–Ω–Ω—ã—Ö"

echo -e "\n‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∑–∞–≤–µ—Ä—à–µ–Ω!"
EOF

chmod +x storage-performance-monitor.sh
```

### **2. –°–æ–∑–¥–∞–Ω–∏–µ –∞–ª–µ—Ä—Ç–æ–≤ –¥–ª—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç storage-alerts.sh
cat << 'EOF' > storage-alerts.sh
#!/bin/bash

echo "üö® –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞"
echo "=================================================="

# –°–æ–∑–¥–∞–Ω–∏–µ PrometheusRule –¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
cat << 'ALERTS_EOF' | kubectl apply -f -
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: storage-performance-alerts
  namespace: monitoring
  labels:
    app: prometheus
    component: storage-alerts
spec:
  groups:
  - name: storage.performance
    rules:
    - alert: HighDiskLatency
      expr: rate(node_disk_read_time_seconds_total[5m]) / rate(node_disk_reads_completed_total[5m]) > 0.1
      for: 5m
      labels:
        severity: warning
        component: storage
      annotations:
        summary: "High disk read latency detected"
        description: "Disk {{ $labels.device }} on node {{ $labels.instance }} has high read latency: {{ $value }}s"
    
    - alert: HighDiskWriteLatency
      expr: rate(node_disk_write_time_seconds_total[5m]) / rate(node_disk_writes_completed_total[5m]) > 0.1
      for: 5m
      labels:
        severity: warning
        component: storage
      annotations:
        summary: "High disk write latency detected"
        description: "Disk {{ $labels.device }} on node {{ $labels.instance }} has high write latency: {{ $value }}s"
    
    - alert: HighDiskUtilization
      expr: rate(node_disk_io_time_seconds_total[5m]) > 0.8
      for: 5m
      labels:
        severity: warning
        component: storage
      annotations:
        summary: "High disk utilization detected"
        description: "Disk {{ $labels.device }} on node {{ $labels.instance }} utilization is {{ $value | humanizePercentage }}"
    
    - alert: VolumeSpaceRunningLow
      expr: kubelet_volume_stats_available_bytes / kubelet_volume_stats_capacity_bytes * 100 < 10
      for: 5m
      labels:
        severity: critical
        component: storage
      annotations:
        summary: "Volume space running low"
        description: "Volume {{ $labels.persistentvolumeclaim }} in namespace {{ $labels.namespace }} has only {{ $value }}% space left"
    
    - alert: VolumeSpaceCritical
      expr: kubelet_volume_stats_available_bytes / kubelet_volume_stats_capacity_bytes * 100 < 5
      for: 2m
      labels:
        severity: critical
        component: storage
      annotations:
        summary: "Volume space critical"
        description: "Volume {{ $labels.persistentvolumeclaim }} in namespace {{ $labels.namespace }} has only {{ $value }}% space left"
    
    - alert: HighIOPS
      expr: rate(node_disk_reads_completed_total[5m]) + rate(node_disk_writes_completed_total[5m]) > 1000
      for: 10m
      labels:
        severity: info
        component: storage
      annotations:
        summary: "High IOPS detected"
        description: "Disk {{ $labels.device }} on node {{ $labels.instance }} has high IOPS: {{ $value }}"
    
    - alert: PersistentVolumeError
      expr: kube_persistentvolume_status_phase{phase="Failed"} == 1
      for: 1m
      labels:
        severity: critical
        component: storage
      annotations:
        summary: "Persistent Volume in Failed state"
        description: "PersistentVolume {{ $labels.persistentvolume }} is in Failed state"
ALERTS_EOF

echo "‚úÖ –ê–ª–µ—Ä—Ç—ã –¥–ª—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∞–ª–µ—Ä—Ç–æ–≤
echo -e "\nüìã –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã:"
kubectl get prometheusrule storage-performance-alerts -n monitoring -o yaml | grep -A 2 "alert:"

echo -e "\nüí° –ê–ª–µ—Ä—Ç—ã –±—É–¥—É—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø—Ä–∏:"
echo "- –í—ã—Å–æ–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–µ –¥–∏—Å–∫–æ–≤ (>100ms)"
echo "- –í—ã—Å–æ–∫–æ–π —É—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ –¥–∏—Å–∫–æ–≤ (>80%)"
echo "- –ù–∏–∑–∫–æ–º —Å–≤–æ–±–æ–¥–Ω–æ–º –º–µ—Å—Ç–µ –Ω–∞ volume (<10%)"
echo "- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–æ–º –º–µ—Å—Ç–µ –Ω–∞ volume (<5%)"
echo "- –í—ã—Å–æ–∫–∏—Ö IOPS (>1000)"
echo "- –û—à–∏–±–∫–∞—Ö Persistent Volume"

echo -e "\nüîó –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∞–ª–µ—Ä—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:"
echo "kubectl port-forward svc/prometheus-server -n monitoring 9090:80"
echo "–ó–∞—Ç–µ–º –æ—Ç–∫—Ä–æ–π—Ç–µ http://localhost:9090/alerts"
EOF

chmod +x storage-alerts.sh
```

## üìä **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                Storage Performance Architecture            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Application Layer                                          ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Database Workloads (High IOPS, Low Latency)           ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Web Applications (Balanced Performance)               ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Batch Processing (High Throughput)                    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Logs & Archives (Cost Optim
