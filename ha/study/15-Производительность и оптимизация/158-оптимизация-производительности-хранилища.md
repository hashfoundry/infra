# 158. –ö–∞–∫ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞?

## üéØ –í–æ–ø—Ä–æ—Å
–ö–∞–∫ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞?

## üí° –û—Ç–≤–µ—Ç

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –≤ Kubernetes –≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä storage classes, –Ω–∞—Å—Ç—Ä–æ–π–∫—É CSI –¥—Ä–∞–π–≤–µ—Ä–æ–≤, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é I/O –æ–ø–µ—Ä–∞—Ü–∏–π –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–∏—Å–∫–æ–≤—ã—Ö –ø–æ–¥—Å–∏—Å—Ç–µ–º –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –≤—ã—Å–æ–∫–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º.

### üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

#### 1. **–°—Ö–µ–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                Storage Performance Stack                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
‚îÇ  ‚îÇ    CSI      ‚îÇ  ‚îÇ  Storage    ‚îÇ  ‚îÇ Persistent  ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ  Drivers    ‚îÇ  ‚îÇ  Classes    ‚îÇ  ‚îÇ  Volumes    ‚îÇ         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
‚îÇ  ‚îÇ Volume      ‚îÇ  ‚îÇ    I/O      ‚îÇ  ‚îÇ File System ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ Snapshots   ‚îÇ  ‚îÇ Scheduler   ‚îÇ  ‚îÇ Optimization‚îÇ         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### 2. **–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
```yaml
# –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
storage_performance_metrics:
  iops_metrics:
    - "node_disk_reads_completed_total"
    - "node_disk_writes_completed_total"
    - "node_disk_read_bytes_total"
    - "node_disk_written_bytes_total"
  
  latency_metrics:
    - "node_disk_read_time_seconds_total"
    - "node_disk_write_time_seconds_total"
    - "node_disk_io_time_seconds_total"
    - "kubelet_volume_stats_inodes_used"
  
  capacity_metrics:
    - "kubelet_volume_stats_capacity_bytes"
    - "kubelet_volume_stats_available_bytes"
    - "kubelet_volume_stats_used_bytes"
    - "node_filesystem_avail_bytes"
```

### üìä –ü—Ä–∏–º–µ—Ä—ã –∏–∑ –Ω–∞—à–µ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:
```bash
# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ storage classes
kubectl get storageclass

# Persistent volumes –∏ –∏—Ö —Å—Ç–∞—Ç—É—Å
kubectl get pv -o wide

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
kubectl get pvc --all-namespaces -o custom-columns=NAME:.metadata.name,NAMESPACE:.metadata.namespace,STATUS:.status.phase,CAPACITY:.status.capacity.storage
```

### üíæ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Storage Classes

#### 1. **–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–µ Storage Classes**
```yaml
# fast-ssd-storage-class.yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: fast-ssd
  annotations:
    storageclass.kubernetes.io/is-default-class: "false"
provisioner: dobs.csi.digitalocean.com
parameters:
  type: do-block-storage-xfs           # XFS –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  fs-type: xfs                         # –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ XFS
reclaimPolicy: Delete
allowVolumeExpansion: true
volumeBindingMode: WaitForFirstConsumer
---
# –ü—Ä–µ–º–∏—É–º SSD –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: premium-ssd
  annotations:
    storageclass.kubernetes.io/is-default-class: "false"
provisioner: dobs.csi.digitalocean.com
parameters:
  type: do-block-storage-xfs
  fs-type: xfs
  # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  iops: "3000"                         # –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ IOPS
  throughput: "125"                    # MB/s –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
reclaimPolicy: Retain                  # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
allowVolumeExpansion: true
volumeBindingMode: Immediate
---
# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∫–ª–∞—Å—Å –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: standard-hdd
  annotations:
    storageclass.kubernetes.io/is-default-class: "true"
provisioner: dobs.csi.digitalocean.com
parameters:
  type: do-block-storage
  fs-type: ext4                        # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
reclaimPolicy: Delete
allowVolumeExpansion: true
volumeBindingMode: WaitForFirstConsumer
---
# –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: local-nvme
provisioner: kubernetes.io/no-provisioner
parameters:
  type: local-nvme
reclaimPolicy: Delete
allowVolumeExpansion: false
volumeBindingMode: WaitForFirstConsumer
```

#### 2. **–°–∫—Ä–∏–ø—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ Storage Classes**
```bash
#!/bin/bash
# storage-class-optimization.sh

echo "üíæ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Storage Classes"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–∏—Ö storage classes
echo "üìä –¢–µ–∫—É—â–∏–µ Storage Classes:"
kubectl get storageclass -o custom-columns=NAME:.metadata.name,PROVISIONER:.provisioner,RECLAIM:.reclaimPolicy,EXPANSION:.allowVolumeExpansion

# –°–æ–∑–¥–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö storage classes
echo "üîß –°–æ–∑–¥–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö Storage Classes..."
kubectl apply -f fast-ssd-storage-class.yaml

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–∏—Å–∫–æ–≤
echo "üìà –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–∏—Å–∫–æ–≤:"
kubectl run disk-test --image=busybox --rm -it -- sh -c "
echo '–¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏:'
dd if=/dev/zero of=/tmp/test bs=1M count=100 oflag=direct
echo '–¢–µ—Å—Ç —á—Ç–µ–Ω–∏—è:'
dd if=/tmp/test of=/dev/null bs=1M iflag=direct
rm /tmp/test
"

# –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è storage classes
echo "üìã –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Storage Classes:"
kubectl get pvc --all-namespaces -o custom-columns=NAME:.metadata.name,NAMESPACE:.metadata.namespace,STORAGECLASS:.spec.storageClassName,SIZE:.spec.resources.requests.storage

echo "‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Storage Classes –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
```

### üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Persistent Volumes

#### 1. **–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–µ PV –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
```yaml
# high-performance-pv.yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: fast-database-pv
  labels:
    type: fast-ssd
    performance: high
spec:
  capacity:
    storage: 100Gi
  accessModes:
  - ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain
  storageClassName: fast-ssd
  csi:
    driver: dobs.csi.digitalocean.com
    volumeHandle: "volume-id-12345"
    fsType: xfs                          # XFS –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  mountOptions:
  - noatime                              # –û—Ç–∫–ª—é—á–µ–Ω–∏–µ access time
  - nodiratime                           # –û—Ç–∫–ª—é—á–µ–Ω–∏–µ directory access time
  - nobarrier                            # –û—Ç–∫–ª—é—á–µ–Ω–∏–µ write barriers –¥–ª—è SSD
  - largeio                              # –ë–æ–ª—å—à–∏–µ I/O –æ–ø–µ—Ä–∞—Ü–∏–∏
  - inode64                              # 64-bit inodes –¥–ª—è XFS
---
# PVC –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: database-fast-pvc
  namespace: production
  annotations:
    volume.beta.kubernetes.io/storage-class: "fast-ssd"
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 100Gi
  storageClassName: fast-ssd
---
# StatefulSet —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: high-performance-database
  namespace: production
spec:
  serviceName: database-service
  replicas: 3
  selector:
    matchLabels:
      app: database
  template:
    metadata:
      labels:
        app: database
    spec:
      containers:
      - name: postgres
        image: postgres:13
        resources:
          requests:
            memory: "4Gi"
            cpu: "2000m"
          limits:
            memory: "8Gi"
            cpu: "4000m"
        env:
        - name: POSTGRES_DB
          value: "production"
        - name: POSTGRES_USER
          value: "admin"
        - name: POSTGRES_PASSWORD
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: password
        # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è PostgreSQL –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        - name: POSTGRES_SHARED_BUFFERS
          value: "2GB"                    # 25% –æ—Ç RAM
        - name: POSTGRES_EFFECTIVE_CACHE_SIZE
          value: "6GB"                    # 75% –æ—Ç RAM
        - name: POSTGRES_WORK_MEM
          value: "64MB"                   # –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
        - name: POSTGRES_MAINTENANCE_WORK_MEM
          value: "512MB"                  # –î–ª—è maintenance –æ–ø–µ—Ä–∞—Ü–∏–π
        volumeMounts:
        - name: data
          mountPath: /var/lib/postgresql/data
        - name: wal
          mountPath: /var/lib/postgresql/wal
  volumeClaimTemplates:
  - metadata:
      name: data
    spec:
      accessModes: ["ReadWriteOnce"]
      storageClassName: fast-ssd
      resources:
        requests:
          storage: 100Gi
  - metadata:
      name: wal
    spec:
      accessModes: ["ReadWriteOnce"]
      storageClassName: premium-ssd       # –û—Ç–¥–µ–ª—å–Ω—ã–π –¥–∏—Å–∫ –¥–ª—è WAL
      resources:
        requests:
          storage: 20Gi
```

#### 2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ PV**
```bash
#!/bin/bash
# pv-performance-monitoring.sh

echo "üöÄ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ Persistent Volumes"

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è PV
echo "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Persistent Volumes:"
kubectl get pv -o custom-columns=NAME:.metadata.name,CAPACITY:.spec.capacity.storage,STATUS:.status.phase,STORAGECLASS:.spec.storageClassName,CLAIM:.spec.claimRef.name

# –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
echo -e "\nüíª –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–∏—Å–∫–æ–≤:"
kubectl get nodes -o jsonpath='{.items[*].metadata.name}' | \
xargs -I {} sh -c 'echo "Node: {}"; kubectl describe node {} | grep -A 10 "Allocated resources"'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ I/O —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
echo -e "\nüìà I/O —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:"
kubectl run iostat-test --image=busybox --rm -it -- sh -c "
if command -v iostat >/dev/null 2>&1; then
    iostat -x 1 3
else
    echo 'iostat –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º /proc/diskstats'
    cat /proc/diskstats
fi
"

# –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
echo -e "\nüíæ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞:"
kubectl get pvc --all-namespaces -o json | \
jq -r '.items[] | "\(.metadata.namespace)/\(.metadata.name): \(.status.capacity.storage // "N/A")"'

echo "‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω"
```

### ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è I/O –æ–ø–µ—Ä–∞—Ü–∏–π

#### 1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º**
```yaml
# filesystem-optimization-daemonset.yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: filesystem-optimizer
  namespace: kube-system
spec:
  selector:
    matchLabels:
      app: filesystem-optimizer
  template:
    metadata:
      labels:
        app: filesystem-optimizer
    spec:
      hostNetwork: true
      hostPID: true
      containers:
      - name: optimizer
        image: busybox
        command: ["/bin/sh"]
        args:
        - -c
        - |
          echo "üîß –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º"
          
          # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ I/O scheduler –¥–ª—è SSD
          for disk in /sys/block/*/queue/scheduler; do
            if [ -f "$disk" ]; then
              echo "noop" > "$disk" 2>/dev/null || echo "none" > "$disk" 2>/dev/null
              echo "–ù–∞—Å—Ç—Ä–æ–µ–Ω scheduler –¥–ª—è $(dirname $disk)"
            fi
          done
          
          # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è readahead
          for disk in /sys/block/*/queue/read_ahead_kb; do
            if [ -f "$disk" ]; then
              echo "128" > "$disk"
              echo "–ù–∞—Å—Ç—Ä–æ–µ–Ω readahead –¥–ª—è $(dirname $disk)"
            fi
          done
          
          # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ vm –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
          echo 1 > /proc/sys/vm/swappiness
          echo 80 > /proc/sys/vm/dirty_ratio
          echo 5 > /proc/sys/vm/dirty_background_ratio
          
          echo "‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
          
          # –ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ —Ä–∞–±–æ—á–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
          while true; do sleep 3600; done
        securityContext:
          privileged: true
        volumeMounts:
        - name: proc
          mountPath: /proc
        - name: sys
          mountPath: /sys
      volumes:
      - name: proc
        hostPath:
          path: /proc
      - name: sys
        hostPath:
          path: /sys
      tolerations:
      - operator: Exists
```

#### 2. **–°–∫—Ä–∏–ø—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ I/O**
```bash
#!/bin/bash
# io-optimization.sh

echo "‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è I/O –æ–ø–µ—Ä–∞—Ü–∏–π"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ I/O scheduler
echo "üìä –¢–µ–∫—É—â–∏–µ I/O schedulers:"
for disk in /sys/block/*/queue/scheduler; do
    if [ -f "$disk" ]; then
        echo "$(basename $(dirname $(dirname $disk))): $(cat $disk)"
    fi
done

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π I/O
echo "üîß –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ I/O –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π..."
kubectl apply -f filesystem-optimization-daemonset.yaml

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ I/O
echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ I/O –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏..."
kubectl run io-test --image=busybox --rm -it -- sh -c "
echo '–¢–µ—Å—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –∑–∞–ø–∏—Å–∏:'
dd if=/dev/zero of=/tmp/seq_write bs=1M count=1000 oflag=direct 2>&1 | grep -E '(copied|MB/s)'

echo '–¢–µ—Å—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è:'
dd if=/tmp/seq_write of=/dev/null bs=1M iflag=direct 2>&1 | grep -E '(copied|MB/s)'

echo '–¢–µ—Å—Ç —Å–ª—É—á–∞–π–Ω–æ–π –∑–∞–ø–∏—Å–∏:'
dd if=/dev/urandom of=/tmp/rand_write bs=4k count=10000 oflag=direct 2>&1 | grep -E '(copied|MB/s)'

rm -f /tmp/seq_write /tmp/rand_write
echo '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ'
"

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ I/O –Ω–∞–≥—Ä—É–∑–∫–∏
echo "üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ I/O –Ω–∞–≥—Ä—É–∑–∫–∏:"
kubectl top nodes --sort-by=memory

echo "‚úÖ I/O –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
```

### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

#### 1. **Prometheus –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞**
```yaml
# storage-monitoring.yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: storage-performance
  namespace: monitoring
spec:
  selector:
    matchLabels:
      app: node-exporter
  endpoints:
  - port: metrics
    interval: 15s
    path: /metrics
---
# Grafana dashboard –¥–ª—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
apiVersion: v1
kind: ConfigMap
metadata:
  name: storage-dashboard
  namespace: monitoring
data:
  dashboard.json: |
    {
      "dashboard": {
        "title": "Storage Performance Dashboard",
        "panels": [
          {
            "title": "Disk IOPS",
            "type": "graph",
            "targets": [
              {
                "expr": "rate(node_disk_reads_completed_total[5m])",
                "legendFormat": "Read IOPS - {{device}}"
              },
              {
                "expr": "rate(node_disk_writes_completed_total[5m])",
                "legendFormat": "Write IOPS - {{device}}"
              }
            ]
          },
          {
            "title": "Disk Throughput",
            "type": "graph",
            "targets": [
              {
                "expr": "rate(node_disk_read_bytes_total[5m])",
                "legendFormat": "Read Throughput - {{device}}"
              },
              {
                "expr": "rate(node_disk_written_bytes_total[5m])",
                "legendFormat": "Write Throughput - {{device}}"
              }
            ]
          },
          {
            "title": "Disk Latency",
            "type": "graph",
            "targets": [
              {
                "expr": "rate(node_disk_read_time_seconds_total[5m]) / rate(node_disk_reads_completed_total[5m])",
                "legendFormat": "Read Latency - {{device}}"
              },
              {
                "expr": "rate(node_disk_write_time_seconds_total[5m]) / rate(node_disk_writes_completed_total[5m])",
                "legendFormat": "Write Latency - {{device}}"
              }
            ]
          },
          {
            "title": "Volume Usage",
            "type": "graph",
            "targets": [
              {
                "expr": "kubelet_volume_stats_used_bytes / kubelet_volume_stats_capacity_bytes * 100",
                "legendFormat": "Usage % - {{persistentvolumeclaim}}"
              }
            ]
          }
        ]
      }
    }
---
# –ê–ª–µ—Ä—Ç—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: storage-performance-alerts
  namespace: monitoring
spec:
  groups:
  - name: storage.performance
    rules:
    - alert: HighDiskLatency
      expr: rate(node_disk_read_time_seconds_total[5m]) / rate(node_disk_reads_completed_total[5m]) > 0.1
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "High disk read latency detected"
        description: "Disk {{ $labels.device }} has high read latency: {{ $value }}s"
    
    - alert: HighDiskUtilization
      expr: rate(node_disk_io_time_seconds_total[5m]) > 0.8
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "High disk utilization detected"
        description: "Disk {{ $labels.device }} utilization is {{ $value }}%"
    
    - alert: VolumeSpaceRunningLow
      expr: kubelet_volume_stats_available_bytes / kubelet_volume_stats_capacity_bytes * 100 < 10
      for: 5m
      labels:
        severity: critical
      annotations:
        summary: "Volume space running low"
        description: "Volume {{ $labels.persistentvolumeclaim }} has only {{ $value }}% space left"
```

#### 2. **–°–∫—Ä–∏–ø—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**
```bash
#!/bin/bash
# comprehensive-storage-monitoring.sh

echo "üìä –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞"

# –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
echo "üíæ –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:"
kubectl get storageclass,pv,pvc --all-namespaces

# –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–∏—Å–∫–æ–≤
echo -e "\nüìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–∏—Å–∫–æ–≤:"
kubectl get nodes -o jsonpath='{.items[*].metadata.name}' | \
xargs -I {} sh -c 'echo "=== Node: {} ==="; kubectl describe node {} | grep -A 5 "Allocated resources"'

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ volumes
echo -e "\nüìã –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ volumes:"
kubectl get pods --all-namespaces -o json | \
jq -r '.items[] | select(.spec.volumes != null) | "\(.metadata.namespace)/\(.metadata.name): \(.spec.volumes | length) volumes"'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ CSI –¥—Ä–∞–π–≤–µ—Ä–æ–≤
echo -e "\nüîå CSI –¥—Ä–∞–π–≤–µ—Ä—ã:"
kubectl get csidriver

# –ê–Ω–∞–ª–∏–∑ —Å–æ–±—ã—Ç–∏–π —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
echo -e "\nüìÖ –°–æ–±—ã—Ç–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:"
kubectl get events --all-namespaces --field-selector involvedObject.kind=PersistentVolume | tail -10

# –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
echo -e "\nüß™ –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:"
kubectl run storage-benchmark --image=busybox --rm -it -- sh -c "
echo '–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞...'
dd if=/dev/zero of=/tmp/testfile bs=1M count=100 2>&1 | tail -1

echo '–¢–µ—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏:'
time sync

echo '–¢–µ—Å—Ç —á—Ç–µ–Ω–∏—è:'
dd if=/tmp/testfile of=/dev/null bs=1M 2>&1 | tail -1

rm /tmp/testfile
echo '–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω'
"

# –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
echo -e "\nüí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:"
echo "1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SSD –¥–∏—Å–∫–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π"
echo "2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ storage classes"
echo "3. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã (XFS –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤)"
echo "4. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ IOPS –∏ latency"
echo "5. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –¥–∏—Å–∫–∏ –¥–ª—è WAL/logs"

echo "‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω"
```

### üéØ –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

#### 1. **–°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞**
```yaml
storage_optimization_strategy:
  storage_classes:
    fast_ssd:
      use_cases: ["–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö", "–í—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"]
      filesystem: "xfs"
      mount_options: ["noatime", "nodiratime", "nobarrier"]
      iops: "> 3000"
      
    standard_ssd:
      use_cases: ["Web –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è", "–ö—ç—à–∏"]
      filesystem: "ext4"
      mount_options: ["noatime", "nodiratime"]
      iops: "1000-3000"
      
    standard_hdd:
      use_cases: ["–õ–æ–≥–∏", "Backup", "–ê—Ä—Ö–∏–≤—ã"]
      filesystem: "ext4"
      mount_options: ["noatime"]
      iops: "< 1000"
  
  optimization_techniques:
    io_scheduler:
      ssd: "noop/none"
      hdd: "deadline/cfq"
    
    filesystem_tuning:
      xfs: ["largeio", "inode64", "nobarrier"]
      ext4: ["noatime", "nodiratime", "data=writeback"]
    
    application_level:
      databases: ["–û—Ç–¥–µ–ª—å–Ω—ã–µ –¥–∏—Å–∫–∏ –¥–ª—è WAL", "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ buffer pools"]
      web_apps: ["–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ", "–°–∂–∞—Ç–∏–µ"]
      logs: ["–†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤", "–°–∂–∞—Ç–∏–µ"]
```

#### 2. **–ß–µ–∫-–ª–∏—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞**
```yaml
storage_optimization_checklist:
  planning:
    - "‚úÖ –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"
    - "‚úÖ –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Ç–∏–ø—ã –¥–∏—Å–∫–æ–≤"
    - "‚úÖ –°–ø–ª–∞–Ω–∏—Ä—É–π—Ç–µ storage classes"
    - "‚úÖ –†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ IOPS"
  
  implementation:
    - "‚úÖ –°–æ–∑–¥–∞–π—Ç–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ storage classes"
    - "‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã"
    - "‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ mount –æ–ø—Ü–∏–∏"
    - "‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ I/O scheduler"
  
  monitoring:
    - "‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ IOPS –∏ throughput"
    - "‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ latency –¥–∏—Å–∫–æ–≤"
    - "‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞"
    - "‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã"
  
  maintenance:
    - "‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å"
    - "‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Ç—Ä–∏–∫"
    - "‚úÖ –ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞"
    - "‚úÖ –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ backup –∏ restore"
```

–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±—ã—Å—Ç—Ä—É—é —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –æ—Å–æ–±–µ–Ω–Ω–æ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –∏ –¥—Ä—É–≥–∏—Ö I/O-–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä–µ.
