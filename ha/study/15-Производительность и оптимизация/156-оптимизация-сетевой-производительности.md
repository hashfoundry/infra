# 156. –ö–∞–∫ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–µ–≤—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å?

## üéØ **–ß—Ç–æ —Ç–∞–∫–æ–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–µ—Ç–µ–≤–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏?**

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–µ—Ç–µ–≤–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ Kubernetes** ‚Äî —ç—Ç–æ –∫–æ–º–ø–ª–µ–∫—Å –º–µ—Ä –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ CNI, kube-proxy, DNS, Ingress –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ –∏ —Å–µ—Ç–µ–≤—ã—Ö –ø–æ–ª–∏—Ç–∏–∫ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å–µ—Ç–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∞.

## üèóÔ∏è **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–µ—Ç–µ–≤–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**

### **1. CNI (Container Network Interface)**
- Calico/Flannel/Cilium –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- MTU –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ encapsulation
- Routing –∏ IPAM –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- eBPF –∏ dataplane –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### **2. kube-proxy**
- iptables vs IPVS —Ä–µ–∂–∏–º—ã
- Connection tracking –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- Load balancing –∞–ª–≥–æ—Ä–∏—Ç–º—ã
- Session affinity

### **3. DNS (CoreDNS)**
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ TTL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–µ—Å—É—Ä—Å—ã
- Upstream resolvers
- Query optimization

### **4. Ingress Controllers**
- NGINX/Traefik/HAProxy –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- SSL/TLS termination
- Load balancing –∏ health checks
- Compression –∏ caching

## üìä **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –≤–∞—à–µ–≥–æ HA –∫–ª–∞—Å—Ç–µ—Ä–∞:**

### **1. –ê–Ω–∞–ª–∏–∑ —Å–µ—Ç–µ–≤–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
```bash
# –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ç–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
kubectl get nodes -o wide

# –ü—Ä–æ–≤–µ—Ä–∫–∞ CNI –ø–æ–¥–æ–≤ (Calico)
kubectl get pods -n calico-system -o wide

# –°—Ç–∞—Ç—É—Å kube-proxy
kubectl get pods -n kube-system -l k8s-app=kube-proxy

# CoreDNS —Å—Ç–∞—Ç—É—Å
kubectl get pods -n kube-system -l k8s-app=kube-dns

# NGINX Ingress —Å—Ç–∞—Ç—É—Å
kubectl get pods -n ingress-nginx
```

### **2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–µ–≤–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞:**
```bash
# –¢–æ–ø –ø–æ–¥–æ–≤ –ø–æ —Å–µ—Ç–µ–≤–æ–º—É —Ç—Ä–∞—Ñ–∏–∫—É
kubectl top pods --all-namespaces --sort-by=memory

# –°–µ—Ç–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –Ω–∞ —É–∑–ª–∞—Ö
for node in $(kubectl get nodes -o jsonpath='{.items[*].metadata.name}'); do
    echo "=== Node: $node ==="
    kubectl get --raw /api/v1/nodes/$node/proxy/stats/summary | jq '.node.network'
done

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫ —á–µ—Ä–µ–∑ Prometheus
kubectl port-forward svc/prometheus-server -n monitoring 9090:80 &
```

### **3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ç–µ–≤–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
```bash
# DNS resolution —Ç–µ—Å—Ç
kubectl run dns-test --image=busybox --rm -it -- nslookup kubernetes.default.svc.cluster.local

# –°–µ—Ç–µ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–¥–∞–º–∏
kubectl run nettest-client --image=busybox --rm -it -- ping <pod-ip>

# –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–µ—Ç–∏
kubectl run iperf-server --image=networkstatic/iperf3 --port=5201
kubectl run iperf-client --image=networkstatic/iperf3 --rm -it -- iperf3 -c <server-ip>
```

### **4. –ê–Ω–∞–ª–∏–∑ Ingress –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
```bash
# –°—Ç–∞—Ç—É—Å NGINX Ingress Controller
kubectl describe pods -n ingress-nginx -l app.kubernetes.io/name=ingress-nginx

# –ú–µ—Ç—Ä–∏–∫–∏ NGINX Ingress
kubectl get --raw /metrics | grep nginx_ingress

# –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
kubectl get secrets -n ingress-nginx | grep tls
```

### **5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –ø–æ–ª–∏—Ç–∏–∫:**
```bash
# –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–µ—Ç–µ–≤—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏
kubectl get networkpolicies --all-namespaces

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫
kubectl describe networkpolicy <policy-name> -n <namespace>

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ç–µ–≤–æ–π —Å–≤—è–∑–Ω–æ—Å—Ç–∏
kubectl run connectivity-test --image=busybox --rm -it -- wget -qO- http://<service-name>.<namespace>.svc.cluster.local
```

## üîÑ **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–µ—Ç–µ–≤–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**

### **1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è CNI (Calico):**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç cni-optimizer.sh
cat << 'EOF' > cni-optimizer.sh
#!/bin/bash

echo "üåê –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è CNI (Calico) –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"
echo "=============================================="

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è Calico
echo "üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ Calico:"
kubectl get pods -n calico-system

# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Felix –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
echo -e "\nüîß –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Felix –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:"
cat << 'FELIX_EOF' | kubectl apply -f -
apiVersion: projectcalico.org/v3
kind: FelixConfiguration
metadata:
  name: default
spec:
  # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  bpfLogLevel: "Off"
  chainInsertMode: "Insert"
  dataplaneDriver: "iptables"
  defaultEndpointToHostAction: "ACCEPT"
  deviceRouteSourceAddress: "Use"
  iptablesBackend: "Auto"
  iptablesLockTimeout: "10s"
  iptablesPostWriteCheckInterval: "1s"
  iptablesRefreshInterval: "60s"
  logSeverityScreen: "Info"
  prometheusMetricsEnabled: true
  reportingInterval: "30s"
  routeRefreshInterval: "90s"
  routeTableRange: "1-250"
FELIX_EOF

# –ü—Ä–æ–≤–µ—Ä–∫–∞ MTU –Ω–∞—Å—Ç—Ä–æ–µ–∫
echo -e "\nüìè –ü—Ä–æ–≤–µ—Ä–∫–∞ MTU –Ω–∞—Å—Ç—Ä–æ–µ–∫:"
kubectl get nodes -o jsonpath='{.items[*].metadata.name}' | \
xargs -I {} sh -c 'echo "Node {}: $(kubectl get --raw /api/v1/nodes/{}/proxy/stats/summary | jq -r ".node.network.interfaces[0].mtu // \"N/A\"")"'

# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è IP Pool
echo -e "\nüèä –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è IP Pool:"
cat << 'IPPOOL_EOF' | kubectl apply -f -
apiVersion: projectcalico.org/v3
kind: IPPool
metadata:
  name: default-ipv4-ippool
spec:
  cidr: 10.244.0.0/16
  blockSize: 26
  ipipMode: Never
  vxlanMode: Always
  natOutgoing: true
  nodeSelector: all()
IPPOOL_EOF

echo "‚úÖ CNI –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
EOF

chmod +x cni-optimizer.sh
```

### **2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è kube-proxy:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç kube-proxy-optimizer.sh
cat << 'EOF' > kube-proxy-optimizer.sh
#!/bin/bash

echo "‚öñÔ∏è –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è kube-proxy –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"
echo "==========================================="

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ–∂–∏–º–∞ kube-proxy
echo "üìä –¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º kube-proxy:"
kubectl get configmap kube-proxy -n kube-system -o yaml | grep -A 5 mode

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
echo -e "\nüîß –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π kube-proxy:"
kubectl patch configmap kube-proxy -n kube-system --patch='
data:
  config.conf: |
    apiVersion: kubeproxy.config.k8s.io/v1alpha1
    kind: KubeProxyConfiguration
    mode: "iptables"
    iptables:
      masqueradeAll: false
      masqueradeBit: 14
      minSyncPeriod: 1s
      syncPeriod: 30s
    ipvs:
      minSyncPeriod: 5s
      syncPeriod: 30s
      scheduler: "rr"
      strictARP: false
    clusterCIDR: "10.244.0.0/16"
    hostnameOverride: ""
    bindAddress: "0.0.0.0"
    healthzBindAddress: "0.0.0.0:10256"
    metricsBindAddress: "127.0.0.1:10249"
    oomScoreAdj: -999
    udpIdleTimeout: 250ms
    conntrack:
      maxPerCore: 32768
      min: 131072
      tcpEstablishedTimeout: 86400s
      tcpCloseWaitTimeout: 3600s
'

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ kube-proxy –ø–æ–¥–æ–≤
echo -e "\nüîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ kube-proxy –ø–æ–¥–æ–≤:"
kubectl rollout restart daemonset kube-proxy -n kube-system

# –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
kubectl rollout status daemonset kube-proxy -n kube-system

echo "‚úÖ kube-proxy –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
EOF

chmod +x kube-proxy-optimizer.sh
```

### **3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è CoreDNS:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç dns-optimizer.sh
cat << 'EOF' > dns-optimizer.sh
#!/bin/bash

echo "üîç –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è CoreDNS –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"
echo "======================================="

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è CoreDNS
echo "üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ CoreDNS:"
kubectl get pods -n kube-system -l k8s-app=kube-dns

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ CoreDNS
echo -e "\nüîß –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ CoreDNS:"
kubectl patch configmap coredns -n kube-system --patch='
data:
  Corefile: |
    .:53 {
        errors
        health {
            lameduck 5s
        }
        ready
        kubernetes cluster.local in-addr.arpa ip6.arpa {
            pods insecure
            fallthrough in-addr.arpa ip6.arpa
            ttl 30
        }
        prometheus :9153
        forward . /etc/resolv.conf {
            max_concurrent 1000
            prefer_udp
        }
        cache 30 {
            success 9984 30
            denial 9984 5
            prefetch 10 60s
        }
        loop
        reload
        loadbalance
    }
'

# –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ CoreDNS –¥–ª—è HA
echo -e "\nüìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ CoreDNS:"
kubectl scale deployment coredns -n kube-system --replicas=3

# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ CoreDNS
echo -e "\nüíæ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ CoreDNS:"
kubectl patch deployment coredns -n kube-system --patch='
spec:
  template:
    spec:
      containers:
      - name: coredns
        resources:
          requests:
            cpu: 100m
            memory: 70Mi
          limits:
            cpu: 200m
            memory: 170Mi
'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
kubectl rollout status deployment coredns -n kube-system

echo "‚úÖ CoreDNS –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
EOF

chmod +x dns-optimizer.sh
```

## üîß **–°–∫—Ä–∏–ø—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–µ—Ç–∏:**

### **1. –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å—Ç–µ—Ä-—Å–∫—Ä–∏–ø—Ç–∞:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç network-optimizer.sh
cat << 'EOF' > network-optimizer.sh
#!/bin/bash

echo "üöÄ –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–µ—Ç–µ–≤–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"
echo "===================================================="

# 1. –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
echo -e "\nüêß 1. –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –°–ò–°–¢–ï–ú–ù–´–• –°–ï–¢–ï–í–´–• –ü–ê–†–ê–ú–ï–¢–†–û–í:"

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–µ—Ç–µ–≤—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –Ω–∞ —É–∑–ª–∞—Ö
cat >> /etc/sysctl.conf << 'SYSCTL_EOF'
# Network performance optimizations
net.core.somaxconn = 32768
net.core.netdev_max_backlog = 5000
net.core.rmem_max = 134217728
net.core.wmem_max = 134217728
net.ipv4.tcp_rmem = 4096 87380 134217728
net.ipv4.tcp_wmem = 4096 65536 134217728
net.ipv4.tcp_congestion_control = bbr
net.ipv4.tcp_slow_start_after_idle = 0
net.ipv4.tcp_tw_reuse = 1

# Connection tracking optimizations
net.netfilter.nf_conntrack_max = 1048576
net.netfilter.nf_conntrack_tcp_timeout_established = 600
net.netfilter.nf_conntrack_buckets = 262144
net.netfilter.nf_conntrack_tcp_timeout_time_wait = 120

# Bridge netfilter
net.bridge.bridge-nf-call-iptables = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.ipv4.ip_forward = 1
SYSCTL_EOF

sysctl -p
echo "‚úÖ –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã"

# 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è NGINX Ingress
echo -e "\nüö™ 2. –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø NGINX INGRESS:"

kubectl patch configmap nginx-configuration -n ingress-nginx --patch='
data:
  worker-processes: "auto"
  worker-connections: "16384"
  worker-rlimit-nofile: "65536"
  proxy-buffer-size: "16k"
  proxy-buffers-number: "8"
  proxy-busy-buffers-size: "64k"
  proxy-connect-timeout: "5"
  proxy-send-timeout: "60"
  proxy-read-timeout: "60"
  upstream-keepalive-connections: "100"
  upstream-keepalive-requests: "1000"
  upstream-keepalive-timeout: "60"
  enable-gzip: "true"
  gzip-level: "6"
  gzip-types: "text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript"
  ssl-protocols: "TLSv1.2 TLSv1.3"
  ssl-session-cache: "shared:SSL:10m"
  ssl-session-timeout: "10m"
'

echo "‚úÖ NGINX Ingress –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω"

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–µ—Ç–µ–≤—ã—Ö –ø–æ–ª–∏—Ç–∏–∫
echo -e "\nüõ°Ô∏è 3. –ü–†–û–í–ï–†–ö–ê –°–ï–¢–ï–í–´–• –ü–û–õ–ò–¢–ò–ö:"

# –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π —Å–µ—Ç–µ–≤–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
cat << 'NETPOL_EOF' | kubectl apply -f -
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: monitoring-network-policy
  namespace: monitoring
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: prometheus
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: monitoring
    - namespaceSelector:
        matchLabels:
          name: ingress-nginx
    ports:
    - protocol: TCP
      port: 9090
  egress:
  - {}
NETPOL_EOF

echo "‚úÖ –°–µ—Ç–µ–≤—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã"

# 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
echo -e "\nüß™ 4. –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –°–ï–¢–ï–í–û–ô –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò:"

# DNS —Ç–µ—Å—Ç
echo "DNS resolution test:"
kubectl run dns-perf-test --image=busybox --rm -it --restart=Never -- sh -c "
for i in \$(seq 1 10); do
  time nslookup kubernetes.default.svc.cluster.local
done
"

# –°–µ—Ç–µ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
echo -e "\nNetwork latency test:"
kubectl run latency-test --image=busybox --rm -it --restart=Never -- ping -c 5 8.8.8.8

echo "‚úÖ –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
EOF

chmod +x network-optimizer.sh
```

### **2. –°–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–µ—Ç–µ–≤–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç network-monitor.sh
cat << 'EOF' > network-monitor.sh
#!/bin/bash

echo "üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–µ–≤–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ HA –∫–ª–∞—Å—Ç–µ—Ä–∞"
echo "=================================================="

# 1. –û–±—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ç–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
echo "üåê 1. –°–û–°–¢–û–Ø–ù–ò–ï –°–ï–¢–ï–í–´–• –ö–û–ú–ü–û–ù–ï–ù–¢–û–í:"
echo "CNI (Calico):"
kubectl get pods -n calico-system -o wide

echo -e "\nkube-proxy:"
kubectl get pods -n kube-system -l k8s-app=kube-proxy -o wide

echo -e "\nCoreDNS:"
kubectl get pods -n kube-system -l k8s-app=kube-dns -o wide

echo -e "\nNGINX Ingress:"
kubectl get pods -n ingress-nginx -o wide

# 2. –°–µ—Ç–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
echo -e "\nüìà 2. –°–ï–¢–ï–í–´–ï –ú–ï–¢–†–ò–ö–ò:"

# –¢–æ–ø –ø–æ–¥–æ–≤ –ø–æ —Å–µ—Ç–µ–≤–æ–º—É —Ç—Ä–∞—Ñ–∏–∫—É
echo "–¢–æ–ø –ø–æ–¥–æ–≤ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å–µ—Ç–∏:"
kubectl top pods --all-namespaces --sort-by=memory | head -10

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ —Å–µ—Ç–µ–≤—ã–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
echo -e "\n–†–µ—Å—É—Ä—Å—ã —Å–µ—Ç–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:"
kubectl top pods -n calico-system
kubectl top pods -n kube-system -l k8s-app=kube-proxy
kubectl top pods -n kube-system -l k8s-app=kube-dns
kubectl top pods -n ingress-nginx

# 3. DNS –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
echo -e "\nüîç 3. DNS –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨:"
echo "DNS –∑–∞–ø—Ä–æ—Å—ã –≤ —Å–µ–∫—É–Ω–¥—É (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç):"
if kubectl get svc prometheus-server -n monitoring &>/dev/null; then
    kubectl port-forward svc/prometheus-server -n monitoring 9090:80 &
    PF_PID=$!
    sleep 3
    
    curl -s "http://localhost:9090/api/v1/query?query=rate(coredns_dns_request_count_total[5m])" | \
    jq -r '.data.result[] | "Instance: \(.metric.instance), QPS: \(.value[1])"'
    
    kill $PF_PID 2>/dev/null
fi

# 4. Ingress –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
echo -e "\nüö™ 4. INGRESS –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨:"
echo "NGINX Ingress —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:"
kubectl get ingress --all-namespaces

# 5. –°–µ—Ç–µ–≤—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏
echo -e "\nüõ°Ô∏è 5. –°–ï–¢–ï–í–´–ï –ü–û–õ–ò–¢–ò–ö–ò:"
kubectl get networkpolicies --all-namespaces

# 6. –ü—Ä–æ–±–ª–µ–º—ã –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
echo -e "\n‚ö†Ô∏è 6. –ü–†–û–ë–õ–ï–ú–´ –ò –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–Ø:"
issues=0

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–æ–≤ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –Ω–µ Ready
not_ready_pods=$(kubectl get pods --all-namespaces --field-selector=status.phase!=Running | grep -v NAMESPACE | wc -l)
if [ $not_ready_pods -gt 0 ]; then
    echo "‚ùå –ù–∞–π–¥–µ–Ω—ã –ø–æ–¥—ã –Ω–µ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ Running: $not_ready_pods"
    ((issues++))
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫
echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö..."
error_count=$(kubectl logs -n kube-system -l k8s-app=kube-proxy --tail=100 | grep -i error | wc -l)
if [ $error_count -gt 0 ]; then
    echo "‚ö†Ô∏è –ù–∞–π–¥–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö kube-proxy: $error_count"
    ((issues++))
fi

if [ $issues -eq 0 ]; then
    echo "‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–µ—Ç–µ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ"
fi

echo -e "\n‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–µ–≤–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω!"
EOF

chmod +x network-monitor.sh
```

## üìä **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ—Ç–µ–≤–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                Network Performance Stack                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Application Layer                                          ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Services (ClusterIP, NodePort, LoadBalancer)          ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Ingress (NGINX, Traefik, HAProxy)                     ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Network Policies (Security + Performance)             ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Service Mesh (Istio, Linkerd - optional)              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Kubernetes Network Layer                                   ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ kube-proxy (iptables/IPVS load balancing)             ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ CoreDNS (Service discovery + caching)                 ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ CNI Plugin (Calico, Flannel, Cilium)                  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Pod-to-Pod Communication                               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Node Network Layer                                         ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ iptables/netfilter (Packet filtering)                 ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Bridge/VXLAN (Network virtualization)                 ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Routing Tables (Traffic steering)                     ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Network Interfaces (Physical/Virtual)                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Infrastructure Layer                                       ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Physical Network (Switches, Routers)                  ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Cloud Network (VPC, Subnets, Security Groups)         ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Load Balancers (External traffic distribution)        ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ CDN/Edge (Content delivery optimization)              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üö® **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–µ–≤–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**

### **1. Prometheus –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è —Å–µ—Ç–∏:**
```bash
# –î–æ—Å—Ç—É–ø –∫ Prometheus –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–µ—Ç–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫
kubectl port-forward svc/prometheus-server -n monitoring 9090:80 &

# –ö–ª—é—á–µ–≤—ã–µ —Å–µ—Ç–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
# rate(container_network_receive_bytes_total[5m]) - –≤—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫
# rate(container_network_transmit_bytes_total[5m]) - –∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫
# histogram_quantile(0.95, nginx_ingress_controller_request_duration_seconds_bucket) - –∑–∞–¥–µ—Ä–∂–∫–∞ Ingress
# rate(coredns_dns_request_count_total[5m]) - DNS QPS
# container_network_receive_errors_total - —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏
```

### **2. –ê–ª–µ—Ä—Ç—ã –¥–ª—è —Å–µ—Ç–µ–≤–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
```yaml
# network-alerts.yaml
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: network-performance-alerts
  namespace: monitoring
spec:
  groups:
  - name: network-performance
    rules:
    - alert: HighNetworkLatency
      expr: histogram_quantile(0.95, nginx_ingress_controller_request_duration_seconds_bucket) > 1
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "High network latency detected"
        description: "95th percentile latency is {{ $value }}s"
    
    - alert: HighDNSLatency
      expr: histogram_quantile(0.95, coredns_dns_request_duration_seconds_bucket) > 0.1
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "High DNS resolution latency"
        description: "DNS 95th percentile latency is {{ $value }}s"
    
    - alert: NetworkErrors
      expr: rate(container_network_receive_errors_total[5m]) > 0.01
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "Network errors detected"
        description: "Network error rate is {{ $value }} errors/sec"
    
    - alert: CoreDNSDown
      expr: up{job="coredns"} == 0
      for: 1m
      labels:
        severity: critical
      annotations:
        summary: "CoreDNS is down"
        description: "CoreDNS instance {{ $labels.instance }} is down"
```

## üè≠ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏ –≤ –≤–∞—à–µ–º HA –∫–ª–∞—Å—Ç–µ—Ä–µ:**

### **1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–π —Å–µ—Ç–µ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
```bash
# –ê–Ω–∞–ª–∏–∑ —Å–µ—Ç–µ–≤–æ–π —Ç–æ–ø–æ–ª–æ–≥–∏–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞
kubectl get nodes -o wide

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
kubectl get pods --all-namespaces -o wide | grep -E "(calico|coredns|ingress|kube-proxy)"

# –ê–Ω–∞–ª–∏–∑ —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ –∏—Ö endpoints
kubectl get svc --all-namespaces -o wide
kubectl get endpoints --all-namespaces
```

### **2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ HA:**
```bash
# –ú–µ–∂—É–∑–ª–æ–≤–∞—è —Å–≤—è–∑–Ω–æ—Å—Ç—å
for node in $(kubectl get nodes -o jsonpath='{.items[*].status.addresses[?(@.type=="InternalIP")].address}'); do
    echo "Testing connectivity to $node"
    kubectl run connectivity-test-$RANDOM --image=busybox --rm -it --restart=Never -- ping -c 3 $node
done

# DNS –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
kubectl run dns-benchmark --image=busybox --rm -it --restart=Never -- sh -c "
for i in \$(seq 1 100); do
    nslookup kubernetes.default.svc.cluster.local >/dev/null
done
"
```

### **3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫ –≤ Grafana
kubectl port-forward svc/grafana -n monitoring 3000:80 &

# –ò–º–ø–æ—Ä—Ç –¥–∞—à–±–æ—Ä–¥–æ–≤:
# - Kubernetes Networking (ID: 12114)
# - NGINX Ingress Controller (ID: 9614)
# - CoreDNS (ID: 5926)
```

## üéØ **Best Practices –¥–ª—è —Å–µ—Ç–µ–≤–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**

### **1. CNI –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
- –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π CNI –¥–ª—è –≤–∞—à–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏ (Calico –¥–ª—è –ø–æ–ª–∏—Ç–∏–∫, Cilium –¥–ª—è eBPF)
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π MTU –¥–ª—è –≤–∞—à–µ–π —Å–µ—Ç–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ VXLAN –≤–º–µ—Å—Ç–æ IPIP –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ IP pool —Ä–∞–∑–º–µ—Ä—ã –∏ –±–ª–æ–∫–∏

### **2. kube-proxy –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ IPVS —Ä–µ–∂–∏–º –¥–ª—è –±–æ–ª—å—à–∏—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ (>1000 —Å–µ—Ä–≤–∏—Å–æ–≤)
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ connection tracking –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ sync periods –¥–ª—è –≤–∞—à–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ iptables rules –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ

### **3. DNS –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–π—Ç–µ CoreDNS —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ —Ä–∞–∑–º–µ—Ä—É –∫–ª–∞—Å—Ç–µ—Ä–∞
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ TTL
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ nodelocal DNS cache –¥–ª—è –±–æ–ª—å—à–∏—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ upstream resolvers

### **4. Ingress –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ connection pooling –∏ keep-alive
- –í–∫–ª—é—á–∏—Ç–µ compression –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ SSL/TLS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ session affinity –∫–æ–≥–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ

**–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Ç–µ–≤–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è ‚Äî –∫–ª—é—á –∫ –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ Kubernetes –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π!**
