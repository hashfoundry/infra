# 168. ĞšĞ°Ğº ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ¶Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ñ‹Ğ¼ Ñ†Ğ¸ĞºĞ»Ğ¾Ğ¼ Ğ¸ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸ĞµĞ¼ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ñ‹Ñ… ĞºĞ¾Ğ¿Ğ¸Ğ¹?

## ğŸ¯ Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ
ĞšĞ°Ğº ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ¶Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ñ‹Ğ¼ Ñ†Ğ¸ĞºĞ»Ğ¾Ğ¼ Ğ¸ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸ĞµĞ¼ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ñ‹Ñ… ĞºĞ¾Ğ¿Ğ¸Ğ¹?

## ğŸ’¡ ĞÑ‚Ğ²ĞµÑ‚

Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¶Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ñ‹Ğ¼ Ñ†Ğ¸ĞºĞ»Ğ¾Ğ¼ backup Ğ²ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ, ĞºĞ»Ğ°ÑÑĞ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ Ğ²Ğ°Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸, Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ, Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑÑ‚Ğ°Ñ€Ñ‹Ñ… ĞºĞ¾Ğ¿Ğ¸Ğ¹, Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ storage Ğ¸ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ñ‚Ñ€Ğ°Ñ‚ Ğ½Ğ° Ğ´Ğ¾Ğ»Ğ³Ğ¾ÑÑ€Ğ¾Ñ‡Ğ½Ğ¾Ğµ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ.

### ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¶Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ñ‹Ğ¼ Ñ†Ğ¸ĞºĞ»Ğ¾Ğ¼

#### 1. **Ğ¡Ñ…ĞµĞ¼Ğ° lifecycle management**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Backup Lifecycle Management                  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Creation  â”‚â”€â”€â”€â–¶â”‚  Retention  â”‚â”€â”€â”€â–¶â”‚  Archival   â”‚     â”‚
â”‚  â”‚ (Automated) â”‚    â”‚ (Policies)  â”‚    â”‚ (Long-term) â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Monitoring  â”‚    â”‚ Compliance  â”‚    â”‚   Cleanup   â”‚     â”‚
â”‚  â”‚ & Alerting  â”‚    â”‚ & Auditing  â”‚    â”‚ & Deletion  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. **Ğ¡Ñ‚Ğ°Ğ´Ğ¸Ğ¸ Ğ¶Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ñ†Ğ¸ĞºĞ»Ğ°**
```yaml
# Ğ¡Ñ‚Ğ°Ğ´Ğ¸Ğ¸ Ğ¶Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ñ†Ğ¸ĞºĞ»Ğ° backup
backup_lifecycle_stages:
  creation:
    - "ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ"
    - "Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ñ‹ Ğ¿Ğ¾ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸ÑĞ¼"
    - "Manual backup Ğ¿Ğ¾ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ"
    - "Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ¸ Ğ²ĞµÑ€Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ"
  
  active_retention:
    - "Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğ´Ğ»Ñ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ"
    - "Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¸Ğ»Ğ¸ Ñ€ĞµĞ³Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ"
    - "Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚ÑŒ"
    - "Ğ ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚Ğ¸"
  
  archival:
    - "Ğ”Ğ¾Ğ»Ğ³Ğ¾ÑÑ€Ğ¾Ñ‡Ğ½Ğ¾Ğµ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ"
    - "Ğ‘Ğ¾Ğ»ĞµĞµ Ğ´ĞµÑˆĞµĞ²Ñ‹Ğµ storage ĞºĞ»Ğ°ÑÑÑ‹"
    - "Ğ¡Ğ¶Ğ°Ñ‚Ğ¸Ğµ Ğ¸ Ğ´ĞµĞ´ÑƒĞ¿Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ"
    - "Ğ¡Ğ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ compliance Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸ÑĞ¼"
  
  deletion:
    - "ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°Ğ¼"
    - "Secure deletion Ğ´Ğ»Ñ sensitive Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"
    - "Audit trail ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¹"
    - "Legal hold Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°"
```

### ğŸ“Š ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ¸Ğ· Ğ½Ğ°ÑˆĞµĞ³Ğ¾ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ°

#### ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° backup lifecycle:
```bash
# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° backup Ğ¸ Ğ¸Ñ… Ğ²Ğ¾Ğ·Ñ€Ğ°ÑÑ‚Ğ°
kubectl get backups -n velero --sort-by=.metadata.creationTimestamp
velero backup get

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° storage usage
kubectl get pv | grep backup
df -h /backup-storage

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° retention policies
velero schedule get
kubectl get schedules -n velero -o yaml | grep ttl
```

### ğŸ“… ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ

#### 1. **ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ retention policies**
```yaml
# backup-retention-policies.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: backup-retention-config
  namespace: velero
data:
  retention-policy.yaml: |
    # ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ backup
    retention_policies:
      critical_data:
        daily_backups:
          retention: "30 days"
          storage_class: "fast-ssd"
          location: "primary-region"
        weekly_backups:
          retention: "12 weeks"
          storage_class: "standard"
          location: "primary-region"
        monthly_backups:
          retention: "12 months"
          storage_class: "cold"
          location: "cross-region"
        yearly_backups:
          retention: "7 years"
          storage_class: "glacier"
          location: "archive-region"
      
      standard_data:
        daily_backups:
          retention: "7 days"
          storage_class: "standard"
        weekly_backups:
          retention: "4 weeks"
          storage_class: "standard"
        monthly_backups:
          retention: "6 months"
          storage_class: "cold"
      
      development_data:
        daily_backups:
          retention: "3 days"
          storage_class: "standard"
        weekly_backups:
          retention: "2 weeks"
          storage_class: "standard"
---
# Velero Schedule Ñ retention Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°Ğ¼Ğ¸
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: critical-daily-backup
  namespace: velero
spec:
  schedule: "0 2 * * *"                  # Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ¾ Ğ² 2:00
  template:
    includedNamespaces:
    - production
    - critical-services
    includedResources:
    - "*"
    storageLocation: primary-backup-location
    ttl: 720h                            # 30 Ğ´Ğ½ĞµĞ¹
    metadata:
      labels:
        backup-tier: "critical"
        retention-policy: "long-term"
---
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: standard-weekly-backup
  namespace: velero
spec:
  schedule: "0 3 * * 0"                  # Ğ•Ğ¶ĞµĞ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¾ Ğ² Ğ²Ğ¾ÑĞºÑ€ĞµÑĞµĞ½ÑŒĞµ Ğ² 3:00
  template:
    includedNamespaces:
    - staging
    - testing
    storageLocation: standard-backup-location
    ttl: 672h                            # 4 Ğ½ĞµĞ´ĞµĞ»Ğ¸
    metadata:
      labels:
        backup-tier: "standard"
        retention-policy: "medium-term"
```

#### 2. **ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ lifecycle management**
```bash
#!/bin/bash
# backup-lifecycle-manager.sh

echo "ğŸ“… Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¶Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ñ‹Ğ¼ Ñ†Ğ¸ĞºĞ»Ğ¾Ğ¼ backup"

# ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ
VELERO_NAMESPACE="velero"
BACKUP_STORAGE="/backup-storage"
ARCHIVE_STORAGE="/archive-storage"
LOG_FILE="/var/log/backup-lifecycle.log"

# Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
log_message() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" | tee -a $LOG_FILE
}

# ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ñ… backup
analyze_current_backups() {
    log_message "ğŸ” ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ñ… backup"
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ²ÑĞµÑ… backup Ñ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸
    local backups=$(velero backup get -o json)
    
    # Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ¿Ğ¾ Ğ²Ğ¾Ğ·Ñ€Ğ°ÑÑ‚Ñƒ
    echo "$backups" | jq -r '
        .items[] | 
        {
            name: .metadata.name,
            created: .metadata.creationTimestamp,
            size: .status.progress.totalItems,
            tier: .metadata.labels["backup-tier"] // "unknown",
            age_days: ((now - (.metadata.creationTimestamp | fromdateiso8601)) / 86400 | floor)
        } | 
        "\(.tier):\(.name):\(.age_days) days:\(.size) items"
    ' | sort -t: -k3 -n
    
    log_message "âœ… ĞĞ½Ğ°Ğ»Ğ¸Ğ· backup Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½"
}

# ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ retention Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸Ğº
apply_retention_policies() {
    log_message "ğŸ“‹ ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ retention Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸Ğº"
    
    # ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ backup (30 Ğ´Ğ½ĞµĞ¹)
    local critical_old=$(velero backup get -l backup-tier=critical -o json | \
        jq -r --arg cutoff "$(date -d '30 days ago' -u +%Y-%m-%dT%H:%M:%SZ)" '
            .items[] | 
            select(.metadata.creationTimestamp < $cutoff) | 
            .metadata.name
        ')
    
    # Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğµ backup (7 Ğ´Ğ½ĞµĞ¹)
    local standard_old=$(velero backup get -l backup-tier=standard -o json | \
        jq -r --arg cutoff "$(date -d '7 days ago' -u +%Y-%m-%dT%H:%M:%SZ)" '
            .items[] | 
            select(.metadata.creationTimestamp < $cutoff) | 
            .metadata.name
        ')
    
    # Development backup (3 Ğ´Ğ½Ñ)
    local dev_old=$(velero backup get -l backup-tier=development -o json | \
        jq -r --arg cutoff "$(date -d '3 days ago' -u +%Y-%m-%dT%H:%M:%SZ)" '
            .items[] | 
            select(.metadata.creationTimestamp < $cutoff) | 
            .metadata.name
        ')
    
    # ĞÑ€Ñ…Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ñ… backup
    for backup in $critical_old; do
        archive_backup "$backup" "critical"
    done
    
    # Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ñ… backup
    for backup in $standard_old; do
        delete_backup "$backup" "standard"
    done
    
    # Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ development backup
    for backup in $dev_old; do
        delete_backup "$backup" "development"
    done
    
    log_message "âœ… Retention Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ñ‹"
}

# ĞÑ€Ñ…Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ backup
archive_backup() {
    local backup_name=$1
    local tier=$2
    
    log_message "ğŸ“¦ ĞÑ€Ñ…Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ backup: $backup_name ($tier)"
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ backup Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
    local backup_location=$(velero backup describe $backup_name --details | \
        grep "Storage Location:" | awk '{print $3}')
    
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¿Ğ¸Ğ¸
    local archive_name="${backup_name}-archived-$(date +%s)"
    
    # ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ½Ğ¾Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ
    if [ "$tier" = "critical" ]; then
        # Ğ”Ğ»Ñ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… - ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¿Ğ¸Ğ¸
        velero backup create $archive_name \
            --from-backup $backup_name \
            --storage-location archive-location \
            --wait
        
        log_message "âœ… ĞÑ€Ñ…Ğ¸Ğ²Ğ½Ğ°Ñ ĞºĞ¾Ğ¿Ğ¸Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°: $archive_name"
    fi
    
    # Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ backup Ğ¿Ğ¾ÑĞ»Ğµ Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
    velero backup delete $backup_name --confirm
    
    log_message "âœ… Backup $backup_name Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½"
}

# Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ backup
delete_backup() {
    local backup_name=$1
    local tier=$2
    
    log_message "ğŸ—‘ï¸ Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ backup: $backup_name ($tier)"
    
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° legal hold
    local legal_hold=$(kubectl get backup $backup_name -n $VELERO_NAMESPACE \
        -o jsonpath='{.metadata.annotations.legal-hold}' 2>/dev/null)
    
    if [ "$legal_hold" = "true" ]; then
        log_message "âš ï¸ Backup $backup_name Ğ¿Ğ¾Ğ´ legal hold - Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞº ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ"
        return 0
    fi
    
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ audit Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸
    create_deletion_audit "$backup_name" "$tier"
    
    # Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ backup
    velero backup delete $backup_name --confirm
    
    log_message "âœ… Backup $backup_name ÑƒĞ´Ğ°Ğ»ĞµĞ½"
}

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ audit Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ
create_deletion_audit() {
    local backup_name=$1
    local tier=$2
    
    cat >> /var/log/backup-deletions.audit << EOF
{
  "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
  "action": "backup_deletion",
  "backup_name": "$backup_name",
  "backup_tier": "$tier",
  "deleted_by": "automated-lifecycle-manager",
  "reason": "retention_policy_expiry"
}
EOF
}

# ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ storage
optimize_storage() {
    log_message "ğŸ’¾ ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ storage"
    
    # ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ storage
    local storage_usage=$(df -h $BACKUP_STORAGE | tail -1 | awk '{print $5}' | sed 's/%//')
    
    if [ $storage_usage -gt 80 ]; then
        log_message "âš ï¸ Ğ’Ñ‹ÑĞ¾ĞºĞ¾Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ storage: ${storage_usage}%"
        
        # ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ° ÑÑ‚Ğ°Ñ€Ñ‹Ñ… backup
        force_cleanup_old_backups
        
        # Ğ¡Ğ¶Ğ°Ñ‚Ğ¸Ğµ Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ¾Ğ²
        compress_archive_backups
    fi
    
    # Ğ”ĞµĞ´ÑƒĞ¿Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
    run_deduplication
    
    log_message "âœ… ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ storage Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°"
}

# ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ°
force_cleanup_old_backups() {
    log_message "ğŸ§¹ ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ° ÑÑ‚Ğ°Ñ€Ñ‹Ñ… backup"
    
    # Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ backup ÑÑ‚Ğ°Ñ€ÑˆĞµ 90 Ğ´Ğ½ĞµĞ¹ (emergency cleanup)
    local emergency_old=$(velero backup get -o json | \
        jq -r --arg cutoff "$(date -d '90 days ago' -u +%Y-%m-%dT%H:%M:%SZ)" '
            .items[] | 
            select(.metadata.creationTimestamp < $cutoff) | 
            select(.metadata.annotations["legal-hold"] != "true") |
            .metadata.name
        ')
    
    for backup in $emergency_old; do
        log_message "ğŸš¨ Emergency deletion: $backup"
        velero backup delete $backup --confirm
    done
}

# Ğ¡Ğ¶Ğ°Ñ‚Ğ¸Ğµ Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ½Ñ‹Ñ… backup
compress_archive_backups() {
    log_message "ğŸ—œï¸ Ğ¡Ğ¶Ğ°Ñ‚Ğ¸Ğµ Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ½Ñ‹Ñ… backup"
    
    # ĞŸĞ¾Ğ¸ÑĞº Ğ½ĞµÑĞ¶Ğ°Ñ‚Ñ‹Ñ… Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ¾Ğ²
    find $ARCHIVE_STORAGE -name "*.tar" -mtime +7 | while read archive; do
        log_message "Ğ¡Ğ¶Ğ°Ñ‚Ğ¸Ğµ Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ°: $archive"
        gzip "$archive"
    done
}

# Ğ”ĞµĞ´ÑƒĞ¿Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
run_deduplication() {
    log_message "ğŸ”„ Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ´ĞµĞ´ÑƒĞ¿Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸"
    
    # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ rclone Ğ´Ğ»Ñ Ğ´ĞµĞ´ÑƒĞ¿Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ (ĞµÑĞ»Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½)
    if command -v rclone &> /dev/null; then
        rclone dedupe --dedupe-mode newest $BACKUP_STORAGE
    fi
}

# ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ compliance
monitor_compliance() {
    log_message "ğŸ“Š ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ compliance"
    
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ñ retention Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°Ğ¼
    local compliance_report="/tmp/backup-compliance-$(date +%Y%m%d).json"
    
    cat > $compliance_report << EOF
{
  "report_date": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
  "total_backups": $(velero backup get -o json | jq '.items | length'),
  "by_tier": {
    "critical": $(velero backup get -l backup-tier=critical -o json | jq '.items | length'),
    "standard": $(velero backup get -l backup-tier=standard -o json | jq '.items | length'),
    "development": $(velero backup get -l backup-tier=development -o json | jq '.items | length')
  },
  "storage_usage": {
    "total_gb": $(df -BG $BACKUP_STORAGE | tail -1 | awk '{print $2}' | sed 's/G//'),
    "used_gb": $(df -BG $BACKUP_STORAGE | tail -1 | awk '{print $3}' | sed 's/G//'),
    "available_gb": $(df -BG $BACKUP_STORAGE | tail -1 | awk '{print $4}' | sed 's/G//'),
    "usage_percent": $(df -h $BACKUP_STORAGE | tail -1 | awk '{print $5}' | sed 's/%//')
  }
}
EOF
    
    log_message "ğŸ“„ Compliance Ğ¾Ñ‚Ñ‡ĞµÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½: $compliance_report"
}

# ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°
case "$1" in
    analyze)
        analyze_current_backups
        ;;
    apply-retention)
        apply_retention_policies
        ;;
    optimize)
        optimize_storage
        ;;
    compliance)
        monitor_compliance
        ;;
    full)
        analyze_current_backups
        apply_retention_policies
        optimize_storage
        monitor_compliance
        ;;
    *)
        echo "Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: $0 {analyze|apply-retention|optimize|compliance|full}"
        exit 1
        ;;
esac
```

### ğŸ’° ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ñ‚Ñ€Ğ°Ñ‚

#### 1. **Storage tiering ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ**
```yaml
# storage-tiering-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: storage-tiering-config
  namespace: velero
data:
  tiering-strategy.yaml: |
    # Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ storage tiering
    storage_tiers:
      hot_tier:
        description: "Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğ´Ğ»Ñ Ğ½ĞµĞ´Ğ°Ğ²Ğ½Ğ¸Ñ… backup"
        retention: "7 days"
        storage_class: "fast-ssd"
        cost_per_gb_month: "$0.25"
        access_time: "< 1 minute"
        use_cases:
          - "Daily backups"
          - "Critical recovery scenarios"
          - "Development testing"
      
      warm_tier:
        description: "Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ğ¾Ğµ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ñ€ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ñ‹Ñ… backup"
        retention: "30 days"
        storage_class: "standard"
        cost_per_gb_month: "$0.10"
        access_time: "< 5 minutes"
        use_cases:
          - "Weekly backups"
          - "Monthly compliance backups"
          - "Standard recovery scenarios"
      
      cold_tier:
        description: "Ğ”Ğ¾Ğ»Ğ³Ğ¾ÑÑ€Ğ¾Ñ‡Ğ½Ğ¾Ğµ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ½Ñ‹Ñ… backup"
        retention: "1 year"
        storage_class: "cold"
        cost_per_gb_month: "$0.04"
        access_time: "< 1 hour"
        use_cases:
          - "Monthly backups"
          - "Quarterly compliance backups"
          - "Long-term retention"
      
      glacier_tier:
        description: "ĞÑ€Ñ…Ğ¸Ğ²Ğ½Ğ¾Ğµ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ compliance"
        retention: "7 years"
        storage_class: "glacier"
        cost_per_gb_month: "$0.01"
        access_time: "3-5 hours"
        use_cases:
          - "Yearly backups"
          - "Legal compliance"
          - "Audit requirements"
---
# BackupStorageLocation Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… tiers
apiVersion: velero.io/v1
kind: BackupStorageLocation
metadata:
  name: hot-tier-storage
  namespace: velero
spec:
  provider: aws
  objectStorage:
    bucket: hashfoundry-backup-hot
    prefix: hot-tier
  config:
    region: fra1
    s3StorageClass: STANDARD
---
apiVersion: velero.io/v1
kind: BackupStorageLocation
metadata:
  name: cold-tier-storage
  namespace: velero
spec:
  provider: aws
  objectStorage:
    bucket: hashfoundry-backup-cold
    prefix: cold-tier
  config:
    region: fra1
    s3StorageClass: STANDARD_IA
---
apiVersion: velero.io/v1
kind: BackupStorageLocation
metadata:
  name: glacier-tier-storage
  namespace: velero
spec:
  provider: aws
  objectStorage:
    bucket: hashfoundry-backup-glacier
    prefix: glacier-tier
  config:
    region: fra1
    s3StorageClass: GLACIER
```

#### 2. **ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ tiering**
```bash
#!/bin/bash
# storage-tiering-automation.sh

echo "ğŸ’° ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ storage tiering"

# ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ
HOT_TIER_DAYS=7
WARM_TIER_DAYS=30
COLD_TIER_DAYS=365

# ĞŸĞµÑ€ĞµĞ¼ĞµÑ‰ĞµĞ½Ğ¸Ğµ Ğ² warm tier
move_to_warm_tier() {
    echo "ğŸ”„ ĞŸĞµÑ€ĞµĞ¼ĞµÑ‰ĞµĞ½Ğ¸Ğµ backup Ğ² warm tier"
    
    # ĞŸĞ¾Ğ¸ÑĞº backup ÑÑ‚Ğ°Ñ€ÑˆĞµ 7 Ğ´Ğ½ĞµĞ¹ Ğ² hot tier
    local hot_old=$(velero backup get -o json | \
        jq -r --arg cutoff "$(date -d "${HOT_TIER_DAYS} days ago" -u +%Y-%m-%dT%H:%M:%SZ)" '
            .items[] | 
            select(.metadata.creationTimestamp < $cutoff) |
            select(.spec.storageLocation == "hot-tier-storage") |
            .metadata.name
        ')
    
    for backup in $hot_old; do
        echo "ğŸ“¦ ĞŸĞµÑ€ĞµĞ¼ĞµÑ‰ĞµĞ½Ğ¸Ğµ $backup Ğ² warm tier"
        
        # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ¿Ğ¸Ğ¸ Ğ² warm tier
        velero backup create ${backup}-warm \
            --from-backup $backup \
            --storage-location warm-tier-storage \
            --wait
        
        # Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· hot tier
        velero backup delete $backup --confirm
        
        echo "âœ… $backup Ğ¿ĞµÑ€ĞµĞ¼ĞµÑ‰ĞµĞ½ Ğ² warm tier"
    done
}

# ĞŸĞµÑ€ĞµĞ¼ĞµÑ‰ĞµĞ½Ğ¸Ğµ Ğ² cold tier
move_to_cold_tier() {
    echo "ğŸ§Š ĞŸĞµÑ€ĞµĞ¼ĞµÑ‰ĞµĞ½Ğ¸Ğµ backup Ğ² cold tier"
    
    # ĞŸĞ¾Ğ¸ÑĞº backup ÑÑ‚Ğ°Ñ€ÑˆĞµ 30 Ğ´Ğ½ĞµĞ¹ Ğ² warm tier
    local warm_old=$(velero backup get -o json | \
        jq -r --arg cutoff "$(date -d "${WARM_TIER_DAYS} days ago" -u +%Y-%m-%dT%H:%M:%SZ)" '
            .items[] | 
            select(.metadata.creationTimestamp < $cutoff) |
            select(.spec.storageLocation == "warm-tier-storage") |
            .metadata.name
        ')
    
    for backup in $warm_old; do
        echo "â„ï¸ ĞŸĞµÑ€ĞµĞ¼ĞµÑ‰ĞµĞ½Ğ¸Ğµ $backup Ğ² cold tier"
        
        # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ¿Ğ¸Ğ¸ Ğ² cold tier
        velero backup create ${backup}-cold \
            --from-backup $backup \
            --storage-location cold-tier-storage \
            --wait
        
        # Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· warm tier
        velero backup delete $backup --confirm
        
        echo "âœ… $backup Ğ¿ĞµÑ€ĞµĞ¼ĞµÑ‰ĞµĞ½ Ğ² cold tier"
    done
}

# ĞŸĞµÑ€ĞµĞ¼ĞµÑ‰ĞµĞ½Ğ¸Ğµ Ğ² glacier tier
move_to_glacier_tier() {
    echo "ğŸ”ï¸ ĞŸĞµÑ€ĞµĞ¼ĞµÑ‰ĞµĞ½Ğ¸Ğµ backup Ğ² glacier tier"
    
    # ĞŸĞ¾Ğ¸ÑĞº backup ÑÑ‚Ğ°Ñ€ÑˆĞµ 1 Ğ³Ğ¾Ğ´Ğ° Ğ² cold tier
    local cold_old=$(velero backup get -o json | \
        jq -r --arg cutoff "$(date -d "${COLD_TIER_DAYS} days ago" -u +%Y-%m-%dT%H:%M:%SZ)" '
            .items[] | 
            select(.metadata.creationTimestamp < $cutoff) |
            select(.spec.storageLocation == "cold-tier-storage") |
            select(.metadata.labels["backup-tier"] == "critical") |
            .metadata.name
        ')
    
    for backup in $cold_old; do
        echo "ğŸ—» ĞŸĞµÑ€ĞµĞ¼ĞµÑ‰ĞµĞ½Ğ¸Ğµ $backup Ğ² glacier tier"
        
        # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ¿Ğ¸Ğ¸ Ğ² glacier tier
        velero backup create ${backup}-glacier \
            --from-backup $backup \
            --storage-location glacier-tier-storage \
            --wait
        
        # Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· cold tier
        velero backup delete $backup --confirm
        
        echo "âœ… $backup Ğ¿ĞµÑ€ĞµĞ¼ĞµÑ‰ĞµĞ½ Ğ² glacier tier"
    done
}

# Ğ Ğ°ÑÑ‡ĞµÑ‚ ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ storage
calculate_storage_costs() {
    echo "ğŸ’µ Ğ Ğ°ÑÑ‡ĞµÑ‚ ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ storage"
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ¾Ğ² backup Ğ¿Ğ¾ tiers
    local hot_size=$(aws s3 ls s3://hashfoundry-backup-hot/hot-tier/ --recursive --summarize | \
        grep "Total Size:" | awk '{print $3}')
    local warm_size=$(aws s3 ls s3://hashfoundry-backup-warm/warm-tier/ --recursive --summarize | \
        grep "Total Size:" | awk '{print $3}')
    local cold_size=$(aws s3 ls s3://hashfoundry-backup-cold/cold-tier/ --recursive --summarize | \
        grep "Total Size:" | awk '{print $3}')
    local glacier_size=$(aws s3 ls s3://hashfoundry-backup-glacier/glacier-tier/ --recursive --summarize | \
        grep "Total Size:" | awk '{print $3}')
    
    # ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ² GB
    local hot_gb=$((hot_size / 1024 / 1024 / 1024))
    local warm_gb=$((warm_size / 1024 / 1024 / 1024))
    local cold_gb=$((cold_size / 1024 / 1024 / 1024))
    local glacier_gb=$((glacier_size / 1024 / 1024 / 1024))
    
    # Ğ Ğ°ÑÑ‡ĞµÑ‚ Ğ¼ĞµÑÑÑ‡Ğ½Ñ‹Ñ… Ğ·Ğ°Ñ‚Ñ€Ğ°Ñ‚
    local hot_cost=$(echo "$hot_gb * 0.25" | bc -l)
    local warm_cost=$(echo "$warm_gb * 0.10" | bc -l)
    local cold_cost=$(echo "$cold_gb * 0.04" | bc -l)
    local glacier_cost=$(echo "$glacier_gb * 0.01" | bc -l)
    local total_cost=$(echo "$hot_cost + $warm_cost + $cold_cost + $glacier_cost" | bc -l)
    
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ‚Ñ‡ĞµÑ‚Ğ°
    cat > /tmp/storage-cost-report.json << EOF
{
  "report_date": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
  "storage_tiers": {
    "hot": {
      "size_gb": $hot_gb,
      "monthly_cost_usd": $hot_cost
    },
    "warm": {
      "size_gb": $warm_gb,
      "monthly_cost_usd": $warm_cost
    },
    "cold": {
      "size_gb": $cold_gb,
      "monthly_cost_usd": $cold_cost
    },
    "glacier": {
      "size_gb": $glacier_gb,
      "monthly_cost_usd": $glacier_cost
    }
  },
  "total_monthly_cost_usd": $total_cost
}
EOF
    
    echo "ğŸ“Š ĞÑ‚Ñ‡ĞµÑ‚ Ğ¾ ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½: /tmp/storage-cost-report.json"
    echo "ğŸ’° ĞĞ±Ñ‰Ğ°Ñ Ğ¼ĞµÑÑÑ‡Ğ½Ğ°Ñ ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ: \$${total_cost}"
}

# ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°
case "$1" in
    warm)
        move_to_warm_tier
        ;;
    cold)
        move_to_cold_tier
        ;;
    glacier)
        move_to_glacier_tier
        ;;
    costs)
        calculate_storage_costs
        ;;
    full)
        move_to_warm_tier
        move_to_cold_tier
        move_to_glacier_tier
        calculate_storage_costs
        ;;
    *)
        echo "Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: $0 {warm|cold|glacier|costs|full}"
        exit 1
        ;;
esac
```

### ğŸ“Š ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹

#### 1. **ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ lifecycle**
```yaml
# backup-lifecycle-monitoring.yaml
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: backup-lifecycle-alerts
  namespace: monitoring
spec:
  groups:
  - name: backup-lifecycle
    rules:
    - alert: BackupStorageUsageHigh
      expr: backup_storage_usage_percent > 85
      for: 15m
      labels:
        severity: warning
        component: backup
      annotations:
        summary: "Backup storage usage high"
        description: "Backup storage usage is {{ $value }}%, exceeding 85% threshold"
    
    - alert: BackupRetentionPolicyViolation
      expr: backup_retention_policy_violations > 0
      for: 5m
      labels:
        severity: critical
        component: backup
      annotations:
        summary: "Backup retention policy violation"
        description: "{{ $value }} backups violate retention policies"
    
    - alert: BackupCostBudgetExceeded
      expr: backup_monthly_cost_usd > backup_budget_usd
      for: 0m
      labels:
        severity: warning
        component: backup
      annotations:
        summary: "Backup cost budget exceeded"
        description: "Monthly backup cost ${{ $value }} exceeds budget"
    
    - alert: BackupTieringFailed
      expr: backup_tiering_failures_total > 0
      for: 5m
      labels:
        severity: warning
        component: backup
      annotations:
        summary: "Backup tiering failed"
        description: "{{ $value }} backup tiering operations failed"
---
# Grafana Dashboard Ğ´Ğ»Ñ lifecycle monitoring
apiVersion: v1
kind: ConfigMap
metadata:
  name: backup-lifecycle-dashboard
  namespace: monitoring
data:
  dashboard.json: |
    {
      "dashboard": {
        "title": "Backup Lifecycle Management",
        "panels": [
          {
            "title": "Storage Usage by Tier",
            "type": "piechart",
            "targets": [
              {
                "expr": "backup_storage_size_bytes by (tier)"
              }
            ]
          },
          {
            "title": "Monthly Costs by Tier",
            "type": "bargraph",
            "targets": [
              {
                "expr": "backup_monthly_cost_usd by (tier)"
              }
            ]
          },
          {
            "title": "Backup Age Distribution",
            "type": "histogram",
            "targets": [
              {
                "expr": "backup_age_days"
              }
            ]
          },
          {
            "title": "Retention Policy Compliance",
            "type": "stat",
            "targets": [
              {
                "expr": "backup_retention_compliance_percent"
              }
            ]
          }
        ]
      }
    }
```

### ğŸ¯ Ğ›ÑƒÑ‡ÑˆĞ¸Ğµ Ğ¿Ñ€Ğ°ĞºÑ‚Ğ¸ĞºĞ¸

#### 1. **Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ lifecycle management**
```yaml
backup_lifecycle_best_practices:
  planning:
    - "ĞĞ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ business requirements Ğ´Ğ»Ñ retention"
    - "Ğ¡Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ storage tiers Ğ¸ costs"
    - "ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ lifecycle"
    - "ĞĞ±ĞµÑĞ¿ĞµÑ‡Ğ¸Ñ‚ÑŒ compliance Ñ regulations"
  
  implementation:
    - "Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ automated retention policies"
    - "ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ storage tiering"
    - "ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ costs Ğ¸ usage"
    - "Ğ ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ğ¾ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ restore Ğ¸Ğ· Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ¾Ğ²"
  
  optimization:
    - "ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ storage costs"
