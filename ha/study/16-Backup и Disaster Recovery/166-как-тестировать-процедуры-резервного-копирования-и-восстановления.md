# 166. ĞšĞ°Ğº Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ†ĞµĞ´ÑƒÑ€Ñ‹ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¸ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ?

## ğŸ¯ Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ
ĞšĞ°Ğº Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ†ĞµĞ´ÑƒÑ€Ñ‹ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¸ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ?

## ğŸ’¡ ĞÑ‚Ğ²ĞµÑ‚

Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ backup Ğ¸ recovery Ğ¿Ñ€Ğ¾Ñ†ĞµĞ´ÑƒÑ€ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ²Ğ°Ğ¶Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ¾Ğ±ĞµÑĞ¿ĞµÑ‡ĞµĞ½Ğ¸Ñ Ğ¸Ñ… Ğ½Ğ°Ğ´ĞµĞ¶Ğ½Ğ¾ÑÑ‚Ğ¸. Ğ’ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚Ğ¸ backup, Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ² Ğ¸Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ¹ ÑÑ€ĞµĞ´Ğµ, Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ‚ĞµÑÑ‚Ğ¾Ğ² Ğ¸ Ñ€ĞµĞ³ÑƒĞ»ÑÑ€Ğ½ÑƒÑ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ RTO/RPO Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº.

### ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

#### 1. **Ğ¡Ñ…ĞµĞ¼Ğ° Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğ¹ ÑÑ€ĞµĞ´Ñ‹**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Backup Testing Architecture                 â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Production  â”‚    â”‚   Backup    â”‚    â”‚    Test     â”‚     â”‚
â”‚  â”‚  Cluster    â”‚â”€â”€â”€â–¶â”‚  Storage    â”‚â”€â”€â”€â–¶â”‚  Cluster    â”‚     â”‚
â”‚  â”‚  (Source)   â”‚    â”‚ (Validation)â”‚    â”‚ (Recovery)  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Automated   â”‚    â”‚ Monitoring  â”‚    â”‚ Reporting   â”‚     â”‚
â”‚  â”‚   Tests     â”‚    â”‚ & Alerting  â”‚    â”‚ & Metrics   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. **Ğ¢Ğ¸Ğ¿Ñ‹ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ**
```yaml
# Ğ¢Ğ¸Ğ¿Ñ‹ backup Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
backup_testing_types:
  integrity_tests:
    - "ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒĞ½Ñ‹Ñ… ÑÑƒĞ¼Ğ¼"
    - "Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹ backup"
    - "Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¶Ğ°Ñ‚Ğ¸Ñ/ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ"
    - "ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"
  
  recovery_tests:
    - "ĞŸĞ¾Ğ»Ğ½Ğ¾Ğµ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ°"
    - "Ğ§Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾Ğµ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ namespace"
    - "Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²"
    - "Point-in-time recovery"
  
  performance_tests:
    - "Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ backup"
    - "Ğ’Ñ€ĞµĞ¼Ñ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ (RTO)"
    - "ĞŸĞ¾Ñ‚ĞµÑ€Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (RPO)"
    - "ĞĞ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ½Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ"
  
  disaster_simulation:
    - "ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ¿Ğ¾Ñ‚ĞµÑ€Ñ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ°"
    - "Ğ§Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¿Ğ¾Ñ‚ĞµÑ€Ñ ÑƒĞ·Ğ»Ğ¾Ğ²"
    - "ĞšĞ¾Ñ€Ñ€ÑƒĞ¿Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"
    - "Ğ¡ĞµÑ‚ĞµĞ²Ñ‹Ğµ ÑĞ±Ğ¾Ğ¸"
```

### ğŸ“Š ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ¸Ğ· Ğ½Ğ°ÑˆĞµĞ³Ğ¾ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ°

#### ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° backup ÑĞ¸ÑÑ‚ĞµĞ¼:
```bash
# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° backup
kubectl get backups -n velero
kubectl get schedules -n velero

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ñ… backup Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹
velero backup get
velero backup describe <backup-name>

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° restore Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹
velero restore get
kubectl get events --field-selector type=Warning | grep -i backup
```

### ğŸ§ª ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

#### 1. **Ğ¡ĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ**
```bash
#!/bin/bash
# backup-testing-suite.sh

echo "ğŸ§ª ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ backup Ğ¸ recovery"

# ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ
TEST_NAMESPACE="backup-test"
TEST_APP="test-application"
BACKUP_NAME="test-backup-$(date +%s)"
RESTORE_NAME="test-restore-$(date +%s)"
TEST_RESULTS_DIR="/tmp/backup-tests"

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğ¹ ÑÑ€ĞµĞ´Ñ‹
setup_test_environment() {
    echo "ğŸ—ï¸ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğ¹ ÑÑ€ĞµĞ´Ñ‹"
    
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ namespace Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¾Ğ²
    kubectl create namespace $TEST_NAMESPACE --dry-run=client -o yaml | kubectl apply -f -
    
    # Ğ Ğ°Ğ·Ğ²ĞµÑ€Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
    cat <<EOF | kubectl apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: $TEST_APP
  namespace: $TEST_NAMESPACE
  labels:
    app: $TEST_APP
spec:
  replicas: 2
  selector:
    matchLabels:
      app: $TEST_APP
  template:
    metadata:
      labels:
        app: $TEST_APP
    spec:
      containers:
      - name: app
        image: nginx:1.21
        ports:
        - containerPort: 80
        volumeMounts:
        - name: data
          mountPath: /usr/share/nginx/html
      volumes:
      - name: data
        persistentVolumeClaim:
          claimName: test-data-pvc
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: test-data-pvc
  namespace: $TEST_NAMESPACE
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: test-config
  namespace: $TEST_NAMESPACE
data:
  test-data: "This is test data for backup validation"
  timestamp: "$(date)"
---
apiVersion: v1
kind: Secret
metadata:
  name: test-secret
  namespace: $TEST_NAMESPACE
type: Opaque
data:
  password: $(echo -n "test-password" | base64)
EOF
    
    # ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸
    kubectl wait --for=condition=available deployment/$TEST_APP -n $TEST_NAMESPACE --timeout=300s
    
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
    kubectl exec -n $TEST_NAMESPACE deployment/$TEST_APP -- \
        sh -c 'echo "Test data created at $(date)" > /usr/share/nginx/html/test.txt'
    
    echo "âœ… Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ğ°Ñ ÑÑ€ĞµĞ´Ğ° Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ°"
}

# Ğ¢ĞµÑÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ backup
test_backup_creation() {
    echo "ğŸ’¾ Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ backup"
    
    local start_time=$(date +%s)
    
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ backup
    velero backup create $BACKUP_NAME \
        --include-namespaces $TEST_NAMESPACE \
        --wait
    
    local end_time=$(date +%s)
    local backup_duration=$((end_time - start_time))
    
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° backup
    local backup_status=$(velero backup describe $BACKUP_NAME --details | grep "Phase:" | awk '{print $2}')
    
    if [ "$backup_status" = "Completed" ]; then
        echo "âœ… Backup ÑĞ¾Ğ·Ğ´Ğ°Ğ½ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ° ${backup_duration} ÑĞµĞºÑƒĞ½Ğ´"
        echo "backup_creation_time:$backup_duration" >> $TEST_RESULTS_DIR/metrics.txt
        return 0
    else
        echo "âŒ Backup Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ğ»ÑÑ Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¾Ğ¹: $backup_status"
        return 1
    fi
}

# Ğ¢ĞµÑÑ‚ Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚Ğ¸ backup
test_backup_integrity() {
    echo "ğŸ” Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚Ğ¸ backup"
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ backup
    local backup_info=$(velero backup describe $BACKUP_NAME --details)
    
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ñ Ğ²ÑĞµÑ… Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²
    local expected_resources=("deployments" "persistentvolumeclaims" "configmaps" "secrets")
    local missing_resources=()
    
    for resource in "${expected_resources[@]}"; do
        if ! echo "$backup_info" | grep -q "$resource"; then
            missing_resources+=("$resource")
        fi
    done
    
    if [ ${#missing_resources[@]} -eq 0 ]; then
        echo "âœ… Ğ’ÑĞµ Ğ¾Ğ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ñ‹Ğµ Ñ€ĞµÑÑƒÑ€ÑÑ‹ Ğ¿Ñ€Ğ¸ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚ Ğ² backup"
        return 0
    else
        echo "âŒ ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ Ñ€ĞµÑÑƒÑ€ÑÑ‹: ${missing_resources[*]}"
        return 1
    fi
}

# Ğ¢ĞµÑÑ‚ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ
test_restore_process() {
    echo "ğŸ”„ Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ"
    
    # Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğ³Ğ¾ namespace
    kubectl delete namespace $TEST_NAMESPACE --wait=true
    
    # ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ
    while kubectl get namespace $TEST_NAMESPACE &>/dev/null; do
        echo "ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ namespace..."
        sleep 5
    done
    
    local start_time=$(date +%s)
    
    # Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· backup
    velero restore create $RESTORE_NAME \
        --from-backup $BACKUP_NAME \
        --wait
    
    local end_time=$(date +%s)
    local restore_duration=$((end_time - start_time))
    
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ
    local restore_status=$(velero restore describe $RESTORE_NAME | grep "Phase:" | awk '{print $2}')
    
    if [ "$restore_status" = "Completed" ]; then
        echo "âœ… Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾ Ğ·Ğ° ${restore_duration} ÑĞµĞºÑƒĞ½Ğ´"
        echo "restore_time:$restore_duration" >> $TEST_RESULTS_DIR/metrics.txt
        return 0
    else
        echo "âŒ Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ğ»Ğ¾ÑÑŒ Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¾Ğ¹: $restore_status"
        return 1
    fi
}

# Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
validate_restored_data() {
    echo "âœ… Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"
    
    # ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¿Ğ¾Ğ´Ğ¾Ğ²
    kubectl wait --for=condition=available deployment/$TEST_APP -n $TEST_NAMESPACE --timeout=300s
    
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¸
    local restored_data=$(kubectl exec -n $TEST_NAMESPACE deployment/$TEST_APP -- cat /usr/share/nginx/html/test.txt 2>/dev/null)
    
    if [[ "$restored_data" == *"Test data created"* ]]; then
        echo "âœ… Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾"
    else
        echo "âŒ Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹ Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾Ğ²Ñ€ĞµĞ¶Ğ´ĞµĞ½Ñ‹"
        return 1
    fi
    
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ConfigMap
    local config_data=$(kubectl get configmap test-config -n $TEST_NAMESPACE -o jsonpath='{.data.test-data}')
    if [[ "$config_data" == *"test data for backup validation"* ]]; then
        echo "âœ… ConfigMap Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾"
    else
        echo "âŒ ConfigMap Ğ½Ğµ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾Ğ²Ñ€ĞµĞ¶Ğ´ĞµĞ½"
        return 1
    fi
    
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Secret
    local secret_data=$(kubectl get secret test-secret -n $TEST_NAMESPACE -o jsonpath='{.data.password}' | base64 -d)
    if [ "$secret_data" = "test-password" ]; then
        echo "âœ… Secret Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾"
    else
        echo "âŒ Secret Ğ½Ğµ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾Ğ²Ñ€ĞµĞ¶Ğ´ĞµĞ½"
        return 1
    fi
    
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° PVC
    local pvc_status=$(kubectl get pvc test-data-pvc -n $TEST_NAMESPACE -o jsonpath='{.status.phase}')
    if [ "$pvc_status" = "Bound" ]; then
        echo "âœ… PVC Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ¸ Ğ¿Ñ€Ğ¸Ğ²ÑĞ·Ğ°Ğ½"
    else
        echo "âŒ PVC Ğ½Ğµ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ¸Ğ»Ğ¸ Ğ½Ğµ Ğ¿Ñ€Ğ¸Ğ²ÑĞ·Ğ°Ğ½: $pvc_status"
        return 1
    fi
    
    return 0
}

# Ğ¢ĞµÑÑ‚ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸
test_performance_metrics() {
    echo "ğŸ“Š Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸"
    
    # Ğ Ğ°Ğ·Ğ¼ĞµÑ€ backup
    local backup_size=$(velero backup describe $BACKUP_NAME --details | grep "Backup Size:" | awk '{print $3}')
    echo "backup_size:$backup_size" >> $TEST_RESULTS_DIR/metrics.txt
    
    # ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²
    local resource_count=$(velero backup describe $BACKUP_NAME --details | grep "Total items to be backed up:" | awk '{print $7}')
    echo "resource_count:$resource_count" >> $TEST_RESULTS_DIR/metrics.txt
    
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° RTO/RPO
    local backup_time=$(grep "backup_creation_time" $TEST_RESULTS_DIR/metrics.txt | cut -d: -f2)
    local restore_time=$(grep "restore_time" $TEST_RESULTS_DIR/metrics.txt | cut -d: -f2)
    local total_rto=$((backup_time + restore_time))
    
    echo "total_rto:$total_rto" >> $TEST_RESULTS_DIR/metrics.txt
    
    echo "ğŸ“ˆ ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸:"
    echo "  Ğ’Ñ€ĞµĞ¼Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ backup: ${backup_time}s"
    echo "  Ğ’Ñ€ĞµĞ¼Ñ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ: ${restore_time}s"
    echo "  ĞĞ±Ñ‰ĞµĞµ RTO: ${total_rto}s"
    echo "  Ğ Ğ°Ğ·Ğ¼ĞµÑ€ backup: $backup_size"
    echo "  ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²: $resource_count"
}

# ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğ¹ ÑÑ€ĞµĞ´Ñ‹
cleanup_test_environment() {
    echo "ğŸ§¹ ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğ¹ ÑÑ€ĞµĞ´Ñ‹"
    
    # Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ namespace
    kubectl delete namespace $TEST_NAMESPACE --ignore-not-found=true
    
    # Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ backup Ğ¸ restore
    velero backup delete $BACKUP_NAME --confirm
    velero restore delete $RESTORE_NAME --confirm
    
    echo "âœ… Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ğ°Ñ ÑÑ€ĞµĞ´Ğ° Ğ¾Ñ‡Ğ¸Ñ‰ĞµĞ½Ğ°"
}

# Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚Ñ‡ĞµÑ‚Ğ°
generate_test_report() {
    echo "ğŸ“‹ Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚Ñ‡ĞµÑ‚Ğ° Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ"
    
    local report_file="$TEST_RESULTS_DIR/backup-test-report-$(date +%Y%m%d-%H%M%S).txt"
    
    cat > $report_file << EOF
=== BACKUP & RECOVERY TEST REPORT ===
Ğ”Ğ°Ñ‚Ğ° Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ: $(date)
ĞšĞ»Ğ°ÑÑ‚ĞµÑ€: $(kubectl config current-context)
Backup: $BACKUP_NAME
Restore: $RESTORE_NAME

=== Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢Ğ« Ğ¢Ğ•Ğ¡Ğ¢ĞĞ’ ===
EOF
    
    if [ -f "$TEST_RESULTS_DIR/metrics.txt" ]; then
        echo "" >> $report_file
        echo "=== ĞœĞ•Ğ¢Ğ Ğ˜ĞšĞ˜ ĞŸĞ ĞĞ˜Ğ—Ğ’ĞĞ”Ğ˜Ğ¢Ğ•Ğ›Ğ¬ĞĞĞ¡Ğ¢Ğ˜ ===" >> $report_file
        cat $TEST_RESULTS_DIR/metrics.txt >> $report_file
    fi
    
    echo "" >> $report_file
    echo "=== Ğ¡Ğ¢ĞĞ¢Ğ£Ğ¡ Ğ¢Ğ•Ğ¡Ğ¢ĞĞ’ ===" >> $report_file
    echo "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ backup: $([ $backup_test_result -eq 0 ] && echo "PASSED" || echo "FAILED")" >> $report_file
    echo "Ğ¦ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ backup: $([ $integrity_test_result -eq 0 ] && echo "PASSED" || echo "FAILED")" >> $report_file
    echo "ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ: $([ $restore_test_result -eq 0 ] && echo "PASSED" || echo "FAILED")" >> $report_file
    echo "Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: $([ $validation_test_result -eq 0 ] && echo "PASSED" || echo "FAILED")" >> $report_file
    
    echo "ğŸ“„ ĞÑ‚Ñ‡ĞµÑ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½: $report_file"
}

# ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
run_full_test_suite() {
    echo "ğŸš€ Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ° Ñ‚ĞµÑÑ‚Ğ¾Ğ² backup Ğ¸ recovery"
    
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ´Ğ»Ñ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²
    mkdir -p $TEST_RESULTS_DIR
    
    # Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ñ‚ĞµÑÑ‚Ğ¾Ğ²
    setup_test_environment
    
    test_backup_creation
    backup_test_result=$?
    
    test_backup_integrity
    integrity_test_result=$?
    
    test_restore_process
    restore_test_result=$?
    
    validate_restored_data
    validation_test_result=$?
    
    test_performance_metrics
    
    generate_test_report
    
    cleanup_test_environment
    
    # ĞĞ±Ñ‰Ğ¸Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
    local total_failures=$((backup_test_result + integrity_test_result + restore_test_result + validation_test_result))
    
    if [ $total_failures -eq 0 ]; then
        echo "âœ… Ğ’ÑĞµ Ñ‚ĞµÑÑ‚Ñ‹ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¸ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾!"
        return 0
    else
        echo "âŒ ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ñ‹ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ² $total_failures Ñ‚ĞµÑÑ‚Ğ°Ñ…"
        return 1
    fi
}

# ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°
case "$1" in
    full)
        run_full_test_suite
        ;;
    setup)
        setup_test_environment
        ;;
    backup)
        test_backup_creation
        ;;
    restore)
        test_restore_process
        ;;
    validate)
        validate_restored_data
        ;;
    cleanup)
        cleanup_test_environment
        ;;
    *)
        echo "Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: $0 {full|setup|backup|restore|validate|cleanup}"
        exit 1
        ;;
esac
```

#### 2. **ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· CronJob**
```yaml
# backup-testing-cronjob.yaml
apiVersion: batch/v1
kind: CronJob
metadata:
  name: backup-testing
  namespace: velero
spec:
  schedule: "0 6 * * 1"                  # ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¿Ğ¾Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¸Ğº Ğ² 6:00
  jobTemplate:
    spec:
      template:
        spec:
          serviceAccountName: velero
          containers:
          - name: backup-tester
            image: hashfoundry/backup-tester:latest
            command:
            - /bin/bash
            - -c
            - |
              # Ğ—Ğ°Ğ¿ÑƒÑĞº Ñ‚ĞµÑÑ‚Ğ¾Ğ² backup
              /scripts/backup-testing-suite.sh full
              
              # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ² Ğ² Slack
              if [ $? -eq 0 ]; then
                curl -X POST -H 'Content-type: application/json' \
                  --data '{"text":"âœ… Weekly backup tests passed successfully"}' \
                  $SLACK_WEBHOOK_URL
              else
                curl -X POST -H 'Content-type: application/json' \
                  --data '{"text":"âŒ Weekly backup tests failed - check logs"}' \
                  $SLACK_WEBHOOK_URL
              fi
            env:
            - name: SLACK_WEBHOOK_URL
              valueFrom:
                secretKeyRef:
                  name: notification-secrets
                  key: slack-webhook
            volumeMounts:
            - name: test-scripts
              mountPath: /scripts
            - name: kubeconfig
              mountPath: /root/.kube
          volumes:
          - name: test-scripts
            configMap:
              name: backup-test-scripts
              defaultMode: 0755
          - name: kubeconfig
            secret:
              secretName: kubeconfig
          restartPolicy: OnFailure
```

### ğŸ¯ Ğ¡Ğ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ‚ĞµÑÑ‚Ñ‹

#### 1. **Ğ¢ĞµÑÑ‚ disaster recovery**
```bash
#!/bin/bash
# dr-testing.sh

echo "ğŸš¨ Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Disaster Recovery"

# Ğ¡Ğ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¹ Ğ¿Ğ¾Ñ‚ĞµÑ€Ğ¸ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ°
simulate_cluster_failure() {
    echo "ğŸ’¥ Ğ¡Ğ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ñ Ğ¾Ñ‚ĞºĞ°Ğ·Ğ° ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ°"
    
    # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°
    local original_context=$(kubectl config current-context)
    
    # ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€
    kubectl config use-context test-cluster
    
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
    kubectl create namespace dr-test
    kubectl run test-pod --image=nginx -n dr-test
    kubectl create configmap test-config --from-literal=data="DR test data" -n dr-test
    
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ backup
    velero backup create dr-test-backup --include-namespaces dr-test --wait
    
    # Ğ¡Ğ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ñ Ğ¿Ğ¾Ñ‚ĞµÑ€Ğ¸ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ° (ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ namespace)
    kubectl delete namespace dr-test --wait=true
    
    echo "âœ… Ğ¡Ğ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ñ Ğ¾Ñ‚ĞºĞ°Ğ·Ğ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°"
}

# Ğ¢ĞµÑÑ‚ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾ÑĞ»Ğµ ĞºĞ°Ñ‚Ğ°ÑÑ‚Ñ€Ğ¾Ñ„Ñ‹
test_disaster_recovery() {
    echo "ğŸ”„ Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾ÑĞ»Ğµ ĞºĞ°Ñ‚Ğ°ÑÑ‚Ñ€Ğ¾Ñ„Ñ‹"
    
    local start_time=$(date +%s)
    
    # Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· backup
    velero restore create dr-test-restore --from-backup dr-test-backup --wait
    
    local end_time=$(date +%s)
    local recovery_time=$((end_time - start_time))
    
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ
    kubectl wait --for=condition=ready pod/test-pod -n dr-test --timeout=300s
    
    local config_data=$(kubectl get configmap test-config -n dr-test -o jsonpath='{.data.data}')
    
    if [ "$config_data" = "DR test data" ]; then
        echo "âœ… DR Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ° ${recovery_time}s"
        echo "dr_recovery_time:$recovery_time" >> /tmp/dr-metrics.txt
        return 0
    else
        echo "âŒ DR Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½ĞµÑƒÑĞ¿ĞµÑˆĞ½Ğ¾"
        return 1
    fi
}

# Ğ¢ĞµÑÑ‚ cross-region Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ
test_cross_region_recovery() {
    echo "ğŸŒ Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ cross-region Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ"
    
    # ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ½Ğ° DR ĞºĞ»Ğ°ÑÑ‚ĞµÑ€ Ğ² Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¼ Ñ€ĞµĞ³Ğ¸Ğ¾Ğ½Ğµ
    kubectl config use-context dr-cluster-ams3
    
    # Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ backup Ğ¸Ğ· Ğ´Ñ€ÑƒĞ³Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ³Ğ¸Ğ¾Ğ½Ğ°
    velero restore create cross-region-restore --from-backup dr-test-backup --wait
    
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
    kubectl wait --for=condition=ready pod/test-pod -n dr-test --timeout=300s
    
    if [ $? -eq 0 ]; then
        echo "âœ… Cross-region Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾"
        return 0
    else
        echo "âŒ Cross-region Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½ĞµÑƒÑĞ¿ĞµÑˆĞ½Ğ¾"
        return 1
    fi
}

# ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° DR Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
case "$1" in
    simulate)
        simulate_cluster_failure
        ;;
    recover)
        test_disaster_recovery
        ;;
    cross-region)
        test_cross_region_recovery
        ;;
    full)
        simulate_cluster_failure
        test_disaster_recovery
        test_cross_region_recovery
        ;;
    *)
        echo "Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: $0 {simulate|recover|cross-region|full}"
        exit 1
        ;;
esac
```

#### 2. **Ğ¢ĞµÑÑ‚ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ backup**
```bash
#!/bin/bash
# backup-performance-test.sh

echo "ğŸ“Š Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ backup"

# Ğ¢ĞµÑÑ‚ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚Ğ¸
test_backup_scalability() {
    echo "ğŸ“ˆ Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚Ğ¸ backup"
    
    local namespace_counts=(1 5 10 20)
    
    for count in "${namespace_counts[@]}"; do
        echo "Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ $count namespace..."
        
        # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ñ… namespace
        for i in $(seq 1 $count); do
            kubectl create namespace scale-test-$i
            kubectl run test-app-$i --image=nginx -n scale-test-$i
            kubectl create configmap test-config-$i --from-literal=data="test" -n scale-test-$i
        done
        
        # Ğ˜Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ğµ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ backup
        local start_time=$(date +%s)
        velero backup create scale-test-$count --include-namespaces="scale-test-*" --wait
        local end_time=$(date +%s)
        local backup_time=$((end_time - start_time))
        
        echo "scale_test_${count}_namespaces:$backup_time" >> /tmp/scalability-metrics.txt
        
        # ĞÑ‡Ğ¸ÑÑ‚ĞºĞ°
        for i in $(seq 1 $count); do
            kubectl delete namespace scale-test-$i --wait=false
        done
        velero backup delete scale-test-$count --confirm
    done
    
    echo "âœ… Ğ¢ĞµÑÑ‚ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚Ğ¸ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½"
}

# Ğ¢ĞµÑÑ‚ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ½Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ
test_backup_load_impact() {
    echo "âš¡ Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²Ğ»Ğ¸ÑĞ½Ğ¸Ñ backup Ğ½Ğ° Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºÑƒ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹"
    
    # Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ½Ğ°Ğ³Ñ€ÑƒĞ·Ğ¾Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ñ‚ĞµÑÑ‚Ğ°
    kubectl run load-generator --image=busybox --restart=Never -- \
        sh -c 'while true; do echo "load test" > /dev/null; done'
    
    # ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ² Ğ´Ğ¾ backup
    local cpu_before=$(kubectl top nodes | awk 'NR>1 {sum+=$3} END {print sum}')
    local memory_before=$(kubectl top nodes | awk 'NR>1 {sum+=$5} END {print sum}')
    
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ backup Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸
    local start_time=$(date +%s)
    velero backup create load-test-backup --include-namespaces default --wait
    local end_time=$(date +%s)
    local backup_time=$((end_time - start_time))
    
    # ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ² Ğ¿Ğ¾ÑĞ»Ğµ backup
    local cpu_after=$(kubectl top nodes | awk 'NR>1 {sum+=$3} END {print sum}')
    local memory_after=$(kubectl top nodes | awk 'NR>1 {sum+=$5} END {print sum}')
    
    echo "load_test_backup_time:$backup_time" >> /tmp/load-metrics.txt
    echo "cpu_impact:$((cpu_after - cpu_before))" >> /tmp/load-metrics.txt
    echo "memory_impact:$((memory_after - memory_before))" >> /tmp/load-metrics.txt
    
    # ĞÑ‡Ğ¸ÑÑ‚ĞºĞ°
    kubectl delete pod load-generator
    velero backup delete load-test-backup --confirm
    
    echo "âœ… Ğ¢ĞµÑÑ‚ Ğ²Ğ»Ğ¸ÑĞ½Ğ¸Ñ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½"
}

# ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°
case "$1" in
    scalability)
        test_backup_scalability
        ;;
    load)
        test_backup_load_impact
        ;;
    all)
        test_backup_scalability
        test_backup_load_impact
        ;;
    *)
        echo "Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: $0 {scalability|load|all}"
        exit 1
        ;;
esac
```

### ğŸ“‹ ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹

#### 1. **ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ backup Ñ‚ĞµÑÑ‚Ğ¾Ğ²**
```yaml
# backup-test-monitoring.yaml
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: backup-test-alerts
  namespace: monitoring
spec:
  groups:
  - name: backup-testing
    rules:
    - alert: BackupTestFailed
      expr: backup_test_success == 0
      for: 5m
      labels:
        severity: critical
        component: backup
      annotations:
        summary: "Backup test failed"
        description: "Automated backup test has failed"
        runbook_url: "https://docs.hashfoundry.com/runbooks/backup-test-failure"
    
    - alert: BackupTestRTOExceeded
      expr: backup_test_rto_seconds > 3600
      for: 0m
      labels:
        severity: warning
        component: backup
      annotations:
        summary: "Backup RTO exceeded"
        description: "Backup test RTO is {{ $value }} seconds, exceeding 1 hour threshold"
    
    - alert: BackupTestNotRun
      expr: time() - backup_test_last_run_timestamp > 604800
      for: 0m
      labels:
        severity: warning
        component: backup
      annotations:
        summary: "Backup test not run recently"
        description: "Last backup test was run {{ $value }} seconds ago"
---
# ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ backup Ñ‚ĞµÑÑ‚Ğ¾Ğ²
apiVersion: v1
kind: ConfigMap
metadata:
  name: backup-test-metrics
  namespace: monitoring
data:
  metrics.py: |
    #!/usr/bin/env python3
    import time
    import subprocess
    from prometheus_client import start_http_server, Gauge, Counter
    
    # ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸
    backup_test_success = Gauge('backup_test_success', 'Backup test success status')
    backup_test_duration = Gauge('backup_test_duration_seconds', 'Backup test duration')
    backup_test_rto = Gauge('backup_test_rto_seconds', 'Backup test RTO')
    backup_test_last_run = Gauge('backup_test_last_run_timestamp', 'Last backup test timestamp')
    
    def run_backup_test():
        try:
            start_time = time.time()
            result = subprocess.run(['/scripts/backup-testing-suite.sh', 'full'], 
                                  capture_output=True, text=True)
            end_time = time.time()
            
            duration = end_time - start_time
            backup_test_duration.set(duration)
            backup_test_last_run.set(time.time())
            
            if result.returncode == 0:
                backup_test_success.set(1)
                # Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ RTO Ğ¸Ğ· Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²
                rto = extract_rto_from_output(result.stdout)
                backup_test_rto.set(rto)
            else:
                backup_test_success.set(0)
                
        except Exception as e:
            print(f"Error running backup test: {e}")
            backup_test_success.set(0)
    
    def extract_rto_from_output(output):
        # Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ RTO Ğ¸Ğ· Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ° Ñ‚ĞµÑÑ‚Ğ¾Ğ²
        for line in output.split('\n'):
            if 'total_rto:' in line:
                return int(line.split(':')[1])
        return 0
    
    if __name__ == '__main__':
        start_http_server(8000)
        while True:
            run_backup_test()
            time.sleep(86400)  # Ğ—Ğ°Ğ¿ÑƒÑĞº Ñ€Ğ°Ğ· Ğ² Ğ´ĞµĞ½ÑŒ
```

### ğŸ¯ Ğ›ÑƒÑ‡ÑˆĞ¸Ğµ Ğ¿Ñ€Ğ°ĞºÑ‚Ğ¸ĞºĞ¸ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

#### 1. **Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ**
```yaml
backup_testing_strategy:
  frequency:
    daily:
      - "ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° backup"
      - "Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ñ… backup"
      - "ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸"
