# 166. –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä—ã —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è?

## üéØ **–ß—Ç–æ —Ç–∞–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ backup –∏ recovery –ø—Ä–æ—Ü–µ–¥—É—Ä?**

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ backup –∏ recovery –ø—Ä–æ—Ü–µ–¥—É—Ä** ‚Äî —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏, —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö. –í–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é backup, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥–µ, –∏–∑–º–µ—Ä–µ–Ω–∏–µ RTO/RPO –º–µ—Ç—Ä–∏–∫ –∏ —Ä–µ–≥—É–ª—è—Ä–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É disaster recovery —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ —Ä–µ–∞–ª—å–Ω—ã–º –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞–º.

## üèóÔ∏è **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è backup:**

### **1. –¢–∏–ø—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**
- **Integrity Tests**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∏ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ backup
- **Recovery Tests**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- **Performance Tests**: –ò–∑–º–µ—Ä–µ–Ω–∏–µ RTO/RPO –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **Disaster Simulation**: –°–∏–º—É–ª—è—Ü–∏—è –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### **2. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**
- **Scheduled Tests**: –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
- **Continuous Validation**: –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è backup
- **Monitoring Integration**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **Alerting**: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö —Ç–µ—Å—Ç–æ–≤

### **3. –ú–µ—Ç—Ä–∏–∫–∏ –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å**
- **RTO Measurement**: –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- **RPO Validation**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö
- **Success Rate**: –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- **Performance Trends**: –¢—Ä–µ–Ω–¥—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üìä **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –≤–∞—à–µ–≥–æ HA –∫–ª–∞—Å—Ç–µ—Ä–∞:**

### **1. –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è backup —Å–∏—Å—Ç–µ–º—ã:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Velero –∏ backup
kubectl get pods -n velero
kubectl get backups -n velero --sort-by=.metadata.creationTimestamp
kubectl get schedules -n velero

# –ê–Ω–∞–ª–∏–∑ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö backup –æ–ø–µ—Ä–∞—Ü–∏–π
velero backup get -o custom-columns=NAME:.metadata.name,STATUS:.status.phase,CREATED:.metadata.creationTimestamp,SIZE:.status.totalItems

# –ü—Ä–æ–≤–µ—Ä–∫–∞ restore –æ–ø–µ—Ä–∞—Ü–∏–π
velero restore get -o custom-columns=NAME:.metadata.name,STATUS:.status.phase,BACKUP:.spec.backupName,CREATED:.metadata.creationTimestamp

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ backup
kubectl get events --field-selector type=Warning | grep -E "(backup|restore|velero)"
```

### **2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ backup:**
```bash
# –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ backup
velero backup describe $(velero backup get -o name | tail -1) --details

# –ü—Ä–æ–≤–µ—Ä–∫–∞ backup location
velero backup-location get
velero snapshot-location get

# –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–º–µ—Ä–∞ –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ backup
kubectl get backups -n velero -o custom-columns=NAME:.metadata.name,PHASE:.status.phase,TOTAL-ITEMS:.status.totalItems,SIZE:.status.totalItems
```

### **3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:**
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ backup
velero backup create test-backup-$(date +%s) --include-namespaces default --wait

# –¢–µ—Å—Ç–æ–≤–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –Ω–æ–≤—ã–π namespace
velero restore create test-restore-$(date +%s) --from-backup test-backup-latest --namespace-mappings default:test-restore --wait
```

## üîÑ **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

### **1. –°–æ–∑–¥–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç comprehensive-backup-testing.sh
cat << 'EOF' > comprehensive-backup-testing.sh
#!/bin/bash

echo "üß™ –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Backup –∏ Recovery"
echo "============================================"

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
TEST_NAMESPACE="backup-test-$(date +%s)"
TEST_APP="test-application"
BACKUP_NAME="automated-test-backup-$(date +%s)"
RESTORE_NAME="automated-test-restore-$(date +%s)"
TEST_RESULTS_DIR="/tmp/backup-test-results"
SLACK_WEBHOOK="$SLACK_WEBHOOK_URL"

# –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1"
}

# –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
send_notification() {
    local severity="$1"
    local message="$2"
    
    log "$severity $message"
    
    # –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Slack
    if [ -n "$SLACK_WEBHOOK" ]; then
        local color="good"
        case $severity in
            "üö®") color="danger" ;;
            "‚ö†Ô∏è") color="warning" ;;
            "‚úÖ") color="good" ;;
        esac
        
        curl -X POST -H 'Content-type: application/json' \
            --data "{\"attachments\":[{\"color\":\"$color\",\"text\":\"$severity Backup Test: $message\",\"ts\":$(date +%s)}]}" \
            "$SLACK_WEBHOOK" >/dev/null 2>&1
    fi
}

# –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã
setup_test_environment() {
    log "üèóÔ∏è –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã"
    
    # –°–æ–∑–¥–∞–Ω–∏–µ namespace
    kubectl create namespace $TEST_NAMESPACE --dry-run=client -o yaml | kubectl apply -f -
    
    # –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    kubectl apply -f - << TEST_APP_EOF
apiVersion: apps/v1
kind: Deployment
metadata:
  name: $TEST_APP
  namespace: $TEST_NAMESPACE
  labels:
    app: $TEST_APP
    test-type: backup-validation
spec:
  replicas: 2
  selector:
    matchLabels:
      app: $TEST_APP
  template:
    metadata:
      labels:
        app: $TEST_APP
    spec:
      containers:
      - name: web
        image: nginx:alpine
        ports:
        - containerPort: 80
        volumeMounts:
        - name: data-volume
          mountPath: /usr/share/nginx/html
        - name: config-volume
          mountPath: /etc/nginx/conf.d
        resources:
          requests:
            cpu: 50m
            memory: 64Mi
          limits:
            cpu: 200m
            memory: 256Mi
      - name: sidecar
        image: busybox:latest
        command: ["/bin/sh"]
        args: ["-c", "while true; do echo 'Sidecar running at $(date)' >> /shared/sidecar.log; sleep 30; done"]
        volumeMounts:
        - name: shared-volume
          mountPath: /shared
        resources:
          requests:
            cpu: 10m
            memory: 16Mi
      volumes:
      - name: data-volume
        persistentVolumeClaim:
          claimName: test-data-pvc
      - name: config-volume
        configMap:
          name: nginx-config
      - name: shared-volume
        emptyDir: {}
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: test-data-pvc
  namespace: $TEST_NAMESPACE
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
  storageClassName: do-block-storage
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-config
  namespace: $TEST_NAMESPACE
data:
  default.conf: |
    server {
        listen 80;
        server_name localhost;
        location / {
            root /usr/share/nginx/html;
            index index.html;
        }
        location /health {
            access_log off;
            return 200 "healthy\n";
            add_header Content-Type text/plain;
        }
    }
  test-data.json: |
    {
      "test_id": "backup-validation-$(date +%s)",
      "created_at": "$(date)",
      "environment": "test",
      "data": {
        "users": [
          {"id": 1, "name": "Alice", "role": "admin"},
          {"id": 2, "name": "Bob", "role": "user"},
          {"id": 3, "name": "Charlie", "role": "viewer"}
        ],
        "settings": {
          "theme": "dark",
          "language": "en",
          "notifications": true
        }
      }
    }
---
apiVersion: v1
kind: Secret
metadata:
  name: test-secrets
  namespace: $TEST_NAMESPACE
type: Opaque
data:
  database-password: $(echo -n "super-secret-password" | base64)
  api-key: $(echo -n "test-api-key-12345" | base64)
  certificate: $(echo -n "-----BEGIN CERTIFICATE-----\ntest-certificate-data\n-----END CERTIFICATE-----" | base64)
---
apiVersion: v1
kind: Service
metadata:
  name: $TEST_APP-service
  namespace: $TEST_NAMESPACE
spec:
  selector:
    app: $TEST_APP
  ports:
  - port: 80
    targetPort: 80
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: $TEST_APP-ingress
  namespace: $TEST_NAMESPACE
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
  - host: test-backup.hashfoundry.local
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: $TEST_APP-service
            port:
              number: 80
TEST_APP_EOF
    
    # –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
    kubectl wait --for=condition=available deployment/$TEST_APP -n $TEST_NAMESPACE --timeout=300s
    
    # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    kubectl exec -n $TEST_NAMESPACE deployment/$TEST_APP -c web -- \
        sh -c 'echo "<h1>Backup Test Data</h1><p>Created at: $(date)</p><p>Test ID: backup-validation-$(date +%s)</p>" > /usr/share/nginx/html/index.html'
    
    kubectl exec -n $TEST_NAMESPACE deployment/$TEST_APP -c web -- \
        sh -c 'echo "Test file for backup validation - $(date)" > /usr/share/nginx/html/test-file.txt'
    
    log "‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞ —Å–æ–∑–¥–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞"
}

# –§—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∏—è backup
test_backup_creation() {
    log "üíæ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è backup"
    
    local start_time=$(date +%s)
    
    # –°–æ–∑–¥–∞–Ω–∏–µ backup —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
    velero backup create $BACKUP_NAME \
        --include-namespaces $TEST_NAMESPACE \
        --include-resources deployments,services,configmaps,secrets,persistentvolumeclaims,ingresses \
        --snapshot-volumes \
        --default-volumes-to-restic \
        --wait
    
    local end_time=$(date +%s)
    local backup_duration=$((end_time - start_time))
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ backup
    local backup_status=$(velero backup describe $BACKUP_NAME --details | grep "Phase:" | awk '{print $2}')
    local backup_errors=$(velero backup describe $BACKUP_NAME --details | grep "Errors:" | awk '{print $2}')
    local backup_warnings=$(velero backup describe $BACKUP_NAME --details | grep "Warnings:" | awk '{print $2}')
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
    mkdir -p $TEST_RESULTS_DIR
    echo "backup_creation_time:$backup_duration" >> $TEST_RESULTS_DIR/metrics.txt
    echo "backup_status:$backup_status" >> $TEST_RESULTS_DIR/metrics.txt
    echo "backup_errors:$backup_errors" >> $TEST_RESULTS_DIR/metrics.txt
    echo "backup_warnings:$backup_warnings" >> $TEST_RESULTS_DIR/metrics.txt
    
    if [ "$backup_status" = "Completed" ] && [ "$backup_errors" = "0" ]; then
        log "‚úÖ Backup —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ –∑–∞ ${backup_duration} —Å–µ–∫—É–Ω–¥"
        send_notification "‚úÖ" "Backup creation successful in ${backup_duration}s"
        return 0
    else
        log "‚ùå Backup –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–∞–º–∏: Status=$backup_status, Errors=$backup_errors"
        send_notification "üö®" "Backup creation failed: Status=$backup_status, Errors=$backup_errors"
        return 1
    fi
}

# –§—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ backup
test_backup_integrity() {
    log "üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ backup"
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ backup
    local backup_details=$(velero backup describe $BACKUP_NAME --details)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≤—Å–µ—Ö –æ–∂–∏–¥–∞–µ–º—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
    local expected_resources=("deployments" "services" "configmaps" "secrets" "persistentvolumeclaims" "ingresses")
    local missing_resources=()
    local found_resources=()
    
    for resource in "${expected_resources[@]}"; do
        if echo "$backup_details" | grep -q "$resource"; then
            found_resources+=("$resource")
        else
            missing_resources+=("$resource")
        fi
    done
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ volume snapshots
    local volume_snapshots=$(echo "$backup_details" | grep -c "VolumeSnapshot" || echo "0")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ backup
    local backup_size=$(velero backup describe $BACKUP_NAME --details | grep "Backup Size:" | awk '{print $3}' || echo "unknown")
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    echo "found_resources:${#found_resources[@]}" >> $TEST_RESULTS_DIR/metrics.txt
    echo "missing_resources:${#missing_resources[@]}" >> $TEST_RESULTS_DIR/metrics.txt
    echo "volume_snapshots:$volume_snapshots" >> $TEST_RESULTS_DIR/metrics.txt
    echo "backup_size:$backup_size" >> $TEST_RESULTS_DIR/metrics.txt
    
    if [ ${#missing_resources[@]} -eq 0 ] && [ "$volume_snapshots" -gt 0 ]; then
        log "‚úÖ –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å backup –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞: –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç"
        log "üìä –ù–∞–π–¥–µ–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤: ${found_resources[*]}"
        log "üíæ Volume snapshots: $volume_snapshots"
        log "üìè –†–∞–∑–º–µ—Ä backup: $backup_size"
        return 0
    else
        log "‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å—é backup:"
        [ ${#missing_resources[@]} -gt 0 ] && log "  –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ä–µ—Å—É—Ä—Å—ã: ${missing_resources[*]}"
        [ "$volume_snapshots" -eq 0 ] && log "  –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç volume snapshots"
        return 1
    fi
}

# –§—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
test_restore_process() {
    log "üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è"
    
    # –£–¥–∞–ª–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ namespace
    kubectl delete namespace $TEST_NAMESPACE --wait=true
    
    # –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
    local timeout=60
    while kubectl get namespace $TEST_NAMESPACE &>/dev/null && [ $timeout -gt 0 ]; do
        log "–û–∂–∏–¥–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è namespace... ($timeout —Å–µ–∫)"
        sleep 5
        timeout=$((timeout - 5))
    done
    
    if kubectl get namespace $TEST_NAMESPACE &>/dev/null; then
        log "‚ùå Namespace –Ω–µ –±—ã–ª —É–¥–∞–ª–µ–Ω –≤ –æ–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è"
        return 1
    fi
    
    local start_time=$(date +%s)
    
    # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup
    velero restore create $RESTORE_NAME \
        --from-backup $BACKUP_NAME \
        --wait
    
    local end_time=$(date +%s)
    local restore_duration=$((end_time - start_time))
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
    local restore_status=$(velero restore describe $RESTORE_NAME | grep "Phase:" | awk '{print $2}')
    local restore_errors=$(velero restore describe $RESTORE_NAME | grep "Errors:" | awk '{print $2}')
    local restore_warnings=$(velero restore describe $RESTORE_NAME | grep "Warnings:" | awk '{print $2}')
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
    echo "restore_time:$restore_duration" >> $TEST_RESULTS_DIR/metrics.txt
    echo "restore_status:$restore_status" >> $TEST_RESULTS_DIR/metrics.txt
    echo "restore_errors:$restore_errors" >> $TEST_RESULTS_DIR/metrics.txt
    echo "restore_warnings:$restore_warnings" >> $TEST_RESULTS_DIR/metrics.txt
    
    if [ "$restore_status" = "Completed" ] && [ "$restore_errors" = "0" ]; then
        log "‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ –∑–∞ ${restore_duration} —Å–µ–∫—É–Ω–¥"
        return 0
    else
        log "‚ùå –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–∏–ª–æ—Å—å —Å –æ—à–∏–±–∫–∞–º–∏: Status=$restore_status, Errors=$restore_errors"
        return 1
    fi
}

# –§—É–Ω–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
validate_restored_data() {
    log "‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö"
    
    # –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø–æ–¥–æ–≤
    kubectl wait --for=condition=available deployment/$TEST_APP -n $TEST_NAMESPACE --timeout=300s
    
    local validation_errors=0
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    if kubectl get deployment $TEST_APP -n $TEST_NAMESPACE >/dev/null 2>&1; then
        local ready_replicas=$(kubectl get deployment $TEST_APP -n $TEST_NAMESPACE -o jsonpath='{.status.readyReplicas}')
        if [ "$ready_replicas" = "2" ]; then
            log "‚úÖ Deployment –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (2/2 replicas ready)"
        else
            log "‚ùå Deployment –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ ($ready_replicas/2 replicas ready)"
            validation_errors=$((validation_errors + 1))
        fi
    else
        log "‚ùå Deployment –Ω–µ –Ω–∞–π–¥–µ–Ω"
        validation_errors=$((validation_errors + 1))
    fi
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
    local app_data=$(kubectl exec -n $TEST_NAMESPACE deployment/$TEST_APP -c web -- cat /usr/share/nginx/html/index.html 2>/dev/null)
    if [[ "$app_data" == *"Backup Test Data"* ]]; then
        log "‚úÖ –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ"
    else
        log "‚ùå –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω—ã"
        validation_errors=$((validation_errors + 1))
    fi
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞
    local test_file=$(kubectl exec -n $TEST_NAMESPACE deployment/$TEST_APP -c web -- cat /usr/share/nginx/html/test-file.txt 2>/dev/null)
    if [[ "$test_file" == *"Test file for backup validation"* ]]; then
        log "‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ"
    else
        log "‚ùå –¢–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω"
        validation_errors=$((validation_errors + 1))
    fi
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ ConfigMap
    local config_data=$(kubectl get configmap nginx-config -n $TEST_NAMESPACE -o jsonpath='{.data.test-data\.json}' 2>/dev/null)
    if [[ "$config_data" == *"backup-validation"* ]]; then
        log "‚úÖ ConfigMap –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ"
    else
        log "‚ùå ConfigMap –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω"
        validation_errors=$((validation_errors + 1))
    fi
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ Secret
    local secret_password=$(kubectl get secret test-secrets -n $TEST_NAMESPACE -o jsonpath='{.data.database-password}' 2>/dev/null | base64 -d)
    if [ "$secret_password" = "super-secret-password" ]; then
        log "‚úÖ Secret –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ"
    else
        log "‚ùå Secret –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω"
        validation_errors=$((validation_errors + 1))
    fi
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ PVC
    local pvc_status=$(kubectl get pvc test-data-pvc -n $TEST_NAMESPACE -o jsonpath='{.status.phase}' 2>/dev/null)
    if [ "$pvc_status" = "Bound" ]; then
        log "‚úÖ PVC –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –ø—Ä–∏–≤—è–∑–∞–Ω"
    else
        log "‚ùå PVC –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–ª–∏ –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω: $pvc_status"
        validation_errors=$((validation_errors + 1))
    fi
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ Service
    local service_endpoints=$(kubectl get endpoints $TEST_APP-service -n $TEST_NAMESPACE -o jsonpath='{.subsets[0].addresses}' 2>/dev/null)
    if [ -n "$service_endpoints" ]; then
        log "‚úÖ Service –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ endpoints"
    else
        log "‚ùå Service –Ω–µ –∏–º–µ–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö endpoints"
        validation_errors=$((validation_errors + 1))
    fi
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ Ingress
    if kubectl get ingress $TEST_APP-ingress -n $TEST_NAMESPACE >/dev/null 2>&1; then
        log "‚úÖ Ingress –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ"
    else
        log "‚ùå Ingress –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        validation_errors=$((validation_errors + 1))
    fi
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
    echo "validation_errors:$validation_errors" >> $TEST_RESULTS_DIR/metrics.txt
    
    if [ $validation_errors -eq 0 ]; then
        log "‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ"
        send_notification "‚úÖ" "Data validation successful - all components restored correctly"
        return 0
    else
        log "‚ùå –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ $validation_errors –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏"
        send_notification "üö®" "Data validation failed - $validation_errors errors found"
        return 1
    fi
}

# –§—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
test_performance_metrics() {
    log "üìä –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ backup –∏ restore"
    
    # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –∏–∑ —Ñ–∞–π–ª–∞
    local backup_time=$(grep "backup_creation_time" $TEST_RESULTS_DIR/metrics.txt | cut -d: -f2)
    local restore_time=$(grep "restore_time" $TEST_RESULTS_DIR/metrics.txt | cut -d: -f2)
    local backup_size=$(grep "backup_size" $TEST_RESULTS_DIR/metrics.txt | cut -d: -f2)
    local volume_snapshots=$(grep "volume_snapshots" $TEST_RESULTS_DIR/metrics.txt | cut -d: -f2)
    local validation_errors=$(grep "validation_errors" $TEST_RESULTS_DIR/metrics.txt | cut -d: -f2)
    
    # –†–∞—Å—á–µ—Ç –æ–±—â–µ–≥–æ RTO
    local total_rto=$((backup_time + restore_time))
    
    # –û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    local performance_grade="A"
    if [ $total_rto -gt 1800 ]; then
        performance_grade="C"
    elif [ $total_rto -gt 900 ]; then
        performance_grade="B"
    fi
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
    echo "total_rto:$total_rto" >> $TEST_RESULTS_DIR/metrics.txt
    echo "performance_grade:$performance_grade" >> $TEST_RESULTS_DIR/metrics.txt
    
    log "üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:"
    log "  ‚è±Ô∏è –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è backup: ${backup_time}s"
    log "  üîÑ –í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: ${restore_time}s"
    log "  üéØ –û–±—â–µ–µ RTO: ${total_rto}s"
    log "  üìè –†–∞–∑–º–µ—Ä backup: $backup_size"
    log "  üíæ Volume snapshots: $volume_snapshots"
    log "  ‚ùå –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏: $validation_errors"
    log "  üèÜ –û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: $performance_grade"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è SLA
    if [ $total_rto -le 1800 ] && [ $validation_errors -eq 0 ]; then
        log "‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç SLA (RTO ‚â§ 30 –º–∏–Ω—É—Ç)"
        return 0
    else
        log "‚ö†Ô∏è –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç SLA"
        return 1
    fi
}

# –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã
cleanup_test_environment() {
    log "üßπ –û—á–∏—Å—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã"
    
    # –£–¥–∞–ª–µ–Ω–∏–µ namespace
    kubectl delete namespace $TEST_NAMESPACE --ignore-not-found=true --wait=false
    
    # –£–¥–∞–ª–µ–Ω–∏–µ backup –∏ restore (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞)
    if [ "$CLEANUP_BACKUPS" = "true" ]; then
        velero backup delete $BACKUP_NAME --confirm >/dev/null 2>&1
        velero restore delete $RESTORE_NAME --confirm >/dev/null 2>&1
        log "üóëÔ∏è Backup –∏ restore —É–¥–∞–ª–µ–Ω—ã"
    else
        log "üíæ Backup –∏ restore —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"
    fi
    
    log "‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
}

# –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞
generate_comprehensive_report() {
    log "üìã –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞"
    
    local report_file="$TEST_RESULTS_DIR/backup-test-report-$(date +%Y%m%d-%H%M%S).json"
    local summary_file="$TEST_RESULTS_DIR/backup-test-summary-$(date +%Y%m%d-%H%M%S).txt"
    
    # JSON –æ—Ç—á–µ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
    cat > $report_file << JSON_EOF
{
  "test_execution": {
    "timestamp": "$(date -Iseconds)",
    "cluster": "$(kubectl config current-context)",
    "test_namespace": "$TEST_NAMESPACE",
    "backup_name": "$BACKUP_NAME",
    "restore_name": "$RESTORE_NAME"
  },
  "metrics": {
$(grep -E ":" $TEST_RESULTS_DIR/metrics.txt | sed 's/\(.*\):\(.*\)/    "\1": "\2",/' | sed '$ s/,$//')
  },
  "test_results": {
    "backup_creation": $([ $backup_test_result -eq 0 ] && echo "true" || echo "false"),
    "backup_integrity": $([ $integrity_test_result -eq 0 ] && echo "true" || echo "false"),
    "restore_process": $([ $restore_test_result -eq 0 ] && echo "true" || echo "false"),
    "data_validation": $([ $validation_test_result -eq 0 ] && echo "true" || echo "false"),
    "performance_check": $([ $performance_test_result -eq 0 ] && echo "true" || echo "false")
  },
  "overall_status": "$([ $((backup_test_result + integrity_test_result + restore_test_result + validation_test_result + performance_test_result)) -eq 0 ] && echo "PASSED" || echo "FAILED")"
}
JSON_EOF
    
    # –¢–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç—á–µ—Ç –¥–ª—è —á—Ç–µ–Ω–∏—è
    cat > $summary_file << SUMMARY_EOF
=== COMPREHENSIVE BACKUP & RECOVERY TEST REPORT ===
–î–∞—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: $(date)
–ö–ª–∞—Å—Ç–µ—Ä: $(kubectl config current-context)
–¢–µ—Å—Ç–æ–≤—ã–π namespace: $TEST_NAMESPACE
Backup: $BACKUP_NAME
Restore: $RESTORE_NAME

=== –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–û–í ===
‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ backup: $([ $backup_test_result -eq 0 ] && echo "PASSED" || echo "FAILED")
‚úÖ –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å backup: $([ $integrity_test_result -eq 0 ] && echo "PASSED" || echo "FAILED")
‚úÖ –ü—Ä–æ—Ü–µ—Å—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: $([ $restore_test_result -eq 0 ] && echo "PASSED" || echo "FAILED")
‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö: $([ $validation_test_result -eq 0 ] && echo "PASSED" || echo "FAILED")
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: $([ $performance_test_result -eq 0 ] && echo "PASSED" || echo "FAILED")

=== –ú–ï–¢–†–ò–ö–ò –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò ===
$(cat $TEST_RESULTS_DIR/metrics.txt | sed 's/:/: /')

=== –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò ===
$([ $((backup_test_result + integrity_test_result + restore_test_result + validation_test_result + performance_test_result)) -eq 0 ] && echo "–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ. –°–∏—Å—Ç–µ–º–∞ backup –≥–æ—Ç–æ–≤–∞ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é." || echo "–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã. –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–Ω–∞–ª–∏–∑ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –ø–µ—Ä–µ–¥ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º.")

=== –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò ===
1. –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–æ–¥–∏—Ç–µ –ø–æ–¥–æ–±–Ω—ã–µ —Ç–µ—Å—Ç—ã
2. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ —Ç—Ä–µ–Ω–¥—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
3. –û–±–Ω–æ–≤–ª—è–π—Ç–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
4. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
SUMMARY_EOF
    
    log "üìÑ –û—Ç—á–µ—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:"
    log "  JSON: $report_file"
    log "  Summary: $summary_file"
}

# –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
run_comprehensive_test_suite() {
    log "üöÄ –ó–∞–ø—É—Å–∫ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ —Ç–µ—Å—Ç–æ–≤ backup –∏ recovery"
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    mkdir -p $TEST_RESULTS_DIR
    
    # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
    setup_test_environment
    
    test_backup_creation
    backup_test_result=$?
    
    test_backup_integrity
    integrity_test_result=$?
    
    test_restore_process
    restore_test_result=$?
    
    validate_restored_data
    validation_test_result=$?
    
    test_performance_metrics
    performance_test_result=$?
    
    generate_comprehensive_report
    
    cleanup_test_environment
    
    # –û–±—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    local total_failures=$((backup_test_result + integrity_test_result + restore_test_result + validation_test_result + performance_test_result))
    
    if [ $total_failures -eq 0 ]; then
        log "üéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–®–õ–ò –£–°–ü–ï–®–ù–û!"
        send_notification "‚úÖ" "Comprehensive backup testing completed successfully - all tests passed"
        return 0
    else
        log "‚ùå –û–ë–ù–ê–†–£–ñ–ï–ù–´ –û–®–ò–ë–ö–ò –í $total_failures –¢–ï–°–¢–ê–•"
        send_notification "üö®" "Comprehensive backup testing failed - $total_failures tests failed"
        return 1
    fi
}

# –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
case "$1" in
    full)
        run_comprehensive_test_suite
        ;;
    setup)
        setup_test_environment
        ;;
    backup)
        test_backup_creation
        ;;
    integrity)
        test_backup_integrity
        ;;
    restore)
        test_restore_process
        ;;
    validate)
        validate_restored_data
        ;;
    performance)
        test_performance_metrics
        ;;
    cleanup)
        cleanup_test_environment
        ;;
    *)
        echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 {full|setup|backup|integrity|restore|validate|performance|cleanup}"
        echo "  full        - –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤"
        echo "  setup       - –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã"
        echo "  backup      - –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è backup"
        echo "  integrity   - –¢–µ—Å—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ backup"
        echo "  restore     - –¢–µ—Å—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è"
        echo "  validate    - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö"
        echo "  performance - –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"
        echo "  cleanup     - –û—á–∏—Å—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã"
        exit 1
        ;;
esac
EOF

chmod +x comprehensive-backup-testing.sh
```

### **2. –°–æ–∑–¥–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç–µ—Å—Ç–æ–≤:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç backup-test-monitoring.sh
cat << 'EOF' > backup-test-monitoring.sh
#!/bin/bash

echo "üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Backup –∏ Recovery"
echo "==========================================="

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
MONITORING_NAMESPACE="monitoring"
TEST_RESULTS_DIR="/tmp/backup-test-results"
PROMETHEUS_URL="http://prometheus.monitoring.svc.cluster.local:9090"

# –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1"
}

# –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è Prometheus –º–µ—Ç—Ä–∏–∫
create_prometheus_metrics() {
    log "üìà –°–æ–∑–¥–∞–Ω–∏–µ Prometheus –º–µ—Ç—Ä–∏–∫ –¥–ª—è backup —Ç–µ—Å—Ç–æ–≤"
    
    kubectl apply -f - << METRICS_EOF
apiVersion: v1
kind: ConfigMap
metadata:
  name: backup-test-metrics-exporter
  namespace: $MONITORING_NAMESPACE
data:
  metrics-exporter.py: |
    #!/usr/bin/env python3
    import time
    import json
    import subprocess
    from prometheus_client import start_http_server, Gauge, Counter, Histogram
    
    # –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è backup —Ç–µ—Å—Ç–æ–≤
    backup_test_success = Gauge('backup_test_success', 'Backup test success status (1=success, 0=failure)')
    backup_test_duration = Gauge('backup_test_duration_seconds', 'Total backup test duration in seconds')
    backup_creation_time = Gauge('backup_creation_time_seconds', 'Backup creation time in seconds')
    restore_time = Gauge('restore_time_seconds', 'Restore time in seconds')
    backup_test_rto = Gauge('backup_test_rto_seconds', 'Backup test RTO in seconds')
    backup_test_errors = Gauge('backup_test_errors_total', 'Number of errors in backup test')
    backup_test_last_run = Gauge('backup_test_last_run_timestamp', 'Timestamp of last backup test run')
    
    def update_metrics_from_file():
        try:
            # –ü–æ–∏—Å–∫ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ñ–∞–π–ª–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
            result = subprocess.run(['find', '/tmp/backup-test-results', '-name', '*.json', '-type', 'f'], 
                                  capture_output=True, text=True)
            
            if result.returncode == 0 and result.stdout.strip():
                latest_file = result.stdout.strip().split('\n')[-1]
                
                with open(latest_file, 'r') as f:
                    data = json.load(f)
                
                # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
                backup_test_last_run.set(time.time())
                
                if data['overall_status'] == 'PASSED':
                    backup_test_success.set(1)
                else:
                    backup_test_success.set(0)
                
                # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                metrics = data.get('metrics', {})
                if 'backup_creation_time' in metrics:
                    backup_creation_time.set(float(metrics['backup_creation_time']))
                if 'restore_time' in metrics:
                    restore_time.set(float(metrics['restore_time']))
                if 'total_rto' in metrics:
                    backup_test_rto.set(float(metrics['total_rto']))
                if 'validation_errors' in metrics:
                    backup_test_errors.set(float(metrics['validation_errors']))
                
                print(f"Metrics updated from {latest_file}")
            
        except Exception as e:
            print(f"Error updating metrics: {e}")
            backup_test_success.set(0)
    
    if __name__ == '__main__':
        start_http_server(8000)
        print("Backup test metrics exporter started on port 8000")
        
        while True:
            update_metrics_from_file()
            time.sleep(60)  # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: backup-test-metrics-exporter
  namespace: $MONITORING_NAMESPACE
spec:
  replicas: 1
  selector:
    matchLabels:
      app: backup-test-metrics-exporter
  template:
    metadata:
      labels:
        app: backup-test-metrics-exporter
    spec:
      containers:
      - name: exporter
        image: python:3.9-slim
        command: ["/bin/bash"]
        args:
        - -c
        - |
          pip install prometheus_client
          python /scripts/metrics-exporter.py
        ports:
        - containerPort: 8000
        volumeMounts:
        - name: scripts
          mountPath: /scripts
        - name: test-results
          mountPath: /tmp/backup-test-results
        resources:
          requests:
            cpu: 50m
            memory: 64Mi
          limits:
            cpu: 200m
            memory: 256Mi
      volumes:
      - name: scripts
        configMap:
          name: backup-test-metrics-exporter
          defaultMode: 0755
      - name: test-results
        hostPath:
          path: /tmp/backup-test-results
          type: DirectoryOrCreate
---
apiVersion: v1
kind: Service
metadata:
  name: backup-test-metrics-exporter
  namespace: $MONITORING_NAMESPACE
  labels:
    app: backup-test-metrics-exporter
spec:
  ports:
  - port: 8000
    targetPort: 8000
    name: metrics
  selector:
    app: backup-test-metrics-exporter
---
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: backup-test-metrics
  namespace: $MONITORING_NAMESPACE
spec:
  selector:
    matchLabels:
      app: backup-test-metrics-exporter
  endpoints:
  - port: metrics
    interval: 30s
    path: /metrics
METRICS_EOF
    
    log "‚úÖ Prometheus –º–µ—Ç—Ä–∏–∫–∏ —Å–æ–∑–¥–∞–Ω—ã"
}

# –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–ª–µ—Ä—Ç–æ–≤
create_backup_test_alerts() {
    log "üö® –°–æ–∑–¥–∞–Ω–∏–µ –∞–ª–µ—Ä—Ç–æ–≤ –¥–ª—è backup —Ç–µ—Å—Ç–æ–≤"
    
    kubectl apply -f - << ALERTS_EOF
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: backup-test-alerts
  namespace: $MONITORING_NAMESPACE
spec:
  groups:
  - name: backup-testing
    rules:
    - alert: BackupTestFailed
      expr: backup_test_success == 0
      for: 5m
      labels:
        severity: critical
        component: backup
        team: infrastructure
      annotations:
        summary: "Backup test failed"
        description: "Automated backup test has failed. Check backup system immediately."
        runbook_url: "https://docs.hashfoundry.com/runbooks/backup-test-failure"
        dashboard_url: "https://grafana.hashfoundry.local/d/backup-tests"
    
    - alert: BackupTestRTOExceeded
      expr: backup_test_rto_seconds > 1800
      for: 0m
      labels:
        severity: warning
        component: backup
        team: infrastructure
      annotations:
        summary: "Backup test RTO exceeded threshold"
        description: "Backup test RTO is {{ $value }} seconds, exceeding 30-minute threshold"
        runbook_url: "https://docs.hashfoundry.com/runbooks/backup-performance"
    
    - alert: BackupTestNotRunRecently
      expr: time() - backup_test_last_run_timestamp > 604800
      for: 0m
      labels:
        severity: warning
        component: backup
        team: infrastructure
      annotations:
        summary: "Backup test not run recently"
        description: "Last backup test was run {{ $value | humanizeDuration }} ago"
        runbook_url: "https://docs.hashfoundry.com/runbooks/backup-test-schedule"
    
    - alert: BackupTestHighErrorRate
      expr: backup_test_errors_total > 3
      for: 5m
      labels:
        severity: warning
        component: backup
        team: infrastructure
      annotations:
        summary: "High error rate in backup tests"
        description: "Backup test has {{ $value }} errors, indicating potential issues"
        runbook_url: "https://docs.hashfoundry.com/runbooks/backup-errors"
    
    - alert: BackupCreationTimeTooLong
      expr: backup_creation_time_seconds > 900
      for: 0m
      labels:
        severity: warning
        component: backup
        team: infrastructure
      annotations:
        summary: "Backup creation time too long"
        description: "Backup creation took {{ $value }} seconds, exceeding 15-minute threshold"
        runbook_url: "https://docs.hashfoundry.com/runbooks/backup-performance"
    
    - alert: RestoreTimeTooLong
      expr: restore_time_seconds > 1200
      for: 0m
      labels:
        severity: warning
        component: backup
        team: infrastructure
      annotations:
        summary: "Restore time too long"
        description: "Restore took {{ $value }} seconds, exceeding 20-minute threshold"
        runbook_url: "https://docs.hashfoundry.com/runbooks/restore-performance"
ALERTS_EOF
    
    log "‚úÖ –ê–ª–µ—Ä—Ç—ã –¥–ª—è backup —Ç–µ—Å—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω—ã"
}

# –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è Grafana dashboard
create_grafana_dashboard() {
    log "üìä –°–æ–∑–¥–∞–Ω–∏–µ Grafana dashboard –¥–ª—è backup —Ç–µ—Å—Ç–æ–≤"
    
    kubectl apply -f - << DASHBOARD_EOF
apiVersion: v1
kind: ConfigMap
metadata:
  name: backup-test-dashboard
  namespace: $MONITORING_NAMESPACE
  labels:
    grafana_dashboard: "1"
data:
  backup-test-dashboard.json: |
    {
      "dashboard": {
        "id": null,
        "title": "Backup Testing Dashboard",
        "tags": ["backup", "testing", "infrastructure"],
        "timezone": "browser",
        "panels": [
          {
            "id": 1,
            "title": "Backup Test Success Rate",
            "type": "stat",
            "targets": [
              {
                "expr": "backup_test_success",
                "legendFormat": "Success Rate"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": 0},
                    {"color": "green", "value": 1}
                  ]
                }
              }
            },
            "gridPos": {"h": 8, "w": 6, "x": 0, "y": 0}
          },
          {
            "id": 2,
            "title": "Backup Test RTO Trend",
            "type": "timeseries",
            "targets": [
              {
                "expr": "backup_test_rto_seconds",
                "legendFormat": "RTO (seconds)"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "s",
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": 0},
                    {"color": "yellow", "value": 900},
                    {"color": "red", "value": 1800}
                  ]
                }
              }
            },
            "gridPos": {"h": 8, "w": 12, "x": 6, "y": 0}
          },
          {
            "id": 3,
            "title": "Backup Creation Time",
            "type": "timeseries",
            "targets": [
              {
                "expr": "backup_creation_time_seconds",
                "legendFormat": "Backup Time"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "s"
              }
            },
            "gridPos": {"h": 8, "w": 6, "x": 18, "y": 0}
          },
          {
            "id": 4,
            "title": "Restore Time",
            "type": "timeseries",
            "targets": [
              {
                "expr": "restore_time_seconds",
                "legendFormat": "Restore Time"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "s"
              }
            },
            "gridPos": {"h": 8, "w": 6, "x": 0, "y": 8}
          },
          {
            "id": 5,
            "title": "Test Errors",
            "type": "timeseries",
            "targets": [
              {
                "expr": "backup_test_errors_total",
                "legendFormat": "Errors"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": 0},
                    {"color": "yellow", "value": 1},
                    {"color": "red", "value": 3}
                  ]
                }
              }
            },
            "gridPos": {"h": 8, "w": 6, "x": 6, "y": 8}
          },
          {
            "id": 6,
            "title": "Last Test Run",
            "type": "stat",
            "targets": [
              {
                "expr": "time() - backup_test_last_run_timestamp",
                "legendFormat": "Time Since Last Test"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "s",
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": 0},
                    {"color": "yellow", "value": 86400},
                    {"color": "red", "value": 604800}
                  ]
                }
              }
            },
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8}
          }
        ],
        "time": {
          "from": "now-7d",
          "to": "now"
        },
        "refresh": "5m"
      }
    }
DASHBOARD_EOF
    
    log "‚úÖ Grafana dashboard —Å–æ–∑–¥–∞–Ω"
}

# –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è CronJob –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤
create_automated_testing_cronjob() {
    log "‚è∞ –°–æ–∑–¥–∞–Ω–∏–µ CronJob –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤"
    
    kubectl apply -f - << CRONJOB_EOF
apiVersion: batch/v1
kind: CronJob
metadata:
  name: automated-backup-testing
  namespace: velero
spec:
  schedule: "0 2 * * 1"  # –ö–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 2:00
  jobTemplate:
    spec:
      template:
        spec:
          serviceAccountName: velero
          containers:
          - name: backup-tester
            image: hashfoundry/backup-tester:latest
            command: ["/bin/bash"]
            args:
            - -c
            - |
              # –ó–∞–ø—É—Å–∫ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
              /scripts/comprehensive-backup-testing.sh full
              
              # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ persistent volume
              cp -r /tmp/backup-test-results/* /shared-results/
              
              # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
              if [ $? -eq 0 ]; then
                echo "‚úÖ Weekly backup tests completed successfully"
              else
                echo "‚ùå Weekly backup tests failed"
              fi
            env:
            - name: SLACK_WEBHOOK_URL
              valueFrom:
                secretKeyRef:
                  name: notification-secrets
                  key: slack-webhook
            - name: CLEANUP_BACKUPS
              value: "true"
            volumeMounts:
            - name: test-scripts
              mountPath: /scripts
            - name: shared-results
              mountPath: /shared-results
            - name: kubeconfig
              mountPath: /root/.kube
            resources:
              requests:
                cpu: 100m
                memory: 256Mi
              limits:
                cpu: 500m
                memory: 1Gi
          volumes:
          - name: test-scripts
            configMap:
              name: backup-test-scripts
              defaultMode: 0755
          - name: shared-results
            persistentVolumeClaim:
              claimName: backup-test-results
          - name: kubeconfig
            secret:
              secretName: kubeconfig
          restartPolicy: OnFailure
      backoffLimit: 3
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: backup-test-results
  namespace: velero
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 5Gi
  storageClassName: do-block-storage
CRONJOB_EOF
    
    log "‚úÖ CronJob –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω"
}

# –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
main() {
    case "$1" in
        setup)
            log "üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ backup —Ç–µ—Å—Ç–æ–≤"
            create_prometheus_metrics
            create_backup_test_alerts
            create_grafana_dashboard
            create_automated_testing_cronjob
            log "‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ backup —Ç–µ—Å—Ç–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
            ;;
        metrics)
            create_prometheus_metrics
            ;;
        alerts)
            create_backup_test_alerts
            ;;
        dashboard)
            create_grafana_dashboard
            ;;
        cronjob)
            create_automated_testing_cronjob
            ;;
        status)
            log "üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞"
            kubectl get pods -n $MONITORING_NAMESPACE -l app=backup-test-metrics-exporter
            kubectl get servicemonitor -n $MONITORING_NAMESPACE backup-test-metrics
            kubectl get prometheusrule -n $MONITORING_NAMESPACE backup-test-alerts
            kubectl get cronjob -n velero automated-backup-testing
            ;;
        *)
            echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 {setup|metrics|alerts|dashboard|cronjob|status}"
            echo "  setup     - –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞"
            echo "  metrics   - –°–æ–∑–¥–∞–Ω–∏–µ Prometheus –º–µ—Ç—Ä–∏–∫"
            echo "  alerts    - –°–æ–∑–¥–∞–Ω–∏–µ –∞–ª–µ—Ä—Ç–æ–≤"
            echo "  dashboard - –°–æ–∑–¥–∞–Ω–∏–µ Grafana dashboard"
            echo "  cronjob   - –°–æ–∑–¥–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤"
            echo "  status    - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞"
            exit 1
            ;;
    esac
}

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
trap 'log "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞"; exit 1' ERR

# –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
main "$@"
EOF

chmod +x backup-test-monitoring.sh
```

## üìä **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è backup:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Backup Testing Architecture                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Test Execution Layer                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
‚îÇ  ‚îÇ  Manual Testing     ‚îÇ    ‚îÇ Automated Testing   ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ Ad-hoc Tests   ‚îÇ    ‚îÇ ‚îú‚îÄ‚îÄ Scheduled Tests ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ Validation     ‚îÇ    ‚îÇ ‚îú‚îÄ‚îÄ CI/CD Integration‚îÇ         ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ Troubleshooting‚îÇ    ‚îÇ ‚îî‚îÄ‚îÄ Continuous Tests‚îÇ         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Test Types                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ Integrity Tests     ‚îÇ Recovery Tests      ‚îÇ Performance ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ‚îÄ Checksum       ‚îÇ ‚îú‚îÄ‚îÄ Full Restore    ‚îÇ ‚îú‚îÄ‚îÄ RTO     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ‚îÄ Metadata       ‚îÇ ‚îú‚îÄ‚îÄ Partial Restore ‚îÇ ‚îú‚îÄ‚îÄ RPO     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ‚îÄ Compression    ‚îÇ ‚îú‚îÄ‚îÄ Point-in-time   ‚îÇ ‚îú‚îÄ‚îÄ Throughput‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îî‚îÄ‚îÄ Encryption     ‚îÇ ‚îî‚îÄ‚îÄ Cross-region    ‚îÇ ‚îî‚îÄ‚îÄ Resource ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Monitoring & Reporting                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ‚îÄ Prometheus Metrics (Success Rate, RTO, RPO)        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ‚îÄ Grafana Dashboards (Trends, Performance)           ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ‚îÄ AlertManager (Failure Notifications)               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îî‚îÄ‚îÄ Automated Reports (JSON, Summary, Trends)          ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üéØ **Best Practices –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è backup:**

### **1. –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**
- –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã (–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ)
- –†–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã —Ç–µ—Å—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä

### **2. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**
- CronJob –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CI/CD –ø–∞–π–ø–ª–∞–π–Ω–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### **3. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ä–µ—Å—É—Ä—Å–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è persistent volumes
- –ü—Ä–æ–≤–µ—Ä–∫–∞ secrets –∏ configmaps

### **4. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
- –ò–∑–º–µ—Ä–µ–Ω–∏–µ RTO/RPO
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç—Ä–µ–Ω–¥–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SLA

**–°–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ backup –∏ recovery –ø—Ä–æ—Ü–µ–¥—É—Ä –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã –∑–∞—â–∏—Ç—ã –¥–∞–Ω–Ω—ã—Ö –∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–µ–∞–ª—å–Ω—ã–º –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞–º!**
