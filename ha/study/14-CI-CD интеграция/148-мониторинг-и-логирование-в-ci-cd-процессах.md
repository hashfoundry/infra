# 148. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ CI/CD –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö

## üéØ **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**

| –ê—Å–ø–µ–∫—Ç | –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ | –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π CI/CD –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ |
|--------|---------------------|------------------------------|
| **–í–∏–¥–∏–º–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤** | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è | –ü–æ–ª–Ω–∞—è observability |
| **–°–±–æ—Ä –º–µ—Ç—Ä–∏–∫** | –†—É—á–Ω–æ–π | –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π |
| **–ê–ª–µ—Ä—Ç–∏–Ω–≥** | –†–µ–∞–∫—Ç–∏–≤–Ω—ã–π | –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–π |
| **–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤** | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ |
| **DORA –º–µ—Ç—Ä–∏–∫–∏** | –ù–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç |
| **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** | –ù–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ | –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º |
| **–î–∞—à–±–æ—Ä–¥—ã** | –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç—á–µ—Ç—ã | –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ real-time –¥–∞—à–±–æ—Ä–¥—ã |
| **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** | –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã | –ï–¥–∏–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ |
| **–í—Ä–µ–º—è —Ä–µ–∞–∫—Ü–∏–∏** | –ß–∞—Å—ã/–¥–Ω–∏ | –ú–∏–Ω—É—Ç—ã/—Å–µ–∫—É–Ω–¥—ã |
| **–ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è —Å–æ–±—ã—Ç–∏–π** | –†—É—á–Ω–∞—è | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è |
| **Capacity planning** | –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–π | Data-driven |
| **Troubleshooting** | –°–ª–æ–∂–Ω—ã–π | –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º |

## üèÜ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ CI/CD - —á—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?**

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ CI/CD –ø—Ä–æ—Ü–µ—Å—Å–æ–≤** ‚Äî —ç—Ç–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –∑–∞ –≤—Å–µ–º–∏ —ç—Ç–∞–ø–∞–º–∏ –∫–æ–Ω–≤–µ–π–µ—Ä–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è, –≤–∫–ª—é—á–∞—é—â–∞—è —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ DORA –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–ª–µ—Ä—Ç–∏–Ω–≥ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –∏ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

### **–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**
1. **Metrics Collection** - —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–∞–π–ø–ª–∞–π–Ω–æ–≤
2. **DORA Metrics** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π DevOps
3. **Structured Logging** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
4. **Real-time Dashboards** - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è CI/CD –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
5. **Proactive Alerting** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö –∏ –∞–Ω–æ–º–∞–ª–∏—è—Ö
6. **Trend Analysis** - –∞–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

## üìä **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –≤–∞—à–µ–≥–æ HA –∫–ª–∞—Å—Ç–µ—Ä–∞:**

### **1. –ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Prometheus –¥–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫
kubectl get pods -n monitoring | grep prometheus

# –ê–Ω–∞–ª–∏–∑ ServiceMonitor'–æ–≤ –¥–ª—è CI/CD –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
kubectl get servicemonitors -A -o json | jq -r '
  .items[] | 
  select(.metadata.name | test("argocd|jenkins|gitlab")) | 
  "\(.metadata.namespace)/\(.metadata.name): \(.spec.selector.matchLabels)"
'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ ArgoCD
kubectl port-forward svc/prometheus-server 9090:80 -n monitoring &
curl -s "http://localhost:9090/api/v1/query?query=argocd_app_info" | jq '.data.result[].metric'

# –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ ArgoCD Application Controller
kubectl logs -f deployment/argocd-application-controller -n argocd --tail=100

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±—ã—Ç–∏–π —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π
kubectl get events --sort-by=.metadata.creationTimestamp -A | grep -E "(Deploy|Rollout|Sync)"

# –ê–Ω–∞–ª–∏–∑ Grafana –¥–∞—à–±–æ—Ä–¥–æ–≤
kubectl get configmaps -n monitoring | grep dashboard

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤
kubectl get prometheusrules -A | grep -E "(argocd|cicd|deploy)"
```

### **2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ArgoCD –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π:**
```bash
# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö ArgoCD –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
kubectl get applications -n argocd -o json | jq -r '
  .items[] | 
  "\(.metadata.name): \(.status.health.status) / \(.status.sync.status)"
'

# –ò—Å—Ç–æ—Ä–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π
kubectl get applications -n argocd -o json | jq -r '
  .items[] | 
  "\(.metadata.name): Last sync: \(.status.operationState.finishedAt // "Never")"
'

# –ê–Ω–∞–ª–∏–∑ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
kubectl get applications -n argocd -o json | jq -r '
  .items[] | 
  "\(.metadata.name): \(.status.resources | length) resources"
'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
kubectl exec -n monitoring deployment/prometheus-server -- \
  promtool query instant 'argocd_app_sync_total'

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
kubectl exec -n monitoring deployment/prometheus-server -- \
  promtool query instant 'argocd_app_reconcile_bucket'
```

### **3. –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–∞–π–ø–ª–∞–π–Ω–æ–≤:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ kubectl events
kubectl get events -A --sort-by=.metadata.creationTimestamp | \
  grep -E "(Deployment|ReplicaSet)" | \
  tail -20

# –ê–Ω–∞–ª–∏–∑ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤–æ –≤—Ä–µ–º—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
kubectl top pods -A --sort-by=cpu

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–µ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
kubectl get networkpolicies -A
kubectl get services -A --field-selector spec.type=LoadBalancer

# –ü—Ä–æ–≤–µ—Ä–∫–∞ storage I/O –≤–æ –≤—Ä–µ–º—è CI/CD
kubectl get pvc -A -o json | jq -r '
  .items[] | 
  "\(.metadata.namespace)/\(.metadata.name): \(.status.phase) - \(.spec.resources.requests.storage)"
'
```

## üõ†Ô∏è **Comprehensive CI/CD Monitoring Implementation:**

### **1. Prometheus Configuration –¥–ª—è CI/CD –º–µ—Ç—Ä–∏–∫:**
```yaml
# k8s/monitoring/prometheus-cicd-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-cicd-config
  namespace: monitoring
data:
  cicd-rules.yml: |
    groups:
    - name: cicd.rules
      interval: 30s
      rules:
      # DORA Metrics
      - record: dora:deployment_frequency
        expr: |
          increase(argocd_app_sync_total{phase="Succeeded"}[24h])
      
      - record: dora:lead_time_seconds
        expr: |
          histogram_quantile(0.95, 
            rate(argocd_app_reconcile_bucket[5m])
          )
      
      - record: dora:change_failure_rate
        expr: |
          (
            rate(argocd_app_sync_total{phase="Failed"}[24h]) /
            rate(argocd_app_sync_total[24h])
          ) * 100
      
      - record: dora:mttr_seconds
        expr: |
          avg_over_time(
            (time() - argocd_app_health_status{health_status!="Healthy"} > 0)[24h:]
          )
      
      # Pipeline Performance Metrics
      - record: cicd:pipeline_duration_seconds
        expr: |
          histogram_quantile(0.95,
            rate(argocd_app_reconcile_bucket[5m])
          )
      
      - record: cicd:sync_success_rate
        expr: |
          (
            rate(argocd_app_sync_total{phase="Succeeded"}[5m]) /
            rate(argocd_app_sync_total[5m])
          ) * 100
      
      - record: cicd:apps_out_of_sync
        expr: |
          count(argocd_app_info{sync_status!="Synced"})
      
      - record: cicd:apps_unhealthy
        expr: |
          count(argocd_app_info{health_status!="Healthy"})
      
      # Resource Utilization
      - record: cicd:controller_cpu_usage
        expr: |
          rate(container_cpu_usage_seconds_total{
            pod=~"argocd-application-controller-.*",
            container="argocd-application-controller"
          }[5m])
      
      - record: cicd:controller_memory_usage
        expr: |
          container_memory_usage_bytes{
            pod=~"argocd-application-controller-.*",
            container="argocd-application-controller"
          }
---
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: argocd-metrics
  namespace: monitoring
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: argocd-metrics
  endpoints:
  - port: metrics
    interval: 30s
    path: /metrics
  namespaceSelector:
    matchNames:
    - argocd
---
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: argocd-server-metrics
  namespace: monitoring
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: argocd-server-metrics
  endpoints:
  - port: metrics
    interval: 30s
    path: /metrics
  namespaceSelector:
    matchNames:
    - argocd
```

### **2. Grafana Dashboard –¥–ª—è DORA –º–µ—Ç—Ä–∏–∫:**
```yaml
# k8s/monitoring/dora-dashboard.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: dora-metrics-dashboard
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  dora-metrics.json: |
    {
      "dashboard": {
        "id": null,
        "title": "DORA Metrics - HashFoundry CI/CD",
        "tags": ["dora", "cicd", "devops"],
        "timezone": "browser",
        "panels": [
          {
            "id": 1,
            "title": "Deployment Frequency",
            "type": "stat",
            "gridPos": {"h": 8, "w": 6, "x": 0, "y": 0},
            "targets": [
              {
                "expr": "dora:deployment_frequency",
                "legendFormat": "Deployments per day",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "short",
                "color": {"mode": "thresholds"},
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": 0},
                    {"color": "yellow", "value": 1},
                    {"color": "green", "value": 5}
                  ]
                }
              }
            }
          },
          {
            "id": 2,
            "title": "Lead Time for Changes",
            "type": "stat",
            "gridPos": {"h": 8, "w": 6, "x": 6, "y": 0},
            "targets": [
              {
                "expr": "dora:lead_time_seconds",
                "legendFormat": "Lead time (95th percentile)",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "s",
                "color": {"mode": "thresholds"},
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": 0},
                    {"color": "yellow", "value": 300},
                    {"color": "red", "value": 900}
                  ]
                }
              }
            }
          },
          {
            "id": 3,
            "title": "Change Failure Rate",
            "type": "stat",
            "gridPos": {"h": 8, "w": 6, "x": 12, "y": 0},
            "targets": [
              {
                "expr": "dora:change_failure_rate",
                "legendFormat": "Failure rate %",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "percent",
                "color": {"mode": "thresholds"},
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": 0},
                    {"color": "yellow", "value": 5},
                    {"color": "red", "value": 15}
                  ]
                }
              }
            }
          },
          {
            "id": 4,
            "title": "Mean Time to Recovery",
            "type": "stat",
            "gridPos": {"h": 8, "w": 6, "x": 18, "y": 0},
            "targets": [
              {
                "expr": "dora:mttr_seconds",
                "legendFormat": "MTTR",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "s",
                "color": {"mode": "thresholds"},
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": 0},
                    {"color": "yellow", "value": 3600},
                    {"color": "red", "value": 14400}
                  ]
                }
              }
            }
          },
          {
            "id": 5,
            "title": "Deployment Trends",
            "type": "graph",
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
            "targets": [
              {
                "expr": "increase(argocd_app_sync_total{phase=\"Succeeded\"}[1h])",
                "legendFormat": "Successful deployments",
                "refId": "A"
              },
              {
                "expr": "increase(argocd_app_sync_total{phase=\"Failed\"}[1h])",
                "legendFormat": "Failed deployments",
                "refId": "B"
              }
            ],
            "yAxes": [
              {"label": "Deployments", "min": 0},
              {"show": false}
            ]
          },
          {
            "id": 6,
            "title": "Application Health Status",
            "type": "piechart",
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
            "targets": [
              {
                "expr": "count by (health_status) (argocd_app_info)",
                "legendFormat": "{{health_status}}",
                "refId": "A"
              }
            ]
          },
          {
            "id": 7,
            "title": "Sync Performance",
            "type": "graph",
            "gridPos": {"h": 8, "w": 24, "x": 0, "y": 16},
            "targets": [
              {
                "expr": "histogram_quantile(0.50, rate(argocd_app_reconcile_bucket[5m]))",
                "legendFormat": "50th percentile",
                "refId": "A"
              },
              {
                "expr": "histogram_quantile(0.95, rate(argocd_app_reconcile_bucket[5m]))",
                "legendFormat": "95th percentile",
                "refId": "B"
              },
              {
                "expr": "histogram_quantile(0.99, rate(argocd_app_reconcile_bucket[5m]))",
                "legendFormat": "99th percentile",
                "refId": "C"
              }
            ],
            "yAxes": [
              {"label": "Duration (seconds)", "min": 0},
              {"show": false}
            ]
          }
        ],
        "time": {"from": "now-24h", "to": "now"},
        "refresh": "30s"
      }
    }
```

### **3. Structured Logging –¥–ª—è CI/CD –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:**
```yaml
# k8s/monitoring/fluentd-cicd-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: fluentd-cicd-config
  namespace: monitoring
data:
  fluent.conf: |
    # ArgoCD Application Controller logs
    <source>
      @type tail
      path /var/log/containers/*argocd-application-controller*.log
      pos_file /var/log/fluentd-argocd-controller.log.pos
      tag argocd.controller
      format json
      time_key time
      time_format %Y-%m-%dT%H:%M:%S.%NZ
    </source>
    
    # ArgoCD Server logs
    <source>
      @type tail
      path /var/log/containers/*argocd-server*.log
      pos_file /var/log/fluentd-argocd-server.log.pos
      tag argocd.server
      format json
      time_key time
      time_format %Y-%m-%dT%H:%M:%S.%NZ
    </source>
    
    # Parse ArgoCD logs
    <filter argocd.**>
      @type parser
      key_name log
      reserve_data true
      <parse>
        @type json
      </parse>
    </filter>
    
    # Enrich with Kubernetes metadata
    <filter argocd.**>
      @type kubernetes_metadata
      @log_level warn
      skip_labels true
      skip_container_metadata true
      skip_master_url true
      skip_namespace_metadata true
    </filter>
    
    # Add CI/CD context
    <filter argocd.**>
      @type record_transformer
      <record>
        component "cicd"
        system "argocd"
        environment "#{ENV['CLUSTER_ENV'] || 'production'}"
        cluster "#{ENV['CLUSTER_NAME'] || 'hashfoundry-ha'}"
      </record>
    </filter>
    
    # Extract deployment events
    <filter argocd.controller>
      @type grep
      <regexp>
        key log
        pattern /sync|deploy|health|reconcile/i
      </regexp>
    </filter>
    
    # Parse deployment metrics from logs
    <filter argocd.controller>
      @type parser
      key_name log
      reserve_data true
      <parse>
        @type regexp
        expression /.*app=(?<app_name>[^\s]+).*operation=(?<operation>[^\s]+).*phase=(?<phase>[^\s]+).*duration=(?<duration_ms>\d+)ms.*/
      </parse>
    </filter>
    
    # Send to Elasticsearch
    <match argocd.**>
      @type elasticsearch
      host elasticsearch.logging.svc.cluster.local
      port 9200
      index_name cicd-logs-%Y.%m.%d
      type_name _doc
      include_tag_key true
      tag_key @log_name
      flush_interval 5s
      <buffer>
        @type file
        path /var/log/fluentd-buffers/argocd
        flush_mode interval
        flush_interval 5s
        chunk_limit_size 10MB
        queue_limit_length 32
        retry_max_interval 30
        retry_forever true
      </buffer>
    </match>
    
    # Send metrics to Prometheus
    <match argocd.controller>
      @type prometheus
      <metric>
        name argocd_deployment_duration_seconds
        type histogram
        desc ArgoCD deployment duration
        key duration_ms
        buckets 100,500,1000,5000,10000,30000,60000
        <labels>
          app_name ${app_name}
          operation ${operation}
          phase ${phase}
        </labels>
      </metric>
    </match>
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: fluentd-cicd
  namespace: monitoring
spec:
  selector:
    matchLabels:
      name: fluentd-cicd
  template:
    metadata:
      labels:
        name: fluentd-cicd
    spec:
      serviceAccountName: fluentd
      containers:
      - name: fluentd
        image: fluent/fluentd-kubernetes-daemonset:v1.16-debian-elasticsearch7-1
        env:
        - name: FLUENT_ELASTICSEARCH_HOST
          value: "elasticsearch.logging.svc.cluster.local"
        - name: FLUENT_ELASTICSEARCH_PORT
          value: "9200"
        - name: CLUSTER_NAME
          value: "hashfoundry-ha"
        - name: CLUSTER_ENV
          value: "production"
        resources:
          limits:
            memory: 512Mi
            cpu: 200m
          requests:
            memory: 256Mi
            cpu: 100m
        volumeMounts:
        - name: varlog
          mountPath: /var/log
        - name: varlibdockercontainers
          mountPath: /var/lib/docker/containers
          readOnly: true
        - name: fluentd-config
          mountPath: /fluentd/etc/fluent.conf
          subPath: fluent.conf
      volumes:
      - name: varlog
        hostPath:
          path: /var/log
      - name: varlibdockercontainers
        hostPath:
          path: /var/lib/docker/containers
      - name: fluentd-config
        configMap:
          name: fluentd-cicd-config
```

### **4. Alerting Rules –¥–ª—è CI/CD:**
```yaml
# k8s/monitoring/cicd-alerts.yaml
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: cicd-alerts
  namespace: monitoring
spec:
  groups:
  - name: cicd.alerts
    rules:
    # DORA Metrics Alerts
    - alert: LowDeploymentFrequency
      expr: dora:deployment_frequency < 1
      for: 24h
      labels:
        severity: warning
        component: cicd
        dora_metric: deployment_frequency
      annotations:
        summary: "Low deployment frequency detected"
        description: "Only {{ $value }} deployments in the last 24 hours. Target: >1 per day"
        runbook_url: "https://docs.hashfoundry.com/runbooks/low-deployment-frequency"
    
    - alert: HighChangeFailureRate
      expr: dora:change_failure_rate > 15
      for: 1h
      labels:
        severity: critical
        component: cicd
        dora_metric: change_failure_rate
      annotations:
        summary: "High change failure rate"
        description: "Change failure rate is {{ $value }}%. Target: <15%"
        runbook_url: "https://docs.hashfoundry.com/runbooks/high-failure-rate"
    
    - alert: LongLeadTime
      expr: dora:lead_time_seconds > 3600
      for: 30m
      labels:
        severity: warning
        component: cicd
        dora_metric: lead_time
      annotations:
        summary: "Lead time is too long"
        description: "Lead time is {{ $value | humanizeDuration }}. Target: <1 hour"
        runbook_url: "https://docs.hashfoundry.com/runbooks/long-lead-time"
    
    - alert: HighMTTR
      expr: dora:mttr_seconds > 14400
      for: 15m
      labels:
        severity: critical
        component: cicd
        dora_metric: mttr
      annotations:
        summary: "Mean Time to Recovery is too high"
        description: "MTTR is {{ $value | humanizeDuration }}. Target: <4 hours"
        runbook_url: "https://docs.hashfoundry.com/runbooks/high-mttr"
    
    # ArgoCD Specific Alerts
    - alert: ArgoCDApplicationOutOfSync
      expr: cicd:apps_out_of_sync > 0
      for: 10m
      labels:
        severity: warning
        component: argocd
      annotations:
        summary: "ArgoCD applications out of sync"
        description: "{{ $value }} applications are out of sync"
        runbook_url: "https://docs.hashfoundry.com/runbooks/argocd-out-of-sync"
    
    - alert: ArgoCDApplicationUnhealthy
      expr: cicd:apps_unhealthy > 0
      for: 5m
      labels:
        severity: critical
        component: argocd
      annotations:
        summary: "ArgoCD applications unhealthy"
        description: "{{ $value }} applications are in unhealthy state"
        runbook_url: "https://docs.hashfoundry.com/runbooks/argocd-unhealthy"
    
    - alert: ArgoCDControllerHighCPU
      expr: cicd:controller_cpu_usage > 0.8
      for: 15m
      labels:
        severity: warning
        component: argocd
      annotations:
        summary: "ArgoCD controller high CPU usage"
        description: "ArgoCD controller CPU usage is {{ $value | humanizePercentage }}"
        runbook_url: "https://docs.hashfoundry.com/runbooks/argocd-high-cpu"
    
    - alert: ArgoCDControllerHighMemory
      expr: cicd:controller_memory_usage > 2000000000  # 2GB
      for: 15m
      labels:
        severity: warning
        component: argocd
      annotations:
        summary: "ArgoCD controller high memory usage"
        description: "ArgoCD controller memory usage is {{ $value | humanizeBytes }}"
        runbook_url: "https://docs.hashfoundry.com/runbooks/argocd-high-memory"
    
    # Pipeline Performance Alerts
    - alert: SlowSyncPerformance
      expr: cicd:pipeline_duration_seconds > 300
      for: 10m
      labels:
        severity: warning
        component: cicd
      annotations:
        summary: "Slow sync performance detected"
        description: "95th percentile sync duration is {{ $value }}s. Target: <300s"
        runbook_url: "https://docs.hashfoundry.com/runbooks/slow-sync"
    
    - alert: LowSyncSuccessRate
      expr: cicd:sync_success_rate < 95
      for: 15m
      labels:
        severity: critical
        component: cicd
      annotations:
        summary: "Low sync success rate"
        description: "Sync success rate is {{ $value }}%. Target: >95%"
        runbook_url: "https://docs.hashfoundry.com/runbooks/low-success-rate"
```

### **5. Webhook Integration –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö CI/CD —Å–∏—Å—Ç–µ–º:**
```yaml
# k8s/monitoring/webhook-receiver.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cicd-webhook-receiver
  namespace: monitoring
spec:
  replicas: 2
  selector:
    matchLabels:
      app: cicd-webhook-receiver
  template:
    metadata:
      labels:
        app: cicd-webhook-receiver
    spec:
      containers:
      - name: webhook-receiver
        image: hashfoundry/webhook-receiver:latest
        ports:
        - containerPort: 8080
        env:
        - name: PROMETHEUS_PUSHGATEWAY_URL
          value: "http://prometheus-pushgateway.monitoring.svc.cluster.local:9091"
        - name: ELASTICSEARCH_URL
          value: "http://elasticsearch.logging.svc.cluster.local:9200"
        - name: WEBHOOK_SECRET
          valueFrom:
            secretKeyRef:
              name: webhook-secrets
              key: webhook-secret
        resources:
          requests:
            memory: "128Mi"
            cpu: "100m"
          limits:
            memory: "256Mi"
            cpu: "200m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /ready
            port: 8080
          initialDelaySeconds: 5
          periodSeconds: 5
---
apiVersion: v1
kind: Service
metadata:
  name: cicd-webhook-receiver
  namespace: monitoring
spec:
  selector:
    app: cicd-webhook-receiver
  ports:
  - port: 80
    targetPort: 8080
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: cicd-webhook-receiver
  namespace: monitoring
  annotations:
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    cert-manager.io/cluster-issuer: letsencrypt-prod
spec:
  tls:
  - hosts:
    - webhooks.hashfoundry.com
    secretName: webhook-receiver-tls
  rules:
  - host: webhooks.hashfoundry.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: cicd-webhook-receiver
            port:
              number: 80
```

## üéì **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ:**

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ CI/CD –ø—Ä–æ—Ü–µ—Å—Å–æ–≤** –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –ø–æ–ª–Ω—É—é –≤–∏–¥–∏–º–æ—Å—Ç—å –∫–æ–Ω–≤–µ–π–µ—Ä–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å data-driven —Ä–µ—à–µ–Ω–∏—è –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

### **üîë –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
1. **DORA Metrics** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –∫–ª—é—á–µ–≤—ã—Ö DevOps –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
2. **Proactive Alerting** - —Ä–∞–Ω–Ω–µ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –∏ –∞–Ω–æ–º–∞–ª–∏–π
3. **Trend Analysis** - –≤—ã—è–≤–ª–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
4. **Root Cause Analysis** - –±—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
5. **Performance Optimization** - data-driven —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
6. **Compliance & Audit** - –ø–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä—É–µ–º–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–π

### **üõ†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**
- **Prometheus** - —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥
- **Grafana** - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ –¥–∞—à–±–æ—Ä–¥—ã
- **Fluentd/Loki** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Elasticsearch** - –ø–æ–∏—Å–∫ –∏ –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤
- **AlertManager** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
- **Jaeger** - distributed tracing –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –ø–∞–π–ø–ª–∞–π–Ω–æ–≤

### **üìä DORA Metrics:**
- **Deployment Frequency** - —á–∞—Å—Ç–æ—Ç–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π
- **Lead Time for Changes** - –≤—Ä–µ–º—è –æ—Ç –∫–æ–º–º–∏—Ç–∞ –¥–æ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- **Change Failure Rate** - –ø—Ä–æ—Ü–µ–Ω—Ç –Ω–µ—É–¥–∞—á–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **Mean Time to Recovery** - —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

### **üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –≤ –≤–∞—à–µ–º HA –∫–ª–∞—Å—Ç–µ—Ä–µ:**
```bash
# –ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
kubectl get pods -n monitoring | grep prometheus
kubectl get servicemonitors -A | grep argocd

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ ArgoCD
kubectl port-forward svc/prometheus-server 9090:80 -n monitoring
# –ó–∞—Ç–µ–º –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:9090

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π ArgoCD
kubectl get applications -n argocd
kubectl logs -f deployment/argocd-application-controller -n argocd

# –ê–Ω–∞–ª–∏–∑ —Å–æ–±—ã—Ç–∏–π —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π
kubectl get events --sort-by=.metadata.creationTimestamp -A | grep -E "(Deploy|Sync)"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤
kubectl get prometheusrules -A | grep cicd

# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
kubectl top pods -A --sort-by=cpu
kubectl top nodes
```

### **üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–±–æ—Ä DORA –º–µ—Ç—Ä–∏–∫ –¥–ª—è –≤–∞—à–µ–≥–æ HA –∫–ª–∞—Å—Ç–µ—Ä–∞
2. –°–æ–∑–¥–∞–π—Ç–µ –¥–∞—à–±–æ—Ä–¥—ã –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ CI/CD –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
3. –í–Ω–µ–¥—Ä–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç—Ä–∏–∫
5. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ –≤–Ω–µ—à–Ω–∏–µ CI/CD —Å–∏—Å—Ç–µ–º—ã —á–µ—Ä–µ–∑ webhooks
6. –†–µ–≥—É–ª—è—Ä–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ç—Ä–µ–Ω–¥—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

### **üí° –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏:**
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–π—Ç–µ —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫** - –Ω–µ –ø–æ–ª–∞–≥–∞–π—Ç–µ—Å—å –Ω–∞ —Ä—É—á–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏** - DORA metrics –∫–∞–∫ –æ—Å–Ω–æ–≤–∞
- **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—é —Å–æ–±—ã—Ç–∏–π** - —Å–≤—è–∑—ã–≤–∞–π—Ç–µ –ª–æ–≥–∏ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
- **–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã** - –∏–∑–±–µ–≥–∞–π—Ç–µ –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π
- **–†–µ–≥—É–ª—è—Ä–Ω–æ –ø–µ—Ä–µ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ –ø–æ—Ä–æ–≥–∏** - –∞–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ –ø–æ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ runbook'–∏** - –æ–±–µ—Å–ø–µ—á—å—Ç–µ –±—ã—Å—Ç—Ä—É—é —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

**–ü–æ–º–Ω–∏—Ç–µ:** –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ CI/CD - —ç—Ç–æ –Ω–µ —Ç–æ–ª—å–∫–æ —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –∏ –∏—Ö –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –¥–ª—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏!
