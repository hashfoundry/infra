# 141. –ö–∞–∫ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Kubernetes —Å CI/CD –ø–∞–π–ø–ª–∞–π–Ω–∞–º–∏?

## üéØ **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**

| –ê—Å–ø–µ–∫—Ç | –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π CI/CD | Kubernetes CI/CD |
|--------|-------------------|------------------|
| **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ** | –ù–∞ —Å–µ—Ä–≤–µ—Ä—ã –Ω–∞–ø—Ä—è–º—É—é | –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –ø–æ–¥—ã |
| **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** | –†—É—á–Ω–æ–µ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ |
| **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** | –§–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö | YAML –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã |
| **–û—Ç–∫–∞—Ç** | –°–ª–æ–∂–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π rollback |
| **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** | –í–Ω–µ—à–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ |
| **–°–µ–∫—Ä–µ—Ç—ã** | –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—ã | Kubernetes Secrets |
| **–°–µ—Ç—å** | –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ IP | Service Discovery |
| **–•—Ä–∞–Ω–∏–ª–∏—â–µ** | –õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∏—Å–∫–∏ | Persistent Volumes |

## üöÄ **CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Kubernetes**

**CI/CD —Å Kubernetes** ‚Äî —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Å–±–æ—Ä–∫–∏, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≤ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã—Ö –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤.

### **–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- **Container Registry** - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤
- **Build Pipeline** - —Å–±–æ—Ä–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Deployment Pipeline** - —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ –∫–ª–∞—Å—Ç–µ—Ä
- **GitOps** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Git
- **Monitoring** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π
- **Security Scanning** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üèóÔ∏è **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ CI/CD —Å Kubernetes**

**CI/CD Pipeline** —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —ç—Ç–∞–ø–æ–≤ —Å–±–æ—Ä–∫–∏, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, —É–ø–∞–∫–æ–≤–∫–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –≤ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä.

### **–≠—Ç–∞–ø—ã CI/CD Pipeline:**
- **Source** - –∫–æ–¥ –≤ Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- **Build** - —Å–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **Test** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
- **Package** - —Å–æ–∑–¥–∞–Ω–∏–µ Docker –æ–±—Ä–∞–∑–∞
- **Deploy** - —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Kubernetes
- **Monitor** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã

## üìä **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –≤–∞—à–µ–≥–æ HA –∫–ª–∞—Å—Ç–µ—Ä–∞:**

### **1. ArgoCD - GitOps —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω):**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ ArgoCD –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
kubectl get applications -n argocd

# –°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
kubectl describe application hashfoundry-react -n argocd

# –ü—Ä–æ—Å–º–æ—Ç—Ä ArgoCD UI
kubectl port-forward svc/argocd-server -n argocd 8080:443

# –õ–æ–≥–∏ ArgoCD –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
kubectl logs -f deployment/argocd-application-controller -n argocd

# –ü—Ä–æ–≤–µ—Ä–∫–∞ ArgoCD —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
kubectl get secrets -n argocd -l argocd.argoproj.io/secret-type=repository
```

### **2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–∏—Ö —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π:**
```bash
# –í—Å–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ
kubectl get deployments --all-namespaces

# –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π ArgoCD
kubectl rollout history deployment/argocd-server -n argocd

# –°—Ç–∞—Ç—É—Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π
kubectl get deployments -n argocd -o wide

# –°–æ–±—ã—Ç–∏—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π
kubectl get events -n argocd --sort-by='.lastTimestamp'
```

### **3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Prometheus (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω):**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Prometheus –º–µ—Ç—Ä–∏–∫
kubectl port-forward svc/prometheus-server -n monitoring 9090:80

# –ú–µ—Ç—Ä–∏–∫–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π:
# - kube_deployment_status_replicas
# - kube_deployment_status_replicas_available
# - kube_deployment_status_replicas_updated
# - argocd_app_info
# - argocd_app_sync_total
```

## üõ†Ô∏è **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ CI/CD Pipeline:**

### **1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Å CI/CD:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞
mkdir -p webapp-cicd/{src,k8s,helm,ci}
cd webapp-cicd

# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤
cat << 'EOF'
webapp-cicd/
‚îú‚îÄ‚îÄ src/                          # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ app.js
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ k8s/                          # Kubernetes –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ namespace.yaml
‚îÇ   ‚îú‚îÄ‚îÄ deployment.yaml
‚îÇ   ‚îú‚îÄ‚îÄ service.yaml
‚îÇ   ‚îú‚îÄ‚îÄ ingress.yaml
‚îÇ   ‚îî‚îÄ‚îÄ configmap.yaml
‚îú‚îÄ‚îÄ helm/                         # Helm chart
‚îÇ   ‚îú‚îÄ‚îÄ Chart.yaml
‚îÇ   ‚îú‚îÄ‚îÄ values.yaml
‚îÇ   ‚îî‚îÄ‚îÄ templates/
‚îú‚îÄ‚îÄ ci/                           # CI/CD –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îú‚îÄ‚îÄ .gitlab-ci.yml
‚îÇ   ‚îú‚îÄ‚îÄ Jenkinsfile
‚îÇ   ‚îî‚îÄ‚îÄ azure-pipelines.yml
‚îî‚îÄ‚îÄ scripts/                      # Deployment —Å–∫—Ä–∏–ø—Ç—ã
    ‚îú‚îÄ‚îÄ build.sh
    ‚îú‚îÄ‚îÄ deploy.sh
    ‚îî‚îÄ‚îÄ rollback.sh
EOF
```

### **2. Dockerfile –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
```dockerfile
# src/Dockerfile
FROM node:18-alpine AS builder

WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production && npm cache clean --force

FROM node:18-alpine AS runtime

# –°–æ–∑–¥–∞—Ç—å non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
RUN addgroup -g 1001 -S nodejs && \
    adduser -S nextjs -u 1001

WORKDIR /app

# –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
COPY --from=builder --chown=nextjs:nodejs /app/node_modules ./node_modules
COPY --chown=nextjs:nodejs src/ ./

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
USER nextjs
EXPOSE 3000

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:3000/health || exit 1

CMD ["node", "app.js"]
```

### **3. Kubernetes –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã:**
```yaml
# k8s/namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: webapp-production
  labels:
    name: webapp-production
    environment: production

---
# k8s/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: webapp
  namespace: webapp-production
  labels:
    app: webapp
    version: "1.0"
spec:
  replicas: 3
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 1
  selector:
    matchLabels:
      app: webapp
  template:
    metadata:
      labels:
        app: webapp
        version: "1.0"
      annotations:
        prometheus.io/scrape: "true"
        prometheus.io/port: "3000"
        prometheus.io/path: "/metrics"
    spec:
      securityContext:
        runAsNonRoot: true
        runAsUser: 1001
        fsGroup: 1001
      containers:
      - name: webapp
        image: hashfoundry/webapp:latest
        ports:
        - containerPort: 3000
          name: http
        env:
        - name: NODE_ENV
          value: "production"
        - name: PORT
          value: "3000"
        envFrom:
        - configMapRef:
            name: webapp-config
        - secretRef:
            name: webapp-secrets
        resources:
          requests:
            cpu: 100m
            memory: 128Mi
          limits:
            cpu: 500m
            memory: 512Mi
        livenessProbe:
          httpGet:
            path: /health
            port: 3000
          initialDelaySeconds: 30
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 3
        readinessProbe:
          httpGet:
            path: /ready
            port: 3000
          initialDelaySeconds: 5
          periodSeconds: 5
          timeoutSeconds: 3
          failureThreshold: 3
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
        volumeMounts:
        - name: tmp
          mountPath: /tmp
        - name: cache
          mountPath: /app/.cache
      volumes:
      - name: tmp
        emptyDir: {}
      - name: cache
        emptyDir: {}

---
# k8s/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: webapp-service
  namespace: webapp-production
  labels:
    app: webapp
spec:
  selector:
    app: webapp
  ports:
  - name: http
    port: 80
    targetPort: 3000
    protocol: TCP
  type: ClusterIP

---
# k8s/ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: webapp-ingress
  namespace: webapp-production
  annotations:
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    cert-manager.io/cluster-issuer: letsencrypt-prod
spec:
  tls:
  - hosts:
    - webapp.hashfoundry.com
    secretName: webapp-tls
  rules:
  - host: webapp.hashfoundry.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: webapp-service
            port:
              number: 80

---
# k8s/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: webapp-config
  namespace: webapp-production
data:
  LOG_LEVEL: "info"
  METRICS_ENABLED: "true"
  CACHE_TTL: "3600"
  API_TIMEOUT: "30000"
```

### **4. GitHub Actions CI/CD Pipeline:**
```yaml
# .github/workflows/ci-cd.yml
name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: hashfoundry/webapp
  KUBE_NAMESPACE: webapp-production

jobs:
  test:
    name: Test Application
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'

    - name: Install dependencies
      run: npm ci

    - name: Run linting
      run: npm run lint

    - name: Run unit tests
      run: npm run test:unit

    - name: Run integration tests
      run: npm run test:integration

    - name: Generate test coverage
      run: npm run test:coverage

    - name: Upload coverage to Codecov
      uses: codecov/codecov-action@v3

  security:
    name: Security Scan
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Run Trivy vulnerability scanner
      uses: aquasecurity/trivy-action@master
      with:
        scan-type: 'fs'
        scan-ref: '.'
        format: 'sarif'
        output: 'trivy-results.sarif'

    - name: Upload Trivy scan results
      uses: github/codeql-action/upload-sarif@v2
      with:
        sarif_file: 'trivy-results.sarif'

  build:
    name: Build and Push Image
    runs-on: ubuntu-latest
    needs: [test, security]
    if: github.ref == 'refs/heads/main'
    outputs:
      image-tag: ${{ steps.meta.outputs.tags }}
      image-digest: ${{ steps.build.outputs.digest }}
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3

    - name: Log in to Container Registry
      uses: docker/login-action@v3
      with:
        registry: ${{ env.REGISTRY }}
        username: ${{ github.actor }}
        password: ${{ secrets.GITHUB_TOKEN }}

    - name: Extract metadata
      id: meta
      uses: docker/metadata-action@v5
      with:
        images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}
        tags: |
          type=ref,event=branch
          type=ref,event=pr
          type=sha,prefix={{branch}}-
          type=raw,value=latest,enable={{is_default_branch}}

    - name: Build and push Docker image
      id: build
      uses: docker/build-push-action@v5
      with:
        context: ./src
        file: ./src/Dockerfile
        push: true
        tags: ${{ steps.meta.outputs.tags }}
        labels: ${{ steps.meta.outputs.labels }}
        cache-from: type=gha
        cache-to: type=gha,mode=max
        platforms: linux/amd64,linux/arm64

    - name: Generate SBOM
      uses: anchore/sbom-action@v0
      with:
        image: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }}

  deploy:
    name: Deploy to Kubernetes
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/main'
    environment: production
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup kubectl
      uses: azure/setup-kubectl@v3
      with:
        version: 'v1.28.0'

    - name: Configure kubectl
      run: |
        echo "${{ secrets.KUBE_CONFIG }}" | base64 -d > ~/.kube/config
        chmod 600 ~/.kube/config

    - name: Validate Kubernetes manifests
      run: |
        kubectl apply --dry-run=client -f k8s/
        kubectl apply --dry-run=server -f k8s/

    - name: Deploy to Kubernetes
      run: |
        # Update image tag in deployment
        sed -i "s|hashfoundry/webapp:latest|${{ needs.build.outputs.image-tag }}|g" k8s/deployment.yaml
        
        # Apply manifests
        kubectl apply -f k8s/
        
        # Wait for rollout to complete
        kubectl rollout status deployment/webapp -n ${{ env.KUBE_NAMESPACE }} --timeout=300s

    - name: Verify deployment
      run: |
        kubectl get pods -n ${{ env.KUBE_NAMESPACE }} -l app=webapp
        kubectl get service -n ${{ env.KUBE_NAMESPACE }} webapp-service
        kubectl get ingress -n ${{ env.KUBE_NAMESPACE }} webapp-ingress

    - name: Run smoke tests
      run: |
        # Wait for service to be ready
        kubectl wait --for=condition=ready pod -l app=webapp -n ${{ env.KUBE_NAMESPACE }} --timeout=300s
        
        # Port forward and test
        kubectl port-forward svc/webapp-service 8080:80 -n ${{ env.KUBE_NAMESPACE }} &
        sleep 10
        
        # Health check
        curl -f http://localhost:8080/health || exit 1
        
        # API test
        curl -f http://localhost:8080/api/status || exit 1

  notify:
    name: Notify Deployment
    runs-on: ubuntu-latest
    needs: [deploy]
    if: always()
    steps:
    - name: Notify Slack
      uses: 8398a7/action-slack@v3
      with:
        status: ${{ job.status }}
        channel: '#deployments'
        webhook_url: ${{ secrets.SLACK_WEBHOOK }}
        fields: repo,message,commit,author,action,eventName,ref,workflow
```

### **5. GitLab CI/CD Pipeline:**
```yaml
# .gitlab-ci.yml
stages:
  - test
  - security
  - build
  - deploy
  - verify

variables:
  DOCKER_REGISTRY: registry.gitlab.com
  IMAGE_NAME: $DOCKER_REGISTRY/$CI_PROJECT_PATH/webapp
  KUBE_NAMESPACE: webapp-production
  DOCKER_DRIVER: overlay2
  DOCKER_TLS_CERTDIR: "/certs"

.kubectl_config: &kubectl_config
  - echo "$KUBE_CONFIG" | base64 -d > ~/.kube/config
  - chmod 600 ~/.kube/config

test:unit:
  stage: test
  image: node:18-alpine
  cache:
    paths:
      - node_modules/
  script:
    - npm ci
    - npm run lint
    - npm run test:unit
    - npm run test:coverage
  coverage: '/Lines\s*:\s*(\d+\.\d+)%/'
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: coverage/cobertura-coverage.xml
    paths:
      - coverage/

test:integration:
  stage: test
  image: node:18-alpine
  services:
    - postgres:13-alpine
    - redis:6-alpine
  variables:
    POSTGRES_DB: testdb
    POSTGRES_USER: testuser
    POSTGRES_PASSWORD: testpass
    DATABASE_URL: postgres://testuser:testpass@postgres:5432/testdb
    REDIS_URL: redis://redis:6379
  script:
    - npm ci
    - npm run test:integration

security:sast:
  stage: security
  image: securecodewarrior/gitlab-sast:latest
  script:
    - /analyzer run
  artifacts:
    reports:
      sast: gl-sast-report.json

security:container:
  stage: security
  image: aquasec/trivy:latest
  script:
    - trivy fs --format template --template "@contrib/gitlab.tpl" -o gl-container-scanning-report.json .
  artifacts:
    reports:
      container_scanning: gl-container-scanning-report.json

build:
  stage: build
  image: docker:24-dind
  services:
    - docker:24-dind
  before_script:
    - echo $CI_REGISTRY_PASSWORD | docker login -u $CI_REGISTRY_USER --password-stdin $CI_REGISTRY
  script:
    - docker build -t $IMAGE_NAME:$CI_COMMIT_SHA ./src
    - docker tag $IMAGE_NAME:$CI_COMMIT_SHA $IMAGE_NAME:latest
    - docker push $IMAGE_NAME:$CI_COMMIT_SHA
    - docker push $IMAGE_NAME:latest
  only:
    - main

deploy:staging:
  stage: deploy
  image: bitnami/kubectl:latest
  environment:
    name: staging
    url: https://webapp-staging.hashfoundry.com
  before_script:
    - *kubectl_config
  script:
    - sed -i "s|hashfoundry/webapp:latest|$IMAGE_NAME:$CI_COMMIT_SHA|g" k8s/deployment.yaml
    - kubectl apply -f k8s/ -n webapp-staging
    - kubectl rollout status deployment/webapp -n webapp-staging --timeout=300s
  only:
    - main

deploy:production:
  stage: deploy
  image: bitnami/kubectl:latest
  environment:
    name: production
    url: https://webapp.hashfoundry.com
  before_script:
    - *kubectl_config
  script:
    - sed -i "s|hashfoundry/webapp:latest|$IMAGE_NAME:$CI_COMMIT_SHA|g" k8s/deployment.yaml
    - kubectl apply -f k8s/ -n $KUBE_NAMESPACE
    - kubectl rollout status deployment/webapp -n $KUBE_NAMESPACE --timeout=300s
  when: manual
  only:
    - main

verify:production:
  stage: verify
  image: curlimages/curl:latest
  script:
    - sleep 30
    - curl -f https://webapp.hashfoundry.com/health
    - curl -f https://webapp.hashfoundry.com/api/status
  dependencies:
    - deploy:production
  only:
    - main
```

### **6. Jenkins Pipeline:**
```groovy
// Jenkinsfile
pipeline {
    agent any
    
    environment {
        DOCKER_REGISTRY = 'registry.hashfoundry.com'
        IMAGE_NAME = 'hashfoundry/webapp'
        KUBE_NAMESPACE = 'webapp-production'
        DOCKER_CREDENTIALS = credentials('docker-registry-creds')
        KUBE_CONFIG = credentials('kube-config')
    }
    
    stages {
        stage('Checkout') {
            steps {
                checkout scm
                script {
                    env.GIT_COMMIT_SHORT = sh(
                        script: 'git rev-parse --short HEAD',
                        returnStdout: true
                    ).trim()
                }
            }
        }
        
        stage('Test') {
            parallel {
                stage('Unit Tests') {
                    steps {
                        sh '''
                            npm ci
                            npm run lint
                            npm run test:unit
                        '''
                    }
                    post {
                        always {
                            publishTestResults testResultsPattern: 'test-results.xml'
                            publishCoverage adapters: [
                                istanbulCoberturaAdapter('coverage/cobertura-coverage.xml')
                            ]
                        }
                    }
                }
                
                stage('Security Scan') {
                    steps {
                        sh '''
                            docker run --rm -v $(pwd):/workspace \
                              aquasec/trivy:latest fs /workspace
                        '''
                    }
                }
            }
        }
        
        stage('Build') {
            when {
                branch 'main'
            }
            steps {
                script {
                    def image = docker.build("${IMAGE_NAME}:${GIT_COMMIT_SHORT}", "./src")
                    
                    docker.withRegistry("https://${DOCKER_REGISTRY}", 'docker-registry-creds') {
                        image.push("${GIT_COMMIT_SHORT}")
                        image.push("latest")
                    }
                }
            }
        }
        
        stage('Deploy to Staging') {
            when {
                branch 'main'
            }
            steps {
                script {
                    withKubeConfig([credentialsId: 'kube-config']) {
                        sh '''
                            sed -i "s|hashfoundry/webapp:latest|${DOCKER_REGISTRY}/${IMAGE_NAME}:${GIT_COMMIT_SHORT}|g" k8s/deployment.yaml
                            kubectl apply -f k8s/ -n webapp-staging
                            kubectl rollout status deployment/webapp -n webapp-staging --timeout=300s
                        '''
                    }
                }
            }
        }
        
        stage('Integration Tests') {
            when {
                branch 'main'
            }
            steps {
                sh '''
                    kubectl port-forward svc/webapp-service 8080:80 -n webapp-staging &
                    sleep 10
                    npm run test:integration
                '''
            }
        }
        
        stage('Deploy to Production') {
            when {
                branch 'main'
            }
            input {
                message "Deploy to production?"
                ok "Deploy"
                parameters {
                    choice(
                        name: 'DEPLOYMENT_STRATEGY',
                        choices: ['rolling', 'blue-green', 'canary'],
                        description: 'Deployment strategy'
                    )
                }
            }
            steps {
                script {
                    withKubeConfig([credentialsId: 'kube-config']) {
                        if (params.DEPLOYMENT_STRATEGY == 'rolling') {
                            sh '''
                                sed -i "s|hashfoundry/webapp:latest|${DOCKER_REGISTRY}/${IMAGE_NAME}:${GIT_COMMIT_SHORT}|g" k8s/deployment.yaml
                                kubectl apply -f k8s/ -n ${KUBE_NAMESPACE}
                                kubectl rollout status deployment/webapp -n ${KUBE_NAMESPACE} --timeout=300s
                            '''
                        } else if (params.DEPLOYMENT_STRATEGY == 'blue-green') {
                            sh '''
                                # Blue-Green deployment logic
                                kubectl apply -f k8s/blue-green/ -n ${KUBE_NAMESPACE}
                            '''
                        } else if (params.DEPLOYMENT_STRATEGY == 'canary') {
                            sh '''
                                # Canary deployment logic
                                kubectl apply -f k8s/canary/ -n ${KUBE_NAMESPACE}
                            '''
                        }
                    }
                }
            }
        }
        
        stage('Verify Deployment') {
            when {
                branch 'main'
            }
            steps {
                sh '''
                    sleep 30
                    curl -f https://webapp.hashfoundry.com/health
                    curl -f https://webapp.hashfoundry.com/api/status
                '''
            }
        }
    }
    
    post {
        always {
            cleanWs()
        }
        success {
            slackSend(
                channel: '#deployments',
                color: 'good',
                message: "‚úÖ Deployment successful: ${env.JOB_NAME} - ${env.BUILD_NUMBER}"
            )
        }
        failure {
            slackSend(
                channel: '#deployments',
                color: 'danger',
                message: "‚ùå Deployment failed: ${env.JOB_NAME} - ${env.BUILD_NUMBER}"
            )
        }
    }
}
```

## üîß **Helm –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ CI/CD:**

### **1. Helm Chart —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```bash
# helm/Chart.yaml
apiVersion: v2
name: webapp
description: HashFoundry WebApp Helm Chart
type: application
version: 1.0.0
appVersion: "1.0.0"
dependencies:
- name: postgresql
  version: 12.1.9
  repository: https://charts.bitnami.com/bitnami
  condition: postgresql.enabled
- name: redis
  version: 17.3.7
  repository: https://charts.bitnami.com/bitnami
  condition: redis.enabled
```

```yaml
# helm/values.yaml
replicaCount: 3

image:
  repository: hashfoundry/webapp
  tag: latest
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 80
  targetPort: 3000

ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
  hosts:
  - host: webapp.hashfoundry.com
    paths:
    - path: /
      pathType: Prefix
  tls:
  - secretName: webapp-tls
    hosts:
    - webapp.hashfoundry.com

resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 512Mi

autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

postgresql:
  enabled: true
  auth:
    database: webapp
    username: webapp

redis:
  enabled: true
  auth:
    enabled: false

monitoring:
  enabled: true
  serviceMonitor:
    enabled: true
    interval: 30s
    path: /metrics
```

### **2. Helm –≤ CI/CD Pipeline:**
```bash
# scripts/deploy-helm.sh
#!/bin/bash

set -e

NAMESPACE=${KUBE_NAMESPACE:-webapp-production}
RELEASE_NAME=${HELM_RELEASE:-webapp}
CHART_PATH=${CHART_PATH:-./helm}
IMAGE_TAG=${IMAGE_TAG:-latest}

echo "Deploying ${RELEASE_NAME} to ${NAMESPACE} with image tag ${IMAGE_TAG}"

# –î–æ–±–∞–≤–∏—Ç—å Helm —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Helm chart
helm lint ${CHART_PATH}

# Dry run
helm upgrade --install ${RELEASE_NAME} ${CHART_PATH} \
  --namespace ${NAMESPACE} \
  --create-namespace \
  --set image.tag=${IMAGE_TAG} \
  --dry-run --debug

# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
helm upgrade --install ${RELEASE_NAME} ${CHART_PATH} \
  --namespace ${NAMESPACE} \
  --create-namespace \
  --set image.tag=${IMAGE_TAG} \
  --wait --timeout=300s

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
helm status ${RELEASE_NAME} -n ${NAMESPACE}
kubectl get pods -n ${NAMESPACE} -l app.kubernetes.io/instance=${RELEASE_NAME}

echo "Deployment completed successfully!"
```

## üîê **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤ CI/CD:**

### **1. RBAC –¥–ª—è CI/CD Service Account:**
```yaml
# ci/rbac.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: ci-cd-deployer
  namespace: webapp-production
automountServiceAccountToken: false

---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: webapp-production
  name: ci-cd-deployer
rules:
- apiGroups: [""]
  resources: ["pods", "services", "configmaps", "secrets"]
  verbs: ["get", "list", "create", "update", "patch", "delete"]
- apiGroups: ["apps"]
  resources: ["deployments", "replicasets"]
  verbs: ["get", "list", "create", "update", "patch", "delete"]
- apiGroups: ["networking.k8s.io"]
  resources: ["ingresses"]
  verbs: ["get", "list", "create", "update", "patch", "delete"]
- apiGroups: ["autoscaling"]
  resources: ["horizontalpodautoscalers"]
  verbs: ["get", "list", "create", "update", "patch", "delete"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: ci-cd-deployer
  namespace: webapp-production
subjects:
- kind: ServiceAccount
  name: ci-cd-deployer
  namespace: webapp-production
roleRef:
  kind: Role
  name: ci-cd-deployer
  apiGroup: rbac.authorization.k8s.io
```

### **2. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –¥–ª—è CI/CD:**
```bash
# –°–æ–∑–¥–∞—Ç—å –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–ª—è CI/CD
kubectl create token ci-cd-deployer --duration=8760h -n webapp-production

# –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –∏–∑ Secret (–¥–ª—è —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π K8s)
kubectl get secret ci-cd-deployer-token -n webapp-production -o jsonpath='{.data.token}' | base64 -d

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤ CI/CD
export KUBE_TOKEN=$(kubectl create token ci-cd-deployer --duration=8760h -n webapp-production)
kubectl --token=$KUBE_TOKEN get pods -n webapp-production
```

### **3. –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏:**
```yaml
# ci/security-policies.yaml
apiVersion: v1
kind: Secret
metadata:
  name: webapp-secrets
  namespace: webapp-production
type: Opaque
data:
  database-password: <base64-encoded-password>
  api-key: <base64-encoded-api-key>
  jwt-secret: <base64-encoded-jwt-secret>

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: webapp-network-policy
  namespace: webapp-production
spec:
  podSelector:
    matchLabels:
      app: webapp
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: ingress-nginx
    ports:
    - protocol: TCP
      port: 3000
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          name: webapp-production
    ports:
    - protocol: TCP
      port: 5432  # PostgreSQL
    - protocol: TCP
      port: 6379  # Redis
  - to: []
    ports:
    - protocol: TCP
      port: 443   # HTTPS
    - protocol: TCP
      port: 53    # DNS
    - protocol: UDP
      port: 53    # DNS
```

## üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ CI/CD –≤ –≤–∞—à–µ–º –∫–ª–∞—Å—Ç–µ—Ä–µ:**

### **1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π —á–µ—Ä–µ–∑ kubectl:**
```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Å–µ—Ö —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π
kubectl get deployments --all-namespaces -o wide

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ ArgoCD –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
kubectl get applications -n argocd -o custom-columns=NAME:.metadata.name,SYNC:.status.sync.status,HEALTH:.status.health.status

# –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π
kubectl rollout history deployment/argocd-server -n argocd

# –°–æ–±—ã—Ç–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
kubectl get events --all-namespaces --watch

# –õ–æ–≥–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π
kubectl logs -f deployment/argocd-application-controller -n argocd

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
kubectl top pods -n argocd
kubectl top nodes
```

### **2. Prometheus –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è CI/CD:**
```bash
# Port forward –∫ Prometheus
kubectl port-forward svc/prometheus-server -n monitoring 9090:80

# –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ CI/CD:
# - kube_deployment_status_replicas
# - kube_deployment_status_replicas_available
# - kube_deployment_status_replicas_updated
# - kube_pod_container_status_restarts_total
# - argocd_app_info
# - argocd_app_sync_total
# - argocd_app_health_status
```

### **3. Grafana –¥–∞—à–±–æ—Ä–¥—ã:**
```bash
# Port forward –∫ Grafana
kubectl port-forward svc/grafana -n monitoring 3000:80

# –°–æ–∑–¥–∞—Ç—å –¥–∞—à–±–æ—Ä–¥ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
# - Deployment success rate
# - Build duration
# - Test coverage
# - Security scan results
# - Application health
```

## üîÑ **–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:**

### **1. Rolling Update (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):**
```yaml
# k8s/rolling-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: webapp-rolling
  namespace: webapp-production
spec:
  replicas: 6
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 2        # –ú–∞–∫—Å–∏–º—É–º 2 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–¥–∞
      maxUnavailable: 1  # –ú–∞–∫—Å–∏–º—É–º 1 –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–π –ø–æ–¥
  selector:
    matchLabels:
      app: webapp
      strategy: rolling
  template:
    metadata:
      labels:
        app: webapp
        strategy: rolling
    spec:
      containers:
      - name: webapp
        image: hashfoundry/webapp:latest
        ports:
        - containerPort: 3000
        readinessProbe:
          httpGet:
            path: /ready
            port: 3000
          initialDelaySeconds: 5
          periodSeconds: 5
```

### **2. Blue-Green —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ:**
```yaml
# k8s/blue-green/blue-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: webapp-blue
  namespace: webapp-production
  labels:
    app: webapp
    version: blue
spec:
  replicas: 3
  selector:
    matchLabels:
      app: webapp
      version: blue
  template:
    metadata:
      labels:
        app: webapp
        version: blue
    spec:
      containers:
      - name: webapp
        image: hashfoundry/webapp:v1.0.0
        ports:
        - containerPort: 3000

---
# k8s/blue-green/green-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: webapp-green
  namespace: webapp-production
  labels:
    app: webapp
    version: green
spec:
  replicas: 3
  selector:
    matchLabels:
      app: webapp
      version: green
  template:
    metadata:
      labels:
        app: webapp
        version: green
    spec:
      containers:
      - name: webapp
        image: hashfoundry/webapp:v2.0.0
        ports:
        - containerPort: 3000

---
# k8s/blue-green/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: webapp-service
  namespace: webapp-production
spec:
  selector:
    app: webapp
    version: blue  # –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É blue –∏ green
  ports:
  - port: 80
    targetPort: 3000
```

### **3. Canary —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ:**
```yaml
# k8s/canary/stable-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: webapp-stable
  namespace: webapp-production
  labels:
    app: webapp
    version: stable
spec:
  replicas: 9  # 90% —Ç—Ä–∞—Ñ–∏–∫–∞
  selector:
    matchLabels:
      app: webapp
      version: stable
  template:
    metadata:
      labels:
        app: webapp
        version: stable
    spec:
      containers:
      - name: webapp
        image: hashfoundry/webapp:v1.0.0
        ports:
        - containerPort: 3000

---
# k8s/canary/canary-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: webapp-canary
  namespace: webapp-production
  labels:
    app: webapp
    version: canary
spec:
  replicas: 1  # 10% —Ç—Ä–∞—Ñ–∏–∫–∞
  selector:
    matchLabels:
      app: webapp
      version: canary
  template:
    metadata:
      labels:
        app: webapp
        version: canary
    spec:
      containers:
      - name: webapp
        image: hashfoundry/webapp:v2.0.0
        ports:
        - containerPort: 3000

---
# k8s/canary/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: webapp-service
  namespace: webapp-production
spec:
  selector:
    app: webapp  # –û–±–µ –≤–µ—Ä—Å–∏–∏ –ø–æ–ª—É—á–∞—é—Ç —Ç—Ä–∞—Ñ–∏–∫
  ports:
  - port: 80
    targetPort: 3000
```

## üõ†Ô∏è **–°–∫—Ä–∏–ø—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏:**

### **1. –°–∫—Ä–∏–ø—Ç —Å–±–æ—Ä–∫–∏ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:**
```bash
#!/bin/bash
# scripts/deploy.sh

set -e

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
NAMESPACE=${NAMESPACE:-webapp-production}
IMAGE_TAG=${IMAGE_TAG:-latest}
DEPLOYMENT_STRATEGY=${DEPLOYMENT_STRATEGY:-rolling}
REGISTRY=${REGISTRY:-hashfoundry}
APP_NAME=${APP_NAME:-webapp}

echo "üöÄ Starting deployment of ${APP_NAME}:${IMAGE_TAG} to ${NAMESPACE}"

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
check_readiness() {
    local deployment=$1
    local namespace=$2
    local timeout=${3:-300}
    
    echo "‚è≥ Waiting for deployment ${deployment} to be ready..."
    kubectl rollout status deployment/${deployment} -n ${namespace} --timeout=${timeout}s
    
    if [ $? -eq 0 ]; then
        echo "‚úÖ Deployment ${deployment} is ready"
        return 0
    else
        echo "‚ùå Deployment ${deployment} failed to become ready"
        return 1
    fi
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è smoke tests
run_smoke_tests() {
    local service=$1
    local namespace=$2
    
    echo "üß™ Running smoke tests..."
    
    # Port forward –≤ —Ñ–æ–Ω–µ
    kubectl port-forward svc/${service} 8080:80 -n ${namespace} &
    local pf_pid=$!
    
    # –î–æ–∂–¥–∞—Ç—å—Å—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ port forward
    sleep 10
    
    # Health check
    if curl -f http://localhost:8080/health; then
        echo "‚úÖ Health check passed"
    else
        echo "‚ùå Health check failed"
        kill $pf_pid
        return 1
    fi
    
    # API test
    if curl -f http://localhost:8080/api/status; then
        echo "‚úÖ API test passed"
    else
        echo "‚ùå API test failed"
        kill $pf_pid
        return 1
    fi
    
    # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å port forward
    kill $pf_pid
    
    echo "‚úÖ All smoke tests passed"
    return 0
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫–∞—Ç–∞
rollback_deployment() {
    local deployment=$1
    local namespace=$2
    
    echo "üîÑ Rolling back deployment ${deployment}..."
    kubectl rollout undo deployment/${deployment} -n ${namespace}
    
    if check_readiness ${deployment} ${namespace}; then
        echo "‚úÖ Rollback successful"
        return 0
    else
        echo "‚ùå Rollback failed"
        return 1
    fi
}

# –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
deploy_application() {
    case ${DEPLOYMENT_STRATEGY} in
        "rolling")
            echo "üì¶ Deploying with Rolling Update strategy"
            
            # –û–±–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–∑ –≤ deployment
            sed -i "s|${REGISTRY}/${APP_NAME}:.*|${REGISTRY}/${APP_NAME}:${IMAGE_TAG}|g" k8s/deployment.yaml
            
            # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã
            kubectl apply -f k8s/ -n ${NAMESPACE}
            
            # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å
            if check_readiness ${APP_NAME} ${NAMESPACE}; then
                if run_smoke_tests "${APP_NAME}-service" ${NAMESPACE}; then
                    echo "‚úÖ Rolling deployment successful"
                else
                    echo "‚ùå Smoke tests failed, rolling back..."
                    rollback_deployment ${APP_NAME} ${NAMESPACE}
                    exit 1
                fi
            else
                echo "‚ùå Deployment failed"
                exit 1
            fi
            ;;
            
        "blue-green")
            echo "üîµüü¢ Deploying with Blue-Green strategy"
            
            # –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–µ–∫—É—â—É—é –∞–∫—Ç–∏–≤–Ω—É—é –≤–µ—Ä—Å–∏—é
            current_version=$(kubectl get service ${APP_NAME}-service -n ${NAMESPACE} -o jsonpath='{.spec.selector.version}')
            
            if [ "$current_version" = "blue" ]; then
                new_version="green"
            else
                new_version="blue"
            fi
            
            echo "Current version: ${current_version}, deploying to: ${new_version}"
            
            # –û–±–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–∑ –≤ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏
            sed -i "s|${REGISTRY}/${APP_NAME}:.*|${REGISTRY}/${APP_NAME}:${IMAGE_TAG}|g" k8s/blue-green/${new_version}-deployment.yaml
            
            # –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é
            kubectl apply -f k8s/blue-green/${new_version}-deployment.yaml -n ${NAMESPACE}
            
            # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å
            if check_readiness "${APP_NAME}-${new_version}" ${NAMESPACE}; then
                # –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫
                kubectl patch service ${APP_NAME}-service -n ${NAMESPACE} -p '{"spec":{"selector":{"version":"'${new_version}'"}}}'
                
                if run_smoke_tests "${APP_NAME}-service" ${NAMESPACE}; then
                    echo "‚úÖ Blue-Green deployment successful"
                    
                    # –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é
                    kubectl delete deployment ${APP_NAME}-${current_version} -n ${NAMESPACE}
                else
                    echo "‚ùå Smoke tests failed, switching back..."
                    kubectl patch service ${APP_NAME}-service -n ${NAMESPACE} -p '{"spec":{"selector":{"version":"'${current_version}'"}}}'
                    exit 1
                fi
            else
                echo "‚ùå Blue-Green deployment failed"
                exit 1
            fi
            ;;
            
        "canary")
            echo "üê§ Deploying with Canary strategy"
            
            # –û–±–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–∑ –≤ canary deployment
            sed -i "s|${REGISTRY}/${APP_NAME}:.*|${REGISTRY}/${APP_NAME}:${IMAGE_TAG}|g" k8s/canary/canary-deployment.yaml
            
            # –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å canary –≤–µ—Ä—Å–∏—é
            kubectl apply -f k8s/canary/canary-deployment.yaml -n ${NAMESPACE}
            
            # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å
            if check_readiness "${APP_NAME}-canary" ${NAMESPACE}; then
                echo "‚úÖ Canary deployment ready"
                
                # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ canary –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç
                echo "üìä Monitoring canary for 5 minutes..."
                sleep 300
                
                # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ (–∑–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Prometheus)
                if run_smoke_tests "${APP_NAME}-service" ${NAMESPACE}; then
                    echo "‚úÖ Canary metrics look good, promoting to stable"
                    
                    # –û–±–Ω–æ–≤–∏—Ç—å stable –≤–µ—Ä—Å–∏—é
                    sed -i "s|${REGISTRY}/${APP_NAME}:.*|${REGISTRY}/${APP_NAME}:${IMAGE_TAG}|g" k8s/canary/stable-deployment.yaml
                    kubectl apply -f k8s/canary/stable-deployment.yaml -n ${NAMESPACE}
                    
                    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å stable
                    if check_readiness "${APP_NAME}-stable" ${NAMESPACE}; then
                        # –£–¥–∞–ª–∏—Ç—å canary
                        kubectl delete deployment ${APP_NAME}-canary -n ${NAMESPACE}
                        echo "‚úÖ Canary deployment promoted successfully"
                    else
                        echo "‚ùå Failed to promote canary to stable"
                        exit 1
                    fi
                else
                    echo "‚ùå Canary metrics failed, rolling back..."
                    kubectl delete deployment ${APP_NAME}-canary -n ${NAMESPACE}
                    exit 1
                fi
            else
                echo "‚ùå Canary deployment failed"
                exit 1
            fi
            ;;
            
        *)
            echo "‚ùå Unknown deployment strategy: ${DEPLOYMENT_STRATEGY}"
            exit 1
            ;;
    esac
}

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
if ! command -v kubectl &> /dev/null; then
    echo "‚ùå kubectl is not installed"
    exit 1
fi

if ! command -v curl &> /dev/null; then
    echo "‚ùå curl is not installed"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–ª–∞—Å—Ç–µ—Ä—É
if ! kubectl cluster-info &> /dev/null; then
    echo "‚ùå Cannot connect to Kubernetes cluster"
    exit 1
fi

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
deploy_application

echo "üéâ Deployment completed successfully!"
```

### **2. –°–∫—Ä–∏–ø—Ç –æ—Ç–∫–∞—Ç–∞:**
```bash
#!/bin/bash
# scripts/rollback.sh

set -e

NAMESPACE=${NAMESPACE:-webapp-production}
APP_NAME=${APP_NAME:-webapp}
REVISION=${REVISION:-}

echo "üîÑ Starting rollback of ${APP_NAME} in ${NAMESPACE}"

# –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π
echo "üìú Deployment history:"
kubectl rollout history deployment/${APP_NAME} -n ${NAMESPACE}

# –í—ã–ø–æ–ª–Ω–∏—Ç—å –æ—Ç–∫–∞—Ç
if [ -n "${REVISION}" ]; then
    echo "üîÑ Rolling back to revision ${REVISION}"
    kubectl rollout undo deployment/${APP_NAME} -n ${NAMESPACE} --to-revision=${REVISION}
else
    echo "üîÑ Rolling back to previous revision"
    kubectl rollout undo deployment/${APP_NAME} -n ${NAMESPACE}
fi

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –æ—Ç–∫–∞—Ç–∞
echo "‚è≥ Waiting for rollback to complete..."
kubectl rollout status deployment/${APP_NAME} -n ${NAMESPACE} --timeout=300s

if [ $? -eq 0 ]; then
    echo "‚úÖ Rollback completed successfully"
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–¥–æ–≤
    kubectl get pods -n ${NAMESPACE} -l app=${APP_NAME}
    
    # –ó–∞–ø—É—Å—Ç–∏—Ç—å smoke tests
    echo "üß™ Running post-rollback smoke tests..."
    kubectl port-forward svc/${APP_NAME}-service 8080:80 -n ${NAMESPACE} &
    local pf_pid=$!
    
    sleep 10
    
    if curl -f http://localhost:8080/health; then
        echo "‚úÖ Post-rollback health check passed"
    else
        echo "‚ùå Post-rollback health check failed"
        kill $pf_pid
        exit 1
    fi
    
    kill $pf_pid
    echo "üéâ Rollback verification completed successfully!"
else
    echo "‚ùå Rollback failed"
    exit 1
fi
```

## üéØ **Best Practices –¥–ª—è Kubernetes CI/CD:**

### **1. –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```bash
# –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
docker build -t hashfoundry/webapp:v1.2.3 .
docker build -t hashfoundry/webapp:v1.2.3-${GIT_COMMIT} .

# –ò–∑–±–µ–≥–∞—Ç—å latest –≤ production
# ‚ùå –ü–ª–æ—Ö–æ
image: hashfoundry/webapp:latest

# ‚úÖ –•–æ—Ä–æ—à–æ
image: hashfoundry/webapp:v1.2.3

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Git commit hash
IMAGE_TAG=${GIT_COMMIT_SHA:-$(git rev-parse --short HEAD)}
docker build -t hashfoundry/webapp:${IMAGE_TAG} .
```

### **2. –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```bash
# –í–∞–ª–∏–¥–∞—Ü–∏—è YAML –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤
kubectl apply --dry-run=client -f k8s/
kubectl apply --dry-run=server -f k8s/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å kubeval
kubeval k8s/*.yaml

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å kubesec
kubesec scan k8s/deployment.yaml

# –õ–∏–Ω—Ç–∏–Ω–≥ Helm charts
helm lint ./helm

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Dockerfile
hadolint src/Dockerfile
```

### **3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã:**
```yaml
# Prometheus AlertManager –ø—Ä–∞–≤–∏–ª–∞
groups:
- name: deployment.rules
  rules:
  - alert: DeploymentReplicasMismatch
    expr: kube_deployment_status_replicas != kube_deployment_status_replicas_available
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Deployment {{ $labels.deployment }} has mismatched replicas"
      
  - alert: PodCrashLooping
    expr: rate(kube_pod_container_status_restarts_total[15m]) > 0
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: "Pod {{ $labels.pod }} is crash looping"
```

## üèóÔ∏è **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ CI/CD –≤ –≤–∞—à–µ–º –∫–ª–∞—Å—Ç–µ—Ä–µ:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    HashFoundry HA Cluster                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  CI/CD Pipeline Architecture                                ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  ‚îÇ   Source    ‚îÇ    ‚îÇ    Build    ‚îÇ    ‚îÇ   Deploy    ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ             ‚îÇ    ‚îÇ             ‚îÇ    ‚îÇ             ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ    ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ    ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ ‚îÇ   Git   ‚îÇ ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ ‚îÇ Docker  ‚îÇ ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ ‚îÇArgoCD/  ‚îÇ ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ ‚îÇ Repo    ‚îÇ ‚îÇ    ‚îÇ ‚îÇ Build   ‚îÇ ‚îÇ    ‚îÇ ‚îÇkubectl  ‚îÇ ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ    ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ    ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ             ‚îÇ    ‚îÇ             ‚îÇ    ‚îÇ             ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ    ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ    ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ ‚îÇWebhooks ‚îÇ ‚îÇ    ‚îÇ ‚îÇ Tests   ‚îÇ ‚îÇ    ‚îÇ ‚îÇ Health  ‚îÇ ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ ‚îÇ         ‚îÇ ‚îÇ    ‚îÇ ‚îÇSecurity ‚îÇ ‚îÇ    ‚îÇ ‚îÇ Checks  ‚îÇ ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ    ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ    ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  Deployment Strategies:                                     ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Rolling Update (default)                               ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Blue-Green (zero downtime)                             ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Canary (gradual rollout)                               ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  Monitoring & Observability:                                ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Prometheus (metrics)                                   ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Grafana (dashboards)                                   ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ ArgoCD (GitOps status)                                 ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Kubernetes Events                                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üéØ **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ:**

**Kubernetes CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∏ –Ω–∞–¥–µ–∂–Ω—É—é –¥–æ—Å—Ç–∞–≤–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π:

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
1. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** - –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ—Ç –∫–æ–¥–∞ –¥–æ production
2. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –æ—Ç–∫–∞—Ç—ã
3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ RBAC
5. **–ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å** - –ø–æ–ª–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å–∞

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ HashFoundry HA –∫–ª–∞—Å—Ç–µ—Ä–µ:**
- **ArgoCD** –¥–ª—è GitOps —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π
- **Prometheus/Grafana** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **NGINX Ingress** –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞
- **Helm** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–∫–µ—Ç–∞–º–∏

CI/CD —Å Kubernetes –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≤ –Ω–∞–¥–µ–∂–Ω—ã–π, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–π –ø—Ä–æ—Ü–µ—Å—Å.
