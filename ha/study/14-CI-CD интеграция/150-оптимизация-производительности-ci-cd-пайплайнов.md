# 150. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ CI/CD –ø–∞–π–ø–ª–∞–π–Ω–æ–≤

## üéØ **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**

| –ê—Å–ø–µ–∫—Ç | –ù–µ–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ | –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ |
|--------|---------------------------|-------------------------|
| **–°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤** | –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è + –º–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω–∞—è —Å–±–æ—Ä–∫–∞ |
| **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** | –ë–µ–∑ –∫—ç—à–∞ | –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π |
| **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** | –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø–æ –≥—Ä—É–ø–ø–∞–º |
| **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ** | –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ | –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |
| **–†–µ—Å—É—Ä—Å—ã** | –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ |
| **–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã** | –ü–æ–≤—Ç–æ—Ä–Ω–∞—è —Å–±–æ—Ä–∫–∞ | –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ |
| **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** | –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞–∂–¥—ã–π —Ä–∞–∑ | –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ |
| **–û–±—Ä–∞–∑—ã Docker** | –ë–æ–ª—å—à–∏–µ –æ–±—Ä–∞–∑—ã | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–∑—ã |
| **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** | –ë–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ | –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ |
| **–°—Ç—Ä–∞—Ç–µ–≥–∏—è** | –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–µ –ø–∞–π–ø–ª–∞–π–Ω—ã | –ú–æ–¥—É–ª—å–Ω—ã–µ –º–∏–∫—Ä–æ-–ø–∞–π–ø–ª–∞–π–Ω—ã |

## üèÜ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è CI/CD - —á—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?**

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ CI/CD –ø–∞–π–ø–ª–∞–π–Ω–æ–≤** ‚Äî —ç—Ç–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —É—Å–∫–æ—Ä–µ–Ω–∏—é –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç–∞–≤–∫–∏ —á–µ—Ä–µ–∑ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–µ—Ö–Ω–∏–∫ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è, –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏–∏, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è —É–∑–∫–∏—Ö –º–µ—Å—Ç, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—é –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç –∫–æ–º–º–∏—Ç–∞ –¥–æ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –∏ –ø–æ–≤—ã—à–µ–Ω–∏—é —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

### **–ö–ª—é—á–µ–≤—ã–µ –æ–±–ª–∞—Å—Ç–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
1. **Build Optimization** - —É—Å–∫–æ—Ä–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–±–æ—Ä–∫–∏
2. **Test Optimization** - –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
3. **Caching Strategies** - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
4. **Resource Management** - –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
5. **Pipeline Architecture** - –º–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–∞–π–ø–ª–∞–π–Ω–æ–≤
6. **Artifact Management** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞–º–∏

## üìä **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –≤–∞—à–µ–≥–æ HA –∫–ª–∞—Å—Ç–µ—Ä–∞:**

### **1. –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ ArgoCD:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ ArgoCD –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
kubectl get applications -n argocd -o custom-columns=NAME:.metadata.name,SYNC:.status.sync.status,HEALTH:.status.health.status,LAST_SYNC:.status.operationState.finishedAt

# –ê–Ω–∞–ª–∏–∑ —Ä–µ—Å—É—Ä—Å–æ–≤ ArgoCD
kubectl top pods -n argocd

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π ArgoCD
kubectl get applications -n argocd -o jsonpath='{range .items[*]}{.metadata.name}{"\t"}{.status.operationState.operation.sync.revision}{"\t"}{.status.operationState.finishedAt}{"\n"}{end}'

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
kubectl get events -n argocd --sort-by='.lastTimestamp' | grep -E "Sync|Deploy" | tail -20
```

### **2. –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ —É–∑–ª–æ–≤
kubectl top nodes

# –ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–ø—É—Å–∫–∞ –ø–æ–¥–æ–≤
kubectl get pods --all-namespaces -o custom-columns=NAME:.metadata.name,NAMESPACE:.metadata.namespace,AGE:.metadata.creationTimestamp,STATUS:.status.phase

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤
kubectl describe pods -n argocd | grep -A 5 -B 5 "Pulling\|Pulled"

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–µ–≤–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
kubectl get pods -n argocd -o wide
```

### **3. –ê–Ω–∞–ª–∏–∑ Helm —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ Helm –æ–ø–µ—Ä–∞—Ü–∏–π
helm list --all-namespaces -o json | jq '.[] | {name: .name, namespace: .namespace, updated: .updated, status: .status}'

# –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–º–µ—Ä–æ–≤ Helm —á–∞—Ä—Ç–æ–≤
find ha/k8s/addons -name "*.yaml" -exec wc -l {} + | sort -n

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞ Helm
helm repo list
```

### üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Docker –æ–±—Ä–∞–∑–æ–≤

#### 1. **–ú–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω–∞—è —Å–±–æ—Ä–∫–∞**
```dockerfile
# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Dockerfile
# –≠—Ç–∞–ø 1: –°–±–æ—Ä–∫–∞
FROM node:18-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production && npm cache clean --force
COPY . .
RUN npm run build

# –≠—Ç–∞–ø 2: –ü—Ä–æ–¥–∞–∫—à–µ–Ω
FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

#### 2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–ª–æ–µ–≤**
```dockerfile
# ‚ùå –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ - –∫–∞–∂–¥–∞—è –∫–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞–µ—Ç —Å–ª–æ–π
FROM node:18-alpine
RUN apk add --no-cache git
RUN apk add --no-cache python3
RUN apk add --no-cache make
RUN apk add --no-cache g++

# ‚úÖ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥
FROM node:18-alpine
RUN apk add --no-cache \
    git \
    python3 \
    make \
    g++ \
    && rm -rf /var/cache/apk/*
```

### üìä –ü—Ä–∏–º–µ—Ä—ã –∏–∑ –Ω–∞—à–µ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞

#### –ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–æ–≤:
```bash
docker history myapp:latest --format "table {{.CreatedBy}}\t{{.Size}}"
```

#### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏:
```bash
kubectl top pods -n jenkins
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞ Docker:
```bash
docker system df
```

### üéØ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

#### 1. **GitHub Actions –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**
```yaml
# .github/workflows/optimized-build.yml
name: Optimized Build

on:
  push:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ Node.js –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    - name: Cache Node modules
      uses: actions/cache@v3
      with:
        path: ~/.npm
        key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
        restore-keys: |
          ${{ runner.os }}-node-
    
    # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ Docker —Å–ª–æ–µ–≤
    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v2
    
    - name: Build and push
      uses: docker/build-push-action@v4
      with:
        context: .
        push: true
        tags: myregistry/myapp:${{ github.sha }}
        cache-from: type=gha
        cache-to: type=gha,mode=max
    
    # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    - name: Cache test data
      uses: actions/cache@v3
      with:
        path: test-data/
        key: test-data-${{ hashFiles('test-data/**') }}
```

#### 2. **Jenkins –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**
```groovy
// Jenkinsfile —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
pipeline {
    agent any
    
    stages {
        stage('Cache Dependencies') {
            steps {
                script {
                    // –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ npm –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
                    def cacheKey = sh(
                        script: "sha256sum package-lock.json | cut -d' ' -f1",
                        returnStdout: true
                    ).trim()
                    
                    if (fileExists("cache/node_modules_${cacheKey}.tar.gz")) {
                        echo "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
                        sh "tar -xzf cache/node_modules_${cacheKey}.tar.gz"
                    } else {
                        echo "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
                        sh "npm ci"
                        sh "mkdir -p cache"
                        sh "tar -czf cache/node_modules_${cacheKey}.tar.gz node_modules/"
                    }
                }
            }
        }
        
        stage('Build with Cache') {
            steps {
                sh '''
                    # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ BuildKit –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è Docker
                    export DOCKER_BUILDKIT=1
                    docker build \
                      --cache-from myregistry/myapp:cache \
                      --tag myregistry/myapp:${BUILD_NUMBER} \
                      --tag myregistry/myapp:cache \
                      .
                '''
            }
        }
    }
}
```

### üîÑ –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á

#### 1. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã**
```yaml
# .github/workflows/parallel-tests.yml
name: Parallel Tests

on:
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        test-group: [unit, integration, e2e]
        node-version: [16, 18, 20]
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-node@v3
      with:
        node-version: ${{ matrix.node-version }}
    
    - name: Install dependencies
      run: npm ci
    
    - name: Run tests
      run: npm run test:${{ matrix.test-group }}
```

#### 2. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**
```yaml
# docker-compose.build.yml –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–∏
version: '3.8'
services:
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    image: myregistry/frontend:${TAG}
  
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    image: myregistry/backend:${TAG}
  
  worker:
    build:
      context: ./worker
      dockerfile: Dockerfile
    image: myregistry/worker:${TAG}
```

```bash
#!/bin/bash
# parallel-build.sh

echo "üöÄ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤..."

# –°–±–æ—Ä–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
docker-compose -f docker-compose.build.yml build --parallel

# –ü—É—à –æ–±—Ä–∞–∑–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
docker-compose -f docker-compose.build.yml push &
PUSH_PID=$!

# –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
wait $PUSH_PID

echo "‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
```

### üé™ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Kubernetes —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π

#### 1. **–ë—ã—Å—Ç—Ä—ã–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è**
```yaml
# fast-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: fast-app
spec:
  replicas: 3
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 0
      maxSurge: 2  # –ë—ã—Å—Ç—Ä–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
  template:
    spec:
      containers:
      - name: app
        image: myapp:latest
        readinessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 5  # –ë—ã—Å—Ç—Ä–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å
          periodSeconds: 2
        livenessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 10
          periodSeconds: 10
        resources:
          requests:
            cpu: 100m
            memory: 128Mi
          limits:
            cpu: 500m
            memory: 512Mi
```

#### 2. **–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤**
```yaml
# image-puller-daemonset.yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: image-puller
spec:
  selector:
    matchLabels:
      app: image-puller
  template:
    metadata:
      labels:
        app: image-puller
    spec:
      initContainers:
      - name: pull-images
        image: docker:dind
        command:
        - sh
        - -c
        - |
          docker pull myregistry/myapp:latest
          docker pull myregistry/worker:latest
          docker pull nginx:alpine
        volumeMounts:
        - name: docker-sock
          mountPath: /var/run/docker.sock
      containers:
      - name: sleep
        image: alpine
        command: ["sleep", "infinity"]
      volumes:
      - name: docker-sock
        hostPath:
          path: /var/run/docker.sock
```

### üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### 1. **–ú–µ—Ç—Ä–∏–∫–∏ –ø–∞–π–ø–ª–∞–π–Ω–∞**
```javascript
// pipeline-metrics.js
const prometheus = require('prom-client');

// –ú–µ—Ç—Ä–∏–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
const pipelineDuration = new prometheus.Histogram({
  name: 'pipeline_duration_seconds',
  help: 'Pipeline execution duration',
  labelNames: ['pipeline', 'stage', 'status'],
  buckets: [10, 30, 60, 120, 300, 600, 1200]
});

// –ú–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
const resourceUsage = new prometheus.Gauge({
  name: 'pipeline_resource_usage',
  help: 'Pipeline resource usage',
  labelNames: ['pipeline', 'resource_type']
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø–∏—Å–∏ –º–µ—Ç—Ä–∏–∫
function recordPipelineMetrics(pipeline, stage, duration, status) {
  pipelineDuration
    .labels(pipeline, stage, status)
    .observe(duration);
}

// –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫
app.get('/metrics', (req, res) => {
  res.set('Content-Type', prometheus.register.contentType);
  res.end(prometheus.register.metrics());
});
```

#### 2. **Dashboard –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
```json
{
  "dashboard": {
    "title": "CI/CD Performance",
    "panels": [
      {
        "title": "Pipeline Duration Trend",
        "type": "graph",
        "targets": [
          {
            "expr": "avg(pipeline_duration_seconds) by (pipeline)"
          }
        ]
      },
      {
        "title": "Build Cache Hit Rate",
        "type": "stat",
        "targets": [
          {
            "expr": "rate(build_cache_hits_total[5m]) / rate(build_cache_requests_total[5m]) * 100"
          }
        ]
      },
      {
        "title": "Resource Utilization",
        "type": "graph",
        "targets": [
          {
            "expr": "pipeline_resource_usage{resource_type=\"cpu\"}"
          },
          {
            "expr": "pipeline_resource_usage{resource_type=\"memory\"}"
          }
        ]
      }
    ]
  }
}
```

### üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### 1. **–ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–º–µ—Ä–∞ –æ–±—Ä–∞–∑–æ–≤**
```bash
#!/bin/bash
# analyze-image-size.sh

IMAGE="$1"

echo "üìä –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–º–µ—Ä–∞ –æ–±—Ä–∞–∑–∞: $IMAGE"

# –†–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞
echo "–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä:"
docker images $IMAGE --format "table {{.Repository}}\t{{.Tag}}\t{{.Size}}"

# –ê–Ω–∞–ª–∏–∑ —Å–ª–æ–µ–≤
echo -e "\nüìã –ê–Ω–∞–ª–∏–∑ —Å–ª–æ–µ–≤:"
docker history $IMAGE --format "table {{.CreatedBy}}\t{{.Size}}" --no-trunc

# –ü–æ–∏—Å–∫ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
echo -e "\nüîç –ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã –≤ –æ–±—Ä–∞–∑–µ:"
docker run --rm $IMAGE find / -type f -size +10M 2>/dev/null | head -10

# –ê–Ω–∞–ª–∏–∑ —Å dive (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
if command -v dive &> /dev/null; then
    echo -e "\nüèóÔ∏è –ó–∞–ø—É—Å–∫ dive –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞..."
    dive $IMAGE
fi
```

#### 2. **–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–±–æ—Ä–∫–∏**
```bash
#!/bin/bash
# profile-build.sh

echo "‚è±Ô∏è –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–±–æ—Ä–∫–∏..."

# –í–∫–ª—é—á–µ–Ω–∏–µ BuildKit –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –ª–æ–≥–æ–≤
export DOCKER_BUILDKIT=1

# –°–±–æ—Ä–∫–∞ —Å –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º
docker build \
  --progress=plain \
  --no-cache \
  -t myapp:profile \
  . 2>&1 | tee build.log

# –ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
echo -e "\nüìä –ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:"
grep -E "^\#[0-9]+" build.log | \
  awk '{print $1, $2, $3}' | \
  sort -k3 -nr | \
  head -10
```

### üéØ –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### 1. **–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è**
```yaml
# –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ CI/CD
caching_strategies:
  dependencies:
    - npm_modules: "package-lock.json hash"
    - maven_deps: "pom.xml hash"
    - pip_packages: "requirements.txt hash"
  
  build_artifacts:
    - compiled_code: "source code hash"
    - test_results: "test files hash"
    - docker_layers: "Dockerfile + context hash"
  
  infrastructure:
    - terraform_state: "tf files hash"
    - helm_charts: "Chart.yaml + values hash"
```

#### 2. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**
```bash
#!/bin/bash
# auto-optimize.sh

echo "üîß –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–π–ø–ª–∞–π–Ω–∞..."

# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∫—ç—à–µ–π
find cache/ -type f -mtime +7 -delete

# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Docker –æ–±—Ä–∞–∑–æ–≤
docker system prune -f
docker builder prune -f

# –ê–Ω–∞–ª–∏–∑ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Dockerfile
if command -v hadolint &> /dev/null; then
    hadolint Dockerfile
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ –æ–±—Ä–∞–∑–æ–≤
docker images --format "table {{.Repository}}\t{{.Tag}}\t{{.Size}}" | \
  sort -k3 -hr | head -10

echo "‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
```

### üìã –ß–µ–∫-–ª–∏—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### 1. **Docker –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**
- ‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω—É—é —Å–±–æ—Ä–∫—É** –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
- ‚úÖ **–û–±—ä–µ–¥–∏–Ω—è–π—Ç–µ RUN –∫–æ–º–∞–Ω–¥—ã** –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ —Å–ª–æ–µ–≤
- ‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ .dockerignore** –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–µ–Ω—É–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ **–í—ã–±–∏—Ä–∞–π—Ç–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –±–∞–∑–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã** (alpine, distroless)
- ‚úÖ **–ö—ç—à–∏—Ä—É–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –∫–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

#### 2. **CI/CD –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**
- ‚úÖ **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∏—Ä—É–π—Ç–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –∑–∞–¥–∞—á–∏**
- ‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ —Ç–µ—Å—Ç—ã** (–±—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã –ø–µ—Ä–≤—ã–º–∏)
- ‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—É—é —Å–±–æ—Ä–∫—É**
- ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –ø–∞–π–ø–ª–∞–π–Ω–æ–≤

#### 3. **Kubernetes –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**
- ‚úÖ **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ resource requests/limits**
- ‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ readiness/liveness probes**
- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è**
- ‚úÖ **–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Å–∫–∞—á–∏–≤–∞–π—Ç–µ –æ–±—Ä–∞–∑—ã**
- ‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HPA –¥–ª—è –∞–≤—Ç–æ–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è**

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ CI/CD –ø–∞–π–ø–ª–∞–π–Ω–æ–≤ —Ç—Ä–µ–±—É–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, –∞–Ω–∞–ª–∏–∑–∞ —É–∑–∫–∏—Ö –º–µ—Å—Ç –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ª—É—á—à–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –±—ã—Å—Ç—Ä–æ–π –∏ –Ω–∞–¥–µ–∂–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏.
