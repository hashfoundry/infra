# 58. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏ ConfigMaps –∏ Secrets

## üéØ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏ ConfigMaps –∏ Secrets**

**–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ConfigMaps –∏ Secrets** - —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–∫–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ Kubernetes. –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏ –ø–æ–º–æ–≥–∞–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

## üèóÔ∏è **–û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:**

### **1. –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å –≤–µ—Ä—Å–∏—è–º–∏ (Versioned Naming)**
### **2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ labels –∏ annotations**
### **3. Immutable ConfigMaps –∏ Secrets**
### **4. GitOps –ø–æ–¥—Ö–æ–¥ —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º**
### **5. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏**

## üìä **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –≤–∞—à–µ–≥–æ HA –∫–ª–∞—Å—Ç–µ—Ä–∞:**

### **1. –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å—Ä–µ–¥—ã:**
```bash
# –°–æ–∑–¥–∞—Ç—å namespace –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
kubectl create namespace config-versioning-demo

# –°–æ–∑–¥–∞—Ç—å –Ω–∞—á–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é ConfigMap —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∏–º–µ–Ω–µ–º
kubectl create configmap app-config-v1 \
  --from-literal=app.name="HashFoundry Application" \
  --from-literal=app.version="1.0.0" \
  --from-literal=app.environment="development" \
  --from-literal=database.host="postgres-dev.hashfoundry.local" \
  --from-literal=database.port="5432" \
  --from-literal=feature.flags="feature1=true,feature2=false" \
  --from-literal=config.version="v1" \
  -n config-versioning-demo

# –î–æ–±–∞–≤–∏—Ç—å labels –∏ annotations –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
kubectl label configmap app-config-v1 \
  app.kubernetes.io/name=hashfoundry-app \
  app.kubernetes.io/version=1.0.0 \
  config.hashfoundry.io/version=v1 \
  config.hashfoundry.io/environment=development \
  -n config-versioning-demo

kubectl annotate configmap app-config-v1 \
  config.hashfoundry.io/created-by="DevOps Team" \
  config.hashfoundry.io/description="Initial development configuration" \
  config.hashfoundry.io/changelog="Initial version with basic settings" \
  config.hashfoundry.io/git-commit="abc123def456" \
  -n config-versioning-demo

# –°–æ–∑–¥–∞—Ç—å –Ω–∞—á–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é Secret
kubectl create secret generic app-secrets-v1 \
  --from-literal=database.username="dev_user" \
  --from-literal=database.password="dev_password_123" \
  --from-literal=api.key="dev_api_key_456" \
  --from-literal=jwt.secret="dev_jwt_secret_789" \
  -n config-versioning-demo

# –î–æ–±–∞–≤–∏—Ç—å labels –∏ annotations –¥–ª—è Secret
kubectl label secret app-secrets-v1 \
  app.kubernetes.io/name=hashfoundry-app \
  app.kubernetes.io/version=1.0.0 \
  config.hashfoundry.io/version=v1 \
  config.hashfoundry.io/environment=development \
  -n config-versioning-demo

kubectl annotate secret app-secrets-v1 \
  config.hashfoundry.io/created-by="Security Team" \
  config.hashfoundry.io/description="Development environment secrets" \
  config.hashfoundry.io/changelog="Initial secrets for development" \
  config.hashfoundry.io/git-commit="abc123def456" \
  -n config-versioning-demo

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
kubectl get configmaps,secrets -n config-versioning-demo --show-labels
```

### **2. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏–π —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ–º:**
```bash
# –°–æ–∑–¥–∞—Ç—å –≤–µ—Ä—Å–∏—é v2 ConfigMap —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
kubectl create configmap app-config-v2 \
  --from-literal=app.name="HashFoundry Application" \
  --from-literal=app.version="2.0.0" \
  --from-literal=app.environment="staging" \
  --from-literal=database.host="postgres-staging.hashfoundry.local" \
  --from-literal=database.port="5432" \
  --from-literal=feature.flags="feature1=true,feature2=true,feature3=true" \
  --from-literal=cache.enabled="true" \
  --from-literal=cache.ttl="3600" \
  --from-literal=monitoring.enabled="true" \
  --from-literal=config.version="v2" \
  -n config-versioning-demo

# –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è v2
kubectl label configmap app-config-v2 \
  app.kubernetes.io/name=hashfoundry-app \
  app.kubernetes.io/version=2.0.0 \
  config.hashfoundry.io/version=v2 \
  config.hashfoundry.io/environment=staging \
  config.hashfoundry.io/previous-version=v1 \
  -n config-versioning-demo

kubectl annotate configmap app-config-v2 \
  config.hashfoundry.io/created-by="DevOps Team" \
  config.hashfoundry.io/description="Staging configuration with enhanced features" \
  config.hashfoundry.io/changelog="Added caching, monitoring, and new feature flags" \
  config.hashfoundry.io/git-commit="def456ghi789" \
  config.hashfoundry.io/migration-notes="Requires cache service deployment" \
  -n config-versioning-demo

# –°–æ–∑–¥–∞—Ç—å –≤–µ—Ä—Å–∏—é v2 Secret
kubectl create secret generic app-secrets-v2 \
  --from-literal=database.username="staging_user" \
  --from-literal=database.password="staging_password_456" \
  --from-literal=api.key="staging_api_key_789" \
  --from-literal=jwt.secret="staging_jwt_secret_abc" \
  --from-literal=cache.password="cache_password_def" \
  --from-literal=monitoring.token="monitoring_token_ghi" \
  -n config-versioning-demo

kubectl label secret app-secrets-v2 \
  app.kubernetes.io/name=hashfoundry-app \
  app.kubernetes.io/version=2.0.0 \
  config.hashfoundry.io/version=v2 \
  config.hashfoundry.io/environment=staging \
  config.hashfoundry.io/previous-version=v1 \
  -n config-versioning-demo

kubectl annotate secret app-secrets-v2 \
  config.hashfoundry.io/created-by="Security Team" \
  config.hashfoundry.io/description="Staging secrets with additional services" \
  config.hashfoundry.io/changelog="Added cache and monitoring credentials" \
  config.hashfoundry.io/git-commit="def456ghi789" \
  -n config-versioning-demo

# –°–æ–∑–¥–∞—Ç—å –≤–µ—Ä—Å–∏—é v3 –¥–ª—è production
kubectl create configmap app-config-v3 \
  --from-literal=app.name="HashFoundry Application" \
  --from-literal=app.version="3.0.0" \
  --from-literal=app.environment="production" \
  --from-literal=database.host="postgres-prod-cluster.hashfoundry.local" \
  --from-literal=database.port="5432" \
  --from-literal=feature.flags="feature1=true,feature2=true,feature3=true,feature4=true" \
  --from-literal=cache.enabled="true" \
  --from-literal=cache.ttl="7200" \
  --from-literal=monitoring.enabled="true" \
  --from-literal=security.enhanced="true" \
  --from-literal=backup.enabled="true" \
  --from-literal=config.version="v3" \
  -n config-versioning-demo

kubectl label configmap app-config-v3 \
  app.kubernetes.io/name=hashfoundry-app \
  app.kubernetes.io/version=3.0.0 \
  config.hashfoundry.io/version=v3 \
  config.hashfoundry.io/environment=production \
  config.hashfoundry.io/previous-version=v2 \
  config.hashfoundry.io/stability=stable \
  -n config-versioning-demo

kubectl annotate configmap app-config-v3 \
  config.hashfoundry.io/created-by="DevOps Team" \
  config.hashfoundry.io/description="Production configuration with full feature set" \
  config.hashfoundry.io/changelog="Added security enhancements and backup configuration" \
  config.hashfoundry.io/git-commit="ghi789jkl012" \
  config.hashfoundry.io/approved-by="Tech Lead" \
  config.hashfoundry.io/release-date="$(date -u +%Y-%m-%dT%H:%M:%SZ)" \
  -n config-versioning-demo

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –≤–µ—Ä—Å–∏–∏
kubectl get configmaps -n config-versioning-demo -o custom-columns="NAME:.metadata.name,VERSION:.metadata.labels.config\.hashfoundry\.io/version,ENVIRONMENT:.metadata.labels.config\.hashfoundry\.io/environment,AGE:.metadata.creationTimestamp"
```

### **3. –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π:**
```bash
# –°–æ–∑–¥–∞—Ç—å Deployment, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π –≤–µ—Ä—Å–∏—é v1
cat << EOF | kubectl apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: app-v1
  namespace: config-versioning-demo
  labels:
    app: hashfoundry-app
    version: v1
spec:
  replicas: 2
  selector:
    matchLabels:
      app: hashfoundry-app
      version: v1
  template:
    metadata:
      labels:
        app: hashfoundry-app
        version: v1
      annotations:
        config.hashfoundry.io/config-version: v1
        config.hashfoundry.io/secret-version: v1
    spec:
      containers:
      - name: app
        image: nginx:1.21
        ports:
        - containerPort: 80
        env:
        - name: APP_NAME
          valueFrom:
            configMapKeyRef:
              name: app-config-v1
              key: app.name
        - name: APP_VERSION
          valueFrom:
            configMapKeyRef:
              name: app-config-v1
              key: app.version
        - name: APP_ENVIRONMENT
          valueFrom:
            configMapKeyRef:
              name: app-config-v1
              key: app.environment
        - name: CONFIG_VERSION
          valueFrom:
            configMapKeyRef:
              name: app-config-v1
              key: config.version
        - name: DATABASE_USERNAME
          valueFrom:
            secretKeyRef:
              name: app-secrets-v1
              key: database.username
        volumeMounts:
        - name: config-volume
          mountPath: /etc/app-config
          readOnly: true
        - name: secret-volume
          mountPath: /etc/app-secrets
          readOnly: true
        command: ["sh", "-c"]
        args:
        - |
          cat > /usr/share/nginx/html/index.html << 'HTML_EOF'
          <!DOCTYPE html>
          <html>
          <head>
              <title>HashFoundry App - Version Tracking</title>
              <style>
                  body { font-family: Arial, sans-serif; margin: 40px; }
                  .version-info { background: #e8f4fd; padding: 20px; border-radius: 5px; margin: 20px 0; }
                  .config-info { background: #f0f8e8; padding: 15px; border-radius: 5px; margin: 10px 0; }
              </style>
          </head>
          <body>
              <h1>HashFoundry Application</h1>
              <div class="version-info">
                  <h2>Version Information</h2>
                  <p><strong>App Name:</strong> $APP_NAME</p>
                  <p><strong>App Version:</strong> $APP_VERSION</p>
                  <p><strong>Environment:</strong> $APP_ENVIRONMENT</p>
                  <p><strong>Config Version:</strong> $CONFIG_VERSION</p>
                  <p><strong>Pod:</strong> $(hostname)</p>
                  <p><strong>Database User:</strong> $DATABASE_USERNAME</p>
              </div>
              <div class="config-info">
                  <h3>Configuration Files</h3>
                  <p><strong>ConfigMap files:</strong></p>
                  <pre>$(ls -la /etc/app-config/ 2>/dev/null || echo 'No config files')</pre>
                  <p><strong>Secret files:</strong></p>
                  <pre>$(ls -la /etc/app-secrets/ 2>/dev/null || echo 'No secret files')</pre>
              </div>
          </body>
          </html>
          HTML_EOF
          
          nginx -g 'daemon off;'
        resources:
          requests:
            memory: "64Mi"
            cpu: "100m"
          limits:
            memory: "128Mi"
            cpu: "200m"
      volumes:
      - name: config-volume
        configMap:
          name: app-config-v1
      - name: secret-volume
        secret:
          secretName: app-secrets-v1
          defaultMode: 0600
EOF

# –°–æ–∑–¥–∞—Ç—å Deployment –¥–ª—è –≤–µ—Ä—Å–∏–∏ v2
cat << EOF | kubectl apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: app-v2
  namespace: config-versioning-demo
  labels:
    app: hashfoundry-app
    version: v2
spec:
  replicas: 2
  selector:
    matchLabels:
      app: hashfoundry-app
      version: v2
  template:
    metadata:
      labels:
        app: hashfoundry-app
        version: v2
      annotations:
        config.hashfoundry.io/config-version: v2
        config.hashfoundry.io/secret-version: v2
    spec:
      containers:
      - name: app
        image: nginx:1.21
        ports:
        - containerPort: 80
        env:
        - name: APP_NAME
          valueFrom:
            configMapKeyRef:
              name: app-config-v2
              key: app.name
        - name: APP_VERSION
          valueFrom:
            configMapKeyRef:
              name: app-config-v2
              key: app.version
        - name: APP_ENVIRONMENT
          valueFrom:
            configMapKeyRef:
              name: app-config-v2
              key: app.environment
        - name: CONFIG_VERSION
          valueFrom:
            configMapKeyRef:
              name: app-config-v2
              key: config.version
        - name: CACHE_ENABLED
          valueFrom:
            configMapKeyRef:
              name: app-config-v2
              key: cache.enabled
        - name: MONITORING_ENABLED
          valueFrom:
            configMapKeyRef:
              name: app-config-v2
              key: monitoring.enabled
        - name: DATABASE_USERNAME
          valueFrom:
            secretKeyRef:
              name: app-secrets-v2
              key: database.username
        volumeMounts:
        - name: config-volume
          mountPath: /etc/app-config
          readOnly: true
        - name: secret-volume
          mountPath: /etc/app-secrets
          readOnly: true
        command: ["sh", "-c"]
        args:
        - |
          cat > /usr/share/nginx/html/index.html << 'HTML_EOF'
          <!DOCTYPE html>
          <html>
          <head>
              <title>HashFoundry App V2 - Enhanced Features</title>
              <style>
                  body { font-family: Arial, sans-serif; margin: 40px; }
                  .version-info { background: #e8f4fd; padding: 20px; border-radius: 5px; margin: 20px 0; }
                  .feature-info { background: #fff3cd; padding: 15px; border-radius: 5px; margin: 10px 0; }
                  .config-info { background: #f0f8e8; padding: 15px; border-radius: 5px; margin: 10px 0; }
              </style>
          </head>
          <body>
              <h1>HashFoundry Application V2</h1>
              <div class="version-info">
                  <h2>Version Information</h2>
                  <p><strong>App Name:</strong> $APP_NAME</p>
                  <p><strong>App Version:</strong> $APP_VERSION</p>
                  <p><strong>Environment:</strong> $APP_ENVIRONMENT</p>
                  <p><strong>Config Version:</strong> $CONFIG_VERSION</p>
                  <p><strong>Pod:</strong> $(hostname)</p>
                  <p><strong>Database User:</strong> $DATABASE_USERNAME</p>
              </div>
              <div class="feature-info">
                  <h3>Enhanced Features</h3>
                  <p><strong>Cache Enabled:</strong> $CACHE_ENABLED</p>
                  <p><strong>Monitoring Enabled:</strong> $MONITORING_ENABLED</p>
                  <p><strong>Feature Flags:</strong> $(cat /etc/app-config/feature.flags 2>/dev/null || echo 'N/A')</p>
              </div>
              <div class="config-info">
                  <h3>Configuration Details</h3>
                  <p><strong>All ConfigMap keys:</strong></p>
                  <pre>$(ls /etc/app-config/ 2>/dev/null | sort || echo 'No config files')</pre>
                  <p><strong>All Secret keys:</strong></p>
                  <pre>$(ls /etc/app-secrets/ 2>/dev/null | sort || echo 'No secret files')</pre>
              </div>
          </body>
          </html>
          HTML_EOF
          
          nginx -g 'daemon off;'
        resources:
          requests:
            memory: "64Mi"
            cpu: "100m"
          limits:
            memory: "128Mi"
            cpu: "200m"
      volumes:
      - name: config-volume
        configMap:
          name: app-config-v2
      - name: secret-volume
        secret:
          secretName: app-secrets-v2
          defaultMode: 0600
EOF

# –°–æ–∑–¥–∞—Ç—å Services –¥–ª—è –∫–∞–∂–¥–æ–π –≤–µ—Ä—Å–∏–∏
cat << EOF | kubectl apply -f -
apiVersion: v1
kind: Service
metadata:
  name: app-v1-service
  namespace: config-versioning-demo
  labels:
    app: hashfoundry-app
    version: v1
spec:
  selector:
    app: hashfoundry-app
    version: v1
  ports:
  - port: 80
    targetPort: 80
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  name: app-v2-service
  namespace: config-versioning-demo
  labels:
    app: hashfoundry-app
    version: v2
spec:
  selector:
    app: hashfoundry-app
    version: v2
  ports:
  - port: 80
    targetPort: 80
  type: ClusterIP
EOF

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
kubectl get deployments,pods,services -n config-versioning-demo
```

### **4. –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏—è–º–∏:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏—è–º–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
cat << 'EOF' > config-version-manager.sh
#!/bin/bash

NAMESPACE="config-versioning-demo"

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Å–µ—Ö –≤–µ—Ä—Å–∏–π
list_versions() {
    echo "=== Available Configuration Versions ==="
    echo
    
    echo "ConfigMaps:"
    kubectl get configmaps -n $NAMESPACE \
        -o custom-columns="NAME:.metadata.name,VERSION:.metadata.labels.config\.hashfoundry\.io/version,ENVIRONMENT:.metadata.labels.config\.hashfoundry\.io/environment,AGE:.metadata.creationTimestamp" \
        | grep app-config | sed 's/^/  /'
    echo
    
    echo "Secrets:"
    kubectl get secrets -n $NAMESPACE \
        -o custom-columns="NAME:.metadata.name,VERSION:.metadata.labels.config\.hashfoundry\.io/version,ENVIRONMENT:.metadata.labels.config\.hashfoundry\.io/environment,AGE:.metadata.creationTimestamp" \
        | grep app-secrets | sed 's/^/  /'
    echo
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–µ—Ä—Å–∏–∏
describe_version() {
    local version=$1
    
    if [ -z "$version" ]; then
        echo "Usage: describe_version <version>"
        return 1
    fi
    
    echo "=== Configuration Version $version Details ==="
    echo
    
    # ConfigMap –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    echo "ConfigMap: app-config-$version"
    if kubectl get configmap app-config-$version -n $NAMESPACE >/dev/null 2>&1; then
        echo "  Labels:"
        kubectl get configmap app-config-$version -n $NAMESPACE -o jsonpath='{.metadata.labels}' | jq '.' | sed 's/^/    /'
        echo
        echo "  Annotations:"
        kubectl get configmap app-config-$version -n $NAMESPACE -o jsonpath='{.metadata.annotations}' | jq '.' | sed 's/^/    /'
        echo
        echo "  Data keys:"
        kubectl get configmap app-config-$version -n $NAMESPACE -o jsonpath='{.data}' | jq 'keys[]' | sed 's/^/    /'
        echo
    else
        echo "  ConfigMap not found"
    fi
    
    # Secret –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    echo "Secret: app-secrets-$version"
    if kubectl get secret app-secrets-$version -n $NAMESPACE >/dev/null 2>&1; then
        echo "  Labels:"
        kubectl get secret app-secrets-$version -n $NAMESPACE -o jsonpath='{.metadata.labels}' | jq '.' | sed 's/^/    /'
        echo
        echo "  Annotations:"
        kubectl get secret app-secrets-$version -n $NAMESPACE -o jsonpath='{.metadata.annotations}' | jq '.' | sed 's/^/    /'
        echo
        echo "  Data keys:"
        kubectl get secret app-secrets-$version -n $NAMESPACE -o jsonpath='{.data}' | jq 'keys[]' | sed 's/^/    /'
        echo
    else
        echo "  Secret not found"
    fi
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –≤–µ—Ä—Å–∏–π
compare_versions() {
    local version1=$1
    local version2=$2
    
    if [ -z "$version1" ] || [ -z "$version2" ]; then
        echo "Usage: compare_versions <version1> <version2>"
        return 1
    fi
    
    echo "=== Comparing Configuration Versions $version1 vs $version2 ==="
    echo
    
    # –°—Ä–∞–≤–Ω–∏—Ç—å ConfigMaps
    echo "ConfigMap Differences:"
    if kubectl get configmap app-config-$version1 -n $NAMESPACE >/dev/null 2>&1 && \
       kubectl get configmap app-config-$version2 -n $NAMESPACE >/dev/null 2>&1; then
        
        # –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ —Å—Ä–∞–≤–Ω–∏—Ç—å
        kubectl get configmap app-config-$version1 -n $NAMESPACE -o jsonpath='{.data}' > /tmp/config-$version1.json
        kubectl get configmap app-config-$version2 -n $NAMESPACE -o jsonpath='{.data}' > /tmp/config-$version2.json
        
        echo "  Keys in $version1 but not in $version2:"
        diff <(jq -r 'keys[]' /tmp/config-$version1.json | sort) <(jq -r 'keys[]' /tmp/config-$version2.json | sort) | grep "^<" | sed 's/^< /    /' || echo "    None"
        
        echo "  Keys in $version2 but not in $version1:"
        diff <(jq -r 'keys[]' /tmp/config-$version1.json | sort) <(jq -r 'keys[]' /tmp/config-$version2.json | sort) | grep "^>" | sed 's/^> /    /' || echo "    None"
        
        echo "  Common keys with different values:"
        for key in $(jq -r 'keys[]' /tmp/config-$version1.json); do
            if jq -e "has(\"$key\")" /tmp/config-$version2.json >/dev/null; then
                val1=$(jq -r ".[\"$key\"]" /tmp/config-$version1.json)
                val2=$(jq -r ".[\"$key\"]" /tmp/config-$version2.json)
                if [ "$val1" != "$val2" ]; then
                    echo "    $key: '$val1' -> '$val2'"
                fi
            fi
        done
        
        rm -f /tmp/config-$version1.json /tmp/config-$version2.json
    else
        echo "  One or both ConfigMaps not found"
    fi
    echo
    
    # –°—Ä–∞–≤–Ω–∏—Ç—å Secrets (—Ç–æ–ª—å–∫–æ –∫–ª—é—á–∏, –Ω–µ –∑–Ω–∞—á–µ–Ω–∏—è)
    echo "Secret Key Differences:"
    if kubectl get secret app-secrets-$version1 -n $NAMESPACE >/dev/null 2>&1 && \
       kubectl get secret app-secrets-$version2 -n $NAMESPACE >/dev/null 2>&1; then
        
        keys1=$(kubectl get secret app-secrets-$version1 -n $NAMESPACE -o jsonpath='{.data}' | jq -r 'keys[]' | sort)
        keys2=$(kubectl get secret app-secrets-$version2 -n $NAMESPACE -o jsonpath='{.data}' | jq -r 'keys[]' | sort)
        
        echo "  Keys in $version1 but not in $version2:"
        diff <(echo "$keys1") <(echo "$keys2") | grep "^<" | sed 's/^< /    /' || echo "    None"
        
        echo "  Keys in $version2 but not in $version1:"
        diff <(echo "$keys1") <(echo "$keys2") | grep "^>" | sed 's/^> /    /' || echo "    None"
    else
        echo "  One or both Secrets not found"
    fi
    echo
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π
create_new_version() {
    local base_version=$1
    local new_version=$2
    local environment=$3
    local description=$4
    
    if [ -z "$base_version" ] || [ -z "$new_version" ] || [ -z "$environment" ]; then
        echo "Usage: create_new_version <base_version> <new_version> <environment> [description]"
        return 1
    fi
    
    echo "=== Creating Configuration Version $new_version ==="
    echo "Base version: $base_version"
    echo "New version: $new_version"
    echo "Environment: $environment"
    echo "Description: $description"
    echo
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    if ! kubectl get configmap app-config-$base_version -n $NAMESPACE >/dev/null 2>&1; then
        echo "Error: Base ConfigMap app-config-$base_version not found"
        return 1
    fi
    
    if ! kubectl get secret app-secrets-$base_version -n $NAMESPACE >/dev/null 2>&1; then
        echo "Error: Base Secret app-secrets-$base_version not found"
        return 1
    fi
    
    # –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π ConfigMap –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ
    kubectl get configmap app-config-$base_version -n $NAMESPACE -o yaml | \
        sed "s/name: app-config-$base_version/name: app-config-$new_version/" | \
        sed '/resourceVersion:/d' | \
        sed '/uid:/d' | \
        sed '/creationTimestamp:/d' | \
        kubectl apply -f -
    
    # –û–±–Ω–æ–≤–∏—Ç—å labels –∏ annotations
    kubectl label configmap app-config-$new_version \
        config.hashfoundry.io/version=$new_version \
        config.hashfoundry.io/environment=$environment \
        config.hashfoundry.io/previous-version=$base_version \
        -n $NAMESPACE --overwrite
    
    kubectl annotate configmap app-config-$new_version \
        config.hashfoundry.io/description="$description" \
        config.hashfoundry.io/created-at="$(date -u +%Y-%m-%dT%H:%M:%SZ)" \
        config.hashfoundry.io/created-from="app-config-$base_version" \
        -n $NAMESPACE --overwrite
    
    # –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π Secret –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ
    kubectl get secret app-secrets-$base_version -n $NAMESPACE -o yaml | \
        sed "s/name: app-secrets-$base_version/name: app-secrets-$new_version/" | \
        sed '/resourceVersion:/d' | \
        sed '/uid:/d' | \
        sed '/creationTimestamp:/d' | \
        kubectl apply -f -
    
    # –û–±–Ω–æ–≤–∏—Ç—å labels –∏ annotations –¥–ª—è Secret
    kubectl label secret app-secrets-$new_version \
        config.hashfoundry.io/version=$new_version \
        config.hashfoundry.io/environment=$environment \
        config.hashfoundry.io/previous-version=$base_version \
        -n $NAMESPACE --overwrite
    
    kubectl annotate secret app-secrets-$new_version \
        config.hashfoundry.io/description="$description" \
        config.hashfoundry.io/created-at="$(date -u +%Y-%m-%dT%H:%M:%SZ)" \
        config.hashfoundry.io/created-from="app-secrets-$base_version" \
        -n $NAMESPACE --overwrite
    
    echo "‚úì Configuration version $new_version created successfully"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫–∞—Ç–∞ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏
rollback_deployment() {
    local deployment_name=$1
    local target_version=$2
    
    if [ -z "$deployment_name" ] || [ -z "$target_version" ]; then
        echo "Usage: rollback_deployment <deployment_name> <target_version>"
        return 1
    fi
    
    echo "=== Rolling back $deployment_name to version $target_version ==="
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ü–µ–ª–µ–≤–∞—è –≤–µ—Ä—Å–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    if ! kubectl get configmap app-config-$target_version -n $NAMESPACE >/dev/null 2>&1; then
        echo "Error: Target ConfigMap app-config-$target_version not found"
        return 1
    fi
    
    if ! kubectl get secret app-secrets-$target_version -n $NAMESPACE >/dev/null 2>&1; then
        echo "Error: Target Secret app-secrets-$target_version not found"
        return 1
    fi
    
    # –û–±–Ω–æ–≤–∏—Ç—å Deployment –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏
    kubectl patch deployment $deployment_name -n $NAMESPACE --type='merge' -p="{
        \"spec\": {
            \"template\": {
                \"metadata\": {
                    \"annotations\": {
                        \"config.hashfoundry.io/config-version\": \"$target_version\",
                        \"config.hashfoundry.io/secret-version\": \"$target_version\",
                        \"kubectl.kubernetes.io/restartedAt\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"
                    }
                },
                \"spec\": {
                    \"containers\": [{
                        \"name\": \"app\",
                        \"env\": [
                            {\"name\": \"APP_NAME\", \"valueFrom\": {\"configMapKeyRef\": {\"name\": \"app-config-$target_version\", \"key\": \"app.name\"}}},
                            {\"name\": \"APP_VERSION\", \"valueFrom\": {\"configMapKeyRef\": {\"name\": \"app-config-$target_version\", \"key\": \"app.version\"}}},
                            {\"name\": \"APP_ENVIRONMENT\", \"valueFrom\": {\"configMapKeyRef\": {\"name\": \"app-config-$target_version\", \"key\": \"app.environment\"}}},
                            {\"name\": \"CONFIG_VERSION\", \"valueFrom\": {\"configMapKeyRef\": {\"name\": \"app-config-$target_version\", \"key\": \"config.version\"}}},
                            {\"name\": \"DATABASE_USERNAME\", \"valueFrom\": {\"secretKeyRef\": {\"name\": \"app-secrets-$target_version\", \"key\": \"database.username\"}}}
                        ],
                        \"volumeMounts\": [
                            {\"name\": \"config-volume\", \"mountPath\": \"/etc/app-config\", \"readOnly\": true},
                            {\"name\": \"secret-volume\", \"mountPath\": \"/etc/app-secrets\", \"readOnly\": true}
                        ]
                    }],
                    \"volumes\": [
                        {\"name\": \"config-volume\", \"configMap\": {\"name\": \"app-config-$target_version\"}},
                        {\"name\": \"secret-volume\", \"secret\": {\"secretName\": \"app-secrets-$target_version\", \"defaultMode\": 384}}
                    ]
                }
            }
        }
    }"
    
    echo "Waiting for rollout to complete..."
    kubectl rollout status deployment/$deployment_name -n $NAMESPACE
    
    echo "‚úì Rollback to version $target_version completed successfully"
}

# –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
main() {
    case "$1" in
        "list")
            list_versions
            ;;
        "describe")
            describe_version "$2"
            ;;
        "compare")
            compare_versions "$2" "$3"
            ;;
        "create")
            create_new_version "$2" "$3" "$4" "$5"
            ;;
        "rollback")
            rollback_deployment "$2" "$3"
            ;;
        *)
            echo "Usage: $0 {list|describe|compare|create|rollback}"
            echo ""
            echo "Commands:"
            echo "  list                                    - List all configuration versions"
            echo "  describe <version>                      - Show detailed information about a version"
            echo "  compare <version1> <version2>           - Compare two versions"
            echo "  create <base_version> <new_version> <environment> [description] - Create new version"
            echo "  rollback <deployment_name> <version>    - Rollback deployment to specific version"
            echo ""
            echo "Examples:"
            echo "  $0 list"
            echo "  $0 describe v2"
            echo "  $0 compare v1 v2"
            echo "  $0 create v2 v4 production 'Production release with bug fixes'"
            echo "  $0 rollback app-v2 v1"
            ;;
    esac
}

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é —Å –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏
main "$@"

EOF

chmod +x config-version-manager.sh

# –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞
echo "=== Testing Configuration Version Manager ==="
echo

# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –≤–µ—Ä—Å–∏–∏
./config-version-manager.sh list

# –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –≤–µ—Ä—Å–∏–∏ v2
./config-version-manager.sh describe v2

# –°—Ä–∞–≤–Ω–∏—Ç—å –≤–µ—Ä—Å–∏–∏ v1 –∏ v2
./config-version-manager.sh compare v1 v2

# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é v4 –Ω–∞ –æ—Å–Ω–æ–≤–µ v3
./config-version-manager.sh create v3 v4 production "Production hotfix release"
```

### **5. Immutable ConfigMaps –∏ Secrets:**
```bash
# –°–æ–∑–¥–∞—Ç—å immutable ConfigMap
cat << EOF | kubectl apply -f -
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config-immutable-v1
  namespace: config-versioning-demo
  labels:
    app.kubernetes.io/name: hashfoundry-app
    config.hashfoundry.io/version: immutable-v1
    config.hashfoundry.io/immutable: "true"
  annotations:
    config.hashfoundry.io/description: "Immutable configuration for critical production settings"
    config.hashfoundry.io/created-by: "Release Manager"
immutable: true
data:
  app.name: "HashFoundry Production"
  app.version: "1.0.0"
  app.environment: "production"
  database.host: "postgres-prod-cluster.hashfoundry.local"
  database.port: "5432"
  security.level: "high"
  backup.enabled: "true"
  monitoring.enabled: "true"
  config.checksum: "sha256:abc123def456ghi789"
EOF

# –°–æ–∑–¥–∞—Ç—å immutable Secret
cat << EOF | kubectl apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: app-secrets-immutable-v1
  namespace: config-versioning-demo
  labels:
    app.kubernetes.io/name: hashfoundry-app
    config.hashfoundry.io/version: immutable-v1
    config.hashfoundry.io/immutable: "true"
  annotations:
    config.hashfoundry.io/description: "Immutable secrets for production environment"
    config.hashfoundry.io/created-by: "Security Team"
type: Opaque
immutable: true
data:
  database.username: cHJvZF91c2Vy  # prod_user
  database.password: cHJvZF9wYXNzd29yZF9zZWN1cmVfMTIz  # prod_password_secure_123
  api.key: cHJvZF9hcGlfa2V5X3NlY3VyZV80NTY=  # prod_api_key_secure_456
  jwt.secret: cHJvZF9qd3Rfc2VjcmV0X3NlY3VyZV83ODk=  # prod_jwt_secret_secure_789
EOF

# –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –∏–∑–º–µ–Ω–∏—Ç—å immutable ConfigMap (—ç—Ç–æ –¥–æ–ª–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –æ—à–∏–±–∫–æ–π)
echo "=== Testing Immutable ConfigMap Protection ==="
kubectl patch configmap app-config-immutable-v1 -n config-versioning-demo --type merge -p='{"data":{"app.version":"2.0.0"}}' || echo "‚úì Immutable ConfigMap correctly protected from changes"

# –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –∏–∑–º–µ–Ω–∏—Ç—å immutable Secret (—ç—Ç–æ –¥–æ–ª–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –æ—à–∏–±–∫–æ–π)
echo "=== Testing Immutable Secret Protection ==="
kubectl patch secret app-secrets-immutable-v1 -n config-versioning-demo --type merge -p='{"data":{"api.key":"'$(echo -n "new_api_key" | base64)'"}}' || echo "‚úì Immutable Secret correctly protected from changes"

# –ü–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é
echo "=== Creating New Immutable Version ==="
cat << EOF | kubectl apply -f -
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config-immutable-v2
  namespace: config-versioning-demo
  labels:
    app.kubernetes.io/name: hashfoundry-app
    config.hashfoundry.io/version: immutable-v2
    config.hashfoundry.io/immutable: "true"
    config.hashfoundry.io/previous-version: immutable-v1
  annotations:
    config.hashfoundry.io/description: "Updated immutable configuration with version 2.0.0"
    config.hashfoundry.io/changelog: "Updated app version to 2.0.0"
    config.hashfoundry.io/created-by: "Release Manager"
immutable: true
data:
  app.name: "HashFoundry Production"
  app.version: "2.0.0"  # –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
  app.environment: "production"
  database.host: "postgres-prod-cluster.hashfoundry.local"
  database.port: "5432"
  security.level: "high"
  backup.enabled: "true"
  monitoring.enabled: "true"
  config.checksum: "sha256:def456ghi789jkl012"  # –ù–æ–≤—ã–π checksum
EOF

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å immutable —Ä–µ—Å—É—Ä—Å—ã
kubectl get configmaps,secrets -n config-versioning-demo -l config.hashfoundry.io/immutable=true
```

### **6. GitOps –ø–æ–¥—Ö–æ–¥ —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è GitOps –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
mkdir -p gitops-config/{environments,versions,templates}

# –°–æ–∑–¥–∞—Ç—å template –¥–ª—è ConfigMap
cat << 'EOF' > gitops-config/templates/configmap-template.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config-{{.Version}}
  namespace: {{.Namespace}}
  labels:
    app.kubernetes.io/name: {{.AppName}}
    app.kubernetes.io/version: {{.AppVersion}}
    config.hashfoundry.io/version: {{.Version}}
    config.hashfoundry.io/environment: {{.Environment}}
  annotations:
    config.hashfoundry.io/git-commit: {{.GitCommit}}
    config.hashfoundry.io/created-by: {{.CreatedBy}}
    config.hashfoundry.io/description: {{.Description}}
data:
  app.name: {{.AppName}}
  app.version: {{.AppVersion}}
  app.environment: {{.Environment}}
  database.host: {{.DatabaseHost}}
  database.port: "{{.DatabasePort}}"
  feature.flags: {{.FeatureFlags}}
  monitoring.enabled: "{{.MonitoringEnabled}}"
  config.version: {{.Version}}
EOF

# –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è development
cat << 'EOF' > gitops-config/environments/development.yaml
namespace: config-versioning-demo
environment: development
appName: HashFoundry Application
appVersion: 1.0.0
databaseHost: postgres-dev.hashfoundry.local
databasePort: 5432
featureFlags: "feature1=true,feature2=false,feature3=false"
monitoringEnabled: false
description: "Development environment configuration"
createdBy: "DevOps Team"
EOF

# –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è staging
cat << 'EOF' > gitops-config/environments/staging.yaml
namespace: config-versioning-demo
environment: staging
appName: HashFoundry Application
appVersion: 2.0.0
databaseHost: postgres-staging.hashfoundry.local
databasePort: 5432
featureFlags: "feature1=true,feature2=true,feature3=true"
monitoringEnabled: true
description: "Staging environment configuration"
createdBy: "DevOps Team"
EOF

# –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è production
cat << 'EOF' > gitops-config/environments/production.yaml
namespace: config-versioning-demo
environment: production
appName: HashFoundry Application
appVersion: 3.0.0
databaseHost: postgres-prod-cluster.hashfoundry.local
databasePort: 5432
featureFlags: "feature1=true,feature2=true,feature3=true,feature4=true"
monitoringEnabled: true
description: "Production environment configuration"
createdBy: "Release Manager"
EOF

# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
cat << 'EOF' > gitops-config/generate-config.sh
#!/bin/bash

TEMPLATE_DIR="templates"
ENV_DIR="environments"
OUTPUT_DIR="versions"

generate_config() {
    local environment=$1
    local version=$2
    local git_commit=${3:-"unknown"}
    
    if [ -z "$environment" ] || [ -z "$version" ]; then
        echo "Usage: generate_config <environment> <version> [git_commit]"
        return 1
    fi
    
    local env_file="$ENV_DIR/$environment.yaml"
    local template_file="$TEMPLATE_DIR/configmap-template.yaml"
    local output_file="$OUTPUT_DIR/$environment-$version.yaml"
    
    if [ ! -f "$env_file" ]; then
        echo "Error: Environment file $env_file not found"
        return 1
    fi
    
    if [ ! -f "$template_file" ]; then
        echo "Error: Template file $template_file not found"
        return 1
    fi
    
    # –°–æ–∑–¥–∞—Ç—å output –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    mkdir -p "$OUTPUT_DIR"
    
    # –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ environment —Ñ–∞–π–ª–∞
    source <(grep -v '^#' "$env_file" | sed 's/: /=/' | sed 's/^/export /')
    
    # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    export Version="$version"
    export GitCommit="$git_commit"
    
    # –ó–∞–º–µ–Ω–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ template
    envsubst < "$template_file" > "$output_file"
    
    echo "Generated configuration: $output_file"
    echo "Environment: $environment"
    echo "Version: $version"
    echo "Git commit: $git_commit"
    echo
}

# –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
main() {
    case "$1" in
        "generate")
            generate_config "$2" "$3" "$4"
            ;;
        "generate-all")
            local version=${2:-"v$(date +%Y%m%d-%H%M%S)"}
            local git_commit=${3:-$(git rev-parse --short HEAD 2>/dev/null || echo "unknown")}
            
            echo "Generating all environment configurations for version $version"
            echo
            
            for env_file in $ENV_DIR/*.yaml; do
                if [ -f "$env_file" ]; then
                    env_name=$(basename "$env_file" .yaml)
                    generate_config "$env_name" "$version" "$git_commit"
                fi
            done
            ;;
        "apply")
            local config_file="$OUTPUT_DIR/$2"
            if [ -f "$config_file" ]; then
                echo "Applying configuration: $config_file"
                kubectl apply -f "$config_file"
            else
                echo "Error: Configuration file $config_file not found"
                return 1
            fi
            ;;
        "list")
            echo "Available configurations:"
            ls -la "$OUTPUT_DIR"/ 2>/dev/null || echo "No configurations generated yet"
            ;;
        *)
            echo "Usage: $0 {generate|generate-all|apply|list}"
            echo ""
            echo "Commands:"
            echo "  generate <environment> <version> [git_commit] - Generate config for specific environment"
            echo "  generate-all [version] [git_commit]           - Generate configs for all environments"
            echo "  apply <config_file>                           - Apply generated configuration"
            echo "  list                                          - List generated configurations"
            echo ""
            echo "Examples:"
            echo "  $0 generate development v1.0.0 abc123"
            echo "  $0 generate-all v2.0.0"
            echo "  $0 apply development-v1.0.0.yaml"
            echo "  $0 list"
            ;;
    esac
}

main "$@"
EOF

chmod +x gitops-config/generate-config.sh

# –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è GitOps –ø–æ–¥—Ö–æ–¥–∞
cd gitops-config

echo "=== GitOps Configuration Generation Demo ==="
echo

# –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π
./generate-config.sh generate-all v1.0.0 abc123def456

# –ü–æ–∫–∞–∑–∞—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
./generate-config.sh list

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è development
./generate-config.sh apply development-v1.0.0.yaml

cd ..
```

## üßπ **–û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
cat << 'EOF' > cleanup-versioning-demo.sh
#!/bin/bash

NAMESPACE="config-versioning-demo"

echo "=== Cleaning up Configuration Versioning Demo ==="
echo

# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ Pod'—ã –∏ Deployments
echo "Deleting deployments and pods..."
kubectl delete deployments,pods,services --all -n $NAMESPACE

# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ ConfigMaps –∏ Secrets
echo "Deleting ConfigMaps and Secrets..."
kubectl delete configmaps --all -n $NAMESPACE
kubectl delete secrets --all -n $NAMESPACE

# –£–¥–∞–ª–∏—Ç—å namespace
echo "Deleting namespace..."
kubectl delete namespace $NAMESPACE

# –£–¥–∞–ª–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
echo "Cleaning up local files..."
rm -f config-version-manager.sh
rm -rf gitops-config

echo "‚úì Cleanup completed"

EOF

chmod +x cleanup-versioning-demo.sh
./cleanup-versioning-demo.sh
```

## üìã **–°–≤–æ–¥–∫–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:**

### **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ ConfigMap
kubectl create configmap app-config-v1 --from-literal=key=value

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–æ–Ω–Ω—ã—Ö labels
kubectl label configmap app-config-v1 config.hashfoundry.io/version=v1

# –°–æ–∑–¥–∞–Ω–∏–µ immutable ConfigMap
kubectl apply -f - <<EOF
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config-immutable-v1
immutable: true
data:
  key: value
EOF

# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π
kubectl get configmap app-config-v1 -o yaml > v1.yaml
kubectl get configmap app-config-v2 -o yaml > v2.yaml
diff v1.yaml v2.yaml
```

## üìä **–°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:**

| **–°—Ç—Ä–∞—Ç–µ–≥–∏—è** | **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞** | **–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏** | **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** |
|---------------|------------------|----------------|-------------------|
| **Versioned Naming** | –ü—Ä–æ—Å—Ç–æ—Ç–∞, —è—Å–Ω–æ—Å—Ç—å | –ú–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–æ–≤ | –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ |
| **Labels/Annotations** | –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –ø–æ–∏—Å–∫ | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å | –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| **Immutable Resources** | –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å | –ù—É–∂–Ω—ã –Ω–æ–≤—ã–µ —Ä–µ—Å—É—Ä—Å—ã | Production –æ–∫—Ä—É–∂–µ–Ω–∏—è |
| **GitOps** | –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è, –∞—É–¥–∏—Ç | –°–ª–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ | CI/CD –ø–∞–π–ø–ª–∞–π–Ω—ã |

## üéØ **Best Practices –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:**

### **1. –°—Ç—Ä–∞—Ç–µ–≥–∏—è –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è:**
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** (v1.0.0, v1.1.0, v2.0.0)
- **–í–∫–ª—é—á–∞–π—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≤ –∏–º—è** –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ consistent –ø—Ä–µ—Ñ–∏–∫—Å—ã** –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
- **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ö–µ–º—É –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è**

### **2. –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:**
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ labels** (app.kubernetes.io/*)
- **–î–æ–±–∞–≤–ª—è–π—Ç–µ custom labels** –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- **–í–∫–ª—é—á–∞–π—Ç–µ changelog –≤ annotations**
- **–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ git commits**

### **3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º:**
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ immutable —Ä–µ—Å—É—Ä—Å—ã** –¥–ª—è production
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–π—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–π**
- **–†–µ–∞–ª–∏–∑—É–π—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –æ—á–∏—Å—Ç–∫–∏** —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π
- **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤**

### **4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∞—É–¥–∏—Ç:**
- **–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ** –≤–µ—Ä—Å–∏–π
- **–õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è**
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ approval –ø—Ä–æ—Ü–µ—Å—Å—ã** –¥–ª—è production
- **–†–µ–≥—É–ª—è—Ä–Ω–æ –∞—É–¥–∏—Ä—É–π—Ç–µ** –≤–µ—Ä—Å–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ConfigMaps –∏ Secrets –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º–æ—Å—Ç—å –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–∫–∞—Ç–∞ –≤ Kubernetes!**
