# 57. –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ ConfigMap –∏–ª–∏ Secret?

## üéØ **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ ConfigMap –∏–ª–∏ Secret?**

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ConfigMaps –∏ Secrets** - —ç—Ç–æ –≤–∞–∂–Ω—ã–π –∞—Å–ø–µ–∫—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏ –≤ Kubernetes. –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–æ–≥–æ, –∫–∞–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã.

## üèóÔ∏è **–û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**

### **1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (env/envFrom)**
### **2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ volume mounts**
### **3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ vs —Ä—É—á–Ω–æ–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫**
### **4. Graceful updates –∏ rolling restarts**
### **5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π**

## üìä **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –≤–∞—à–µ–≥–æ HA –∫–ª–∞—Å—Ç–µ—Ä–∞:**

### **1. –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å—Ä–µ–¥—ã:**
```bash
# –°–æ–∑–¥–∞—Ç—å namespace –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
kubectl create namespace config-update-demo

# –°–æ–∑–¥–∞—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ ConfigMap –∏ Secret
kubectl create configmap app-config \
  --from-literal=app.name="HashFoundry Application" \
  --from-literal=app.version="1.0.0" \
  --from-literal=app.environment="development" \
  --from-literal=database.host="postgres-dev.hashfoundry.local" \
  --from-literal=database.port="5432" \
  --from-literal=feature.flags="feature1=true,feature2=false,feature3=true" \
  --from-literal=log.level="INFO" \
  -n config-update-demo

kubectl create secret generic app-secrets \
  --from-literal=database.username="dev_user" \
  --from-literal=database.password="dev_password_123" \
  --from-literal=api.key="dev_api_key_456" \
  --from-literal=jwt.secret="dev_jwt_secret_789" \
  -n config-update-demo

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
kubectl get configmaps,secrets -n config-update-demo
kubectl describe configmap app-config -n config-update-demo
```

### **2. –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
# –°–æ–∑–¥–∞—Ç—å Pod —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ ConfigMap –∏ Secret
cat << EOF | kubectl apply -f -
apiVersion: v1
kind: Pod
metadata:
  name: env-update-demo
  namespace: config-update-demo
  labels:
    app: env-demo
spec:
  containers:
  - name: app
    image: busybox:1.35
    command: ["sh", "-c"]
    args:
    - |
      echo "=== Environment Variables Update Demo ==="
      echo "Initial configuration:"
      echo "APP_NAME: \$APP_NAME"
      echo "APP_VERSION: \$APP_VERSION"
      echo "APP_ENVIRONMENT: \$APP_ENVIRONMENT"
      echo "DATABASE_HOST: \$DATABASE_HOST"
      echo "DATABASE_USERNAME: \$DATABASE_USERNAME"
      echo "LOG_LEVEL: \$LOG_LEVEL"
      echo ""
      
      echo "Monitoring environment variables every 30 seconds..."
      while true; do
        echo "\$(date): Current environment:"
        echo "  APP_NAME: \$APP_NAME"
        echo "  APP_VERSION: \$APP_VERSION"
        echo "  APP_ENVIRONMENT: \$APP_ENVIRONMENT"
        echo "  DATABASE_HOST: \$DATABASE_HOST"
        echo "  LOG_LEVEL: \$LOG_LEVEL"
        echo "  DATABASE_USERNAME: \$DATABASE_USERNAME"
        echo ""
        sleep 30
      done
    env:
    - name: APP_NAME
      valueFrom:
        configMapKeyRef:
          name: app-config
          key: app.name
    - name: APP_VERSION
      valueFrom:
        configMapKeyRef:
          name: app-config
          key: app.version
    - name: APP_ENVIRONMENT
      valueFrom:
        configMapKeyRef:
          name: app-config
          key: app.environment
    - name: DATABASE_HOST
      valueFrom:
        configMapKeyRef:
          name: app-config
          key: database.host
    - name: LOG_LEVEL
      valueFrom:
        configMapKeyRef:
          name: app-config
          key: log.level
    - name: DATABASE_USERNAME
      valueFrom:
        secretKeyRef:
          name: app-secrets
          key: database.username
    - name: DATABASE_PASSWORD
      valueFrom:
        secretKeyRef:
          name: app-secrets
          key: database.password
    resources:
      requests:
        memory: "32Mi"
        cpu: "50m"
      limits:
        memory: "64Mi"
        cpu: "100m"
  restartPolicy: Never
EOF

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
kubectl logs env-update-demo -n config-update-demo --tail=20

# –û–±–Ω–æ–≤–∏—Ç—å ConfigMap
echo "=== Updating ConfigMap ==="
kubectl patch configmap app-config -n config-update-demo --type merge -p='{"data":{"app.version":"2.0.0","app.environment":"production","database.host":"postgres-prod.hashfoundry.local","log.level":"DEBUG"}}'

# –û–±–Ω–æ–≤–∏—Ç—å Secret
echo "=== Updating Secret ==="
kubectl patch secret app-secrets -n config-update-demo --type merge -p='{"data":{"database.username":"'$(echo -n "prod_user" | base64)'","database.password":"'$(echo -n "prod_password_456" | base64)'"}}'

echo "ConfigMap and Secret updated. Check Pod logs to see if environment variables changed..."
echo "Note: Environment variables from ConfigMaps/Secrets do NOT update automatically in running containers!"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
sleep 60
kubectl logs env-update-demo -n config-update-demo --tail=10
```

### **3. –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ volume mounts:**
```bash
# –°–æ–∑–¥–∞—Ç—å Pod —Å volume mounts
cat << EOF | kubectl apply -f -
apiVersion: v1
kind: Pod
metadata:
  name: volume-update-demo
  namespace: config-update-demo
  labels:
    app: volume-demo
spec:
  containers:
  - name: app
    image: busybox:1.35
    command: ["sh", "-c"]
    args:
    - |
      echo "=== Volume Mount Update Demo ==="
      echo "Initial configuration files:"
      echo ""
      
      echo "ConfigMap files:"
      ls -la /etc/config/
      echo ""
      
      echo "Secret files:"
      ls -la /etc/secrets/
      echo ""
      
      echo "Initial values:"
      echo "App Name: \$(cat /etc/config/app.name)"
      echo "App Version: \$(cat /etc/config/app.version)"
      echo "App Environment: \$(cat /etc/config/app.environment)"
      echo "Database Host: \$(cat /etc/config/database.host)"
      echo "Log Level: \$(cat /etc/config/log.level)"
      echo "Database Username: \$(cat /etc/secrets/database.username)"
      echo ""
      
      echo "Monitoring file changes every 30 seconds..."
      while true; do
        echo "\$(date): Current configuration:"
        echo "  App Name: \$(cat /etc/config/app.name 2>/dev/null || echo 'ERROR')"
        echo "  App Version: \$(cat /etc/config/app.version 2>/dev/null || echo 'ERROR')"
        echo "  App Environment: \$(cat /etc/config/app.environment 2>/dev/null || echo 'ERROR')"
        echo "  Database Host: \$(cat /etc/config/database.host 2>/dev/null || echo 'ERROR')"
        echo "  Log Level: \$(cat /etc/config/log.level 2>/dev/null || echo 'ERROR')"
        echo "  Database Username: \$(cat /etc/secrets/database.username 2>/dev/null || echo 'ERROR')"
        echo ""
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–∞—Ö
        echo "File modification times:"
        ls -la /etc/config/ | grep -v "^total"
        ls -la /etc/secrets/ | grep -v "^total"
        echo ""
        
        sleep 30
      done
    volumeMounts:
    - name: config-volume
      mountPath: /etc/config
      readOnly: true
    - name: secret-volume
      mountPath: /etc/secrets
      readOnly: true
    resources:
      requests:
        memory: "32Mi"
        cpu: "50m"
      limits:
        memory: "64Mi"
        cpu: "100m"
  volumes:
  - name: config-volume
    configMap:
      name: app-config
  - name: secret-volume
    secret:
      secretName: app-secrets
      defaultMode: 0600
  restartPolicy: Never
EOF

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
kubectl logs volume-update-demo -n config-update-demo --tail=20

# –ü–æ–¥–æ–∂–¥–∞—Ç—å –Ω–µ–º–Ω–æ–≥–æ, –∑–∞—Ç–µ–º –æ–±–Ω–æ–≤–∏—Ç—å ConfigMap –∏ Secret
sleep 30

echo "=== Updating ConfigMap and Secret again ==="
kubectl patch configmap app-config -n config-update-demo --type merge -p='{"data":{"app.version":"3.0.0","app.environment":"staging","database.host":"postgres-staging.hashfoundry.local","log.level":"WARN","feature.flags":"feature1=false,feature2=true,feature3=true,feature4=true"}}'

kubectl patch secret app-secrets -n config-update-demo --type merge -p='{"data":{"database.username":"'$(echo -n "staging_user" | base64)'","database.password":"'$(echo -n "staging_password_789" | base64)'","api.key":"'$(echo -n "staging_api_key_123" | base64)'"}}'

echo "ConfigMap and Secret updated. Check Pod logs to see file changes..."
echo "Note: Files from mounted ConfigMaps/Secrets update automatically (with some delay)!"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
sleep 90
kubectl logs volume-update-demo -n config-update-demo --tail=15
```

### **4. –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Å Deployment –∏ rolling updates:**
```bash
# –°–æ–∑–¥–∞—Ç—å Deployment –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ rolling updates
cat << EOF | kubectl apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: rolling-update-demo
  namespace: config-update-demo
spec:
  replicas: 3
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1
      maxSurge: 1
  selector:
    matchLabels:
      app: rolling-demo
  template:
    metadata:
      labels:
        app: rolling-demo
    spec:
      containers:
      - name: app
        image: nginx:1.21
        ports:
        - containerPort: 80
        env:
        - name: APP_NAME
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: app.name
        - name: APP_VERSION
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: app.version
        - name: APP_ENVIRONMENT
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: app.environment
        - name: DATABASE_HOST
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: database.host
        - name: DATABASE_USERNAME
          valueFrom:
            secretKeyRef:
              name: app-secrets
              key: database.username
        volumeMounts:
        - name: config-volume
          mountPath: /etc/app-config
          readOnly: true
        - name: secret-volume
          mountPath: /etc/app-secrets
          readOnly: true
        - name: nginx-config
          mountPath: /etc/nginx/conf.d/default.conf
          subPath: nginx.conf
          readOnly: true
        command: ["sh", "-c"]
        args:
        - |
          # –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Å—Ç—É—é nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
          cat > /etc/nginx/conf.d/default.conf << 'NGINX_EOF'
          server {
              listen 80;
              server_name localhost;
              
              location / {
                  root /usr/share/nginx/html;
                  index index.html;
              }
              
              location /config {
                  add_header Content-Type application/json;
                  return 200 '{"app_name":"$APP_NAME","app_version":"$APP_VERSION","app_environment":"$APP_ENVIRONMENT","database_host":"$DATABASE_HOST","database_username":"$DATABASE_USERNAME"}';
              }
              
              location /health {
                  access_log off;
                  return 200 "healthy\n";
                  add_header Content-Type text/plain;
              }
          }
          NGINX_EOF
          
          # –°–æ–∑–¥–∞—Ç—å index.html —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
          cat > /usr/share/nginx/html/index.html << 'HTML_EOF'
          <!DOCTYPE html>
          <html>
          <head>
              <title>HashFoundry Config Demo</title>
              <style>
                  body { font-family: Arial, sans-serif; margin: 40px; }
                  .config { background: #f5f5f5; padding: 20px; border-radius: 5px; }
                  .env-var { margin: 10px 0; }
                  .file-content { background: #e8e8e8; padding: 10px; margin: 10px 0; border-radius: 3px; }
              </style>
          </head>
          <body>
              <h1>HashFoundry Configuration Demo</h1>
              <div class="config">
                  <h2>Environment Variables</h2>
                  <div class="env-var">APP_NAME: $APP_NAME</div>
                  <div class="env-var">APP_VERSION: $APP_VERSION</div>
                  <div class="env-var">APP_ENVIRONMENT: $APP_ENVIRONMENT</div>
                  <div class="env-var">DATABASE_HOST: $DATABASE_HOST</div>
                  <div class="env-var">DATABASE_USERNAME: $DATABASE_USERNAME</div>
                  
                  <h2>Mounted Files</h2>
                  <div class="file-content">
                      <strong>ConfigMap files:</strong><br>
                      $(ls -la /etc/app-config/ 2>/dev/null | tail -n +2 | sed 's/^/<br>/')
                  </div>
                  <div class="file-content">
                      <strong>Secret files:</strong><br>
                      $(ls -la /etc/app-secrets/ 2>/dev/null | tail -n +2 | sed 's/^/<br>/')
                  </div>
              </div>
              <p><strong>Pod:</strong> $(hostname)</p>
              <p><strong>Started:</strong> $(date)</p>
          </body>
          </html>
          HTML_EOF
          
          nginx -g 'daemon off;'
        resources:
          requests:
            memory: "64Mi"
            cpu: "100m"
          limits:
            memory: "128Mi"
            cpu: "200m"
        livenessProbe:
          httpGet:
            path: /health
            port: 80
          initialDelaySeconds: 10
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /health
            port: 80
          initialDelaySeconds: 5
          periodSeconds: 5
      volumes:
      - name: config-volume
        configMap:
          name: app-config
      - name: secret-volume
        secret:
          secretName: app-secrets
          defaultMode: 0600
      - name: nginx-config
        configMap:
          name: app-config
          items:
          - key: app.name
            path: nginx.conf
EOF

# –°–æ–∑–¥–∞—Ç—å Service
cat << EOF | kubectl apply -f -
apiVersion: v1
kind: Service
metadata:
  name: rolling-update-service
  namespace: config-update-demo
spec:
  selector:
    app: rolling-demo
  ports:
  - port: 80
    targetPort: 80
  type: ClusterIP
EOF

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Deployment
kubectl get deployment,pods,service -n config-update-demo -l app=rolling-demo

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ Pod'–∞—Ö
echo "=== Checking configuration in pods ==="
for pod in $(kubectl get pods -n config-update-demo -l app=rolling-demo -o jsonpath='{.items[*].metadata.name}'); do
    echo "Pod: $pod"
    kubectl exec $pod -n config-update-demo -- sh -c "echo 'Environment: APP_VERSION='\$APP_VERSION', APP_ENVIRONMENT='\$APP_ENVIRONMENT"
    echo ""
done
```

### **5. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Deployment –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è ConfigMap/Secret:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
cat << 'EOF' > force-deployment-update.sh
#!/bin/bash

NAMESPACE="config-update-demo"
DEPLOYMENT="rolling-update-demo"

echo "=== Force Deployment Update Demo ==="
echo

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∏–∑ Pod'–æ–≤
check_pod_configs() {
    echo "Current configuration in pods:"
    for pod in $(kubectl get pods -n $NAMESPACE -l app=rolling-demo -o jsonpath='{.items[*].metadata.name}'); do
        if kubectl get pod $pod -n $NAMESPACE >/dev/null 2>&1; then
            echo "Pod: $pod"
            kubectl exec $pod -n $NAMESPACE -- sh -c "echo '  APP_VERSION: '\$APP_VERSION; echo '  APP_ENVIRONMENT: '\$APP_ENVIRONMENT; echo '  DATABASE_HOST: '\$DATABASE_HOST" 2>/dev/null || echo "  Pod not ready"
        fi
    done
    echo
}

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
echo "=== Before Update ==="
check_pod_configs

# –û–±–Ω–æ–≤–∏—Ç—å ConfigMap –∏ Secret
echo "=== Updating ConfigMap and Secret ==="
kubectl patch configmap app-config -n $NAMESPACE --type merge -p='{"data":{"app.version":"4.0.0","app.environment":"production","database.host":"postgres-prod-ha.hashfoundry.local","log.level":"ERROR"}}'

kubectl patch secret app-secrets -n $NAMESPACE --type merge -p='{"data":{"database.username":"'$(echo -n "prod_ha_user" | base64)'","database.password":"'$(echo -n "prod_ha_password_secure_123" | base64)'"}}'

echo "ConfigMap and Secret updated"
echo

# –ü–æ–¥–æ–∂–¥–∞—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å - –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
echo "=== Waiting 60 seconds to check if environment variables changed ==="
sleep 60
check_pod_configs

echo "As expected, environment variables did NOT change in existing pods"
echo

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å Deployment
echo "=== Force rolling update of Deployment ==="
kubectl patch deployment $DEPLOYMENT -n $NAMESPACE -p '{"spec":{"template":{"metadata":{"annotations":{"kubectl.kubernetes.io/restartedAt":"'$(date -u +%Y-%m-%dT%H:%M:%SZ)'"}}}}}'

echo "Rolling update initiated. Waiting for completion..."
kubectl rollout status deployment/$DEPLOYMENT -n $NAMESPACE

echo
echo "=== After Rolling Update ==="
check_pod_configs

echo "Environment variables are now updated in new pods!"

EOF

chmod +x force-deployment-update.sh
./force-deployment-update.sh
```

### **6. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ñ–∞–π–ª–∞—Ö:**
```bash
# –°–æ–∑–¥–∞—Ç—å Pod —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ñ–∞–π–ª–æ–≤
cat << EOF | kubectl apply -f -
apiVersion: v1
kind: Pod
metadata:
  name: file-watcher-demo
  namespace: config-update-demo
  labels:
    app: file-watcher
spec:
  containers:
  - name: app
    image: busybox:1.35
    command: ["sh", "-c"]
    args:
    - |
      echo "=== File Watcher Demo ==="
      echo "Monitoring ConfigMap and Secret file changes"
      echo ""
      
      # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ö–µ—à–µ–π —Ñ–∞–π–ª–æ–≤
      get_file_hashes() {
        echo "Current file hashes:"
        for file in /etc/config/* /etc/secrets/*; do
          if [ -f "\$file" ]; then
            hash=\$(md5sum "\$file" | cut -d' ' -f1)
            echo "  \$(basename \$file): \$hash"
          fi
        done
        echo ""
      }
      
      # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–æ–≤
      check_file_contents() {
        echo "Current file contents:"
        echo "  app.version: \$(cat /etc/config/app.version 2>/dev/null || echo 'N/A')"
        echo "  app.environment: \$(cat /etc/config/app.environment 2>/dev/null || echo 'N/A')"
        echo "  database.host: \$(cat /etc/config/database.host 2>/dev/null || echo 'N/A')"
        echo "  log.level: \$(cat /etc/config/log.level 2>/dev/null || echo 'N/A')"
        echo "  database.username: \$(cat /etc/secrets/database.username 2>/dev/null || echo 'N/A')"
        echo ""
      }
      
      # –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
      echo "Initial state:"
      get_file_hashes
      check_file_contents
      
      # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π
      echo "Starting file monitoring (checking every 15 seconds)..."
      previous_hash=""
      
      while true; do
        current_hash=\$(find /etc/config /etc/secrets -type f -exec md5sum {} \; 2>/dev/null | md5sum | cut -d' ' -f1)
        
        if [ "\$current_hash" != "\$previous_hash" ]; then
          echo "\$(date): FILES CHANGED!"
          get_file_hashes
          check_file_contents
          previous_hash="\$current_hash"
        else
          echo "\$(date): No changes detected"
        fi
        
        sleep 15
      done
    volumeMounts:
    - name: config-volume
      mountPath: /etc/config
      readOnly: true
    - name: secret-volume
      mountPath: /etc/secrets
      readOnly: true
    resources:
      requests:
        memory: "32Mi"
        cpu: "50m"
      limits:
        memory: "64Mi"
        cpu: "100m"
  volumes:
  - name: config-volume
    configMap:
      name: app-config
  - name: secret-volume
    secret:
      secretName: app-secrets
      defaultMode: 0600
  restartPolicy: Never
EOF

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
kubectl logs file-watcher-demo -n config-update-demo --tail=20

# –ü–æ–¥–æ–∂–¥–∞—Ç—å –Ω–µ–º–Ω–æ–≥–æ, –∑–∞—Ç–µ–º –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sleep 30

echo "=== Updating configuration to trigger file changes ==="
kubectl patch configmap app-config -n config-update-demo --type merge -p='{"data":{"app.version":"5.0.0","app.environment":"testing","database.host":"postgres-test.hashfoundry.local","log.level":"TRACE","new.feature":"enabled"}}'

kubectl patch secret app-secrets -n config-update-demo --type merge -p='{"data":{"database.username":"'$(echo -n "test_user" | base64)'","database.password":"'$(echo -n "test_password_abc" | base64)'","new.secret":"'$(echo -n "new_secret_value" | base64)'"}}'

echo "Configuration updated. Check file-watcher logs to see changes..."

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
sleep 60
kubectl logs file-watcher-demo -n config-update-demo --tail=20
```

### **7. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è graceful reload —Å –ø–æ–º–æ—â—å—é sidecar:**
```bash
# –°–æ–∑–¥–∞—Ç—å Deployment —Å sidecar –¥–ª—è graceful reload
cat << EOF | kubectl apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: graceful-reload-demo
  namespace: config-update-demo
spec:
  replicas: 2
  selector:
    matchLabels:
      app: graceful-reload
  template:
    metadata:
      labels:
        app: graceful-reload
    spec:
      containers:
      # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
      - name: app
        image: nginx:1.21
        ports:
        - containerPort: 80
        volumeMounts:
        - name: config-volume
          mountPath: /etc/app-config
          readOnly: true
        - name: secret-volume
          mountPath: /etc/app-secrets
          readOnly: true
        - name: nginx-config
          mountPath: /etc/nginx/conf.d
          readOnly: true
        - name: shared-data
          mountPath: /shared
        env:
        - name: APP_VERSION
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: app.version
        - name: APP_ENVIRONMENT
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: app.environment
        command: ["sh", "-c"]
        args:
        - |
          # –°–æ–∑–¥–∞—Ç—å nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
          cat > /etc/nginx/conf.d/default.conf << 'NGINX_EOF'
          server {
              listen 80;
              server_name localhost;
              
              location / {
                  root /usr/share/nginx/html;
                  index index.html;
              }
              
              location /config {
                  alias /etc/app-config;
                  autoindex on;
              }
              
              location /reload {
                  return 200 "Reload triggered\n";
                  add_header Content-Type text/plain;
              }
              
              location /health {
                  access_log off;
                  return 200 "healthy\n";
                  add_header Content-Type text/plain;
              }
          }
          NGINX_EOF
          
          # –°–æ–∑–¥–∞—Ç—å HTML —Å—Ç—Ä–∞–Ω–∏—Ü—É
          cat > /usr/share/nginx/html/index.html << 'HTML_EOF'
          <!DOCTYPE html>
          <html>
          <head>
              <title>Graceful Reload Demo</title>
              <meta http-equiv="refresh" content="10">
          </head>
          <body>
              <h1>Graceful Reload Demo</h1>
              <p>App Version: $APP_VERSION</p>
              <p>Environment: $APP_ENVIRONMENT</p>
              <p>Pod: $(hostname)</p>
              <p>Last reload: $(cat /shared/last-reload 2>/dev/null || echo 'Never')</p>
              <p>Page auto-refreshes every 10 seconds</p>
          </body>
          </html>
          HTML_EOF
          
          # –ó–∞–ø—É—Å—Ç–∏—Ç—å nginx —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º reload —Å–∏–≥–Ω–∞–ª–æ–≤
          nginx &
          NGINX_PID=\$!
          
          echo "Nginx started with PID: \$NGINX_PID"
          
          # –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Ñ–∞–π–ª reload trigger
          while true; do
            if [ -f /shared/reload-trigger ]; then
              echo "\$(date): Reload trigger detected, reloading nginx..."
              nginx -s reload
              echo "\$(date): Nginx reloaded" > /shared/last-reload
              rm -f /shared/reload-trigger
            fi
            sleep 5
          done
        resources:
          requests:
            memory: "64Mi"
            cpu: "100m"
          limits:
            memory: "128Mi"
            cpu: "200m"
      
      # Sidecar –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
      - name: config-watcher
        image: busybox:1.35
        command: ["sh", "-c"]
        args:
        - |
          echo "=== Config Watcher Sidecar ==="
          echo "Monitoring configuration changes..."
          
          # –ü–æ–ª—É—á–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ —Ö–µ—à–∏
          get_config_hash() {
            find /etc/app-config /etc/app-secrets -type f -exec md5sum {} \; 2>/dev/null | md5sum | cut -d' ' -f1
          }
          
          previous_hash=\$(get_config_hash)
          echo "Initial config hash: \$previous_hash"
          
          while true; do
            current_hash=\$(get_config_hash)
            
            if [ "\$current_hash" != "\$previous_hash" ]; then
              echo "\$(date): Configuration changed!"
              echo "Previous hash: \$previous_hash"
              echo "Current hash: \$current_hash"
              
              # –°–æ–∑–¥–∞—Ç—å trigger –¥–ª—è reload
              touch /shared/reload-trigger
              echo "\$(date): Reload trigger created"
              
              previous_hash="\$current_hash"
            fi
            
            sleep 10
          done
        volumeMounts:
        - name: config-volume
          mountPath: /etc/app-config
          readOnly: true
        - name: secret-volume
          mountPath: /etc/app-secrets
          readOnly: true
        - name: shared-data
          mountPath: /shared
        resources:
          requests:
            memory: "32Mi"
            cpu: "50m"
          limits:
            memory: "64Mi"
            cpu: "100m"
      
      volumes:
      - name: config-volume
        configMap:
          name: app-config
      - name: secret-volume
        secret:
          secretName: app-secrets
          defaultMode: 0600
      - name: nginx-config
        configMap:
          name: app-config
      - name: shared-data
        emptyDir: {}
EOF

# –°–æ–∑–¥–∞—Ç—å Service
cat << EOF | kubectl apply -f -
apiVersion: v1
kind: Service
metadata:
  name: graceful-reload-service
  namespace: config-update-demo
spec:
  selector:
    app: graceful-reload
  ports:
  - port: 80
    targetPort: 80
  type: ClusterIP
EOF

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Deployment
kubectl get deployment,pods,service -n config-update-demo -l app=graceful-reload

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ sidecar'–∞
echo "=== Checking config-watcher sidecar logs ==="
POD_NAME=$(kubectl get pods -n config-update-demo -l app=graceful-reload -o jsonpath='{.items[0].metadata.name}')
kubectl logs $POD_NAME -c config-watcher -n config-update-demo --tail=10

# –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è graceful reload
echo "=== Updating configuration to test graceful reload ==="
kubectl patch configmap app-config -n config-update-demo --type merge -p='{"data":{"app.version":"6.0.0","app.environment":"production-ha","database.host":"postgres-prod-cluster.hashfoundry.local"}}'

echo "Configuration updated. Check sidecar logs to see reload process..."

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
sleep 30
kubectl logs $POD_NAME -c config-watcher -n config-update-demo --tail=15
kubectl logs $POD_NAME -c app -n config-update-demo --tail=10
```

## üîç **–ê–Ω–∞–ª–∏–∑ –ø–æ–≤–µ–¥–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:**

### **8. –°–æ–∑–¥–∞–Ω–∏–µ comprehensive –∞–Ω–∞–ª–∏–∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
cat << 'EOF' > analyze-update-behavior.sh
#!/bin/bash

NAMESPACE="config-update-demo"

echo "=== ConfigMap and Secret Update Behavior Analysis ==="
echo

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
analyze_current_state() {
    echo "=== Current State Analysis ==="
    
    echo "ConfigMaps:"
    kubectl get configmaps -n $NAMESPACE -o custom-columns="NAME:.metadata.name,AGE:.metadata.creationTimestamp,DATA-KEYS:.data" | sed 's/^/  /'
    echo
    
    echo "Secrets:"
    kubectl get secrets -n $NAMESPACE -o custom-columns="NAME:.metadata.name,TYPE:.type,AGE:.metadata.creationTimestamp" | grep -v default-token | sed 's/^/  /'
    echo
    
    echo "Pods using ConfigMaps/Secrets:"
    kubectl get pods -n $NAMESPACE -o custom-columns="NAME:.metadata.name,STATUS:.status.phase,AGE:.metadata.creationTimestamp" | sed 's/^/  /'
    echo
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
test_update_propagation() {
    local resource_type=$1
    local resource_name=$2
    local test_key=$3
    local new_value=$4
    
    echo "=== Testing $resource_type Update Propagation ==="
    echo "Resource: $resource_name"
    echo "Key: $test_key"
    echo "New Value: $new_value"
    echo
    
    # –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    if [ "$resource_type" = "configmap" ]; then
        current_value=$(kubectl get configmap $resource_name -n $NAMESPACE -o jsonpath="{.data.$test_key}" 2>/dev/null || echo "N/A")
    else
        current_value=$(kubectl get secret $resource_name -n $NAMESPACE -o jsonpath="{.data.$test_key}" 2>/dev/null | base64 --decode 2>/dev/null || echo "N/A")
    fi
    
    echo "Current value: $current_value"
    
    # –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ—Å—É—Ä—Å
    if [ "$resource_type" = "configmap" ]; then
        kubectl patch configmap $resource_name -n $NAMESPACE --type merge -p="{\"data\":{\"$test_key\":\"$new_value\"}}"
    else
        encoded_value=$(echo -n "$new_value" | base64)
        kubectl patch secret $resource_name -n $NAMESPACE --type merge -p="{\"data\":{\"$test_key\":\"$encoded_value\"}}"
    fi
    
    echo "Resource updated at: $(date)"
    echo
    
    # –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Pod'–∞—Ö
    echo "Monitoring propagation to pods..."
    for i in {1..12}; do
        echo "Check $i ($(date)):"
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Pod'–∞—Ö —Å volume mounts
        for pod in $(kubectl get pods -n $NAMESPACE -l app=volume-demo -o jsonpath='{.items[*].metadata.name}' 2>/dev/null); do
            if kubectl get pod $pod -n $NAMESPACE >/dev/null 2>&1; then
                if [ "$resource_type" = "configmap" ]; then
                    pod_value=$(kubectl exec $pod -n $NAMESPACE -- cat /etc/config/$test_key 2>/dev/null || echo "N/A")
                else
                    pod_value=$(kubectl exec $pod -n $NAMESPACE -- cat /etc/secrets/$test_key 2>/dev/null || echo "N/A")
                fi
                echo "  Pod $pod (volume): $pod_value"
            fi
        done
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Pod'–∞—Ö —Å environment variables
        for pod in $(kubectl get pods -n $NAMESPACE -l app=env-demo -o jsonpath='{.items[*].metadata.name}' 2>/dev/null); do
            if kubectl get pod $pod -n $NAMESPACE >/dev/null 2>&1; then
                # Environment variables –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è, –ø–æ—ç—Ç–æ–º—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç—Ç–æ
                echo "  Pod $pod (env): Environment variables do not update automatically"
            fi
        done
        
        echo
        sleep 10
    done
}

# –í—ã–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∞–ª–∏–∑
analyze_current_state

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ ConfigMap
test_update_propagation "configmap" "app-config" "app.version" "analysis-test-$(date +%s)"

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Secret
test_update_propagation "secret" "app-secrets" "database.password" "analysis-password-$(date +%s)"

echo "=== Update Behavior Summary ==="
cat << 'EOL'

Key Findings:

1. Environment Variables (env/envFrom):
   ‚ùå Do NOT update automatically in running containers
   ‚úÖ Require pod restart to pick up new values
   ‚ö†Ô∏è  Use rolling updates for Deployments

2. Volume Mounts:
   ‚úÖ Update automatically (with delay)
   ‚è±Ô∏è  Propagation time: 10-60 seconds typically
   üîÑ Files are replaced atomically via symlinks

3. Best Practices:
   üìù Use volume mounts for configs that can change
   üîÑ Use env vars for configs that rarely change
   üöÄ Implement graceful reload mechanisms
   üìä Monitor configuration changes
   üîí Use immutable ConfigMaps/Secrets for critical configs

4. Update Strategies:
   üîÑ Rolling updates for environment variables
   ‚ö° Graceful reload for volume-mounted configs
   üéØ Blue-green deployments for major changes
   üìà Canary deployments for gradual rollouts

EOL

EOF

chmod +x analyze-update-behavior.sh
./analyze-update-behavior.sh
```

## üßπ **–û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
cat << 'EOF' > cleanup-config-update-demo.sh
#!/bin/bash

NAMESPACE="config-update-demo"

echo "=== Cleaning up Config Update Demo ==="
echo

# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ Pod'—ã
echo "Deleting pods..."
kubectl delete pods --all -n $NAMESPACE

# –£–¥–∞–ª–∏—Ç—å Deployments –∏ Services
echo "Deleting deployments and services..."
kubectl delete deployments,services --all -n $NAMESPACE

# –£–¥–∞–ª–∏—Ç—å ConfigMaps –∏ Secrets
echo "Deleting ConfigMaps and Secrets..."
kubectl delete configmaps --all -n $NAMESPACE
kubectl delete secrets --all -n $NAMESPACE

# –£–¥–∞–ª–∏—Ç—å namespace
echo "Deleting namespace..."
kubectl delete namespace $NAMESPACE

# –£–¥–∞–ª–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
echo "Cleaning up local files..."
rm -f force-deployment-update.sh
rm -f analyze-update-behavior.sh

echo "‚úì Cleanup completed"

EOF

chmod +x cleanup-config-update-demo.sh
./cleanup-config-update-demo.sh
```

## üìã **–°–≤–æ–¥–∫–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:**

### **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ConfigMap
kubectl patch configmap my-config --type merge -p='{"data":{"key":"new-value"}}'

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Secret
kubectl patch secret my-secret --type merge -p='{"data":{"key":"'$(echo -n "new-value" | base64)'"}}'

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Deployment
kubectl patch deployment my-app -p '{"spec":{"template":{"metadata":{"annotations":{"kubectl.kubernetes.io/restartedAt":"'$(date -u +%Y-%m-%dT%H:%M:%SZ)'"}}}}}'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ rolling update
kubectl rollout status deployment/my-app
```

## üìä **–°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –º–µ—Ç–æ–¥–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**

| **–ú–µ—Ç–æ–¥** | **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** | **–í—Ä–µ–º—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è** | **Downtime** | **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** |
|-----------|------------------------------|---------------------------|--------------|-------------------|
| **Environment Variables** | ‚ùå –ù–µ—Ç | N/A (—Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫) | –î–∞ (rolling update) | –°—Ç–∞—Ç–∏—á–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ |
| **Volume Mounts** | ‚úÖ –î–∞ | 10-60 —Å–µ–∫—É–Ω–¥ | –ù–µ—Ç | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ |
| **envFrom** | ‚ùå –ù–µ—Ç | N/A (—Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫) | –î–∞ (rolling update) | –ú–∞—Å—Å–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö |
| **Projected Volumes** | ‚úÖ –î–∞ | 10-60 —Å–µ–∫—É–Ω–¥ | –ù–µ—Ç | –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ |

## üéØ **Best Practices –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:**

### **1. –í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
- **Environment Variables**: –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–¥–∫–æ –º–µ–Ω—è—é—Ç—Å—è
- **Volume Mounts**: –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã
- **–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥**: –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ env, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —á–µ—Ä–µ–∑ volumes

### **2. –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
- **Rolling Updates**: –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è environment variables
- **Graceful Reload**: –¥–ª—è volume-mounted –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- **Blue-Green**: –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **Canary**: –¥–ª—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### **3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞:**
- **–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å–æ–±—ã—Ç–∏—è** ConfigMaps –∏ Secrets
- **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –≤—Ä–µ–º—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è** –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ health checks** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- **–õ–æ–≥–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### **4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:**
- **–í–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ staged rollouts** –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **–°–æ–∑–¥–∞–≤–∞–π—Ç–µ backups** –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
- **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤ staging** –æ–∫—Ä—É–∂–µ–Ω–∏–∏

**–ü–æ–Ω–∏–º–∞–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π ConfigMaps –∏ Secrets –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –Ω–∞–¥–µ–∂–Ω—ã—Ö –∏ —É–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≤ Kubernetes!**
