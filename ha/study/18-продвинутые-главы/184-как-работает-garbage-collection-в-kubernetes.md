# 184. –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç garbage collection –≤ Kubernetes?

## üéØ **–ß—Ç–æ —Ç–∞–∫–æ–µ Garbage Collection –≤ Kubernetes?**

**Garbage Collection** ‚Äî —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å –æ—á–∏—Å—Ç–∫–∏ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ Kubernetes, –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∞. –°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞–µ—Ç owner references –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏, cascading deletion –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤, –∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ä–µ—Å—É—Ä—Å–æ–≤.

## üèóÔ∏è **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Garbage Collection:**

### **1. Owner References**
- –£–ø—Ä–∞–≤–ª—è—é—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ –º–µ–∂–¥—É –æ–±—ä–µ–∫—Ç–∞–º–∏
- –û–ø—Ä–µ–¥–µ–ª—è—é—Ç –∏–µ—Ä–∞—Ä—Ö–∏—é –≤–ª–∞–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏
- –û–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É –∑–∞–≤–∏—Å–∏–º—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤

### **2. Cascading Deletion**
- Foreground deletion (—É–¥–∞–ª–µ–Ω–∏–µ dependents –ø–µ—Ä–µ–¥ owner)
- Background deletion (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ dependents)
- Orphan deletion (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ dependents)

### **3. Specialized Collectors**
- Pod Garbage Collector (–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ pods)
- Image Garbage Collector (–Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—Ä–∞–∑—ã)
- Volume Garbage Collector (–Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ volumes)

## üìä **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –≤–∞—à–µ–≥–æ HA –∫–ª–∞—Å—Ç–µ—Ä–∞:**

### **1. –ü—Ä–æ–≤–µ—Ä–∫–∞ garbage collection:**
```bash
# Garbage collector —Å—Ç–∞—Ç—É—Å
kubectl get pods -n kube-system -l component=kube-controller-manager

# Owner references –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ
kubectl get pods --all-namespaces -o jsonpath='{range .items[*]}{.metadata.name}{"\t"}{.metadata.ownerReferences[*].name}{"\n"}{end}' | head -10

# GC –º–µ—Ç—Ä–∏–∫–∏
kubectl get --raw /metrics | grep garbage_collector

# Orphaned –æ–±—ä–µ–∫—Ç—ã
kubectl get all --all-namespaces -o json | jq '.items[] | select(.metadata.ownerReferences == null and .kind != "Namespace") | {kind: .kind, name: .metadata.name, namespace: .metadata.namespace}' | head -5
```

### **2. ArgoCD –∏ owner references:**
```bash
# ArgoCD Applications –∏ –∏—Ö dependents
kubectl get applications -n argocd -o jsonpath='{range .items[*]}{.metadata.name}{"\t"}{.metadata.ownerReferences[*].name}{"\n"}{end}'

# –†–µ—Å—É—Ä—Å—ã —Å–æ–∑–¥–∞–Ω–Ω—ã–µ ArgoCD
kubectl get all -n monitoring -o json | jq '.items[] | select(.metadata.ownerReferences != null) | {kind: .kind, name: .metadata.name, owner: .metadata.ownerReferences[0].name}'

# ArgoCD managed resources
kubectl get all --all-namespaces -l app.kubernetes.io/instance=monitoring -o json | jq '.items[] | {kind: .kind, name: .metadata.name, namespace: .metadata.namespace}'
```

### **3. Storage garbage collection:**
```bash
# PV/PVC owner references
kubectl get pv -o jsonpath='{range .items[*]}{.metadata.name}{"\t"}{.metadata.ownerReferences[*].name}{"\n"}{end}'

# PVC –≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–µ
kubectl get pvc -n monitoring -o yaml | grep -A 5 -B 5 ownerReferences

# –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ volumes
kubectl get pv --no-headers | awk '$5=="Available" {print $1}'
```

### **4. Pod garbage collection:**
```bash
# –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ pods
kubectl get pods --all-namespaces --field-selector status.phase=Succeeded

# Failed pods
kubectl get pods --all-namespaces --field-selector status.phase=Failed

# Pod owner references
kubectl get pods -n monitoring -o json | jq '.items[] | {name: .metadata.name, owner: .metadata.ownerReferences[0].name}'
```

## üîÑ **–¢–∏–ø—ã Deletion Strategies:**

### **1. Background Deletion (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):**
```bash
# Background deletion - owner —É–¥–∞–ª—è–µ—Ç—Å—è —Å—Ä–∞–∑—É, dependents –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
kubectl delete deployment test-app --cascade=background

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
kubectl get deployment test-app  # –£–¥–∞–ª–µ–Ω —Å—Ä–∞–∑—É
kubectl get replicaset -l app=test-app  # –£–¥–∞–ª—è–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
kubectl get pods -l app=test-app  # –£–¥–∞–ª—è–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
```

### **2. Foreground Deletion:**
```bash
# Foreground deletion - dependents —É–¥–∞–ª—è—é—Ç—Å—è –ø–µ—Ä–µ–¥ owner
kubectl delete deployment test-app --cascade=foreground

# Owner –æ—Å—Ç–∞–µ—Ç—Å—è –¥–æ —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö dependents
kubectl get deployment test-app -o yaml | grep deletionTimestamp
kubectl get replicaset -l app=test-app
kubectl get pods -l app=test-app
```

### **3. Orphan Deletion:**
```bash
# Orphan deletion - dependents –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ owner
kubectl delete deployment test-app --cascade=orphan

# Owner —É–¥–∞–ª–µ–Ω, dependents –æ—Å—Ç–∞—é—Ç—Å—è
kubectl get deployment test-app  # –ù–µ –Ω–∞–π–¥–µ–Ω
kubectl get replicaset -l app=test-app  # –û—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ owner
kubectl get pods -l app=test-app  # –û—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ owner
```

## üîß **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è Owner References:**

### **1. –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ —Å owner references:**
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ Deployment (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç ReplicaSet –∏ Pods —Å owner references)
kubectl create deployment gc-demo --image=nginx:alpine --replicas=3

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–µ—Ä–∞—Ä—Ö–∏–∏ owner references
kubectl get deployment gc-demo -o yaml | grep -A 10 metadata
kubectl get replicaset -l app=gc-demo -o yaml | grep -A 10 ownerReferences
kubectl get pods -l app=gc-demo -o yaml | grep -A 10 ownerReferences

# –£–¥–∞–ª–µ–Ω–∏–µ Deployment (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç ReplicaSet –∏ Pods)
kubectl delete deployment gc-demo

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
kubectl get replicaset -l app=gc-demo
kubectl get pods -l app=gc-demo
```

### **2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ orphan deletion:**
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ Deployment
kubectl create deployment orphan-demo --image=nginx:alpine --replicas=2

# Orphan deletion - ReplicaSet –∏ Pods –æ—Å—Ç–∞–Ω—É—Ç—Å—è
kubectl delete deployment orphan-demo --cascade=orphan

# –ü—Ä–æ–≤–µ—Ä–∫–∞ orphaned —Ä–µ—Å—É—Ä—Å–æ–≤
kubectl get replicaset -l app=orphan-demo
kubectl get pods -l app=orphan-demo

# –†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ orphaned —Ä–µ—Å—É—Ä—Å–æ–≤
kubectl delete replicaset -l app=orphan-demo
```

### **3. –°–æ–∑–¥–∞–Ω–∏–µ custom owner reference:**
```bash
# ConfigMap –∫–∞–∫ owner
cat << EOF | kubectl apply -f -
apiVersion: v1
kind: ConfigMap
metadata:
  name: owner-demo
  namespace: default
data:
  config: "test"
EOF

# Secret —Å owner reference –Ω–∞ ConfigMap
cat << EOF | kubectl apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: dependent-demo
  namespace: default
  ownerReferences:
  - apiVersion: v1
    kind: ConfigMap
    name: owner-demo
    uid: $(kubectl get configmap owner-demo -o jsonpath='{.metadata.uid}')
    controller: false
    blockOwnerDeletion: false
type: Opaque
data:
  key: $(echo -n "value" | base64)
EOF

# –ü—Ä–æ–≤–µ—Ä–∫–∞ owner reference
kubectl describe secret dependent-demo | grep -A 5 "Owner References"

# –£–¥–∞–ª–µ–Ω–∏–µ owner (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç dependent)
kubectl delete configmap owner-demo

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
kubectl get secret dependent-demo
```

## üìà **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Garbage Collection:**

### **1. GC –º–µ—Ç—Ä–∏–∫–∏:**
```bash
# Garbage collector –º–µ—Ç—Ä–∏–∫–∏
kubectl get --raw /metrics | grep "garbage_collector_attempt_duration_seconds"

# GC attempts
kubectl get --raw /metrics | grep "garbage_collector_attempts_total"

# Pending deletions
kubectl get all --all-namespaces -o json | jq '.items[] | select(.metadata.deletionTimestamp != null) | {kind: .kind, name: .metadata.name, namespace: .metadata.namespace}'
```

### **2. –ê–Ω–∞–ª–∏–∑ owner references:**
```bash
# –ü–æ–¥—Å—á–µ—Ç –æ–±—ä–µ–∫—Ç–æ–≤ —Å owner references
kubectl get all --all-namespaces -o json | jq '.items[] | select(.metadata.ownerReferences != null) | {kind: .kind, name: .metadata.name, owner: .metadata.ownerReferences[0].name}' | jq -s 'group_by(.kind) | map({kind: .[0].kind, count: length})'

# Orphaned –æ–±—ä–µ–∫—Ç—ã –ø–æ —Ç–∏–ø–∞–º
kubectl get all --all-namespaces -o json | jq '.items[] | select(.metadata.ownerReferences == null and .kind != "Namespace") | .kind' | sort | uniq -c

# Blocked deletions
kubectl get all --all-namespaces -o json | jq '.items[] | select(.metadata.ownerReferences != null and .metadata.ownerReferences[].blockOwnerDeletion == true) | {kind: .kind, name: .metadata.name}'
```

### **3. Resource usage analysis:**
```bash
# Pod —Å—Ç–∞—Ç—É—Å—ã
kubectl get pods --all-namespaces --no-headers | awk '{print $4}' | sort | uniq -c

# Completed jobs —Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤
kubectl get jobs --all-namespaces -o json | jq '.items[] | select(.status.completionTime != null and (.status.completionTime | fromdateiso8601) < (now - 86400)) | {namespace: .metadata.namespace, name: .metadata.name, completed: .status.completionTime}'

# Image usage –Ω–∞ nodes
kubectl describe nodes | grep -A 10 "Images:" | grep -E "(Names|Size)"
```

## üè≠ **Garbage Collection –≤ –≤–∞—à–µ–º HA –∫–ª–∞—Å—Ç–µ—Ä–µ:**

### **1. ArgoCD garbage collection:**
```bash
# ArgoCD Applications –∏ –∏—Ö —Ä–µ—Å—É—Ä—Å—ã
kubectl get applications -n argocd
kubectl describe application monitoring -n argocd | grep -A 10 "Resource Status"

# –†–µ—Å—É—Ä—Å—ã —É–ø—Ä–∞–≤–ª—è–µ–º—ã–µ ArgoCD
kubectl get all -n monitoring -l app.kubernetes.io/managed-by=argocd

# ArgoCD finalizers –∏ GC
kubectl get applications -n argocd -o yaml | grep -A 5 -B 5 finalizers
```

### **2. Monitoring stack GC:**
```bash
# Prometheus owner references
kubectl get statefulset prometheus-server -n monitoring -o yaml | grep -A 10 ownerReferences

# Grafana dependents
kubectl get all -n monitoring -l app.kubernetes.io/name=grafana -o json | jq '.items[] | {kind: .kind, name: .metadata.name, owner: .metadata.ownerReferences[0].name}'

# PVC garbage collection –≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–µ
kubectl get pvc -n monitoring -o yaml | grep -A 5 -B 5 ownerReferences
```

### **3. Storage garbage collection:**
```bash
# NFS volumes GC
kubectl get pv | grep nfs
kubectl describe pv | grep -A 5 "Reclaim Policy"

# Block storage GC
kubectl get pv | grep do-block-storage
kubectl get pvc --all-namespaces | grep Bound

# Unused PVs
kubectl get pv --no-headers | awk '$5=="Available" {print "Unused PV:", $1}'
```

## üîÑ **Specialized Garbage Collectors:**

### **1. Pod Garbage Collection:**
```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Pod GC –≤ controller-manager
kubectl describe pod -n kube-system -l component=kube-controller-manager | grep -A 5 -B 5 "terminated-pod-gc-threshold"

# –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ pods –¥–ª—è –æ—á–∏—Å—Ç–∫–∏
kubectl get pods --all-namespaces --field-selector status.phase=Succeeded --no-headers | wc -l
kubectl get pods --all-namespaces --field-selector status.phase=Failed --no-headers | wc -l

# Manual pod cleanup
kubectl delete pods --all-namespaces --field-selector status.phase=Succeeded --grace-period=0 --force
```

### **2. Image Garbage Collection:**
```bash
# Image usage –Ω–∞ nodes
kubectl get nodes -o json | jq '.items[] | {node: .metadata.name, images: (.status.images | length)}'

# Kubelet image GC –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
kubectl describe node | grep -A 10 "System Info" | grep -E "(Container Runtime|Kubelet)"

# Manual image cleanup (–Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π node)
kubectl debug node/<node-name> -it --image=alpine -- chroot /host sh -c "docker system prune -f"
```

### **3. Volume Garbage Collection:**
```bash
# Volume attachment status
kubectl get volumeattachments

# Unused PVCs
kubectl get pvc --all-namespaces -o json | jq '.items[] | select(.status.phase == "Bound") | {namespace: .metadata.namespace, name: .metadata.name, volume: .spec.volumeName}'

# Storage class reclaim policies
kubectl get storageclass -o yaml | grep reclaimPolicy
```

## üéØ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Garbage Collection:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Kubernetes Garbage Collection                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Garbage Collector Controller                               ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Owner Reference tracking                              ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Dependency graph analysis                             ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Cascading deletion logic                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Deletion Strategies                                        ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Foreground (dependents first)                         ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Background (owner first, async dependents)            ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Orphan (owner only, keep dependents)                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Specialized Collectors                                     ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Pod GC (completed/failed pods)                        ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Image GC (unused container images)                    ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Volume GC (unattached volumes)                        ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Event GC (old cluster events)                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Resource Types                                             ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Deployments ‚Üí ReplicaSets ‚Üí Pods                      ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ StatefulSets ‚Üí Pods ‚Üí PVCs                           ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Jobs ‚Üí Pods                                           ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Custom Resources ‚Üí Dependents                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîß **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Garbage Collection:**

### **1. Controller Manager –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ GC –Ω–∞—Å—Ç—Ä–æ–µ–∫
kubectl describe pod -n kube-system -l component=kube-controller-manager | grep -A 20 "Command:"

# GC —Ñ–ª–∞–≥–∏
kubectl logs -n kube-system -l component=kube-controller-manager | grep -E "(garbage|gc)" | head -5

# Concurrent GC syncs
kubectl get pod -n kube-system -l component=kube-controller-manager -o yaml | grep -A 5 -B 5 "concurrent-gc-syncs"
```

### **2. Kubelet GC –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
```bash
# Image GC thresholds
kubectl describe node | grep -A 5 -B 5 "image-gc"

# Container GC –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
kubectl get --raw /api/v1/nodes/<node-name>/proxy/configz | jq '.kubeletconfig | {imageGCHighThresholdPercent, imageGCLowThresholdPercent}'

# Manual GC trigger
kubectl get --raw /api/v1/nodes/<node-name>/proxy/stats/summary | jq '.node.fs'
```

## üö® **Troubleshooting Garbage Collection:**

### **1. Stuck deletions:**
```bash
# –û–±—ä–µ–∫—Ç—ã —Å deletionTimestamp –Ω–æ –Ω–µ —É–¥–∞–ª–µ–Ω–Ω—ã–µ
kubectl get all --all-namespaces -o json | jq '.items[] | select(.metadata.deletionTimestamp != null) | {kind: .kind, name: .metadata.name, namespace: .metadata.namespace, deletionTimestamp: .metadata.deletionTimestamp}'

# Blocked owner deletions
kubectl get all --all-namespaces -o json | jq '.items[] | select(.metadata.ownerReferences != null and .metadata.ownerReferences[].blockOwnerDeletion == true and .metadata.deletionTimestamp != null)'

# GC controller –ª–æ–≥–∏
kubectl logs -n kube-system -l component=kube-controller-manager | grep -i "garbage\|gc" | tail -10
```

### **2. Orphaned resources:**
```bash
# –ü–æ–∏—Å–∫ orphaned pods
kubectl get pods --all-namespaces -o json | jq '.items[] | select(.metadata.ownerReferences == null) | {namespace: .metadata.namespace, name: .metadata.name}'

# Orphaned ReplicaSets
kubectl get replicasets --all-namespaces -o json | jq '.items[] | select(.metadata.ownerReferences == null) | {namespace: .metadata.namespace, name: .metadata.name}'

# Manual cleanup orphaned resources
kubectl delete replicasets --all-namespaces --field-selector metadata.ownerReferences=null
```

### **3. GC performance issues:**
```bash
# GC metrics analysis
kubectl get --raw /metrics | grep "garbage_collector_attempt_duration_seconds" | grep -E "(sum|count)"

# High deletion latency
kubectl get events --all-namespaces --field-selector reason=FailedDelete

# Resource pressure
kubectl top nodes
kubectl describe nodes | grep -A 5 "Allocated resources"
```

## üéØ **Best Practices –¥–ª—è Garbage Collection:**

### **1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ GC –º–µ—Ç—Ä–∏–∫–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ orphaned —Ä–µ—Å—É—Ä—Å—ã
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ stuck deletions

### **2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ GC thresholds
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ deletion strategies
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–π—Ç–µ retention policies

### **3. –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞:**
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ owner references
- –ò–∑–±–µ–≥–∞–π—Ç–µ circular dependencies
- –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ deletion scenarios

### **4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ—á–∏—â–∞–π—Ç–µ completed jobs
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ image usage
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ storage reclaim policies

**Garbage Collection ‚Äî —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —á–∏—Å—Ç–æ—Ç—ã –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä–∞!**
