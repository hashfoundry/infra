# 201. –ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è?

## üéØ **–ß—Ç–æ —Ç–∞–∫–æ–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è?**

**Advanced Scheduling Constraints** ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º—ã Kubernetes –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è Pod'–æ–≤ –Ω–∞ Node'–∞—Ö. –û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ affinity, anti-affinity, topology spread constraints –∏ custom schedulers –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–∞–±–æ—á–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫.

## üèóÔ∏è **–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π:**

### **1. Node Affinity**
- –ü—Ä–∏–≤—è–∑–∫–∞ Pod'–æ–≤ –∫ Node'–∞–º –ø–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º
- Required (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ) –∏ Preferred (–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–µ) –ø—Ä–∞–≤–∏–ª–∞
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ labels Node'–æ–≤

### **2. Pod Affinity/Anti-Affinity**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–≤–º–µ—Å—Ç–Ω—ã–º —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ–º Pod'–æ–≤
- Co-location –¥–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –≤—ã—Å–æ–∫–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

### **3. Topology Spread Constraints**
- –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∑–æ–Ω–∞–º/Node'–∞–º
- –ö–æ–Ω—Ç—Ä–æ–ª—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
- –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏

### **4. Taints & Tolerations**
- –ò–∑–æ–ª—è—Ü–∏—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö Node'–æ–≤
- –í—ã–¥–µ–ª–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö workload'–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –∫ Node'–∞–º

## üìä **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –≤–∞—à–µ–≥–æ HA –∫–ª–∞—Å—Ç–µ—Ä–∞:**

### **1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å labels Node'–æ–≤
kubectl get nodes --show-labels

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å taints –Ω–∞ Node'–∞—Ö
kubectl describe nodes | grep -A 5 "Taints"

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Pod'–æ–≤ –ø–æ Node'–∞–º
kubectl get pods -o wide --all-namespaces

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å scheduling events
kubectl get events --all-namespaces | grep -i "schedule\|affinity"
```

### **2. ArgoCD —Å Anti-Affinity:**
```bash
# ArgoCD —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç anti-affinity –¥–ª—è HA
kubectl describe deployment argocd-server -n argocd | grep -A 10 "Pod Template"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ ArgoCD Pod'–æ–≤
kubectl get pods -n argocd -l app.kubernetes.io/name=argocd-server -o wide

# ArgoCD Pod'—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã—Ö Node'–∞—Ö
kubectl get pods -n argocd -o custom-columns=NAME:.metadata.name,NODE:.spec.nodeName
```

### **3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å Topology Spread:**
```bash
# Prometheus —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ –∑–æ–Ω–∞–º
kubectl get pods -n monitoring -l app=prometheus -o wide

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å topology spread constraints
kubectl describe deployment prometheus-server -n monitoring | grep -A 5 "Topology Spread"

# Grafana —Ç–æ–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
kubectl get pods -n monitoring -l app.kubernetes.io/name=grafana -o wide
```

## üîß **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è Node Affinity:**

### **1. GPU Node'—ã –¥–ª—è ML workload'–æ–≤:**
```bash
# –°–æ–∑–¥–∞—Ç—å Deployment —Å Node Affinity
cat << EOF | kubectl apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ml-training
  namespace: default
spec:
  replicas: 2
  selector:
    matchLabels:
      app: ml-training
  template:
    metadata:
      labels:
        app: ml-training
    spec:
      affinity:
        nodeAffinity:
          # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ: —Ç–æ–ª—å–∫–æ worker Node'—ã
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: node-role.kubernetes.io/worker
                operator: Exists
          # –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ: Node'—ã —Å SSD
          preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 80
            preference:
              matchExpressions:
              - key: storage-type
                operator: In
                values: ["ssd"]
      containers:
      - name: trainer
        image: tensorflow/tensorflow:latest
        resources:
          requests:
            cpu: 1000m
            memory: 2Gi
          limits:
            cpu: 2000m
            memory: 4Gi
EOF

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ
kubectl get pods -l app=ml-training -o wide

# –û—á–∏—Å—Ç–∫–∞
kubectl delete deployment ml-training
```

### **2. Database —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∫ storage:**
```bash
# StatefulSet —Å Node Affinity –¥–ª—è SSD
cat << EOF | kubectl apply -f -
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: database
  namespace: default
spec:
  serviceName: database
  replicas: 2
  selector:
    matchLabels:
      app: database
  template:
    metadata:
      labels:
        app: database
    spec:
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: node-role.kubernetes.io/worker
                operator: Exists
          preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 100
            preference:
              matchExpressions:
              - key: storage-type
                operator: In
                values: ["ssd", "nvme"]
      containers:
      - name: postgres
        image: postgres:13
        env:
        - name: POSTGRES_DB
          value: "testdb"
        - name: POSTGRES_USER
          value: "testuser"
        - name: POSTGRES_PASSWORD
          value: "testpass"
        resources:
          requests:
            cpu: 500m
            memory: 1Gi
          limits:
            cpu: 1000m
            memory: 2Gi
EOF

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ
kubectl get pods -l app=database -o wide

# –û—á–∏—Å—Ç–∫–∞
kubectl delete statefulset database
```

## üîÑ **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è Pod Anti-Affinity:**

### **1. Web Frontend —Å HA:**
```bash
# Deployment —Å Pod Anti-Affinity
cat << EOF | kubectl apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-frontend
  namespace: default
spec:
  replicas: 3
  selector:
    matchLabels:
      app: web-frontend
  template:
    metadata:
      labels:
        app: web-frontend
    spec:
      affinity:
        podAntiAffinity:
          # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ: –∫–∞–∂–¥—ã–π Pod –Ω–∞ —Ä–∞–∑–Ω–æ–π Node
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
              - key: app
                operator: In
                values: ["web-frontend"]
            topologyKey: kubernetes.io/hostname
      containers:
      - name: web
        image: nginx:alpine
        ports:
        - containerPort: 80
        resources:
          requests:
            cpu: 100m
            memory: 128Mi
          limits:
            cpu: 200m
            memory: 256Mi
EOF

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ Node'–∞–º
kubectl get pods -l app=web-frontend -o wide

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã—Ö Node'–∞—Ö
kubectl get pods -l app=web-frontend -o custom-columns=NAME:.metadata.name,NODE:.spec.nodeName

# –û—á–∏—Å—Ç–∫–∞
kubectl delete deployment web-frontend
```

### **2. Cache —Å Affinity –∫ Database:**
```bash
# Redis Cache —Å Pod Affinity
cat << EOF | kubectl apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: redis-cache
  namespace: default
spec:
  replicas: 2
  selector:
    matchLabels:
      app: redis-cache
  template:
    metadata:
      labels:
        app: redis-cache
    spec:
      affinity:
        # Anti-affinity –º–µ–∂–¥—É cache Pod'–∞–º–∏
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 100
            podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app
                  operator: In
                  values: ["redis-cache"]
              topologyKey: kubernetes.io/hostname
        # Affinity —Å database Pod'–∞–º–∏
        podAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 80
            podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app
                  operator: In
                  values: ["database"]
              topologyKey: kubernetes.io/hostname
      containers:
      - name: redis
        image: redis:6-alpine
        ports:
        - containerPort: 6379
        resources:
          requests:
            cpu: 100m
            memory: 256Mi
          limits:
            cpu: 200m
            memory: 512Mi
EOF

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ database
kubectl get pods -l app=redis-cache -o wide
kubectl get pods -l app=database -o wide

# –û—á–∏—Å—Ç–∫–∞
kubectl delete deployment redis-cache
```

## üìà **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è Topology Spread Constraints:**

### **1. –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∑–æ–Ω–∞–º:**
```bash
# Deployment —Å Topology Spread
cat << EOF | kubectl apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: distributed-app
  namespace: default
spec:
  replicas: 6
  selector:
    matchLabels:
      app: distributed-app
  template:
    metadata:
      labels:
        app: distributed-app
    spec:
      topologySpreadConstraints:
      # –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ –ø–æ –∑–æ–Ω–∞–º (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ: 1)
      - maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: DoNotSchedule
        labelSelector:
          matchLabels:
            app: distributed-app
      # –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –ø–æ Node'–∞–º (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ: 2)
      - maxSkew: 2
        topologyKey: kubernetes.io/hostname
        whenUnsatisfiable: ScheduleAnyway
        labelSelector:
          matchLabels:
            app: distributed-app
      containers:
      - name: app
        image: nginx:alpine
        resources:
          requests:
            cpu: 100m
            memory: 128Mi
          limits:
            cpu: 200m
            memory: 256Mi
EOF

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∑–æ–Ω–∞–º
kubectl get pods -l app=distributed-app -o custom-columns=NAME:.metadata.name,NODE:.spec.nodeName,ZONE:.metadata.labels.topology\\.kubernetes\\.io/zone

# –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å Pod'—ã –ø–æ –∑–æ–Ω–∞–º
kubectl get pods -l app=distributed-app -o jsonpath='{.items[*].metadata.labels.topology\.kubernetes\.io/zone}' | tr ' ' '\n' | sort | uniq -c

# –û—á–∏—Å—Ç–∫–∞
kubectl delete deployment distributed-app
```

### **2. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Å–µ—Ä–≤–∏—Å —Å —Å—Ç—Ä–æ–≥–∏–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º:**
```bash
# –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Å–µ—Ä–≤–∏—Å
cat << EOF | kubectl apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: critical-service
  namespace: default
spec:
  replicas: 3
  selector:
    matchLabels:
      app: critical-service
  template:
    metadata:
      labels:
        app: critical-service
        tier: critical
    spec:
      topologySpreadConstraints:
      # –°—Ç—Ä–æ–≥–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ: –ø–æ –æ–¥–Ω–æ–º—É Pod'—É –Ω–∞ –∑–æ–Ω—É
      - maxSkew: 0
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: DoNotSchedule
        labelSelector:
          matchLabels:
            app: critical-service
      containers:
      - name: service
        image: nginx:alpine
        ports:
        - containerPort: 80
        resources:
          requests:
            cpu: 200m
            memory: 256Mi
          limits:
            cpu: 500m
            memory: 512Mi
        livenessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 5
          periodSeconds: 5
EOF

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä–æ–≥–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
kubectl get pods -l app=critical-service -o wide

# –û—á–∏—Å—Ç–∫–∞
kubectl delete deployment critical-service
```

## üîí **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è Taints & Tolerations:**

### **1. –í—ã–¥–µ–ª–µ–Ω–Ω—ã–µ Node'—ã –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö Pod'–æ–≤:**
```bash
# –î–æ–±–∞–≤–∏—Ç—å taint –Ω–∞ Node (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)
# kubectl taint nodes <node-name> dedicated=system:NoSchedule

# DaemonSet —Å tolerations –¥–ª—è –≤—Å–µ—Ö Node'–æ–≤
cat << EOF | kubectl apply -f -
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: monitoring-agent
  namespace: default
spec:
  selector:
    matchLabels:
      app: monitoring-agent
  template:
    metadata:
      labels:
        app: monitoring-agent
    spec:
      tolerations:
      # Tolerate –≤—Å–µ taints –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
      - operator: Exists
        effect: NoSchedule
      - operator: Exists
        effect: NoExecute
      - operator: Exists
        effect: PreferNoSchedule
      containers:
      - name: agent
        image: busybox
        command: ["sleep", "3600"]
        resources:
          requests:
            cpu: 50m
            memory: 64Mi
          limits:
            cpu: 100m
            memory: 128Mi
EOF

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö Node'–∞—Ö
kubectl get pods -l app=monitoring-agent -o wide

# –û—á–∏—Å—Ç–∫–∞
kubectl delete daemonset monitoring-agent
```

### **2. Workload —Å —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–º–∏ tolerations:**
```bash
# Pod —Å tolerations –¥–ª—è maintenance Node'–æ–≤
cat << EOF | kubectl apply -f -
apiVersion: v1
kind: Pod
metadata:
  name: maintenance-job
  namespace: default
spec:
  tolerations:
  - key: maintenance
    operator: Equal
    value: "scheduled"
    effect: NoSchedule
  - key: node.kubernetes.io/not-ready
    operator: Exists
    effect: NoExecute
    tolerationSeconds: 300
  containers:
  - name: job
    image: busybox
    command: ["sleep", "300"]
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
EOF

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ
kubectl get pod maintenance-job -o wide

# –û—á–∏—Å—Ç–∫–∞
kubectl delete pod maintenance-job
```

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:**

### **1. –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
cat << 'EOF' > test-scheduling.sh
#!/bin/bash

echo "üß™ Testing Advanced Scheduling Constraints"

# Test 1: Node Affinity
echo "=== Testing Node Affinity ==="
kubectl apply -f - << YAML
apiVersion: v1
kind: Pod
metadata:
  name: node-affinity-test
spec:
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: node-role.kubernetes.io/worker
            operator: Exists
  containers:
  - name: test
    image: busybox
    command: ["sleep", "60"]
YAML

kubectl wait --for=condition=PodScheduled pod/node-affinity-test --timeout=30s
if [ $? -eq 0 ]; then
    echo "‚úÖ Node affinity test passed"
    kubectl get pod node-affinity-test -o wide
else
    echo "‚ùå Node affinity test failed"
fi

# Test 2: Pod Anti-Affinity
echo "=== Testing Pod Anti-Affinity ==="
kubectl apply -f - << YAML
apiVersion: apps/v1
kind: Deployment
metadata:
  name: anti-affinity-test
spec:
  replicas: 2
  selector:
    matchLabels:
      app: anti-affinity-test
  template:
    metadata:
      labels:
        app: anti-affinity-test
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
              - key: app
                operator: In
                values: ["anti-affinity-test"]
            topologyKey: kubernetes.io/hostname
      containers:
      - name: test
        image: busybox
        command: ["sleep", "60"]
YAML

kubectl wait --for=condition=available deployment/anti-affinity-test --timeout=60s
if [ $? -eq 0 ]; then
    echo "‚úÖ Pod anti-affinity test passed"
    kubectl get pods -l app=anti-affinity-test -o wide
else
    echo "‚ùå Pod anti-affinity test failed"
fi

# Cleanup
echo "=== Cleanup ==="
kubectl delete pod node-affinity-test --ignore-not-found=true
kubectl delete deployment anti-affinity-test --ignore-not-found=true

echo "‚úÖ Testing completed"
EOF

chmod +x test-scheduling.sh
./test-scheduling.sh
```

### **2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ scheduling events:**
```bash
# –°–ª–µ–¥–∏—Ç—å –∑–∞ scheduling events –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
kubectl get events --watch --field-selector reason=Scheduled

# –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å failed scheduling events
kubectl get events --field-selector reason=FailedScheduling

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å pending Pod'—ã —Å –ø—Ä–∏—á–∏–Ω–∞–º–∏
kubectl get pods --all-namespaces --field-selector=status.phase=Pending -o wide
```

## üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ Grafana:**

### **1. Scheduler –º–µ—Ç—Ä–∏–∫–∏:**
```bash
# Port forward –∫ Prometheus
kubectl port-forward svc/prometheus-server -n monitoring 9090:80

# Scheduler –º–µ—Ç—Ä–∏–∫–∏:
# scheduler_scheduling_duration_seconds - –≤—Ä–µ–º—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
# scheduler_pending_pods - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ pending Pod'–æ–≤
# scheduler_schedule_attempts_total - –ø–æ–ø—ã—Ç–∫–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
```

### **2. Node utilization:**
```bash
# Port forward –∫ Grafana
kubectl port-forward svc/grafana -n monitoring 3000:80

# Dashboards –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
# - Node utilization –ø–æ –∑–æ–Ω–∞–º
# - Pod distribution –ø–æ Node'–∞–º
# - Scheduling latency
```

## üéØ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Advanced Scheduling:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                Advanced Scheduling                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Pod Specification                                          ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Node Affinity (required/preferred)                    ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Pod Affinity/Anti-Affinity                            ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Topology Spread Constraints                           ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Tolerations                                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Scheduler Framework                                        ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Filter Plugins (node selection)                       ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Score Plugins (node ranking)                          ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Bind Plugins (pod assignment)                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Constraint Evaluation                                      ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Node Labels & Taints                                  ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Resource Availability                                 ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Topology Requirements                                 ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Custom Scheduler Logic                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Node Selection                                             ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Zone A (Node 1, Node 2)                              ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Zone B (Node 3, Node 4)                              ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Zone C (Node 5, Node 6)                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üö® **Troubleshooting:**

### **1. Pod –Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Pod events
kubectl describe pod <pod-name>

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Node'—ã –∏ –∏—Ö labels
kubectl get nodes --show-labels

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å taints
kubectl describe nodes | grep -A 5 "Taints"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å resource requests
kubectl describe pod <pod-name> | grep -A 5 "Requests"
```

### **2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å topology spread constraints
kubectl describe deployment <deployment-name> | grep -A 10 "Topology Spread"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å affinity rules
kubectl describe deployment <deployment-name> | grep -A 10 "Affinity"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
kubectl get pods -l <selector> -o wide
```

## üéØ **Best Practices:**

### **1. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ preferred affinity –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏
- –ö–æ–º–±–∏–Ω–∏—Ä—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
- –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ constraints –≤ dev —Å—Ä–µ–¥–µ

### **2. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- –ò–∑–±–µ–≥–∞–π—Ç–µ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ scheduler latency
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ topology spread –¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏

### **3. –í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:**
- –ü—Ä–∏–º–µ–Ω—è–π—Ç–µ anti-affinity –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–π—Ç–µ –ø–æ –∑–æ–Ω–∞–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
- –£—á–∏—Ç—ã–≤–∞–π—Ç–µ failure domains

**Advanced Scheduling Constraints ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è workload'–æ–≤ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ!**
