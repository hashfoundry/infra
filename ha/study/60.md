# 60. How do you troubleshoot ConfigMap and Secret issues?

## üéØ **Troubleshooting ConfigMaps –∏ Secrets**

**Troubleshooting ConfigMaps –∏ Secrets** - —ç—Ç–æ –≤–∞–∂–Ω—ã–π –Ω–∞–≤—ã–∫ –¥–ª—è DevOps –∏–Ω–∂–µ–Ω–µ—Ä–æ–≤. –ü—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏ –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Å–±–æ—è–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –ø–æ—ç—Ç–æ–º—É –≤–∞–∂–Ω–æ –∑–Ω–∞—Ç—å, –∫–∞–∫ –±—ã—Å—Ç—Ä–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —Ä–µ—à–∞—Ç—å —Ç–∞–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã.

## üèóÔ∏è **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–æ–±–ª–µ–º:**

### **1. –ü—Ä–æ–±–ª–µ–º—ã —Å–æ–∑–¥–∞–Ω–∏—è –∏ –¥–æ—Å—Ç—É–ø–∞**
### **2. –ü—Ä–æ–±–ª–µ–º—ã –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è**
### **3. –ü—Ä–æ–±–ª–µ–º—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**
### **4. –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∏ RBAC**
### **5. –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—Å—É—Ä—Å–æ–≤**

## üìä **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –≤–∞—à–µ–≥–æ HA –∫–ª–∞—Å—Ç–µ—Ä–∞:**

### **1. –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å—Ä–µ–¥—ã —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏:**
```bash
# –°–æ–∑–¥–∞—Ç—å namespace –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ troubleshooting
kubectl create namespace troubleshooting-demo

# –°–æ–∑–¥–∞—Ç—å ConfigMap —Å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏
kubectl create configmap problematic-config \
  --from-literal=app.name="HashFoundry Application" \
  --from-literal=app.version="1.0.0" \
  --from-literal=database.host="postgres-server.hashfoundry.local" \
  --from-literal=database.port="5432" \
  --from-literal=invalid.json='{"key": "value", "missing": }' \
  --from-literal=empty.value="" \
  --from-literal=special.chars="value with spaces & symbols!" \
  -n troubleshooting-demo

# –°–æ–∑–¥–∞—Ç—å Secret —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏
kubectl create secret generic problematic-secret \
  --from-literal=database.username="user" \
  --from-literal=database.password="" \
  --from-literal=api.key="invalid-key-format" \
  --from-literal=malformed.base64="not-base64-encoded!" \
  -n troubleshooting-demo

# –°–æ–∑–¥–∞—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
cat << EOF | kubectl apply -f -
apiVersion: v1
kind: Pod
metadata:
  name: problematic-pod
  namespace: troubleshooting-demo
spec:
  containers:
  - name: app
    image: busybox:1.35
    command: ["sleep", "3600"]
    env:
    # –°—Å—ã–ª–∫–∞ –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π ConfigMap
    - name: MISSING_CONFIG
      valueFrom:
        configMapKeyRef:
          name: non-existent-config
          key: some.key
    # –°—Å—ã–ª–∫–∞ –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–ª—é—á
    - name: MISSING_KEY
      valueFrom:
        configMapKeyRef:
          name: problematic-config
          key: non.existent.key
    # –°—Å—ã–ª–∫–∞ –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Secret
    - name: MISSING_SECRET
      valueFrom:
        secretKeyRef:
          name: non-existent-secret
          key: some.key
    volumeMounts:
    - name: config-volume
      mountPath: /etc/config
    - name: secret-volume
      mountPath: /etc/secrets
    - name: missing-volume
      mountPath: /etc/missing
  volumes:
  - name: config-volume
    configMap:
      name: problematic-config
  - name: secret-volume
    secret:
      secretName: problematic-secret
  # –°—Å—ã–ª–∫–∞ –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π ConfigMap
  - name: missing-volume
    configMap:
      name: missing-configmap
  restartPolicy: Never
EOF

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å Pod'–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ—à–∏–±–∫–∏)
kubectl get pods -n troubleshooting-demo
kubectl describe pod problematic-pod -n troubleshooting-demo
```

### **2. –°–æ–∑–¥–∞–Ω–∏–µ comprehensive troubleshooting toolkit:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ ConfigMaps –∏ Secrets
cat << 'EOF' > troubleshoot-config.sh
#!/bin/bash

NAMESPACE=${1:-"troubleshooting-demo"}
POD_NAME=${2:-""}

echo "=== ConfigMap and Secret Troubleshooting Toolkit ==="
echo "Namespace: $NAMESPACE"
echo "Pod: ${POD_NAME:-"All pods"}"
echo

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
check_resource_existence() {
    echo "=== Resource Existence Check ==="
    
    echo "ConfigMaps in namespace $NAMESPACE:"
    kubectl get configmaps -n $NAMESPACE -o custom-columns="NAME:.metadata.name,AGE:.metadata.creationTimestamp,KEYS:.data" 2>/dev/null || echo "No ConfigMaps found or access denied"
    echo
    
    echo "Secrets in namespace $NAMESPACE:"
    kubectl get secrets -n $NAMESPACE -o custom-columns="NAME:.metadata.name,TYPE:.type,AGE:.metadata.creationTimestamp,KEYS:.data" 2>/dev/null || echo "No Secrets found or access denied"
    echo
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ Pod'–æ–≤ —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏
analyze_pod_issues() {
    echo "=== Pod Configuration Issues Analysis ==="
    
    if [ -n "$POD_NAME" ]; then
        pods=($POD_NAME)
    else
        pods=($(kubectl get pods -n $NAMESPACE -o jsonpath='{.items[*].metadata.name}' 2>/dev/null))
    fi
    
    for pod in "${pods[@]}"; do
        if [ -z "$pod" ]; then
            echo "No pods found in namespace $NAMESPACE"
            continue
        fi
        
        echo "Analyzing pod: $pod"
        echo "----------------------------------------"
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å Pod'–∞
        status=$(kubectl get pod $pod -n $NAMESPACE -o jsonpath='{.status.phase}' 2>/dev/null)
        echo "Pod status: $status"
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–±—ã—Ç–∏—è Pod'–∞
        echo "Recent events for pod $pod:"
        kubectl get events -n $NAMESPACE --field-selector involvedObject.name=$pod --sort-by='.lastTimestamp' | tail -5
        echo
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
        echo "Container statuses:"
        kubectl get pod $pod -n $NAMESPACE -o jsonpath='{.status.containerStatuses[*].state}' 2>/dev/null | jq '.' 2>/dev/null || echo "Container status not available"
        echo
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
        echo "Environment variables configuration:"
        kubectl get pod $pod -n $NAMESPACE -o jsonpath='{.spec.containers[*].env[*]}' 2>/dev/null | jq '.' 2>/dev/null || echo "Environment variables not available"
        echo
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å volume mounts
        echo "Volume mounts configuration:"
        kubectl get pod $pod -n $NAMESPACE -o jsonpath='{.spec.containers[*].volumeMounts[*]}' 2>/dev/null | jq '.' 2>/dev/null || echo "Volume mounts not available"
        echo
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å volumes
        echo "Volumes configuration:"
        kubectl get pod $pod -n $NAMESPACE -o jsonpath='{.spec.volumes[*]}' 2>/dev/null | jq '.' 2>/dev/null || echo "Volumes not available"
        echo
        
        echo "=========================================="
        echo
    done
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ ConfigMaps
validate_configmap_content() {
    echo "=== ConfigMap Content Validation ==="
    
    configmaps=($(kubectl get configmaps -n $NAMESPACE -o jsonpath='{.items[*].metadata.name}' 2>/dev/null))
    
    for cm in "${configmaps[@]}"; do
        if [ -z "$cm" ]; then
            echo "No ConfigMaps found"
            continue
        fi
        
        echo "Validating ConfigMap: $cm"
        echo "----------------------------------------"
        
        # –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–ª—é—á–∏
        keys=($(kubectl get configmap $cm -n $NAMESPACE -o jsonpath='{.data}' 2>/dev/null | jq -r 'keys[]' 2>/dev/null))
        
        for key in "${keys[@]}"; do
            echo "Key: $key"
            value=$(kubectl get configmap $cm -n $NAMESPACE -o jsonpath="{.data.$key}" 2>/dev/null)
            
            # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
            if [ -z "$value" ]; then
                echo "  ‚ö†Ô∏è  WARNING: Empty value"
            fi
            
            # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å JSON –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –µ—Å–ª–∏ –∫–ª—é—á —Å–æ–¥–µ—Ä–∂–∏—Ç 'json'
            if [[ "$key" == *"json"* ]]; then
                echo "  Validating JSON format..."
                echo "$value" | jq '.' >/dev/null 2>&1
                if [ $? -ne 0 ]; then
                    echo "  ‚ùå ERROR: Invalid JSON format"
                else
                    echo "  ‚úÖ Valid JSON"
                fi
            fi
            
            # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–ª–∏–Ω—É –∑–Ω–∞—á–µ–Ω–∏—è
            length=${#value}
            echo "  Value length: $length characters"
            
            if [ $length -gt 1000 ]; then
                echo "  ‚ö†Ô∏è  WARNING: Large value (>1000 chars)"
            fi
            
            echo
        done
        
        echo "=========================================="
        echo
    done
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Secret'–æ–≤
validate_secret_content() {
    echo "=== Secret Content Validation ==="
    
    secrets=($(kubectl get secrets -n $NAMESPACE -o jsonpath='{.items[*].metadata.name}' 2>/dev/null | grep -v default-token))
    
    for secret in "${secrets[@]}"; do
        if [ -z "$secret" ]; then
            echo "No user-created Secrets found"
            continue
        fi
        
        echo "Validating Secret: $secret"
        echo "----------------------------------------"
        
        # –ü–æ–ª—É—á–∏—Ç—å —Ç–∏–ø Secret'–∞
        secret_type=$(kubectl get secret $secret -n $NAMESPACE -o jsonpath='{.type}' 2>/dev/null)
        echo "Secret type: $secret_type"
        
        # –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–ª—é—á–∏
        keys=($(kubectl get secret $secret -n $NAMESPACE -o jsonpath='{.data}' 2>/dev/null | jq -r 'keys[]' 2>/dev/null))
        
        for key in "${keys[@]}"; do
            echo "Key: $key"
            
            # –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
            encoded_value=$(kubectl get secret $secret -n $NAMESPACE -o jsonpath="{.data.$key}" 2>/dev/null)
            
            # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å base64 –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å
            decoded_value=$(echo "$encoded_value" | base64 --decode 2>/dev/null)
            if [ $? -ne 0 ]; then
                echo "  ‚ùå ERROR: Invalid base64 encoding"
            else
                echo "  ‚úÖ Valid base64 encoding"
                
                # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                if [ -z "$decoded_value" ]; then
                    echo "  ‚ö†Ô∏è  WARNING: Empty decoded value"
                fi
                
                # –ü–æ–∫–∞–∑–∞—Ç—å –¥–ª–∏–Ω—É –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
                length=${#decoded_value}
                echo "  Decoded value length: $length characters"
            fi
            
            echo
        done
        
        echo "=========================================="
        echo
    done
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ RBAC –ø—Ä–∞–≤
check_rbac_permissions() {
    echo "=== RBAC Permissions Check ==="
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ ConfigMaps
    echo "ConfigMap permissions:"
    kubectl auth can-i get configmaps -n $NAMESPACE && echo "  ‚úÖ Can get ConfigMaps" || echo "  ‚ùå Cannot get ConfigMaps"
    kubectl auth can-i list configmaps -n $NAMESPACE && echo "  ‚úÖ Can list ConfigMaps" || echo "  ‚ùå Cannot list ConfigMaps"
    kubectl auth can-i create configmaps -n $NAMESPACE && echo "  ‚úÖ Can create ConfigMaps" || echo "  ‚ùå Cannot create ConfigMaps"
    kubectl auth can-i update configmaps -n $NAMESPACE && echo "  ‚úÖ Can update ConfigMaps" || echo "  ‚ùå Cannot update ConfigMaps"
    kubectl auth can-i delete configmaps -n $NAMESPACE && echo "  ‚úÖ Can delete ConfigMaps" || echo "  ‚ùå Cannot delete ConfigMaps"
    echo
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ Secrets
    echo "Secret permissions:"
    kubectl auth can-i get secrets -n $NAMESPACE && echo "  ‚úÖ Can get Secrets" || echo "  ‚ùå Cannot get Secrets"
    kubectl auth can-i list secrets -n $NAMESPACE && echo "  ‚úÖ Can list Secrets" || echo "  ‚ùå Cannot list Secrets"
    kubectl auth can-i create secrets -n $NAMESPACE && echo "  ‚úÖ Can create Secrets" || echo "  ‚ùå Cannot create Secrets"
    kubectl auth can-i update secrets -n $NAMESPACE && echo "  ‚úÖ Can update Secrets" || echo "  ‚ùå Cannot update Secrets"
    kubectl auth can-i delete secrets -n $NAMESPACE && echo "  ‚úÖ Can delete Secrets" || echo "  ‚ùå Cannot delete Secrets"
    echo
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Å—ã–ª–æ–∫ –≤ Pod'–∞—Ö
check_pod_references() {
    echo "=== Pod Reference Validation ==="
    
    if [ -n "$POD_NAME" ]; then
        pods=($POD_NAME)
    else
        pods=($(kubectl get pods -n $NAMESPACE -o jsonpath='{.items[*].metadata.name}' 2>/dev/null))
    fi
    
    for pod in "${pods[@]}"; do
        if [ -z "$pod" ]; then
            echo "No pods found"
            continue
        fi
        
        echo "Checking references in pod: $pod"
        echo "----------------------------------------"
        
        # –ü–æ–ª—É—á–∏—Ç—å YAML Pod'–∞
        pod_yaml=$(kubectl get pod $pod -n $NAMESPACE -o yaml 2>/dev/null)
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ ConfigMaps –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
        echo "ConfigMap references in environment variables:"
        echo "$pod_yaml" | grep -A 5 "configMapKeyRef" | while read line; do
            if [[ "$line" == *"name:"* ]]; then
                cm_name=$(echo "$line" | awk '{print $2}')
                kubectl get configmap $cm_name -n $NAMESPACE >/dev/null 2>&1
                if [ $? -eq 0 ]; then
                    echo "  ‚úÖ ConfigMap '$cm_name' exists"
                else
                    echo "  ‚ùå ConfigMap '$cm_name' NOT FOUND"
                fi
            fi
        done
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ Secrets –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
        echo "Secret references in environment variables:"
        echo "$pod_yaml" | grep -A 5 "secretKeyRef" | while read line; do
            if [[ "$line" == *"name:"* ]]; then
                secret_name=$(echo "$line" | awk '{print $2}')
                kubectl get secret $secret_name -n $NAMESPACE >/dev/null 2>&1
                if [ $? -eq 0 ]; then
                    echo "  ‚úÖ Secret '$secret_name' exists"
                else
                    echo "  ‚ùå Secret '$secret_name' NOT FOUND"
                fi
            fi
        done
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Å—ã–ª–∫–∏ –≤ volumes
        echo "ConfigMap/Secret references in volumes:"
        echo "$pod_yaml" | grep -A 3 -B 1 "configMap:\|secret:" | while read line; do
            if [[ "$line" == *"name:"* ]] && [[ "$line" != *"volume"* ]]; then
                resource_name=$(echo "$line" | awk '{print $2}')
                # –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∫–∞–∫ ConfigMap
                kubectl get configmap $resource_name -n $NAMESPACE >/dev/null 2>&1
                if [ $? -eq 0 ]; then
                    echo "  ‚úÖ ConfigMap '$resource_name' exists"
                else
                    # –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∫–∞–∫ Secret
                    kubectl get secret $resource_name -n $NAMESPACE >/dev/null 2>&1
                    if [ $? -eq 0 ]; then
                        echo "  ‚úÖ Secret '$resource_name' exists"
                    else
                        echo "  ‚ùå Resource '$resource_name' NOT FOUND"
                    fi
                fi
            fi
        done
        
        echo "=========================================="
        echo
    done
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
check_mount_issues() {
    echo "=== Mount Issues Check ==="
    
    if [ -n "$POD_NAME" ]; then
        pods=($POD_NAME)
    else
        pods=($(kubectl get pods -n $NAMESPACE -o jsonpath='{.items[*].metadata.name}' 2>/dev/null))
    fi
    
    for pod in "${pods[@]}"; do
        if [ -z "$pod" ]; then
            echo "No pods found"
            continue
        fi
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ Pod –∑–∞–ø—É—â–µ–Ω
        status=$(kubectl get pod $pod -n $NAMESPACE -o jsonpath='{.status.phase}' 2>/dev/null)
        if [ "$status" != "Running" ]; then
            echo "Pod $pod is not running (status: $status), skipping mount check"
            continue
        fi
        
        echo "Checking mounts in pod: $pod"
        echo "----------------------------------------"
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
        echo "Mounted ConfigMap files:"
        kubectl exec $pod -n $NAMESPACE -- find /etc -name "*" -type f 2>/dev/null | grep -E "(config|app)" | while read file; do
            echo "  File: $file"
            size=$(kubectl exec $pod -n $NAMESPACE -- stat -c%s "$file" 2>/dev/null)
            echo "    Size: $size bytes"
            if [ "$size" -eq 0 ]; then
                echo "    ‚ö†Ô∏è  WARNING: Empty file"
            fi
        done
        
        echo "Mounted Secret files:"
        kubectl exec $pod -n $NAMESPACE -- find /etc -name "*" -type f 2>/dev/null | grep -E "(secret|cred)" | while read file; do
            echo "  File: $file"
            size=$(kubectl exec $pod -n $NAMESPACE -- stat -c%s "$file" 2>/dev/null)
            echo "    Size: $size bytes"
            perms=$(kubectl exec $pod -n $NAMESPACE -- stat -c%a "$file" 2>/dev/null)
            echo "    Permissions: $perms"
            if [ "$size" -eq 0 ]; then
                echo "    ‚ö†Ô∏è  WARNING: Empty file"
            fi
        done
        
        echo "=========================================="
        echo
    done
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞ –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö
generate_issue_report() {
    echo "=== Issue Report Summary ==="
    
    # –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
    total_pods=$(kubectl get pods -n $NAMESPACE --no-headers 2>/dev/null | wc -l)
    failed_pods=$(kubectl get pods -n $NAMESPACE --no-headers 2>/dev/null | grep -v "Running\|Completed" | wc -l)
    total_configmaps=$(kubectl get configmaps -n $NAMESPACE --no-headers 2>/dev/null | wc -l)
    total_secrets=$(kubectl get secrets -n $NAMESPACE --no-headers 2>/dev/null | grep -v default-token | wc -l)
    
    echo "Resource Summary:"
    echo "  Total Pods: $total_pods"
    echo "  Failed Pods: $failed_pods"
    echo "  Total ConfigMaps: $total_configmaps"
    echo "  Total Secrets: $total_secrets"
    echo
    
    if [ $failed_pods -gt 0 ]; then
        echo "‚ùå Issues detected:"
        echo "  - $failed_pods pod(s) are not in Running state"
        echo "  - Check pod events and logs for details"
        echo "  - Verify ConfigMap/Secret references"
    else
        echo "‚úÖ No obvious issues detected"
    fi
    echo
    
    echo "Recommended troubleshooting steps:"
    echo "1. Check pod events: kubectl describe pod <pod-name> -n $NAMESPACE"
    echo "2. Check pod logs: kubectl logs <pod-name> -n $NAMESPACE"
    echo "3. Verify resource existence: kubectl get configmaps,secrets -n $NAMESPACE"
    echo "4. Check RBAC permissions: kubectl auth can-i <verb> <resource> -n $NAMESPACE"
    echo "5. Validate resource content and references"
    echo
}

# –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
main() {
    case "$3" in
        "existence")
            check_resource_existence
            ;;
        "pods")
            analyze_pod_issues
            ;;
        "content")
            validate_configmap_content
            validate_secret_content
            ;;
        "rbac")
            check_rbac_permissions
            ;;
        "references")
            check_pod_references
            ;;
        "mounts")
            check_mount_issues
            ;;
        "report")
            generate_issue_report
            ;;
        "all"|"")
            check_resource_existence
            analyze_pod_issues
            validate_configmap_content
            validate_secret_content
            check_rbac_permissions
            check_pod_references
            check_mount_issues
            generate_issue_report
            ;;
        *)
            echo "Usage: $0 [namespace] [pod_name] [check_type]"
            echo ""
            echo "Check types:"
            echo "  existence  - Check if resources exist"
            echo "  pods       - Analyze pod configuration issues"
            echo "  content    - Validate ConfigMap/Secret content"
            echo "  rbac       - Check RBAC permissions"
            echo "  references - Validate pod references to ConfigMaps/Secrets"
            echo "  mounts     - Check mount issues"
            echo "  report     - Generate summary report"
            echo "  all        - Run all checks (default)"
            echo ""
            echo "Examples:"
            echo "  $0 troubleshooting-demo"
            echo "  $0 troubleshooting-demo problematic-pod"
            echo "  $0 troubleshooting-demo problematic-pod content"
            ;;
    esac
}

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
main "$@"

EOF

chmod +x troubleshoot-config.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
./troubleshoot-config.sh troubleshooting-demo
```

### **3. –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º
cat << 'EOF' > fix-config-issues.sh
#!/bin/bash

NAMESPACE=${1:-"troubleshooting-demo"}

echo "=== ConfigMap and Secret Issue Fixer ==="
echo "Namespace: $NAMESPACE"
echo

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
fix_empty_values() {
    echo "=== Fixing Empty Values ==="
    
    # –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—É—Å—Ç–æ–π –ø–∞—Ä–æ–ª—å –≤ Secret
    echo "Fixing empty password in problematic-secret..."
    kubectl patch secret problematic-secret -n $NAMESPACE --type merge -p='{"data":{"database.password":"'$(echo -n "secure_password_123" | base64)'"}}'
    
    # –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—É—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ ConfigMap
    echo "Fixing empty value in problematic-config..."
    kubectl patch configmap problematic-config -n $NAMESPACE --type merge -p='{"data":{"empty.value":"default_value"}}'
    
    echo "‚úÖ Empty values fixed"
    echo
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è JSON
fix_invalid_json() {
    echo "=== Fixing Invalid JSON ==="
    
    # –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON
    valid_json='{"key": "value", "missing": "fixed_value"}'
    kubectl patch configmap problematic-config -n $NAMESPACE --type merge -p="{\"data\":{\"invalid.json\":\"$valid_json\"}}"
    
    echo "‚úÖ Invalid JSON fixed"
    echo
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
create_missing_resources() {
    echo "=== Creating Missing Resources ==="
    
    # –°–æ–∑–¥–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–π ConfigMap
    kubectl create configmap missing-configmap \
        --from-literal=app.name="Missing ConfigMap Fixed" \
        --from-literal=app.version="1.0.0" \
        --from-literal=status="created" \
        -n $NAMESPACE
    
    # –°–æ–∑–¥–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–π ConfigMap –¥–ª—è environment variables
    kubectl create configmap non-existent-config \
        --from-literal=some.key="fixed_value" \
        --from-literal=app.status="working" \
        -n $NAMESPACE
    
    # –°–æ–∑–¥–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–π Secret
    kubectl create secret generic non-existent-secret \
        --from-literal=some.key="secret_value" \
        --from-literal=api.token="fixed_token_123" \
        -n $NAMESPACE
    
    echo "‚úÖ Missing resources created"
    echo
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –∫–ª—é—á–µ–π
add_missing_keys() {
    echo "=== Adding Missing Keys ==="
    
    # –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–π –∫–ª—é—á –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π ConfigMap
    kubectl patch configmap problematic-config -n $NAMESPACE --type merge -p='{"data":{"non.existent.key":"added_value"}}'
    
    echo "‚úÖ Missing keys added"
    echo
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è base64 –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
fix_base64_encoding() {
    echo "=== Fixing Base64 Encoding ==="
    
    # –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    correct_value=$(echo -n "properly-encoded-value" | base64)
    kubectl patch secret problematic-secret -n $NAMESPACE --type merge -p="{\"data\":{\"malformed.base64\":\"$correct_value\"}}"
    
    echo "‚úÖ Base64 encoding fixed"
    echo
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ Pod'–∞
create_fixed_pod() {
    echo "=== Creating Fixed Pod ==="
    
    # –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–π Pod
    kubectl delete pod problematic-pod -n $NAMESPACE --ignore-not-found=true
    
    # –°–æ–∑–¥–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π Pod
    cat << 'POD_EOF' | kubectl apply -f -
apiVersion: v1
kind: Pod
metadata:
  name: fixed-pod
  namespace: troubleshooting-demo
  labels:
    app: troubleshooting-demo
    status: fixed
spec:
  containers:
  - name: app
    image: nginx:1.21
    ports:
    - containerPort: 80
    env:
    # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ ConfigMaps
    - name: APP_NAME
      valueFrom:
        configMapKeyRef:
          name: problematic-config
          key: app.name
    - name: APP_VERSION
      valueFrom:
        configMapKeyRef:
          name: problematic-config
          key: app.version
    - name: FIXED_CONFIG
      valueFrom:
        configMapKeyRef:
          name: non-existent-config
          key: some.key
    - name: FIXED_KEY
      valueFrom:
        configMapKeyRef:
          name: problematic-config
          key: non.existent.key
    # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ Secrets
    - name: DATABASE_USERNAME
      valueFrom:
        secretKeyRef:
          name: problematic-secret
          key: database.username
    - name: DATABASE_PASSWORD
      valueFrom:
        secretKeyRef:
          name: problematic-secret
          key: database.password
    - name: FIXED_SECRET
      valueFrom:
        secretKeyRef:
          name: non-existent-secret
          key: some.key
    volumeMounts:
    - name: config-volume
      mountPath: /etc/config
      readOnly: true
    - name: secret-volume
      mountPath: /etc/secrets
      readOnly: true
    - name: fixed-volume
      mountPath: /etc/fixed
      readOnly: true
    command: ["sh", "-c"]
    args:
    - |
      # –°–æ–∑–¥–∞—Ç—å HTML —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö
      cat > /usr/share/nginx/html/index.html << 'HTML_EOF'
      <!DOCTYPE html>
      <html>
      <head>
          <title>HashFoundry - Fixed Configuration Demo</title>
          <style>
              body { font-family: Arial, sans-serif; margin: 40px; background: #f8f9fa; }
              .container { max-width: 1000px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
              .header { background: #28a745; color: white; padding: 20px; border-radius: 5px; margin-bottom: 30px; }
              .section { background: #e9ecef; padding: 20px; border-radius: 5px; margin: 20px 0; }
              .fixed-badge { background: #28a745; color: white; padding: 5px 10px; border-radius: 3px; font-size: 12px; font-weight: bold; }
              .config-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
              .config-item { background: white; padding: 15px; border-radius: 5px; border-left: 4px solid #28a745; }
              .issue-item { background: #fff3cd; padding: 15px; border-radius: 5px; border-left: 4px solid #ffc107; }
              .fix-item { background: #d1ecf1; padding: 15px; border-radius: 5px; border-left: 4px solid #17a2b8; }
          </style>
      </head>
      <body>
          <div class="container">
              <div class="header">
                  <h1>‚úÖ HashFoundry - Configuration Issues Fixed</h1>
                  <p>Demonstrating resolved ConfigMap and Secret issues</p>
                  <span class="fixed-badge">FIXED</span>
              </div>
              
              <div class="section">
                  <h2>üîß Environment Variables (Fixed)</h2>
                  <div class="config-grid">
                      <div class="config-item">
                          <strong>App Name:</strong> $APP_NAME
                      </div>
                      <div class="config-item">
                          <strong>App Version:</strong> $APP_VERSION
                      </div>
                      <div class="fix-item">
                          <strong>Fixed Config:</strong> $FIXED_CONFIG
                      </div>
                      <div class="fix-item">
                          <strong>Fixed Key:</strong> $FIXED_KEY
                      </div>
                      <div class="config-item">
                          <strong>Database User:</strong> $DATABASE_USERNAME
                      </div>
                      <div class="fix-item">
                          <strong>Fixed Secret:</strong> $FIXED_SECRET
                      </div>
                  </div>
              </div>
              
              <div class="section">
                  <h2>üìÅ Mounted Files Status</h2>
                  <div class="config-grid">
                      <div class="config-item">
                          <strong>Config Files:</strong><br>
                          <pre>$(ls -la /etc/config/ 2>/dev/null | head -5 || echo 'No files')</pre>
                      </div>
                      <div class="config-item">
                          <strong>Secret Files:</strong><br>
                          <pre>$(ls -la /etc/secrets/ 2>/dev/null | head -5 || echo 'No files')</pre>
                      </div>
                      <div class="fix-item">
                          <strong>Fixed Files:</strong><br>
                          <pre>$(ls -la /etc/fixed/ 2>/dev/null | head -5 || echo 'No files')</pre>
                      </div>
                  </div>
              </div>
              
              <div class="section">
                  <h2>‚úÖ Issues Resolved</h2>
                  <div class="config-grid">
                      <div class="fix-item">
                          <strong>Empty Values:</strong> Fixed empty password and config values
                      </div>
                      <div class="fix-item">
                          <strong>Missing Resources:</strong> Created missing ConfigMaps and Secrets
                      </div>
                      <div class="fix-item">
                          <strong>Missing Keys:</strong> Added missing configuration keys
                      </div>
                      <div class="fix-item">
                          <strong>Invalid JSON:</strong> Fixed malformed JSON configuration
                      </div>
                      <div class="fix-item">
                          <strong>Base64 Encoding:</strong> Corrected invalid base64 values
                      </div>
                      <div class="fix-item">
                          <strong>Pod References:</strong> All references now point to existing resources
                      </div>
                  </div>
              </div>
              
              <div class="section">
                  <p><strong>Pod Status:</strong> Running and healthy</p>
                  <p><strong>Last Updated:</strong> $(date)</p>
                  <p><em>All configuration issues have been resolved successfully!</em></p>
              </div>
          </div>
      </body>
      </html>
      HTML_EOF
      
      nginx -g 'daemon off;'
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "256Mi"
        cpu: "200m"
  volumes:
  - name: config-volume
    configMap:
      name: problematic-config
  - name: secret-volume
    secret:
      secretName: problematic-secret
  - name: fixed-volume
    configMap:
      name: missing-configmap
POD_EOF
    
    echo "‚úÖ Fixed pod created"
    echo
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
verify_fixes() {
    echo "=== Verifying Fixes ==="
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å Pod'–∞
    echo "Checking fixed pod status..."
    kubectl get pod fixed-pod -n $NAMESPACE 2>/dev/null && echo "‚úÖ Fixed pod exists" || echo "‚ùå Fixed pod not found"
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
    echo "Checking created resources..."
    kubectl get configmap missing-configmap -n $NAMESPACE >/dev/null 2>&1 && echo "‚úÖ missing-configmap created" || echo "‚ùå missing-configmap not found"
    kubectl get configmap non-existent-config -n $NAMESPACE >/dev/null 2>&1 && echo "‚úÖ non-existent-config created" || echo "‚ùå non-existent-config not found"
    kubectl get secret non-existent-secret -n $NAMESPACE >/dev/null 2>&1 && echo "‚úÖ non-existent-secret created" || echo "‚ùå non-existent-secret not found"
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    echo "Checking fixed values..."
    password=$(kubectl get secret problematic-secret -n $NAMESPACE -o jsonpath='{.data.database\.password}' | base64 --decode 2>/dev/null)
    if [ -n "$password" ]; then
        echo "‚úÖ Database password fixed (length: ${#password})"
    else
        echo "‚ùå Database password still empty"
    fi
    
    empty_value=$(kubectl get configmap problematic-config -n $NAMESPACE -o jsonpath='{.data.empty\.value}' 2>/dev/null)
    if [ -n "$empty_value" ]; then
        echo "‚úÖ Empty value fixed: $empty_value"
    else
        echo "‚ùå Empty value still empty"
    fi
    
    echo
}

# –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
main() {
    case "$2" in
        "empty")
            fix_empty_values
            ;;
        "json")
            fix_invalid_json
            ;;
        "missing")
            create_missing_resources
            ;;
        "keys")
            add_missing_keys
            ;;
        "base64")
            fix_base64_encoding
            ;;
        "pod")
            create_fixed_pod
            ;;
        "verify")
            verify_fixes
            ;;
        "all"|"")
            fix_empty_values
            fix_invalid_json
            create_missing_resources
            add_missing_keys
            fix_base64_encoding
            create_fixed_pod
            verify_fixes
            ;;
        *)
            echo "Usage: $0 [namespace] [fix_type]"
            echo ""
            echo "Fix types:"
            echo "  empty   - Fix empty values in ConfigMaps and Secrets"
            echo "  json    - Fix invalid JSON in ConfigMaps"
            echo "  missing - Create missing ConfigMaps and Secrets"
            echo "  keys    - Add missing keys to existing resources"
            echo "  base64  - Fix invalid base64 encoding in Secrets"
            echo "  pod     - Create fixed pod with correct references"
            echo "  verify  - Verify that fixes were applied correctly"
            echo "  all     - Apply all fixes (default)"
            echo ""
            echo "Examples:"
            echo "  $0 troubleshooting-demo"
            echo "  $0 troubleshooting-demo empty"
            echo "  $0 troubleshooting-demo verify"
            ;;
    esac
}

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
main "$@"

EOF

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
./fix-config-issues.sh troubleshooting-demo
```

### **4. –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ ConfigMaps –∏ Secrets
cat << 'EOF' > monitor-config-health.sh
#!/bin/bash

NAMESPACE=${1:-"troubleshooting-demo"}
INTERVAL=${2:-30}

echo "=== ConfigMap and Secret Health Monitor ==="
echo "Namespace: $NAMESPACE"
echo "Check interval: $INTERVAL seconds"
echo "Press Ctrl+C to stop monitoring"
echo

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è —Ä–µ—Å—É—Ä—Å–æ–≤
check_health() {
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    echo "[$timestamp] Health Check"
    echo "----------------------------------------"
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ConfigMaps
    local cm_count=$(kubectl get configmaps -n $NAMESPACE --no-headers 2>/dev/null | wc -l)
    echo "ConfigMaps: $cm_count found"
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Secrets
    local secret_count=$(kubectl get secrets -n $NAMESPACE --no-headers 2>/dev/null | grep -v default-token | wc -l)
    echo "Secrets: $secret_count found"
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Pod'—ã
    local total_pods=$(kubectl get pods -n $NAMESPACE --no-headers 2>/dev/null | wc -l)
    local running_pods=$(kubectl get pods -n $NAMESPACE --no-headers 2>/dev/null | grep "Running" | wc -l)
    local failed_pods=$(kubectl get pods -n $NAMESPACE --no-headers 2>/dev/null | grep -E "Error|CrashLoopBackOff|ImagePullBackOff" | wc -l)
    
    echo "Pods: $running_pods/$total_pods running, $failed_pods failed"
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–±—ã—Ç–∏—è
    local recent_events=$(kubectl get events -n $NAMESPACE --sort-by='.lastTimestamp' 2>/dev/null | tail -5 | grep -E "Warning|Error" | wc -l)
    echo "Recent warnings/errors: $recent_events"
    
    # –°—Ç–∞—Ç—É—Å –∑–¥–æ—Ä–æ–≤—å—è
    if [ $failed_pods -eq 0 ] && [ $recent_events -eq 0 ]; then
        echo "Status: ‚úÖ HEALTHY"
    elif [ $failed_pods -gt 0 ]; then
        echo "Status: ‚ùå UNHEALTHY (Failed pods detected)"
    else
        echo "Status: ‚ö†Ô∏è  WARNING (Recent errors detected)"
    fi
    
    echo "=========================================="
    echo
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
continuous_monitoring() {
    while true; do
        check_health
        sleep $INTERVAL
    done
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞
generate_health_report() {
    local timestamp=$(date '+%Y-%m-%d_%H-%M-%S')
    local report_file="config_health_report_${timestamp}.txt"
    
    echo "Generating health report: $report_file"
    
    {
        echo "=== ConfigMap and Secret Health Report ==="
        echo "Generated: $(date)"
        echo "Namespace: $NAMESPACE"
        echo
        
        echo "=== Resource Summary ==="
        kubectl get configmaps,secrets,pods -n $NAMESPACE
        echo
        
        echo "=== Recent Events ==="
        kubectl get events -n $NAMESPACE --sort-by='.lastTimestamp' | tail -20
        echo
        
        echo "=== Pod Details ==="
        kubectl get pods -n $NAMESPACE -o wide
        echo
        
        echo "=== ConfigMap Details ==="
        for cm in $(kubectl get configmaps -n $NAMESPACE -o jsonpath='{.items[*].metadata.name}'); do
            echo "ConfigMap: $cm"
            kubectl describe configmap $cm -n $NAMESPACE | head -20
            echo "---"
        done
        echo
        
        echo "=== Secret Details ==="
        for secret in $(kubectl get secrets -n $NAMESPACE -o jsonpath='{.items[*].metadata.name}' | grep -v default-token); do
            echo "Secret: $secret"
            kubectl describe secret $secret -n $NAMESPACE | head -15
            echo "---"
        done
        
    } > $report_file
    
    echo "Report saved to: $report_file"
}

# –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
case "$3" in
    "once")
        check_health
        ;;
    "report")
        generate_health_report
        ;;
    "monitor"|"")
        continuous_monitoring
        ;;
    *)
        echo "Usage: $0 [namespace] [interval] [mode]"
        echo ""
        echo "Modes:"
        echo "  once    - Run health check once"
        echo "  monitor - Continuous monitoring (default)"
        echo "  report  - Generate detailed health report"
        echo ""
        echo "Examples:"
        echo "  $0 troubleshooting-demo 30 monitor"
        echo "  $0 troubleshooting-demo 0 once"
        echo "  $0 troubleshooting-demo 0 report"
        ;;
esac

EOF

chmod +x monitor-config-health.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É
./monitor-config-health.sh troubleshooting-demo 0 once
```

## üßπ **–û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
cat << 'EOF' > cleanup-troubleshooting-demo.sh
#!/bin/bash

NAMESPACE="troubleshooting-demo"

echo "=== Cleaning up Troubleshooting Demo ==="
echo

# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ Pod'—ã
echo "Deleting pods..."
kubectl delete pods --all -n $NAMESPACE

# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ ConfigMaps
echo "Deleting ConfigMaps..."
kubectl delete configmaps --all -n $NAMESPACE

# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ Secrets (–∫—Ä–æ–º–µ default)
echo "Deleting Secrets..."
kubectl delete secrets --all -n $NAMESPACE --field-selector type!=kubernetes.io/service-account-token

# –£–¥–∞–ª–∏—Ç—å namespace
echo "Deleting namespace..."
kubectl delete namespace $NAMESPACE

# –£–¥–∞–ª–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
echo "Cleaning up local files..."
rm -f troubleshoot-config.sh
rm -f fix-config-issues.sh
rm -f monitor-config-health.sh
rm -f config_health_report_*.txt

echo "‚úì Cleanup completed"

EOF

chmod +x cleanup-troubleshooting-demo.sh
./cleanup-troubleshooting-demo.sh
```

## üìã **–°–≤–æ–¥–∫–∞ troubleshooting –º–µ—Ç–æ–¥–æ–≤:**

### **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
kubectl get configmaps,secrets -n <namespace>

# –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ—Å—É—Ä—Å–µ
kubectl describe configmap <name> -n <namespace>
kubectl describe secret <name> -n <namespace>

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
kubectl get configmap <name> -o yaml -n <namespace>
kubectl get secret <name> -o yaml -n <namespace>

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±—ã—Ç–∏–π
kubectl get events -n <namespace> --sort-by='.lastTimestamp'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Pod'–æ–≤ —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏
kubectl describe pod <name> -n <namespace>
kubectl logs <pod-name> -n <namespace>

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
kubectl auth can-i get configmaps -n <namespace>
kubectl auth can-i get secrets -n <namespace>
```

## üìä **–¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è:**

| **–ü—Ä–æ–±–ª–µ–º–∞** | **–°–∏–º–ø—Ç–æ–º—ã** | **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** | **–†–µ—à–µ–Ω–∏–µ** |
|--------------|--------------|-----------------|-------------|
| **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π —Ä–µ—Å—É—Ä—Å** | Pod –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è | `kubectl describe pod` | –°–æ–∑–¥–∞—Ç—å ConfigMap/Secret |
| **–ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á** | –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—É—Å—Ç–∞ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–ª—é—á–∏ –≤ —Ä–µ—Å—É—Ä—Å–µ | –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–π –∫–ª—é—á |
| **–ü—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è** | –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ | –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è |
| **–ù–µ–≤–µ—Ä–Ω—ã–π base64** | Secret –Ω–µ –¥–µ–∫–æ–¥–∏—Ä—É–µ—Ç—Å—è | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥–∏—Ä–æ–≤–∫—É | –ü–µ—Ä–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è |
| **–ü—Ä–æ–±–ª–µ–º—ã –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** | –§–∞–π–ª—ã –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ Pod | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å volume mounts | –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—É—Ç–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è |
| **RBAC –ø—Ä–æ–±–ª–µ–º—ã** | –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω | `kubectl auth can-i` | –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ |

## üéØ **Best Practices –¥–ª—è troubleshooting:**

### **1. –°–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥:**
- **–ù–∞—á–∏–Ω–∞–π—Ç–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è** —Ä–µ—Å—É—Ä—Å–æ–≤
- **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–æ–±—ã—Ç–∏—è Pod'–æ–≤** –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- **–í–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ** ConfigMaps –∏ Secrets
- **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å—Å—ã–ª–∫–∏** –≤ Pod'–∞—Ö –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å

### **2. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:**
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ kubectl describe** –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ Pod'–æ–≤** –¥–ª—è –æ—à–∏–±–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ —Å–æ–±—ã—Ç–∏—è** –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫–∏** —Å –ø–æ–º–æ—â—å—é —Å–∫—Ä–∏–ø—Ç–æ–≤

### **3. –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º:**
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
- **–ü—Ä–∏–º–µ–Ω—è–π—Ç–µ naming conventions** –¥–ª—è —Ä–µ—Å—É—Ä—Å–æ–≤
- **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** –º–µ–∂–¥—É —Ä–µ—Å—É—Ä—Å–∞–º–∏
- **–†–µ–≥—É–ª—è—Ä–Ω–æ –∞—É–¥–∏—Ä—É–π—Ç–µ** –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### **4. –ë—ã—Å—Ç—Ä–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:**
- **–ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ backup** –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–π—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è** —Ç–∏–ø–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –æ—Ç–∫–∞—Ç–∞
- **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∑–¥–æ—Ä–æ–≤—å–µ** —Ä–µ—Å—É—Ä—Å–æ–≤

**–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π troubleshooting ConfigMaps –∏ Secrets —Ç—Ä–µ–±—É–µ—Ç —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞, –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ç–∏–ø–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º!**
