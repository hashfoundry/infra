# Storage Configuration Explanation

## üéØ **–í–æ–ø—Ä–æ—Å –æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Persistent Volume**

–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ storage –¥–ª—è Prometheus:

```yaml
persistentVolume:
  enabled: true
  size: 20Gi
  storageClass: "do-block-storage"
  accessModes:
    - ReadWriteOnce
```

## üìä **1. –ü–æ—á–µ–º—É do-block-storage –≤–º–µ—Å—Ç–æ nfs-client?**

### **üî¥ –ü—Ä–æ–±–ª–µ–º—ã —Å NFS –¥–ª—è Prometheus:**

#### **1.1 –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- **Prometheus TSDB** —Ç—Ä–µ–±—É–µ—Ç –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ I/O –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤
- **NFS** –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–µ—Ç–µ–≤—É—é –∑–∞–¥–µ—Ä–∂–∫—É –ø—Ä–∏ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–ø–∏—Å–∏/—á—Ç–µ–Ω–∏—è
- **Block Storage** –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –¥–∏—Å–∫—É –±–µ–∑ —Å–µ—Ç–µ–≤—ã—Ö –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤

#### **1.2 –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:**
- **Prometheus** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Write-Ahead Log (WAL)** –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- **NFS** –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å **file locking** –∏ **fsync** –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
- **Block Storage** –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞–ø–∏—Å–∏

#### **1.3 –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (–Ω–∞–±–ª—é–¥–∞–ª–∏—Å—å –≤ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏):**
```
ts=2025-07-16T12:47:19.001Z caller=main.go:1019 level=info msg="Starting TSDB ..."
# –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ Prometheus –∑–∞–≤–∏—Å–∞–ª –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ TSDB
```

- Prometheus –Ω–µ –º–æ–≥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å TSDB –Ω–∞ NFS
- Readiness probe –≤–æ–∑–≤—Ä–∞—â–∞–ª 503 Service Unavailable
- –ü–æ–¥ –æ—Å—Ç–∞–≤–∞–ª—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ 1/2 Running

#### **1.4 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è:**
- **Prometheus** - —ç—Ç–æ **single-writer** —Å–∏—Å—Ç–µ–º–∞ (—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä –ø–∏—à–µ—Ç –≤ TSDB)
- **NFS** –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è **multi-reader/multi-writer** —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- **Block Storage** –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è **single-writer** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

### **‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ do-block-storage:**

#### **1.5 –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- **–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø** –∫ SSD –¥–∏—Å–∫–∞–º DigitalOcean
- **–ù–∏–∑–∫–∞—è –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** –æ–ø–µ—Ä–∞—Ü–∏–π I/O
- **–í—ã—Å–æ–∫–∏–π IOPS** –¥–ª—è –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–π –∑–∞–ø–∏—Å–∏ –º–µ—Ç—Ä–∏–∫

#### **1.6 –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** –Ω–∞ —É—Ä–æ–≤–Ω–µ DigitalOcean
- **–†–µ–ø–ª–∏–∫–∞—Ü–∏—è** –¥–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –¥–∞—Ç–∞—Ü–µ–Ω—Ç—Ä–∞
- **Snapshot** –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è backup

#### **1.7 –ü—Ä–æ—Å—Ç–æ—Ç–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** –∫ —É–∑–ª–∞–º
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ provisioning** —á–µ—Ä–µ–∑ CSI driver
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** —Å Kubernetes lifecycle

## üîÑ **2. ReadWriteOnce vs ReadWriteMany**

### **üìñ ReadWriteOnce (RWO):**
```yaml
accessModes:
  - ReadWriteOnce
```

#### **–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- **–û–¥–∏–Ω —É–∑–µ–ª** –º–æ–∂–µ—Ç –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–º –≤ —Ä–µ–∂–∏–º–µ read-write
- **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–¥—ã** –Ω–∞ —Ç–æ–º –∂–µ —É–∑–ª–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–º
- **–î—Ä—É–≥–∏–µ —É–∑–ª—ã** –Ω–µ –º–æ–≥—É—Ç –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–º

#### **–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- **Single-writer** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Prometheus, PostgreSQL, MySQL)
- **Stateful applications** —Å –æ–¥–Ω–∏–º –∞–∫—Ç–∏–≤–Ω—ã–º —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–º
- **–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–µ** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Ç—Ä–µ–±—É—é—â–∏–µ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

### **üìñ ReadWriteMany (RWX):**
```yaml
accessModes:
  - ReadWriteMany
```

#### **–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É–∑–ª—ã** –º–æ–≥—É—Ç –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–º –≤ —Ä–µ–∂–∏–º–µ read-write
- **Concurrent access** –æ—Ç —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥–æ–≤ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É–∑–ª–∞—Ö
- **Shared storage** –º–µ–∂–¥—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏

#### **–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- **Shared file systems** (–ª–æ–≥–∏, —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã)
- **Multi-writer** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **Content management** —Å–∏—Å—Ç–µ–º—ã

### **üéØ –ü–æ—á–µ–º—É ReadWriteOnce –¥–ª—è Prometheus?**

#### **2.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Prometheus:**
- **Single TSDB instance** - —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä Prometheus –ø–∏—à–µ—Ç –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- **No clustering** –Ω–∞ —É—Ä–æ–≤–Ω–µ storage - Prometheus –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç shared storage
- **Leader election** –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è storage

#### **2.2 Performance considerations:**
- **Exclusive access** –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **No file locking overhead** –º–µ–∂–¥—É —É–∑–ª–∞–º–∏
- **Optimal caching** –Ω–∞ —É—Ä–æ–≤–Ω–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

#### **2.3 Data integrity:**
- **Single writer** –∏—Å–∫–ª—é—á–∞–µ—Ç race conditions
- **Consistent WAL** –æ–ø–µ—Ä–∞—Ü–∏–∏
- **Atomic commits** –≤ TSDB

## üìä **3. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ Storage Classes**

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | do-block-storage | nfs-client |
|----------------|------------------|------------|
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê –í—ã—Å–æ–∫–∞—è | ‚≠ê‚≠ê‚≠ê –°—Ä–µ–¥–Ω—è—è |
| **–õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê –ù–∏–∑–∫–∞—è | ‚≠ê‚≠ê –í—ã—Å–æ–∫–∞—è |
| **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê –û—Ç–ª–∏—á–Ω–∞—è | ‚≠ê‚≠ê‚≠ê –•–æ—Ä–æ—à–∞—è |
| **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê –í—ã—Å–æ–∫–∞—è |
| **–°—Ç–æ–∏–º–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê –°—Ä–µ–¥–Ω—è—è | ‚≠ê‚≠ê‚≠ê‚≠ê –ù–∏–∑–∫–∞—è |
| **Backup** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π | ‚≠ê‚≠ê‚≠ê –†—É—á–Ω–æ–π |

## üîß **4. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**

### **4.1 –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å do-block-storage:**
- **Databases** (PostgreSQL, MySQL, MongoDB)
- **Time-series databases** (Prometheus, InfluxDB)
- **Single-writer applications**
- **High-performance workloads**

### **4.2 –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å nfs-client:**
- **Shared configuration files**
- **Static content** (images, documents)
- **Log aggregation** (multiple writers)
- **Development environments**

### **4.3 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤:**

#### **Prometheus (—Ç–µ–∫—É—â–∞—è):**
```yaml
storageClass: "do-block-storage"
accessModes: [ReadWriteOnce]
size: 20Gi
```

#### **Shared logs:**
```yaml
storageClass: "nfs-client"
accessModes: [ReadWriteMany]
size: 10Gi
```

#### **Database:**
```yaml
storageClass: "do-block-storage"
accessModes: [ReadWriteOnce]
size: 100Gi
```

## üí° **5. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è**

### **5.1 –î–ª—è –≤—ã—Å–æ–∫–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Prometheus:**
- **Prometheus Federation** - –∏–µ—Ä–∞—Ä—Ö–∏—è —Å–µ—Ä–≤–µ—Ä–æ–≤
- **Thanos** - –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- **Cortex** - –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–π Prometheus

### **5.2 –î–ª—è shared storage:**
- **ReadWriteMany** —Å NFS –¥–ª—è –ª–æ–≥–æ–≤
- **Object Storage** (S3) –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è
- **Distributed file systems** (CephFS, GlusterFS)

## üéâ **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ**

### **‚úÖ –í—ã–±–æ—Ä do-block-storage + ReadWriteOnce –æ–ø—Ç–∏–º–∞–ª–µ–Ω –¥–ª—è Prometheus –ø–æ—Ç–æ–º—É —á—Ç–æ:**

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å I/O –¥–ª—è TSDB –æ–ø–µ—Ä–∞—Ü–∏–π
2. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
3. **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –ù–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å distributed locking
4. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è single-writer –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã Prometheus
5. **–ü—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å**: –†–µ—à–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, –Ω–∞–±–ª—é–¥–∞–≤—à–∏–µ—Å—è —Å NFS

### **üîÑ –ö–æ–≥–¥–∞ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—ã–±–æ—Ä:**
- –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ **Thanos** –∏–ª–∏ **Cortex** (–º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è object storage)
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ **shared access** –∫ –º–µ—Ç—Ä–∏–∫–∞–º
- –ü—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ **cloud-native** —Ä–µ—à–µ–Ω–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –¥–ª—è Prometheus –≤ HA –∫–ª–∞—Å—Ç–µ—Ä–µ!**
